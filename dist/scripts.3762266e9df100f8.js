(function(ee){"object"==typeof exports&&typeof module<"u"?module.exports=ee():"function"==typeof define&&define.amd?define([],ee):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).AFRAME=ee()})(function(){return function h(C,m,s){function c(d,A){if(!m[d]){if(!C[d]){var E="function"==typeof require&&require;if(!A&&E)return E(d,!0);if(u)return u(d,!0);var g=new Error("Cannot find module '"+d+"'");throw g.code="MODULE_NOT_FOUND",g}var v=m[d]={exports:{}};C[d][0].call(v.exports,function(T){return c(C[d][1][T]||T)},v,v.exports,h,C,m,s)}return m[d].exports}for(var u="function"==typeof require&&require,p=0;p<s.length;p++)c(s[p]);return c}({1:[function(h,C,m){var s=Object.prototype.toString;C.exports=function c(u){return u.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===s.call(u.buffer)||Array.isArray(u)}},{}],2:[function(h,C,m){C.exports=function(c,u){return"number"==typeof c?c:"number"==typeof u?u:0}},{}],3:[function(h,C,m){"use strict";m.byteLength=function g(O){var D=E(O),H=D[1];return 3*(D[0]+H)/4-H},m.toByteArray=function T(O){for(var D,B=E(O),H=B[0],q=B[1],V=new u(function v(O,D,B){return 3*(D+B)/4-B}(0,H,q)),ne=0,ae=q>0?H-4:H,fe=0;fe<ae;fe+=4)D=c[O.charCodeAt(fe)]<<18|c[O.charCodeAt(fe+1)]<<12|c[O.charCodeAt(fe+2)]<<6|c[O.charCodeAt(fe+3)],V[ne++]=D>>16&255,V[ne++]=D>>8&255,V[ne++]=255&D;return 2===q&&(D=c[O.charCodeAt(fe)]<<2|c[O.charCodeAt(fe+1)]>>4,V[ne++]=255&D),1===q&&(D=c[O.charCodeAt(fe)]<<10|c[O.charCodeAt(fe+1)]<<4|c[O.charCodeAt(fe+2)]>>2,V[ne++]=D>>8&255,V[ne++]=255&D),V},m.fromByteArray=function _(O){for(var D,B=O.length,H=B%3,q=[],V=16383,ne=0,ae=B-H;ne<ae;ne+=V)q.push(M(O,ne,ne+V>ae?ae:ne+V));return 1===H?q.push(s[(D=O[B-1])>>2]+s[D<<4&63]+"=="):2===H&&q.push(s[(D=(O[B-2]<<8)+O[B-1])>>10]+s[D>>4&63]+s[D<<2&63]+"="),q.join("")};for(var s=[],c=[],u=typeof Uint8Array<"u"?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,A=p.length;d<A;++d)s[d]=p[d],c[p.charCodeAt(d)]=d;function E(O){var D=O.length;if(D%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var B=O.indexOf("=");return-1===B&&(B=D),[B,B===D?0:4-B%4]}function y(O){return s[O>>18&63]+s[O>>12&63]+s[O>>6&63]+s[63&O]}function M(O,D,B){for(var q=[],V=D;V<B;V+=3)q.push(y((O[V]<<16&16711680)+(O[V+1]<<8&65280)+(255&O[V+2])));return q.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],4:[function(h,C,m){"use strict";C.exports={createLink:function(s,c){var u=document.head||document.getElementsByTagName("head")[0],p=document.createElement("link");for(var d in p.href=s,p.rel="stylesheet",c)c.hasOwnProperty(d)&&p.setAttribute("data-"+d,c[d]);u.appendChild(p)},createStyle:function(s,c){var u=document.head||document.getElementsByTagName("head")[0],p=document.createElement("style");for(var d in p.type="text/css",c)c.hasOwnProperty(d)&&p.setAttribute("data-"+d,c[d]);p.sheet?(p.innerHTML=s,p.sheet.cssText=s,u.appendChild(p)):p.styleSheet?(u.appendChild(p),p.styleSheet.cssText=s):(p.appendChild(document.createTextNode(s)),u.appendChild(p))}}},{}],5:[function(h,C,m){var s=h("buffer").Buffer;C.exports=function(c,u){if(s.isBuffer(c)&&s.isBuffer(u)){if("function"==typeof c.equals)return c.equals(u);if(c.length!==u.length)return!1;for(var p=0;p<c.length;p++)if(c[p]!==u[p])return!1;return!0}}},{buffer:6}],6:[function(h,C,m){(function(s,v){"use strict";var u=h("base64-js"),p=h("ieee754"),d=h("isarray");function E(){return v.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function g(Ce,ie){if(E()<ie)throw new RangeError("Invalid typed array length");return v.TYPED_ARRAY_SUPPORT?(Ce=new Uint8Array(ie)).__proto__=v.prototype:(null===Ce&&(Ce=new v(ie)),Ce.length=ie),Ce}function v(Ce,ie,le){if(!(v.TYPED_ARRAY_SUPPORT||this instanceof v))return new v(Ce,ie,le);if("number"==typeof Ce){if("string"==typeof ie)throw new Error("If encoding is specified then the first argument must be a string");return _(this,Ce)}return T(this,Ce,ie,le)}function T(Ce,ie,le,Fe){if("number"==typeof ie)throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&ie instanceof ArrayBuffer?function B(Ce,ie,le,Fe){if(le<0||ie.byteLength<le)throw new RangeError("'offset' is out of bounds");if(ie.byteLength<le+(Fe||0))throw new RangeError("'length' is out of bounds");return ie=void 0===le&&void 0===Fe?new Uint8Array(ie):void 0===Fe?new Uint8Array(ie,le):new Uint8Array(ie,le,Fe),v.TYPED_ARRAY_SUPPORT?(Ce=ie).__proto__=v.prototype:Ce=D(Ce,ie),Ce}(Ce,ie,le,Fe):"string"==typeof ie?function O(Ce,ie,le){if(("string"!=typeof le||""===le)&&(le="utf8"),!v.isEncoding(le))throw new TypeError('"encoding" must be a valid string encoding');var Fe=0|ne(ie,le),Ye=(Ce=g(Ce,Fe)).write(ie,le);return Ye!==Fe&&(Ce=Ce.slice(0,Ye)),Ce}(Ce,ie,le):function H(Ce,ie){if(v.isBuffer(ie)){var le=0|q(ie.length);return 0===(Ce=g(Ce,le)).length||ie.copy(Ce,0,0,le),Ce}if(ie){if(typeof ArrayBuffer<"u"&&ie.buffer instanceof ArrayBuffer||"length"in ie)return"number"!=typeof ie.length||function mn(Ce){return Ce!=Ce}(ie.length)?g(Ce,0):D(Ce,ie);if("Buffer"===ie.type&&d(ie.data))return D(Ce,ie.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(Ce,ie)}function y(Ce){if("number"!=typeof Ce)throw new TypeError('"size" argument must be a number');if(Ce<0)throw new RangeError('"size" argument must not be negative')}function _(Ce,ie){if(y(ie),Ce=g(Ce,ie<0?0:0|q(ie)),!v.TYPED_ARRAY_SUPPORT)for(var le=0;le<ie;++le)Ce[le]=0;return Ce}function D(Ce,ie){var le=ie.length<0?0:0|q(ie.length);Ce=g(Ce,le);for(var Fe=0;Fe<le;Fe+=1)Ce[Fe]=255&ie[Fe];return Ce}function q(Ce){if(Ce>=E())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+E().toString(16)+" bytes");return 0|Ce}function ne(Ce,ie){if(v.isBuffer(Ce))return Ce.length;if(typeof ArrayBuffer<"u"&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(Ce)||Ce instanceof ArrayBuffer))return Ce.byteLength;"string"!=typeof Ce&&(Ce=""+Ce);var le=Ce.length;if(0===le)return 0;for(var Fe=!1;;)switch(ie){case"ascii":case"latin1":case"binary":return le;case"utf8":case"utf-8":case void 0:return ht(Ce).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*le;case"hex":return le>>>1;case"base64":return Kt(Ce).length;default:if(Fe)return ht(Ce).length;ie=(""+ie).toLowerCase(),Fe=!0}}function ae(Ce,ie,le){var Fe=!1;if((void 0===ie||ie<0)&&(ie=0),ie>this.length||((void 0===le||le>this.length)&&(le=this.length),le<=0)||(le>>>=0)<=(ie>>>=0))return"";for(Ce||(Ce="utf8");;)switch(Ce){case"hex":return un(this,ie,le);case"utf8":case"utf-8":return ze(this,ie,le);case"ascii":return Tt(this,ie,le);case"latin1":case"binary":return $t(this,ie,le);case"base64":return _e(this,ie,le);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return In(this,ie,le);default:if(Fe)throw new TypeError("Unknown encoding: "+Ce);Ce=(Ce+"").toLowerCase(),Fe=!0}}function fe(Ce,ie,le){var Fe=Ce[ie];Ce[ie]=Ce[le],Ce[le]=Fe}function he(Ce,ie,le,Fe,Ye){if(0===Ce.length)return-1;if("string"==typeof le?(Fe=le,le=0):le>2147483647?le=2147483647:le<-2147483648&&(le=-2147483648),le=+le,isNaN(le)&&(le=Ye?0:Ce.length-1),le<0&&(le=Ce.length+le),le>=Ce.length){if(Ye)return-1;le=Ce.length-1}else if(le<0){if(!Ye)return-1;le=0}if("string"==typeof ie&&(ie=v.from(ie,Fe)),v.isBuffer(ie))return 0===ie.length?-1:me(Ce,ie,le,Fe,Ye);if("number"==typeof ie)return ie&=255,v.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?Ye?Uint8Array.prototype.indexOf.call(Ce,ie,le):Uint8Array.prototype.lastIndexOf.call(Ce,ie,le):me(Ce,[ie],le,Fe,Ye);throw new TypeError("val must be string, number or Buffer")}function me(Ce,ie,le,Fe,Ye){var ot,Pt=1,Me=Ce.length,qe=ie.length;if(void 0!==Fe&&("ucs2"===(Fe=String(Fe).toLowerCase())||"ucs-2"===Fe||"utf16le"===Fe||"utf-16le"===Fe)){if(Ce.length<2||ie.length<2)return-1;Pt=2,Me/=2,qe/=2,le/=2}function at(Zt,Xt){return 1===Pt?Zt[Xt]:Zt.readUInt16BE(Xt*Pt)}if(Ye){var dt=-1;for(ot=le;ot<Me;ot++)if(at(Ce,ot)===at(ie,-1===dt?0:ot-dt)){if(-1===dt&&(dt=ot),ot-dt+1===qe)return dt*Pt}else-1!==dt&&(ot-=ot-dt),dt=-1}else for(le+qe>Me&&(le=Me-qe),ot=le;ot>=0;ot--){for(var St=!0,It=0;It<qe;It++)if(at(Ce,ot+It)!==at(ie,It)){St=!1;break}if(St)return ot}return-1}function P(Ce,ie,le,Fe){le=Number(le)||0;var Ye=Ce.length-le;Fe?(Fe=Number(Fe))>Ye&&(Fe=Ye):Fe=Ye;var Pt=ie.length;if(Pt%2!=0)throw new TypeError("Invalid hex string");Fe>Pt/2&&(Fe=Pt/2);for(var Me=0;Me<Fe;++Me){var qe=parseInt(ie.substr(2*Me,2),16);if(isNaN(qe))return Me;Ce[le+Me]=qe}return Me}function X(Ce,ie,le,Fe){return rn(ht(ie,Ce.length-le),Ce,le,Fe)}function W(Ce,ie,le,Fe){return rn(function _t(Ce){for(var ie=[],le=0;le<Ce.length;++le)ie.push(255&Ce.charCodeAt(le));return ie}(ie),Ce,le,Fe)}function te(Ce,ie,le,Fe){return W(Ce,ie,le,Fe)}function ce(Ce,ie,le,Fe){return rn(Kt(ie),Ce,le,Fe)}function Se(Ce,ie,le,Fe){return rn(function Bt(Ce,ie){for(var le,Fe,Pt=[],Me=0;Me<Ce.length&&!((ie-=2)<0);++Me)Fe=(le=Ce.charCodeAt(Me))>>8,Pt.push(le%256),Pt.push(Fe);return Pt}(ie,Ce.length-le),Ce,le,Fe)}function _e(Ce,ie,le){return u.fromByteArray(0===ie&&le===Ce.length?Ce:Ce.slice(ie,le))}function ze(Ce,ie,le){le=Math.min(Ce.length,le);for(var Fe=[],Ye=ie;Ye<le;){var at,ot,dt,St,Pt=Ce[Ye],Me=null,qe=Pt>239?4:Pt>223?3:Pt>191?2:1;if(Ye+qe<=le)switch(qe){case 1:Pt<128&&(Me=Pt);break;case 2:128==(192&(at=Ce[Ye+1]))&&(St=(31&Pt)<<6|63&at)>127&&(Me=St);break;case 3:ot=Ce[Ye+2],128==(192&(at=Ce[Ye+1]))&&128==(192&ot)&&(St=(15&Pt)<<12|(63&at)<<6|63&ot)>2047&&(St<55296||St>57343)&&(Me=St);break;case 4:ot=Ce[Ye+2],dt=Ce[Ye+3],128==(192&(at=Ce[Ye+1]))&&128==(192&ot)&&128==(192&dt)&&(St=(15&Pt)<<18|(63&at)<<12|(63&ot)<<6|63&dt)>65535&&St<1114112&&(Me=St)}null===Me?(Me=65533,qe=1):Me>65535&&(Fe.push((Me-=65536)>>>10&1023|55296),Me=56320|1023&Me),Fe.push(Me),Ye+=qe}return function gt(Ce){var ie=Ce.length;if(ie<=4096)return String.fromCharCode.apply(String,Ce);for(var le="",Fe=0;Fe<ie;)le+=String.fromCharCode.apply(String,Ce.slice(Fe,Fe+=4096));return le}(Fe)}function Tt(Ce,ie,le){var Fe="";le=Math.min(Ce.length,le);for(var Ye=ie;Ye<le;++Ye)Fe+=String.fromCharCode(127&Ce[Ye]);return Fe}function $t(Ce,ie,le){var Fe="";le=Math.min(Ce.length,le);for(var Ye=ie;Ye<le;++Ye)Fe+=String.fromCharCode(Ce[Ye]);return Fe}function un(Ce,ie,le){var Fe=Ce.length;(!ie||ie<0)&&(ie=0),(!le||le<0||le>Fe)&&(le=Fe);for(var Ye="",Pt=ie;Pt<le;++Pt)Ye+=ut(Ce[Pt]);return Ye}function In(Ce,ie,le){for(var Fe=Ce.slice(ie,le),Ye="",Pt=0;Pt<Fe.length;Pt+=2)Ye+=String.fromCharCode(Fe[Pt]+256*Fe[Pt+1]);return Ye}function sn(Ce,ie,le){if(Ce%1!=0||Ce<0)throw new RangeError("offset is not uint");if(Ce+ie>le)throw new RangeError("Trying to access beyond buffer length")}function tr(Ce,ie,le,Fe,Ye,Pt){if(!v.isBuffer(Ce))throw new TypeError('"buffer" argument must be a Buffer instance');if(ie>Ye||ie<Pt)throw new RangeError('"value" argument is out of bounds');if(le+Fe>Ce.length)throw new RangeError("Index out of range")}function Cr(Ce,ie,le,Fe){ie<0&&(ie=65535+ie+1);for(var Ye=0,Pt=Math.min(Ce.length-le,2);Ye<Pt;++Ye)Ce[le+Ye]=(ie&255<<8*(Fe?Ye:1-Ye))>>>8*(Fe?Ye:1-Ye)}function Un(Ce,ie,le,Fe){ie<0&&(ie=4294967295+ie+1);for(var Ye=0,Pt=Math.min(Ce.length-le,4);Ye<Pt;++Ye)Ce[le+Ye]=ie>>>8*(Fe?Ye:3-Ye)&255}function Re(Ce,ie,le,Fe,Ye,Pt){if(le+Fe>Ce.length)throw new RangeError("Index out of range");if(le<0)throw new RangeError("Index out of range")}function Oe(Ce,ie,le,Fe,Ye){return Ye||Re(Ce,0,le,4),p.write(Ce,ie,le,Fe,23,4),le+4}function $e(Ce,ie,le,Fe,Ye){return Ye||Re(Ce,0,le,8),p.write(Ce,ie,le,Fe,52,8),le+8}m.Buffer=v,m.SlowBuffer=function V(Ce){return+Ce!=Ce&&(Ce=0),v.alloc(+Ce)},m.INSPECT_MAX_BYTES=50,v.TYPED_ARRAY_SUPPORT=void 0!==s.TYPED_ARRAY_SUPPORT?s.TYPED_ARRAY_SUPPORT:function A(){try{var Ce=new Uint8Array(1);return Ce.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===Ce.foo()&&"function"==typeof Ce.subarray&&0===Ce.subarray(1,1).byteLength}catch{return!1}}(),m.kMaxLength=E(),v.poolSize=8192,v._augment=function(Ce){return Ce.__proto__=v.prototype,Ce},v.from=function(Ce,ie,le){return T(null,Ce,ie,le)},v.TYPED_ARRAY_SUPPORT&&(v.prototype.__proto__=Uint8Array.prototype,v.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&v[Symbol.species]===v&&Object.defineProperty(v,Symbol.species,{value:null,configurable:!0})),v.alloc=function(Ce,ie,le){return function M(Ce,ie,le,Fe){return y(ie),ie<=0?g(Ce,ie):void 0!==le?"string"==typeof Fe?g(Ce,ie).fill(le,Fe):g(Ce,ie).fill(le):g(Ce,ie)}(null,Ce,ie,le)},v.allocUnsafe=function(Ce){return _(null,Ce)},v.allocUnsafeSlow=function(Ce){return _(null,Ce)},v.isBuffer=function(ie){return!(null==ie||!ie._isBuffer)},v.compare=function(ie,le){if(!v.isBuffer(ie)||!v.isBuffer(le))throw new TypeError("Arguments must be Buffers");if(ie===le)return 0;for(var Fe=ie.length,Ye=le.length,Pt=0,Me=Math.min(Fe,Ye);Pt<Me;++Pt)if(ie[Pt]!==le[Pt]){Fe=ie[Pt],Ye=le[Pt];break}return Fe<Ye?-1:Ye<Fe?1:0},v.isEncoding=function(ie){switch(String(ie).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},v.concat=function(ie,le){if(!d(ie))throw new TypeError('"list" argument must be an Array of Buffers');if(0===ie.length)return v.alloc(0);var Fe;if(void 0===le)for(le=0,Fe=0;Fe<ie.length;++Fe)le+=ie[Fe].length;var Ye=v.allocUnsafe(le),Pt=0;for(Fe=0;Fe<ie.length;++Fe){var Me=ie[Fe];if(!v.isBuffer(Me))throw new TypeError('"list" argument must be an Array of Buffers');Me.copy(Ye,Pt),Pt+=Me.length}return Ye},v.byteLength=ne,v.prototype._isBuffer=!0,v.prototype.swap16=function(){var ie=this.length;if(ie%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var le=0;le<ie;le+=2)fe(this,le,le+1);return this},v.prototype.swap32=function(){var ie=this.length;if(ie%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var le=0;le<ie;le+=4)fe(this,le,le+3),fe(this,le+1,le+2);return this},v.prototype.swap64=function(){var ie=this.length;if(ie%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var le=0;le<ie;le+=8)fe(this,le,le+7),fe(this,le+1,le+6),fe(this,le+2,le+5),fe(this,le+3,le+4);return this},v.prototype.toString=function(){var ie=0|this.length;return 0===ie?"":0===arguments.length?ze(this,0,ie):ae.apply(this,arguments)},v.prototype.equals=function(ie){if(!v.isBuffer(ie))throw new TypeError("Argument must be a Buffer");return this===ie||0===v.compare(this,ie)},v.prototype.inspect=function(){var ie="",le=m.INSPECT_MAX_BYTES;return this.length>0&&(ie=this.toString("hex",0,le).match(/.{2}/g).join(" "),this.length>le&&(ie+=" ... ")),"<Buffer "+ie+">"},v.prototype.compare=function(ie,le,Fe,Ye,Pt){if(!v.isBuffer(ie))throw new TypeError("Argument must be a Buffer");if(void 0===le&&(le=0),void 0===Fe&&(Fe=ie?ie.length:0),void 0===Ye&&(Ye=0),void 0===Pt&&(Pt=this.length),le<0||Fe>ie.length||Ye<0||Pt>this.length)throw new RangeError("out of range index");if(Ye>=Pt&&le>=Fe)return 0;if(Ye>=Pt)return-1;if(le>=Fe)return 1;if(this===ie)return 0;for(var Me=(Pt>>>=0)-(Ye>>>=0),qe=(Fe>>>=0)-(le>>>=0),at=Math.min(Me,qe),ot=this.slice(Ye,Pt),dt=ie.slice(le,Fe),St=0;St<at;++St)if(ot[St]!==dt[St]){Me=ot[St],qe=dt[St];break}return Me<qe?-1:qe<Me?1:0},v.prototype.includes=function(ie,le,Fe){return-1!==this.indexOf(ie,le,Fe)},v.prototype.indexOf=function(ie,le,Fe){return he(this,ie,le,Fe,!0)},v.prototype.lastIndexOf=function(ie,le,Fe){return he(this,ie,le,Fe,!1)},v.prototype.write=function(ie,le,Fe,Ye){if(void 0===le)Ye="utf8",Fe=this.length,le=0;else if(void 0===Fe&&"string"==typeof le)Ye=le,Fe=this.length,le=0;else{if(!isFinite(le))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");le|=0,isFinite(Fe)?(Fe|=0,void 0===Ye&&(Ye="utf8")):(Ye=Fe,Fe=void 0)}var Pt=this.length-le;if((void 0===Fe||Fe>Pt)&&(Fe=Pt),ie.length>0&&(Fe<0||le<0)||le>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ye||(Ye="utf8");for(var Me=!1;;)switch(Ye){case"hex":return P(this,ie,le,Fe);case"utf8":case"utf-8":return X(this,ie,le,Fe);case"ascii":return W(this,ie,le,Fe);case"latin1":case"binary":return te(this,ie,le,Fe);case"base64":return ce(this,ie,le,Fe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Se(this,ie,le,Fe);default:if(Me)throw new TypeError("Unknown encoding: "+Ye);Ye=(""+Ye).toLowerCase(),Me=!0}},v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},v.prototype.slice=function(ie,le){var Ye,Fe=this.length;if((ie=~~ie)<0?(ie+=Fe)<0&&(ie=0):ie>Fe&&(ie=Fe),(le=void 0===le?Fe:~~le)<0?(le+=Fe)<0&&(le=0):le>Fe&&(le=Fe),le<ie&&(le=ie),v.TYPED_ARRAY_SUPPORT)(Ye=this.subarray(ie,le)).__proto__=v.prototype;else{var Pt=le-ie;Ye=new v(Pt,void 0);for(var Me=0;Me<Pt;++Me)Ye[Me]=this[Me+ie]}return Ye},v.prototype.readUIntLE=function(ie,le,Fe){ie|=0,le|=0,Fe||sn(ie,le,this.length);for(var Ye=this[ie],Pt=1,Me=0;++Me<le&&(Pt*=256);)Ye+=this[ie+Me]*Pt;return Ye},v.prototype.readUIntBE=function(ie,le,Fe){ie|=0,le|=0,Fe||sn(ie,le,this.length);for(var Ye=this[ie+--le],Pt=1;le>0&&(Pt*=256);)Ye+=this[ie+--le]*Pt;return Ye},v.prototype.readUInt8=function(ie,le){return le||sn(ie,1,this.length),this[ie]},v.prototype.readUInt16LE=function(ie,le){return le||sn(ie,2,this.length),this[ie]|this[ie+1]<<8},v.prototype.readUInt16BE=function(ie,le){return le||sn(ie,2,this.length),this[ie]<<8|this[ie+1]},v.prototype.readUInt32LE=function(ie,le){return le||sn(ie,4,this.length),(this[ie]|this[ie+1]<<8|this[ie+2]<<16)+16777216*this[ie+3]},v.prototype.readUInt32BE=function(ie,le){return le||sn(ie,4,this.length),16777216*this[ie]+(this[ie+1]<<16|this[ie+2]<<8|this[ie+3])},v.prototype.readIntLE=function(ie,le,Fe){ie|=0,le|=0,Fe||sn(ie,le,this.length);for(var Ye=this[ie],Pt=1,Me=0;++Me<le&&(Pt*=256);)Ye+=this[ie+Me]*Pt;return Ye>=(Pt*=128)&&(Ye-=Math.pow(2,8*le)),Ye},v.prototype.readIntBE=function(ie,le,Fe){ie|=0,le|=0,Fe||sn(ie,le,this.length);for(var Ye=le,Pt=1,Me=this[ie+--Ye];Ye>0&&(Pt*=256);)Me+=this[ie+--Ye]*Pt;return Me>=(Pt*=128)&&(Me-=Math.pow(2,8*le)),Me},v.prototype.readInt8=function(ie,le){return le||sn(ie,1,this.length),128&this[ie]?-1*(255-this[ie]+1):this[ie]},v.prototype.readInt16LE=function(ie,le){le||sn(ie,2,this.length);var Fe=this[ie]|this[ie+1]<<8;return 32768&Fe?4294901760|Fe:Fe},v.prototype.readInt16BE=function(ie,le){le||sn(ie,2,this.length);var Fe=this[ie+1]|this[ie]<<8;return 32768&Fe?4294901760|Fe:Fe},v.prototype.readInt32LE=function(ie,le){return le||sn(ie,4,this.length),this[ie]|this[ie+1]<<8|this[ie+2]<<16|this[ie+3]<<24},v.prototype.readInt32BE=function(ie,le){return le||sn(ie,4,this.length),this[ie]<<24|this[ie+1]<<16|this[ie+2]<<8|this[ie+3]},v.prototype.readFloatLE=function(ie,le){return le||sn(ie,4,this.length),p.read(this,ie,!0,23,4)},v.prototype.readFloatBE=function(ie,le){return le||sn(ie,4,this.length),p.read(this,ie,!1,23,4)},v.prototype.readDoubleLE=function(ie,le){return le||sn(ie,8,this.length),p.read(this,ie,!0,52,8)},v.prototype.readDoubleBE=function(ie,le){return le||sn(ie,8,this.length),p.read(this,ie,!1,52,8)},v.prototype.writeUIntLE=function(ie,le,Fe,Ye){ie=+ie,le|=0,Fe|=0,Ye||tr(this,ie,le,Fe,Math.pow(2,8*Fe)-1,0);var Me=1,qe=0;for(this[le]=255&ie;++qe<Fe&&(Me*=256);)this[le+qe]=ie/Me&255;return le+Fe},v.prototype.writeUIntBE=function(ie,le,Fe,Ye){ie=+ie,le|=0,Fe|=0,Ye||tr(this,ie,le,Fe,Math.pow(2,8*Fe)-1,0);var Me=Fe-1,qe=1;for(this[le+Me]=255&ie;--Me>=0&&(qe*=256);)this[le+Me]=ie/qe&255;return le+Fe},v.prototype.writeUInt8=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,1,255,0),v.TYPED_ARRAY_SUPPORT||(ie=Math.floor(ie)),this[le]=255&ie,le+1},v.prototype.writeUInt16LE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,2,65535,0),v.TYPED_ARRAY_SUPPORT?(this[le]=255&ie,this[le+1]=ie>>>8):Cr(this,ie,le,!0),le+2},v.prototype.writeUInt16BE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,2,65535,0),v.TYPED_ARRAY_SUPPORT?(this[le]=ie>>>8,this[le+1]=255&ie):Cr(this,ie,le,!1),le+2},v.prototype.writeUInt32LE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,4,4294967295,0),v.TYPED_ARRAY_SUPPORT?(this[le+3]=ie>>>24,this[le+2]=ie>>>16,this[le+1]=ie>>>8,this[le]=255&ie):Un(this,ie,le,!0),le+4},v.prototype.writeUInt32BE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,4,4294967295,0),v.TYPED_ARRAY_SUPPORT?(this[le]=ie>>>24,this[le+1]=ie>>>16,this[le+2]=ie>>>8,this[le+3]=255&ie):Un(this,ie,le,!1),le+4},v.prototype.writeIntLE=function(ie,le,Fe,Ye){if(ie=+ie,le|=0,!Ye){var Pt=Math.pow(2,8*Fe-1);tr(this,ie,le,Fe,Pt-1,-Pt)}var Me=0,qe=1,at=0;for(this[le]=255&ie;++Me<Fe&&(qe*=256);)ie<0&&0===at&&0!==this[le+Me-1]&&(at=1),this[le+Me]=(ie/qe>>0)-at&255;return le+Fe},v.prototype.writeIntBE=function(ie,le,Fe,Ye){if(ie=+ie,le|=0,!Ye){var Pt=Math.pow(2,8*Fe-1);tr(this,ie,le,Fe,Pt-1,-Pt)}var Me=Fe-1,qe=1,at=0;for(this[le+Me]=255&ie;--Me>=0&&(qe*=256);)ie<0&&0===at&&0!==this[le+Me+1]&&(at=1),this[le+Me]=(ie/qe>>0)-at&255;return le+Fe},v.prototype.writeInt8=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,1,127,-128),v.TYPED_ARRAY_SUPPORT||(ie=Math.floor(ie)),ie<0&&(ie=255+ie+1),this[le]=255&ie,le+1},v.prototype.writeInt16LE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,2,32767,-32768),v.TYPED_ARRAY_SUPPORT?(this[le]=255&ie,this[le+1]=ie>>>8):Cr(this,ie,le,!0),le+2},v.prototype.writeInt16BE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,2,32767,-32768),v.TYPED_ARRAY_SUPPORT?(this[le]=ie>>>8,this[le+1]=255&ie):Cr(this,ie,le,!1),le+2},v.prototype.writeInt32LE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,4,2147483647,-2147483648),v.TYPED_ARRAY_SUPPORT?(this[le]=255&ie,this[le+1]=ie>>>8,this[le+2]=ie>>>16,this[le+3]=ie>>>24):Un(this,ie,le,!0),le+4},v.prototype.writeInt32BE=function(ie,le,Fe){return ie=+ie,le|=0,Fe||tr(this,ie,le,4,2147483647,-2147483648),ie<0&&(ie=4294967295+ie+1),v.TYPED_ARRAY_SUPPORT?(this[le]=ie>>>24,this[le+1]=ie>>>16,this[le+2]=ie>>>8,this[le+3]=255&ie):Un(this,ie,le,!1),le+4},v.prototype.writeFloatLE=function(ie,le,Fe){return Oe(this,ie,le,!0,Fe)},v.prototype.writeFloatBE=function(ie,le,Fe){return Oe(this,ie,le,!1,Fe)},v.prototype.writeDoubleLE=function(ie,le,Fe){return $e(this,ie,le,!0,Fe)},v.prototype.writeDoubleBE=function(ie,le,Fe){return $e(this,ie,le,!1,Fe)},v.prototype.copy=function(ie,le,Fe,Ye){if(Fe||(Fe=0),!Ye&&0!==Ye&&(Ye=this.length),le>=ie.length&&(le=ie.length),le||(le=0),Ye>0&&Ye<Fe&&(Ye=Fe),Ye===Fe||0===ie.length||0===this.length)return 0;if(le<0)throw new RangeError("targetStart out of bounds");if(Fe<0||Fe>=this.length)throw new RangeError("sourceStart out of bounds");if(Ye<0)throw new RangeError("sourceEnd out of bounds");Ye>this.length&&(Ye=this.length),ie.length-le<Ye-Fe&&(Ye=ie.length-le+Fe);var Me,Pt=Ye-Fe;if(this===ie&&Fe<le&&le<Ye)for(Me=Pt-1;Me>=0;--Me)ie[Me+le]=this[Me+Fe];else if(Pt<1e3||!v.TYPED_ARRAY_SUPPORT)for(Me=0;Me<Pt;++Me)ie[Me+le]=this[Me+Fe];else Uint8Array.prototype.set.call(ie,this.subarray(Fe,Fe+Pt),le);return Pt},v.prototype.fill=function(ie,le,Fe,Ye){if("string"==typeof ie){if("string"==typeof le?(Ye=le,le=0,Fe=this.length):"string"==typeof Fe&&(Ye=Fe,Fe=this.length),1===ie.length){var Pt=ie.charCodeAt(0);Pt<256&&(ie=Pt)}if(void 0!==Ye&&"string"!=typeof Ye)throw new TypeError("encoding must be a string");if("string"==typeof Ye&&!v.isEncoding(Ye))throw new TypeError("Unknown encoding: "+Ye)}else"number"==typeof ie&&(ie&=255);if(le<0||this.length<le||this.length<Fe)throw new RangeError("Out of range index");if(Fe<=le)return this;var Me;if(le>>>=0,Fe=void 0===Fe?this.length:Fe>>>0,ie||(ie=0),"number"==typeof ie)for(Me=le;Me<Fe;++Me)this[Me]=ie;else{var qe=v.isBuffer(ie)?ie:ht(new v(ie,Ye).toString()),at=qe.length;for(Me=0;Me<Fe-le;++Me)this[Me+le]=qe[Me%at]}return this};var Ve=/[^+\/0-9A-Za-z-_]/g;function ut(Ce){return Ce<16?"0"+Ce.toString(16):Ce.toString(16)}function ht(Ce,ie){ie=ie||1/0;for(var le,Fe=Ce.length,Ye=null,Pt=[],Me=0;Me<Fe;++Me){if((le=Ce.charCodeAt(Me))>55295&&le<57344){if(!Ye){if(le>56319){(ie-=3)>-1&&Pt.push(239,191,189);continue}if(Me+1===Fe){(ie-=3)>-1&&Pt.push(239,191,189);continue}Ye=le;continue}if(le<56320){(ie-=3)>-1&&Pt.push(239,191,189),Ye=le;continue}le=65536+(Ye-55296<<10|le-56320)}else Ye&&(ie-=3)>-1&&Pt.push(239,191,189);if(Ye=null,le<128){if((ie-=1)<0)break;Pt.push(le)}else if(le<2048){if((ie-=2)<0)break;Pt.push(le>>6|192,63&le|128)}else if(le<65536){if((ie-=3)<0)break;Pt.push(le>>12|224,le>>6&63|128,63&le|128)}else{if(!(le<1114112))throw new Error("Invalid code point");if((ie-=4)<0)break;Pt.push(le>>18|240,le>>12&63|128,le>>6&63|128,63&le|128)}}return Pt}function Kt(Ce){return u.toByteArray(function Ke(Ce){if((Ce=function nt(Ce){return Ce.trim?Ce.trim():Ce.replace(/^\s+|\s+$/g,"")}(Ce).replace(Ve,"")).length<2)return"";for(;Ce.length%4!=0;)Ce+="=";return Ce}(Ce))}function rn(Ce,ie,le,Fe){for(var Ye=0;Ye<Fe&&!(Ye+le>=ie.length||Ye>=Ce.length);++Ye)ie[Ye+le]=Ce[Ye];return Ye}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},h("buffer").Buffer)},{"base64-js":3,buffer:6,ieee754:29,isarray:35}],7:[function(h,C,m){!function(){if(!(typeof window>"u"))try{var s=new window.CustomEvent("test",{cancelable:!0});if(s.preventDefault(),!0!==s.defaultPrevented)throw new Error("Could not prevent default")}catch{var c=function(p,d){var A,E;return(d=d||{}).bubbles=!!d.bubbles,d.cancelable=!!d.cancelable,(A=document.createEvent("CustomEvent")).initCustomEvent(p,d.bubbles,d.cancelable,d.detail),E=A.preventDefault,A.preventDefault=function(){E.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch{this.defaultPrevented=!0}},A};c.prototype=window.Event.prototype,window.CustomEvent=c}}()},{}],8:[function(h,C,m){function d(){var E;try{E=m.storage.debug}catch{}return E}(m=C.exports=h("./debug")).log=function u(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},m.formatArgs=function c(){var E=arguments,g=this.useColors;if(E[0]=(g?"%c":"")+this.namespace+(g?" %c":" ")+E[0]+(g?"%c ":" "),!g)return E;var v="color: "+this.color;E=[E[0],v,"color: inherit"].concat(Array.prototype.slice.call(E,1));var T=0,y=0;return E[0].replace(/%[a-z%]/g,function(M){"%%"!==M&&(T++,"%c"===M&&(y=T))}),E.splice(y,0,v),E},m.save=function p(E){try{null==E?m.storage.removeItem("debug"):m.storage.debug=E}catch{}},m.load=d,m.useColors=function s(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},m.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:function A(){try{return window.localStorage}catch{}}(),m.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],m.formatters.j=function(E){return JSON.stringify(E)},m.enable(d())},{"./debug":9}],9:[function(h,C,m){m=C.exports=function u(g){function v(){}function T(){var M=T;null==M.useColors&&(M.useColors=m.useColors()),null==M.color&&M.useColors&&(M.color=c());var _=Array.prototype.slice.call(arguments);_[0]=m.coerce(_[0]),"string"!=typeof _[0]&&(_=["%o"].concat(_));var O=0;_[0]=_[0].replace(/%([a-z%])/g,function(B,H){if("%%"===B)return B;O++;var q=m.formatters[H];return"function"==typeof q&&(B=q.call(M,_[O]),_.splice(O,1),O--),B}),"function"==typeof m.formatArgs&&(_=m.formatArgs.apply(M,_));var D=T.log||m.log||console.log.bind(console);D.apply(M,_)}v.enabled=!1,T.enabled=!0;var y=m.enabled(g)?T:v;return y.namespace=g,y},m.coerce=function E(g){return g instanceof Error?g.stack||g.message:g},m.disable=function d(){m.enable("")},m.enable=function p(g){m.save(g);for(var v=(g||"").split(/[\s,]+/),T=v.length,y=0;y<T;y++)v[y]&&("-"===(g=v[y].replace(/\*/g,".*?"))[0]?m.skips.push(new RegExp("^"+g.substr(1)+"$")):m.names.push(new RegExp("^"+g+"$")))},m.enabled=function A(g){var v,T;for(v=0,T=m.skips.length;v<T;v++)if(m.skips[v].test(g))return!1;for(v=0,T=m.names.length;v<T;v++)if(m.names[v].test(g))return!0;return!1},m.names=[],m.skips=[],m.formatters={};var s=0;function c(){return m.colors[s++%m.colors.length]}},{}],10:[function(h,C,m){"use strict";var s=h("is-obj"),c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable;function p(E){if(null==E)throw new TypeError("Sources cannot be null or undefined");return Object(E)}function d(E,g,v){var T=g[v];if(null!=T){if(c.call(E,v)&&null==E[v])throw new TypeError("Cannot convert undefined or null to object ("+v+")");E[v]=c.call(E,v)&&s(T)?A(Object(E[v]),g[v]):T}}function A(E,g){if(E===g)return E;for(var v in g=Object(g))c.call(g,v)&&d(E,g,v);if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(g),y=0;y<T.length;y++)u.call(g,T[y])&&d(E,g,T[y]);return E}C.exports=function(g){g=p(g);for(var v=1;v<arguments.length;v++)A(g,arguments[v]);return g}},{"is-obj":34}],11:[function(h,C,m){"use strict";var s=h("object-keys"),c="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),u=Object.prototype.toString,p=Array.prototype.concat,d=Object.defineProperty,g=d&&function(){var y={};try{for(var M in d(y,"x",{enumerable:!1,value:y}),y)return!1;return y.x===y}catch{return!1}}(),v=function(y,M,_,O){M in y&&(!function(y){return"function"==typeof y&&"[object Function]"===u.call(y)}(O)||!O())||(g?d(y,M,{configurable:!0,enumerable:!1,value:_,writable:!0}):y[M]=_)},T=function(y,M){var _=arguments.length>2?arguments[2]:{},O=s(M);c&&(O=p.call(O,Object.getOwnPropertySymbols(M)));for(var D=0;D<O.length;D+=1)v(y,O[D],M[O[D]],_[O[D]])};T.supportsDescriptors=!!g,C.exports=T},{"object-keys":41}],12:[function(h,C,m){!function(s,c,u,p){"use strict";function d(We,ft){for(var Mt=0,Ht=We.length;Mt<Ht;Mt++)H(We[Mt],ft)}function E(We){return function(ft){_t(ft)&&(H(ft,We),d(ft.querySelectorAll(gt),We))}}function g(We){var ft=rn.call(We,"is"),Mt=We.nodeName.toUpperCase(),Ht=$t.call(ze,ft?ce+ft.toUpperCase():te+Mt);return ft&&-1<Ht&&!v(Mt,ft)?-1:Ht}function v(We,ft){return-1<gt.indexOf(We+'[is="'+ft+'"]')}function T(We){var ft=We.currentTarget,Mt=We.attrChange,Ht=We.attrName,kt=We.target;ot&&(!kt||kt===ft)&&ft.attributeChangedCallback&&"style"!==Ht&&We.prevValue!==We.newValue&&ft.attributeChangedCallback(Ht,Mt===We[fe]?null:We.prevValue,Mt===We[me]?null:We.newValue)}function y(We){var ft=E(We);return function(Mt){Ye.push(ft,Mt.target)}}function M(We){at&&(at=!1,We.currentTarget.removeEventListener(X,M)),d((We.target||c).querySelectorAll(gt),We.detail===ne?ne:V),ht&&function D(){for(var We,ft=0,Mt=Bt.length;ft<Mt;ft++)Tt.contains(We=Bt[ft])||(Mt--,Bt.splice(ft--,1),H(We,ne))}()}function _(We,ft){mn.call(this,We,ft),dt.call(this,{target:this})}function O(We,ft){Ke(We,ft),Zt?Zt.observe(We,le):(qe&&(We.setAttribute=_,We[q]=It(We),We.addEventListener(W,dt)),We.addEventListener(P,T)),We.createdCallback&&ot&&(We.created=!0,We.createdCallback(),We.created=!1)}function B(We){throw new Error("A "+We+" type is already registered")}function H(We,ft){var Mt,Ht=g(We);-1<Ht&&(Xt(We,rt[Ht]),Ht=0,ft!==V||We[V]?ft===ne&&!We[ne]&&(We[V]=!1,We[ne]=!0,Ht=1):(We[ne]=!1,We[V]=!0,Ht=1,ht&&$t.call(Bt,We)<0&&Bt.push(We)),Ht&&(Mt=We[ft+"Callback"])&&Mt.call(We))}if(!(p in c)){var Ye,dt,St,It,Zt,Xt,Vt,q="__"+p+(1e5*Math.random()>>0),V="attached",ne="detached",ae="extends",fe="ADDITION",he="MODIFICATION",me="REMOVAL",P="DOMAttrModified",X="DOMContentLoaded",W="DOMSubtreeModified",te="<",ce="=",Se=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,_e=["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"],ze=[],rt=[],gt="",Tt=c.documentElement,$t=ze.indexOf||function(We){for(var ft=this.length;ft--&&this[ft]!==We;);return ft},un=u.prototype,In=un.hasOwnProperty,sn=un.isPrototypeOf,tr=u.defineProperty,Cr=u.getOwnPropertyDescriptor,Un=u.getOwnPropertyNames,Re=u.getPrototypeOf,Oe=u.setPrototypeOf,$e=!!u.__proto__,Ve=u.create||function We(ft){return ft?(We.prototype=ft,new We):this},Ke=Oe||($e?function(We,ft){return We.__proto__=ft,We}:Un&&Cr?function(){function We(ft,Mt){for(var Ht,kt=Un(Mt),Ft=0,jt=kt.length;Ft<jt;Ft++)In.call(ft,Ht=kt[Ft])||tr(ft,Ht,Cr(Mt,Ht))}return function(ft,Mt){do{We(ft,Mt)}while((Mt=Re(Mt))&&!sn.call(Mt,ft));return ft}}():function(We,ft){for(var Mt in ft)We[Mt]=ft[Mt];return We}),nt=s.MutationObserver||s.WebKitMutationObserver,ut=(s.HTMLElement||s.Element||s.Node).prototype,ht=!sn.call(ut,Tt),_t=ht?function(We){return 1===We.nodeType}:function(We){return sn.call(ut,We)},Bt=ht&&[],Kt=ut.cloneNode,rn=ut.getAttribute,mn=ut.setAttribute,Ce=ut.removeAttribute,ie=c.createElement,le=nt&&{attributes:!0,characterData:!0,attributeOldValue:!0},Fe=nt||function(We){qe=!1,Tt.removeEventListener(P,Fe)},Pt=s.requestAnimationFrame||s.webkitRequestAnimationFrame||s.mozRequestAnimationFrame||s.msRequestAnimationFrame||function(We){setTimeout(We,10)},Me=!1,qe=!0,at=!0,ot=!0;Oe||$e?(Xt=function(We,ft){sn.call(ft,We)||O(We,ft)},Vt=O):(Xt=function(We,ft){We[q]||(We[q]=u(!0),O(We,ft))},Vt=Xt),ht?(qe=!1,We=Cr(ut,"addEventListener"),ft=We.value,Mt=function(Ft){var jt=new CustomEvent(P,{bubbles:!0});jt.attrName=Ft,jt.prevValue=rn.call(this,Ft),jt.newValue=null,jt[me]=jt.attrChange=2,Ce.call(this,Ft),this.dispatchEvent(jt)},Ht=function(Ft,jt){var ln=this.hasAttribute(Ft),vn=ln&&rn.call(this,Ft);e=new CustomEvent(P,{bubbles:!0}),mn.call(this,Ft,jt),e.attrName=Ft,e.prevValue=ln?vn:null,e.newValue=jt,ln?e[he]=e.attrChange=1:e[fe]=e.attrChange=0,this.dispatchEvent(e)},kt=function(Ft){var hn,jt=Ft.currentTarget,ln=jt[q],vn=Ft.propertyName;ln.hasOwnProperty(vn)&&(ln=ln[vn],(hn=new CustomEvent(P,{bubbles:!0})).attrName=ln.name,hn.prevValue=ln.value||null,hn.newValue=ln.value=jt[vn]||null,null==hn.prevValue?hn[fe]=hn.attrChange=0:hn[he]=hn.attrChange=1,jt.dispatchEvent(hn))},We.value=function(Ft,jt,ln){Ft===P&&this.attributeChangedCallback&&this.setAttribute!==Ht&&(this[q]={className:{name:"class",value:this.className}},this.setAttribute=Ht,this.removeAttribute=Mt,ft.call(this,"propertychange",kt)),ft.call(this,Ft,jt,ln)},tr(ut,"addEventListener",We)):nt||(Tt.addEventListener(P,Fe),Tt.setAttribute(q,1),Tt.removeAttribute(q),qe&&(dt=function(We){var Mt,Ht,kt,ft=this;if(ft===We.target){for(kt in Mt=ft[q],ft[q]=Ht=It(ft),Ht){if(!(kt in Mt))return St(0,ft,kt,Mt[kt],Ht[kt],fe);if(Ht[kt]!==Mt[kt])return St(1,ft,kt,Mt[kt],Ht[kt],he)}for(kt in Mt)if(!(kt in Ht))return St(2,ft,kt,Mt[kt],Ht[kt],me)}},St=function(We,ft,Mt,Ht,kt,Ft){var jt={attrChange:We,currentTarget:ft,attrName:Mt,prevValue:Ht,newValue:kt};jt[Ft]=We,T(jt)},It=function(We){for(var ft,Mt,Ht={},kt=We.attributes,Ft=0,jt=kt.length;Ft<jt;Ft++)"setAttribute"!==(Mt=(ft=kt[Ft]).name)&&(Ht[Mt]=ft.value);return Ht})),c[p]=function(We,ft){if(jt=We.toUpperCase(),Me||(Me=!0,nt?(Zt=function(vn,hn){function zn(xn,nr){for(var Pn=0,jr=xn.length;Pn<jr;nr(xn[Pn++]));}return new nt(function(xn){for(var nr,Pn,jr,Xr=0,ur=xn.length;Xr<ur;Xr++)"childList"===(nr=xn[Xr]).type?(zn(nr.addedNodes,vn),zn(nr.removedNodes,hn)):(Pn=nr.target,ot&&Pn.attributeChangedCallback&&"style"!==nr.attributeName&&(jr=rn.call(Pn,nr.attributeName))!==nr.oldValue&&Pn.attributeChangedCallback(nr.attributeName,nr.oldValue,jr))})}(E(V),E(ne))).observe(c,{childList:!0,subtree:!0}):(Ye=[],Pt(function vn(){for(;Ye.length;)Ye.shift().call(null,Ye.shift());Pt(vn)}),c.addEventListener("DOMNodeInserted",y(V)),c.addEventListener("DOMNodeRemoved",y(ne))),c.addEventListener(X,M),c.addEventListener("readystatechange",M),c.createElement=function(vn,hn){var zn=ie.apply(c,arguments),xn=""+vn,nr=$t.call(ze,(hn?ce:te)+(hn||xn).toUpperCase()),Pn=-1<nr;return hn&&(zn.setAttribute("is",hn=hn.toLowerCase()),Pn&&(Pn=v(xn.toUpperCase(),hn))),ot=!c.createElement.innerHTMLHelper,Pn&&Vt(zn,rt[nr]),zn},ut.cloneNode=function(vn){var hn=Kt.call(this,!!vn),zn=g(hn);return-1<zn&&Vt(hn,rt[zn]),vn&&function A(We){for(var Ht,ft=0,Mt=We.length;ft<Mt;ft++)Vt(Ht=We[ft],rt[g(Ht)])}(hn.querySelectorAll(gt)),hn}),-2<$t.call(ze,ce+jt)+$t.call(ze,te+jt)&&B(We),!Se.test(jt)||-1<$t.call(_e,jt))throw new Error("The type "+We+" is invalid");var jt,ln,Mt=function(){return kt?c.createElement(Ft,jt):c.createElement(Ft)},Ht=ft||un,kt=In.call(Ht,ae),Ft=kt?ft[ae].toUpperCase():jt;return kt&&-1<$t.call(ze,te+Ft)&&B(Ft),ln=ze.push((kt?ce:te)+jt)-1,gt=gt.concat(gt.length?",":"",kt?Ft+'[is="'+We.toLowerCase()+'"]':Ft),Mt.prototype=rt[ln]=In.call(Ht,"prototype")?Ht.prototype:Ve(ut),d(c.querySelectorAll(gt),V),Mt}}var We,ft,Mt,Ht,kt}(window,document,Object,"registerElement")},{}],13:[function(h,C,m){C.exports=function(s){switch(s){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},{}],14:[function(h,C,m){"use strict";var s,c=Object.getOwnPropertyDescriptor?function(){return Object.getOwnPropertyDescriptor(arguments,"callee").get}():function(){throw new TypeError},u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,p=Object.getPrototypeOf||function(O){return O.__proto__},y=s,M=typeof Uint8Array>"u"?s:p(Uint8Array),_={"$ %Array%":Array,"$ %ArrayBuffer%":typeof ArrayBuffer>"u"?s:ArrayBuffer,"$ %ArrayBufferPrototype%":typeof ArrayBuffer>"u"?s:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":u?p([][Symbol.iterator]()):s,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":s,"$ %AsyncFunction%":undefined,"$ %AsyncFunctionPrototype%":s,"$ %AsyncGenerator%":s,"$ %AsyncGeneratorFunction%":undefined,"$ %AsyncGeneratorPrototype%":s,"$ %AsyncIteratorPrototype%":y&&u&&Symbol.asyncIterator?y[Symbol.asyncIterator]():s,"$ %Atomics%":typeof Atomics>"u"?s:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":typeof DataView>"u"?s:DataView,"$ %DataViewPrototype%":typeof DataView>"u"?s:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":typeof Float32Array>"u"?s:Float32Array,"$ %Float32ArrayPrototype%":typeof Float32Array>"u"?s:Float32Array.prototype,"$ %Float64Array%":typeof Float64Array>"u"?s:Float64Array,"$ %Float64ArrayPrototype%":typeof Float64Array>"u"?s:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":s,"$ %GeneratorFunction%":undefined,"$ %GeneratorPrototype%":s,"$ %Int8Array%":typeof Int8Array>"u"?s:Int8Array,"$ %Int8ArrayPrototype%":typeof Int8Array>"u"?s:Int8Array.prototype,"$ %Int16Array%":typeof Int16Array>"u"?s:Int16Array,"$ %Int16ArrayPrototype%":typeof Int16Array>"u"?s:Int8Array.prototype,"$ %Int32Array%":typeof Int32Array>"u"?s:Int32Array,"$ %Int32ArrayPrototype%":typeof Int32Array>"u"?s:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":u?p(p([][Symbol.iterator]())):s,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":typeof Map>"u"?s:Map,"$ %MapIteratorPrototype%":typeof Map>"u"||!u?s:p((new Map)[Symbol.iterator]()),"$ %MapPrototype%":typeof Map>"u"?s:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":typeof Promise>"u"?s:Promise,"$ %PromisePrototype%":typeof Promise>"u"?s:Promise.prototype,"$ %PromiseProto_then%":typeof Promise>"u"?s:Promise.prototype.then,"$ %Promise_all%":typeof Promise>"u"?s:Promise.all,"$ %Promise_reject%":typeof Promise>"u"?s:Promise.reject,"$ %Promise_resolve%":typeof Promise>"u"?s:Promise.resolve,"$ %Proxy%":typeof Proxy>"u"?s:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":typeof Reflect>"u"?s:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":typeof Set>"u"?s:Set,"$ %SetIteratorPrototype%":typeof Set>"u"||!u?s:p((new Set)[Symbol.iterator]()),"$ %SetPrototype%":typeof Set>"u"?s:Set.prototype,"$ %SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?s:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":typeof SharedArrayBuffer>"u"?s:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":u?p(""[Symbol.iterator]()):s,"$ %StringPrototype%":String.prototype,"$ %Symbol%":u?Symbol:s,"$ %SymbolPrototype%":u?Symbol.prototype:s,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":c,"$ %TypedArray%":M,"$ %TypedArrayPrototype%":M?M.prototype:s,"$ %TypeError%":TypeError,"$ %TypeErrorPrototype%":TypeError.prototype,"$ %Uint8Array%":typeof Uint8Array>"u"?s:Uint8Array,"$ %Uint8ArrayPrototype%":typeof Uint8Array>"u"?s:Uint8Array.prototype,"$ %Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?s:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":typeof Uint8ClampedArray>"u"?s:Uint8ClampedArray.prototype,"$ %Uint16Array%":typeof Uint16Array>"u"?s:Uint16Array,"$ %Uint16ArrayPrototype%":typeof Uint16Array>"u"?s:Uint16Array.prototype,"$ %Uint32Array%":typeof Uint32Array>"u"?s:Uint32Array,"$ %Uint32ArrayPrototype%":typeof Uint32Array>"u"?s:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":typeof WeakMap>"u"?s:WeakMap,"$ %WeakMapPrototype%":typeof WeakMap>"u"?s:WeakMap.prototype,"$ %WeakSet%":typeof WeakSet>"u"?s:WeakSet,"$ %WeakSetPrototype%":typeof WeakSet>"u"?s:WeakSet.prototype};C.exports=function(D,B){if(arguments.length>1&&"boolean"!=typeof B)throw new TypeError('"allowMissing" argument must be a boolean');var H="$ "+D;if(!(H in _))throw new SyntaxError("intrinsic "+D+" does not exist!");if(typeof _[H]>"u"&&!B)throw new TypeError("intrinsic "+D+" exists, but is not available. Please file an issue!");return _[H]}},{}],15:[function(h,C,m){"use strict";var s=h("./GetIntrinsic"),c=s("%Object%"),u=s("%TypeError%"),p=s("%String%"),d=h("./helpers/assertRecord"),A=h("./helpers/isNaN"),E=h("./helpers/isFinite"),g=h("./helpers/sign"),v=h("./helpers/mod"),T=h("is-callable"),y=h("es-to-primitive/es5"),M=h("has");C.exports={ToPrimitive:y,ToBoolean:function(D){return!!D},ToNumber:function(D){return+D},ToInteger:function(D){var B=this.ToNumber(D);return A(B)?0:0!==B&&E(B)?g(B)*Math.floor(Math.abs(B)):B},ToInt32:function(D){return this.ToNumber(D)>>0},ToUint32:function(D){return this.ToNumber(D)>>>0},ToUint16:function(D){var B=this.ToNumber(D);if(A(B)||0===B||!E(B))return 0;var H=g(B)*Math.floor(Math.abs(B));return v(H,65536)},ToString:function(D){return p(D)},ToObject:function(D){return this.CheckObjectCoercible(D),c(D)},CheckObjectCoercible:function(D,B){if(null==D)throw new u(B||"Cannot call method on "+D);return D},IsCallable:T,SameValue:function(D,B){return D===B?0!==D||1/D==1/B:A(D)&&A(B)},Type:function(D){return null===D?"Null":typeof D>"u"?"Undefined":"function"==typeof D||"object"==typeof D?"Object":"number"==typeof D?"Number":"boolean"==typeof D?"Boolean":"string"==typeof D?"String":void 0},IsPropertyDescriptor:function(D){if("Object"!==this.Type(D))return!1;var B={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var H in D)if(M(D,H)&&!B[H])return!1;var q=M(D,"[[Value]]"),V=M(D,"[[Get]]")||M(D,"[[Set]]");if(q&&V)throw new u("Property Descriptors may not be both accessor and data descriptors");return!0},IsAccessorDescriptor:function(D){return!(typeof D>"u"||(d(this,"Property Descriptor","Desc",D),!M(D,"[[Get]]")&&!M(D,"[[Set]]")))},IsDataDescriptor:function(D){return!(typeof D>"u"||(d(this,"Property Descriptor","Desc",D),!M(D,"[[Value]]")&&!M(D,"[[Writable]]")))},IsGenericDescriptor:function(D){return!(typeof D>"u"||(d(this,"Property Descriptor","Desc",D),this.IsAccessorDescriptor(D)||this.IsDataDescriptor(D)))},FromPropertyDescriptor:function(D){if(typeof D>"u")return D;if(d(this,"Property Descriptor","Desc",D),this.IsDataDescriptor(D))return{value:D["[[Value]]"],writable:!!D["[[Writable]]"],enumerable:!!D["[[Enumerable]]"],configurable:!!D["[[Configurable]]"]};if(this.IsAccessorDescriptor(D))return{get:D["[[Get]]"],set:D["[[Set]]"],enumerable:!!D["[[Enumerable]]"],configurable:!!D["[[Configurable]]"]};throw new u("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function(D){if("Object"!==this.Type(D))throw new u("ToPropertyDescriptor requires an object");var B={};if(M(D,"enumerable")&&(B["[[Enumerable]]"]=this.ToBoolean(D.enumerable)),M(D,"configurable")&&(B["[[Configurable]]"]=this.ToBoolean(D.configurable)),M(D,"value")&&(B["[[Value]]"]=D.value),M(D,"writable")&&(B["[[Writable]]"]=this.ToBoolean(D.writable)),M(D,"get")){var H=D.get;if(typeof H<"u"&&!this.IsCallable(H))throw new TypeError("getter must be a function");B["[[Get]]"]=H}if(M(D,"set")){var q=D.set;if(typeof q<"u"&&!this.IsCallable(q))throw new u("setter must be a function");B["[[Set]]"]=q}if((M(B,"[[Get]]")||M(B,"[[Set]]"))&&(M(B,"[[Value]]")||M(B,"[[Writable]]")))throw new u("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return B}}},{"./GetIntrinsic":14,"./helpers/assertRecord":16,"./helpers/isFinite":17,"./helpers/isNaN":18,"./helpers/mod":19,"./helpers/sign":20,"es-to-primitive/es5":21,has:28,"is-callable":32}],16:[function(h,C,m){"use strict";var s=h("../GetIntrinsic"),c=s("%TypeError%"),u=s("%SyntaxError%"),p=h("has"),d={"Property Descriptor":function(E,g){if("Object"!==E.Type(g))return!1;var v={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var T in g)if(p(g,T)&&!v[T])return!1;var y=p(g,"[[Value]]"),M=p(g,"[[Get]]")||p(g,"[[Set]]");if(y&&M)throw new c("Property Descriptors may not be both accessor and data descriptors");return!0}};C.exports=function(E,g,v,T){var y=d[g];if("function"!=typeof y)throw new u("unknown record type: "+g);if(!y(E,T))throw new c(v+" must be a "+g);console.log(y(E,T),T)}},{"../GetIntrinsic":14,has:28}],17:[function(h,C,m){var s=Number.isNaN||function(c){return c!=c};C.exports=Number.isFinite||function(c){return"number"==typeof c&&!s(c)&&c!==1/0&&c!==-1/0}},{}],18:[function(h,C,m){C.exports=Number.isNaN||function(c){return c!=c}},{}],19:[function(h,C,m){C.exports=function(c,u){var p=c%u;return Math.floor(p>=0?p:p+u)}},{}],20:[function(h,C,m){C.exports=function(c){return c>=0?1:-1}},{}],21:[function(h,C,m){"use strict";var s=Object.prototype.toString,c=h("./helpers/isPrimitive"),u=h("is-callable"),p___DefaultValue__=function(d){var A;if((A=arguments.length>1?arguments[1]:"[object Date]"===s.call(d)?String:Number)===String||A===Number){var g,v,E=A===String?["toString","valueOf"]:["valueOf","toString"];for(v=0;v<E.length;++v)if(u(d[E[v]])&&(g=d[E[v]](),c(g)))return g;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")};C.exports=function(A){return c(A)?A:arguments.length>1?p___DefaultValue__(A,arguments[1]):p___DefaultValue__(A)}},{"./helpers/isPrimitive":22,"is-callable":32}],22:[function(h,C,m){C.exports=function(c){return null===c||"function"!=typeof c&&"object"!=typeof c}},{}],23:[function(h,C,m){var s=h("dtype");C.exports=function c(u,p,d){if(!u)throw new TypeError("must specify data as first parameter");if(d=0|+(d||0),Array.isArray(u)&&u[0]&&"number"==typeof u[0][0]){var g,v,T,y,A=u[0].length,E=u.length*A;(!p||"string"==typeof p)&&(p=new(s(p||"float32"))(E+d));var M=p.length-d;if(E!==M)throw new Error("source length "+E+" ("+A+"x"+u.length+") does not match destination length "+M);for(g=0,T=d;g<u.length;g++)for(v=0;v<A;v++)p[T++]=null===u[g][v]?NaN:u[g][v]}else if(p&&"string"!=typeof p)p.set(u,d);else{var _=s(p||"float32");if(Array.isArray(u)||"array"===p)for(g=0,T=d,y=(p=new _(u.length+d)).length;T<y;T++,g++)p[T]=null===u[g]?NaN:u[g];else 0===d?p=new _(u):(p=new _(u.length+d)).set(u,d)}return p}},{dtype:13}],24:[function(h,C,m){"use strict";var s=h("is-callable"),c=Object.prototype.toString,u=Object.prototype.hasOwnProperty,p=function(v,T,y){for(var M=0,_=v.length;M<_;M++)u.call(v,M)&&(null==y?T(v[M],M,v):T.call(y,v[M],M,v))},d=function(v,T,y){for(var M=0,_=v.length;M<_;M++)null==y?T(v.charAt(M),M,v):T.call(y,v.charAt(M),M,v)},A=function(v,T,y){for(var M in v)u.call(v,M)&&(null==y?T(v[M],M,v):T.call(y,v[M],M,v))};C.exports=function(v,T,y){if(!s(T))throw new TypeError("iterator must be a function");var M;arguments.length>=3&&(M=y),"[object Array]"===c.call(v)?p(v,T,M):"string"==typeof v?d(v,T,M):A(v,T,M)}},{"is-callable":32}],25:[function(h,C,m){"use strict";var s="Function.prototype.bind called on incompatible ",c=Array.prototype.slice,u=Object.prototype.toString,p="[object Function]";C.exports=function(A){var E=this;if("function"!=typeof E||u.call(E)!==p)throw new TypeError(s+E);for(var v,g=c.call(arguments,1),T=function(){if(this instanceof v){var D=E.apply(this,g.concat(c.call(arguments)));return Object(D)===D?D:this}return E.apply(A,g.concat(c.call(arguments)))},y=Math.max(0,E.length-g.length),M=[],_=0;_<y;_++)M.push("$"+_);if(v=Function("binder","return function ("+M.join(",")+"){ return binder.apply(this,arguments); }")(T),E.prototype){var O=function(){};O.prototype=E.prototype,v.prototype=new O,O.prototype=null}return v}},{}],26:[function(h,C,m){"use strict";var s=h("./implementation");C.exports=Function.prototype.bind||s},{"./implementation":25}],27:[function(h,C,m){(function(s){var c;c=typeof window<"u"?window:typeof s<"u"?s:typeof self<"u"?self:{},C.exports=c}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],28:[function(h,C,m){"use strict";var s=h("function-bind");C.exports=s.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":26}],29:[function(h,C,m){m.read=function(s,c,u,p,d){var A,E,g=8*d-p-1,v=(1<<g)-1,T=v>>1,y=-7,M=u?d-1:0,_=u?-1:1,O=s[c+M];for(M+=_,A=O&(1<<-y)-1,O>>=-y,y+=g;y>0;A=256*A+s[c+M],M+=_,y-=8);for(E=A&(1<<-y)-1,A>>=-y,y+=p;y>0;E=256*E+s[c+M],M+=_,y-=8);if(0===A)A=1-T;else{if(A===v)return E?NaN:1/0*(O?-1:1);E+=Math.pow(2,p),A-=T}return(O?-1:1)*E*Math.pow(2,A-p)},m.write=function(s,c,u,p,d,A){var E,g,v,T=8*A-d-1,y=(1<<T)-1,M=y>>1,_=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,O=p?0:A-1,D=p?1:-1,B=c<0||0===c&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(g=isNaN(c)?1:0,E=y):(E=Math.floor(Math.log(c)/Math.LN2),c*(v=Math.pow(2,-E))<1&&(E--,v*=2),(c+=E+M>=1?_/v:_*Math.pow(2,1-M))*v>=2&&(E++,v/=2),E+M>=y?(g=0,E=y):E+M>=1?(g=(c*v-1)*Math.pow(2,d),E+=M):(g=c*Math.pow(2,M-1)*Math.pow(2,d),E=0));d>=8;s[u+O]=255&g,O+=D,g/=256,d-=8);for(E=E<<d|g,T+=d;T>0;s[u+O]=255&E,O+=D,E/=256,T-=8);s[u+O-D]|=128*B}},{}],30:[function(h,C,m){C.exports="function"==typeof Object.create?function(c,u){u&&(c.super_=u,c.prototype=Object.create(u.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:function(c,u){if(u){c.super_=u;var p=function(){};p.prototype=u.prototype,c.prototype=new p,c.prototype.constructor=c}}},{}],31:[function(h,C,m){function s(u){return!!u.constructor&&"function"==typeof u.constructor.isBuffer&&u.constructor.isBuffer(u)}C.exports=function(u){return null!=u&&(s(u)||function c(u){return"function"==typeof u.readFloatLE&&"function"==typeof u.slice&&s(u.slice(0,0))}(u)||!!u._isBuffer)}},{}],32:[function(h,C,m){"use strict";var s=Function.prototype.toString,c=/^\s*class\b/,u=function(T){try{var y=s.call(T);return c.test(y)}catch{return!1}},d=Object.prototype.toString,g="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;C.exports=function(T){if(!T||"function"!=typeof T&&"object"!=typeof T)return!1;if("function"==typeof T&&!T.prototype)return!0;if(g)return function(T){try{return!u(T)&&(s.call(T),!0)}catch{return!1}}(T);if(u(T))return!1;var y=d.call(T);return"[object Function]"===y||"[object GeneratorFunction]"===y}},{}],33:[function(h,C,m){C.exports=function c(u){var p=s.call(u);return"[object Function]"===p||"function"==typeof u&&"[object RegExp]"!==p||typeof window<"u"&&(u===window.setTimeout||u===window.alert||u===window.confirm||u===window.prompt)};var s=Object.prototype.toString},{}],34:[function(h,C,m){"use strict";C.exports=function(s){var c=typeof s;return null!==s&&("object"===c||"function"===c)}},{}],35:[function(h,C,m){var s={}.toString;C.exports=Array.isArray||function(c){return"[object Array]"==s.call(c)}},{}],36:[function(h,C,m){var s=h("word-wrapper"),c=h("xtend"),u=h("as-number"),p=["x","e","a","o","n","s","r","c","u","m","v","w","z"],d=["m","w"],A=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],E="\t".charCodeAt(0),g=" ".charCodeAt(0);function M(fe){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(fe)}function O(fe){return new Function(["return function "+fe+"() {","  return this._"+fe,"}"].join("\n"))()}function D(fe,he){if(!fe.chars||0===fe.chars.length)return null;var me=ae(fe.chars,he);return me>=0?fe.chars[me]:null}function V(fe,he,me){if(!fe.kernings||0===fe.kernings.length)return 0;for(var P=fe.kernings,X=0;X<P.length;X++){var W=P[X];if(W.first===he&&W.second===me)return W.amount}return 0}function ae(fe,he,me){for(var P=me=me||0;P<fe.length;P++)if(fe[P].id===he)return P;return-1}C.exports=function(he){return new M(he)},M.prototype.update=function(fe){if(fe=c({measure:this._measure},fe),this._opt=fe,this._opt.tabSize=u(this._opt.tabSize,4),!fe.font)throw new Error("must provide a valid bitmap font");var he=this.glyphs,me=fe.text||"",P=fe.font;this._setupSpaceGlyphs(P);var X=s.lines(me,fe),W=fe.width||0;he.length=0;var te=X.reduce(function(In,sn){return Math.max(In,sn.width,W)},0),ce=0,Se=0,_e=u(fe.lineHeight,P.common.lineHeight),ze=P.common.base,rt=_e-ze,gt=fe.letterSpacing||0,Tt=_e*X.length-rt,$t=function ne(fe){return"center"===fe?1:"right"===fe?2:0}(this._opt.align);Se-=Tt,this._width=te,this._height=Tt,this._descender=_e-ze,this._baseline=ze,this._xHeight=function B(fe){for(var he=0;he<p.length;he++){var me=p[he].charCodeAt(0),P=ae(fe.chars,me);if(P>=0)return fe.chars[P].height}return 0}(P),this._capHeight=function q(fe){for(var he=0;he<A.length;he++){var me=A[he].charCodeAt(0),P=ae(fe.chars,me);if(P>=0)return fe.chars[P].height}return 0}(P),this._lineHeight=_e,this._ascender=_e-rt-this._xHeight;var un=this;X.forEach(function(In,sn){for(var Re,Cr=In.end,Un=In.width,Oe=In.start;Oe<Cr;Oe++){var $e=me.charCodeAt(Oe),Ve=un.getGlyph(P,$e);if(Ve){Re&&(ce+=V(P,Re.id,Ve.id));var Ke=ce;1===$t?Ke+=(te-Un)/2:2===$t&&(Ke+=te-Un),he.push({position:[Ke,Se],data:Ve,index:Oe,line:sn}),ce+=Ve.xadvance+gt,Re=Ve}}Se+=_e,ce=0}),this._linesTotal=X.length},M.prototype._setupSpaceGlyphs=function(fe){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,fe.chars&&0!==fe.chars.length){var he=D(fe,g)||function H(fe){for(var he=0;he<d.length;he++){var me=d[he].charCodeAt(0),P=ae(fe.chars,me);if(P>=0)return fe.chars[P]}return 0}(fe)||fe.chars[0],me=this._opt.tabSize*he.xadvance;this._fallbackSpaceGlyph=he,this._fallbackTabGlyph=c(he,{x:0,y:0,xadvance:me,id:E,xoffset:0,yoffset:0,width:0,height:0})}},M.prototype.getGlyph=function(fe,he){return D(fe,he)||(he===E?this._fallbackTabGlyph:he===g?this._fallbackSpaceGlyph:null)},M.prototype.computeMetrics=function(fe,he,me,P){var ze,X=this._opt.letterSpacing||0,W=this._opt.font,te=0,ce=0,Se=0;if(!W.chars||0===W.chars.length)return{start:he,end:he,width:0};me=Math.min(fe.length,me);for(var rt=he;rt<me;rt++){var _e,gt=fe.charCodeAt(rt);if(_e=this.getGlyph(W,gt)){var un=(te+=ze?V(W,ze.id,_e.id):0)+_e.xadvance+X,In=te+_e.width;if(In>=P||un>=P)break;te=un,ce=In,ze=_e}Se++}return ze&&(ce+=ze.xoffset),{start:he,end:he+Se,width:ce}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function _(fe){Object.defineProperty(M.prototype,fe,{get:O(fe),configurable:!0})})},{"as-number":2,"word-wrapper":68,xtend:71}],37:[function(h,C,m){(function(s){var c=h("xhr"),u=function(){},p=h("parse-bmfont-ascii"),d=h("parse-bmfont-xml"),A=h("parse-bmfont-binary"),E=h("./lib/is-binary"),g=h("xtend"),v=self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;C.exports=function(M,_){_="function"==typeof _?_:u,"string"==typeof M?M={uri:M}:M||(M={}),M.binary&&(M=function y(M){if(v)return g(M,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var _=new self.XMLHttpRequest;return _.overrideMimeType("text/plain; charset=x-user-defined"),g({xhr:_},M)}(M)),c(M,function(D,B,H){if(D)return _(D);if(!/^2/.test(B.statusCode))return _(new Error("http status code: "+B.statusCode));if(!H)return _(new Error("no body result"));var ne,q=!1;if(function T(M){return"[object ArrayBuffer]"===Object.prototype.toString.call(M)}(H)){var V=new Uint8Array(H);H=new s(V,"binary")}E(H)&&(q=!0,"string"==typeof H&&(H=new s(H,"binary"))),q||(s.isBuffer(H)&&(H=H.toString(M.encoding)),H=H.trim());try{var ae=B.headers["content-type"];ne=q?A(H):/json/.test(ae)||"{"===H.charAt(0)?JSON.parse(H):/xml/.test(ae)||"<"===H.charAt(0)?d(H):p(H)}catch(fe){_(new Error("error parsing font "+fe.message)),_=u}_(null,ne)})}}).call(this,h("buffer").Buffer)},{"./lib/is-binary":38,buffer:6,"parse-bmfont-ascii":43,"parse-bmfont-binary":44,"parse-bmfont-xml":45,xhr:69,xtend:71}],38:[function(h,C,m){(function(s){var c=h("buffer-equal"),u=new s([66,77,70,3]);C.exports=function(p){return"string"==typeof p?"BMF"===p.substring(0,3):p.length>4&&c(p.slice(0,4),u)}}).call(this,h("buffer").Buffer)},{buffer:6,"buffer-equal":5}],39:[function(h,C,m){"use strict";var s=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable;function p(A){if(null==A)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(A)}C.exports=function d(){try{if(!Object.assign)return!1;var A=new String("abc");if(A[5]="de","5"===Object.getOwnPropertyNames(A)[0])return!1;for(var E={},g=0;g<10;g++)E["_"+String.fromCharCode(g)]=g;if("0123456789"!==Object.getOwnPropertyNames(E).map(function(y){return E[y]}).join(""))return!1;var T={};return"abcdefghijklmnopqrst".split("").forEach(function(y){T[y]=y}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},T)).join("")}catch{return!1}}()?Object.assign:function(A,E){for(var g,T,v=p(A),y=1;y<arguments.length;y++){for(var M in g=Object(arguments[y]))c.call(g,M)&&(v[M]=g[M]);if(s){T=s(g);for(var _=0;_<T.length;_++)u.call(g,T[_])&&(v[T[_]]=g[T[_]])}}return v}},{}],40:[function(h,C,m){"use strict";var s;if(!Object.keys){var c=Object.prototype.hasOwnProperty,u=Object.prototype.toString,p=h("./isArguments"),d=Object.prototype.propertyIsEnumerable,A=!d.call({toString:null},"toString"),E=d.call(function(){},"prototype"),g=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],v=function(_){var O=_.constructor;return O&&O.prototype===_},T={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},y=function(){if(typeof window>"u")return!1;for(var _ in window)try{if(!T["$"+_]&&c.call(window,_)&&null!==window[_]&&"object"==typeof window[_])try{v(window[_])}catch{return!0}}catch{return!0}return!1}();s=function(O){var D=null!==O&&"object"==typeof O,B="[object Function]"===u.call(O),H=p(O),q=D&&"[object String]"===u.call(O),V=[];if(!D&&!B&&!H)throw new TypeError("Object.keys called on a non-object");var ne=E&&B;if(q&&O.length>0&&!c.call(O,0))for(var ae=0;ae<O.length;++ae)V.push(String(ae));if(H&&O.length>0)for(var fe=0;fe<O.length;++fe)V.push(String(fe));else for(var he in O)(!ne||"prototype"!==he)&&c.call(O,he)&&V.push(String(he));if(A)for(var me=function(_){if(typeof window>"u"||!y)return v(_);try{return v(_)}catch{return!1}}(O),P=0;P<g.length;++P)(!me||"constructor"!==g[P])&&c.call(O,g[P])&&V.push(g[P]);return V}}C.exports=s},{"./isArguments":42}],41:[function(h,C,m){"use strict";var s=Array.prototype.slice,c=h("./isArguments"),u=Object.keys,p=u?function(E){return u(E)}:h("./implementation"),d=Object.keys;p.shim=function(){if(Object.keys){var E=function(){var g=Object.keys(arguments);return g&&g.length===arguments.length}(1,2);E||(Object.keys=function(v){return c(v)?d(s.call(v)):d(v)})}else Object.keys=p;return Object.keys||p},C.exports=p},{"./implementation":40,"./isArguments":42}],42:[function(h,C,m){"use strict";var s=Object.prototype.toString;C.exports=function(u){var p=s.call(u),d="[object Arguments]"===p;return d||(d="[object Array]"!==p&&null!==u&&"object"==typeof u&&"number"==typeof u.length&&u.length>=0&&"[object Function]"===s.call(u.callee)),d}},{}],43:[function(h,C,m){function s(p,d){if(!(p=p.replace(/\t+/g," ").trim()))return null;var A=p.indexOf(" ");if(-1===A)throw new Error("no named row at line "+d);var E=p.substring(0,A);p=(p=(p=(p=p.substring(A+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map(function(M){return M.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var g=[],v=0;v<p.length;v++){var T=p[v];0===v?g.push({key:T[0],data:""}):v===p.length-1?g[g.length-1].data=c(T[0]):(g[g.length-1].data=c(T[0]),g.push({key:T[1],data:""}))}var y={key:E,data:{}};return g.forEach(function(M){y.data[M.key]=M.data}),y}function c(p){return p&&0!==p.length?0===p.indexOf('"')||0===p.indexOf("'")?p.substring(1,p.length-1):-1!==p.indexOf(",")?function u(p){return p.split(",").map(function(d){return parseInt(d,10)})}(p):parseInt(p,10):""}C.exports=function(d){if(!d)throw new Error("no data provided");var A={pages:[],chars:[],kernings:[]},E=(d=d.toString().trim()).split(/\r\n?|\n/g);if(0===E.length)throw new Error("no data in BMFont file");for(var g=0;g<E.length;g++){var v=s(E[g],g);if(v)if("page"===v.key){if("number"!=typeof v.data.id)throw new Error("malformed file at line "+g+" -- needs page id=N");if("string"!=typeof v.data.file)throw new Error("malformed file at line "+g+' -- needs page file="path"');A.pages[v.data.id]=v.data.file}else"chars"===v.key||"kernings"===v.key||("char"===v.key?A.chars.push(v.data):"kerning"===v.key?A.kernings.push(v.data):A[v.key]=v.data)}return A}},{}],44:[function(h,C,m){var s=[66,77,70];function c(T,y,M){if(M>y.length-1)return 0;var _=y.readUInt8(M++),O=y.readInt32LE(M);switch(M+=4,_){case 1:T.info=function u(T,y){var M={};M.size=T.readInt16LE(y);var _=T.readUInt8(y+2);return M.smooth=_>>7&1,M.unicode=_>>6&1,M.italic=_>>5&1,M.bold=_>>4&1,_>>3&1&&(M.fixedHeight=1),M.charset=T.readUInt8(y+3)||"",M.stretchH=T.readUInt16LE(y+4),M.aa=T.readUInt8(y+6),M.padding=[T.readInt8(y+7),T.readInt8(y+8),T.readInt8(y+9),T.readInt8(y+10)],M.spacing=[T.readInt8(y+11),T.readInt8(y+12)],M.outline=T.readUInt8(y+13),M.face=function v(T,y){return g(T,y).toString("utf8")}(T,y+14),M}(y,M);break;case 2:T.common=function p(T,y){var M={};return M.lineHeight=T.readUInt16LE(y),M.base=T.readUInt16LE(y+2),M.scaleW=T.readUInt16LE(y+4),M.scaleH=T.readUInt16LE(y+6),M.pages=T.readUInt16LE(y+8),T.readUInt8(y+10),M.packed=0,M.alphaChnl=T.readUInt8(y+11),M.redChnl=T.readUInt8(y+12),M.greenChnl=T.readUInt8(y+13),M.blueChnl=T.readUInt8(y+14),M}(y,M);break;case 3:T.pages=function d(T,y,M){for(var _=[],O=g(T,y),D=O.length+1,B=M/D,H=0;H<B;H++)_[H]=T.slice(y,y+O.length).toString("utf8"),y+=D;return _}(y,M,O);break;case 4:T.chars=function A(T,y,M){for(var _=[],O=M/20,D=0;D<O;D++){var B={},H=20*D;B.id=T.readUInt32LE(y+0+H),B.x=T.readUInt16LE(y+4+H),B.y=T.readUInt16LE(y+6+H),B.width=T.readUInt16LE(y+8+H),B.height=T.readUInt16LE(y+10+H),B.xoffset=T.readInt16LE(y+12+H),B.yoffset=T.readInt16LE(y+14+H),B.xadvance=T.readInt16LE(y+16+H),B.page=T.readUInt8(y+18+H),B.chnl=T.readUInt8(y+19+H),_[D]=B}return _}(y,M,O);break;case 5:T.kernings=function E(T,y,M){for(var _=[],O=M/10,D=0;D<O;D++){var B={},H=10*D;B.first=T.readUInt32LE(y+0+H),B.second=T.readUInt32LE(y+4+H),B.amount=T.readInt16LE(y+8+H),_[D]=B}return _}(y,M,O)}return 5+O}function g(T,y){for(var M=y;M<T.length&&0!==T[M];M++);return T.slice(y,M)}C.exports=function(y){if(y.length<6)throw new Error("invalid buffer length for BMFont");if(!s.every(function(H,q){return y.readUInt8(q)===H}))throw new Error("BMFont missing BMF byte header");var _=3;if(y.readUInt8(_++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var D={kernings:[],chars:[]},B=0;B<5;B++)_+=c(D,y,_);return D}},{}],45:[function(h,C,m){var s=h("./parse-attribs"),c=h("xml-parse-from-string"),u={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};function p(E){var g=function d(E){for(var g=[],v=0;v<E.attributes.length;v++)g.push(E.attributes[v]);return g}(E);return g.reduce(function(v,T){var y=function A(E){return u[E.toLowerCase()]||E}(T.nodeName);return v[y]=T.nodeValue,v},{})}C.exports=function(g){g=g.toString();var v=c(g),T={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(H){var q=v.getElementsByTagName(H)[0];q&&(T[H]=s(p(q)))});var y=v.getElementsByTagName("pages")[0];if(!y)throw new Error("malformed file -- no <pages> element");for(var M=y.getElementsByTagName("page"),_=0;_<M.length;_++){var O=M[_],D=parseInt(O.getAttribute("id"),10),B=O.getAttribute("file");if(isNaN(D))throw new Error('malformed file -- page "id" attribute is NaN');if(!B)throw new Error('malformed file -- needs page "file" attribute');T.pages[parseInt(D,10)]=B}return["chars","kernings"].forEach(function(H){var q=v.getElementsByTagName(H)[0];if(q)for(var V=H.substring(0,H.length-1),ne=q.getElementsByTagName(V),ae=0;ae<ne.length;ae++)T[H].push(s(p(ne[ae])))}),T}},{"./parse-attribs":46,"xml-parse-from-string":70}],46:[function(h,C,m){var s="chasrset";C.exports=function(p){for(var d in s in p&&(p.charset=p[s],delete p[s]),p)"face"===d||"charset"===d||(p[d]="padding"===d||"spacing"===d?p[d].split(",").map(function(p){return parseInt(p,10)}):parseInt(p[d],10));return p}},{}],47:[function(h,C,m){var s=h("string.prototype.trim"),c=h("for-each");C.exports=function(p){if(!p)return{};var d={};return c(s(p).split("\n"),function(A){var E=A.indexOf(":"),g=s(A.slice(0,E)).toLowerCase(),v=s(A.slice(E+1));typeof d[g]>"u"?d[g]=v:function(p){return"[object Array]"===Object.prototype.toString.call(p)}(d[g])?d[g].push(v):d[g]=[d[g],v]}),d}},{"for-each":24,"string.prototype.trim":53}],48:[function(h,C,m){(function(s){var c=s.performance||{},u=function(){for(var p=["now","webkitNow","msNow","mozNow","oNow"];p.length;){var d=p.shift();if(d in c)return c[d].bind(c)}var A=Date.now||function(){return(new Date).getTime()},E=(c.timing||{}).navigationStart||A();return function(){return A()-E}}();u.performanceNow=c.now,u.noConflict=function(){c.now=u.performanceNow},u.conflict=function(){c.now=u},u.conflict(),C.exports=u}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],49:[function(h,C,m){var c,u,s=C.exports={};function p(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function A(B){if(c===setTimeout)return setTimeout(B,0);if((c===p||!c)&&setTimeout)return c=setTimeout,setTimeout(B,0);try{return c(B,0)}catch{try{return c.call(null,B,0)}catch{return c.call(this,B,0)}}}!function(){try{c="function"==typeof setTimeout?setTimeout:p}catch{c=p}try{u="function"==typeof clearTimeout?clearTimeout:d}catch{u=d}}();var T,g=[],v=!1,y=-1;function M(){!v||!T||(v=!1,T.length?g=T.concat(g):y=-1,g.length&&_())}function _(){if(!v){var B=A(M);v=!0;for(var H=g.length;H;){for(T=g,g=[];++y<H;)T&&T[y].run();y=-1,H=g.length}T=null,v=!1,function E(B){if(u===clearTimeout)return clearTimeout(B);if((u===d||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(B);try{u(B)}catch{try{return u.call(null,B)}catch{return u.call(this,B)}}}(B)}}function O(B,H){this.fun=B,this.array=H}function D(){}s.nextTick=function(B){var H=new Array(arguments.length-1);if(arguments.length>1)for(var q=1;q<arguments.length;q++)H[q-1]=arguments[q];g.push(new O(B,H)),1===g.length&&!v&&A(_)},O.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=D,s.addListener=D,s.once=D,s.off=D,s.removeListener=D,s.removeAllListeners=D,s.emit=D,s.prependListener=D,s.prependOnceListener=D,s.listeners=function(B){return[]},s.binding=function(B){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(B){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],50:[function(h,C,m){(function(s){!function(c){var u=setTimeout,p="function"==typeof s&&s||function(O){u(O,1)};function d(O,D){return function(){O.apply(D,arguments)}}var A=Array.isArray||function(O){return"[object Array]"===Object.prototype.toString.call(O)};function E(O){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof O)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],_(O,d(v,this),d(T,this))}function g(O){var D=this;null!==this._state?p(function(){var B=D._state?O.onFulfilled:O.onRejected;if(null!==B){var H;try{H=B(D._value)}catch(q){return void O.reject(q)}O.resolve(H)}else(D._state?O.resolve:O.reject)(D._value)}):this._deferreds.push(O)}function v(O){try{if(O===this)throw new TypeError("A promise cannot be resolved with itself.");if(O&&("object"==typeof O||"function"==typeof O)){var D=O.then;if("function"==typeof D)return void _(d(D,O),d(v,this),d(T,this))}this._state=!0,this._value=O,y.call(this)}catch(B){T.call(this,B)}}function T(O){this._state=!1,this._value=O,y.call(this)}function y(){for(var O=0,D=this._deferreds.length;O<D;O++)g.call(this,this._deferreds[O]);this._deferreds=null}function M(O,D,B,H){this.onFulfilled="function"==typeof O?O:null,this.onRejected="function"==typeof D?D:null,this.resolve=B,this.reject=H}function _(O,D,B){var H=!1;try{O(function(q){H||(H=!0,D(q))},function(q){H||(H=!0,B(q))})}catch(q){if(H)return;H=!0,B(q)}}E.prototype.catch=function(O){return this.then(null,O)},E.prototype.then=function(O,D){var B=this;return new E(function(H,q){g.call(B,new M(O,D,H,q))})},E.all=function(){var O=Array.prototype.slice.call(1===arguments.length&&A(arguments[0])?arguments[0]:arguments);return new E(function(D,B){if(0===O.length)return D([]);var H=O.length;function q(ne,ae){try{if(ae&&("object"==typeof ae||"function"==typeof ae)){var fe=ae.then;if("function"==typeof fe)return void fe.call(ae,function(he){q(ne,he)},B)}O[ne]=ae,0==--H&&D(O)}catch(he){B(he)}}for(var V=0;V<O.length;V++)q(V,O[V])})},E.resolve=function(O){return O&&"object"==typeof O&&O.constructor===E?O:new E(function(D){D(O)})},E.reject=function(O){return new E(function(D,B){B(O)})},E.race=function(O){return new E(function(D,B){for(var H=0,q=O.length;H<q;H++)O[H].then(D,B)})},E._setImmediateFn=function(D){p=D},typeof C<"u"&&C.exports?C.exports=E:c.Promise||(c.Promise=E)}(this)}).call(this,h("timers").setImmediate)},{timers:66}],51:[function(h,C,m){var s=h("dtype"),c=h("an-array"),u=h("is-buffer"),p=[0,2,3],d=[2,1,3];C.exports=function(E,g){(!E||!c(E)&&!u(E))&&(g=E||{},E=null);for(var y=(g="number"==typeof g?{count:g}:g||{}).start||0,M=!1!==g.clockwise?p:d,_=M[0],O=M[1],D=M[2],B=6*("number"==typeof g.count?g.count:1),H=E||new(s("string"==typeof g.type?g.type:"uint16"))(B),q=0,V=0;q<B;q+=6,V+=4){var ne=q+y;H[ne+0]=V+0,H[ne+1]=V+1,H[ne+2]=V+2,H[ne+3]=V+_,H[ne+4]=V+O,H[ne+5]=V+D}return H}},{"an-array":1,dtype:13,"is-buffer":31}],52:[function(h,C,m){"use strict";var s=h("function-bind"),c=h("es-abstract/es5"),u=s.call(Function.call,String.prototype.replace),p=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,d=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;C.exports=function(){var E=c.ToString(c.CheckObjectCoercible(this));return u(u(E,p,""),d,"")}},{"es-abstract/es5":15,"function-bind":26}],53:[function(h,C,m){"use strict";var s=h("function-bind"),c=h("define-properties"),u=h("./implementation"),p=h("./polyfill"),d=h("./shim"),A=s.call(Function.call,p());c(A,{getPolyfill:p,implementation:u,shim:d}),C.exports=A},{"./implementation":52,"./polyfill":54,"./shim":55,"define-properties":11,"function-bind":26}],54:[function(h,C,m){"use strict";var s=h("./implementation");C.exports=function(){return String.prototype.trim&&"\u200b"==="\u200b".trim()?String.prototype.trim:s}},{"./implementation":52}],55:[function(h,C,m){"use strict";var s=h("define-properties"),c=h("./polyfill");C.exports=function(){var p=c();return s(String.prototype,{trim:p},{trim:function(){return String.prototype.trim!==p}}),p}},{"./polyfill":54,"define-properties":11}],56:[function(h,C,m){"use strict";var s={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},c={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},u=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],p={CSS:{},springs:{}};function d(Pe,Qe,yt){return Math.min(Math.max(Pe,Qe),yt)}function A(Pe,Qe){return Pe.indexOf(Qe)>-1}function E(Pe,Qe){return Pe.apply(null,Qe)}var g=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,v=/^rgb/,T=/^hsl/,y={arr:function(Pe){return Array.isArray(Pe)},obj:function(Pe){return A(Object.prototype.toString.call(Pe),"Object")},pth:function(Pe){return y.obj(Pe)&&Pe.hasOwnProperty("totalLength")},svg:function(Pe){return Pe instanceof SVGElement},inp:function(Pe){return Pe instanceof HTMLInputElement},dom:function(Pe){return Pe.nodeType||y.svg(Pe)},str:function(Pe){return"string"==typeof Pe},fnc:function(Pe){return"function"==typeof Pe},und:function(Pe){return typeof Pe>"u"},hex:function(Pe){return g.test(Pe)},rgb:function(Pe){return v.test(Pe)},hsl:function(Pe){return T.test(Pe)},col:function(Pe){return y.hex(Pe)||y.rgb(Pe)||y.hsl(Pe)},key:function(Pe){return!s.hasOwnProperty(Pe)&&!c.hasOwnProperty(Pe)&&"targets"!==Pe&&"keyframes"!==Pe}},M=/\(([^)]+)\)/;function _(Pe){var Qe=M.exec(Pe);return Qe?Qe[1].split(",").map(function(yt){return parseFloat(yt)}):[]}function O(Pe,Qe){var yt=_(Pe),Nt=d(y.und(yt[0])?1:yt[0],.1,100),Dt=d(y.und(yt[1])?100:yt[1],.1,100),Qt=d(y.und(yt[2])?10:yt[2],.1,100),gn=d(y.und(yt[3])?0:yt[3],.1,100),On=Math.sqrt(Dt/Nt),bn=Qt/(2*Math.sqrt(Dt*Nt)),Wt=bn<1?On*Math.sqrt(1-bn*bn):0,qn=bn<1?(bn*On-gn)/Wt:-gn+On;function rr(xr){var ir=Qe?Qe*xr/1e3:xr;return ir=bn<1?Math.exp(-ir*bn*On)*(1*Math.cos(Wt*ir)+qn*Math.sin(Wt*ir)):(1+qn*ir)*Math.exp(-ir*On),0===xr||1===xr?xr:1-ir}return Qe?rr:function pi(){var xr=p.springs[Pe];if(xr)return xr;for(var ir=1/6,cr=0,Jr=0;;)if(1===rr(cr+=ir)){if(++Jr>=16)break}else Jr=0;var li=cr*ir*1e3;return p.springs[Pe]=li,li}}function D(Pe,Qe){void 0===Pe&&(Pe=1),void 0===Qe&&(Qe=.5);var yt=d(Pe,1,10),Nt=d(Qe,.1,2);return function(Dt){return 0===Dt||1===Dt?Dt:-yt*Math.pow(2,10*(Dt-1))*Math.sin((Dt-1-Nt/(2*Math.PI)*Math.asin(1/yt))*(2*Math.PI)/Nt)}}function B(Pe){return void 0===Pe&&(Pe=10),function(Qe){return Math.round(Qe*Pe)*(1/Pe)}}var H=function(){function yt(Wn,qn){return 1-3*qn+3*Wn}function Nt(Wn,qn){return 3*qn-6*Wn}function Dt(Wn){return 3*Wn}function Qt(Wn,qn,rr){return((yt(qn,rr)*Wn+Nt(qn,rr))*Wn+Dt(qn))*Wn}function gn(Wn,qn,rr){return 3*yt(qn,rr)*Wn*Wn+2*Nt(qn,rr)*Wn+Dt(qn)}return function Wt(Wn,qn,rr,pi){if(0<=Wn&&Wn<=1&&0<=rr&&rr<=1){var xr=new Float32Array(11);if(Wn!==qn||rr!==pi)for(var ir=0;ir<11;++ir)xr[ir]=Qt(.1*ir,Wn,rr);return function(Jr){return Wn===qn&&rr===pi||0===Jr||1===Jr?Jr:Qt(function cr(Jr){for(var li=0,hr=1;10!==hr&&xr[hr]<=Jr;++hr)li+=.1;--hr;var ta=li+(Jr-xr[hr])/(xr[hr+1]-xr[hr])*.1,ci=gn(ta,Wn,rr);return ci>=.001?function bn(Wn,qn,rr,pi){for(var xr=0;xr<4;++xr){var ir=gn(qn,rr,pi);if(0===ir)return qn;qn-=(Qt(qn,rr,pi)-Wn)/ir}return qn}(Jr,ta,Wn,rr):0===ci?ta:function On(Wn,qn,rr,pi,xr){var ir,cr,Jr=0;do{(ir=Qt(cr=qn+(rr-qn)/2,pi,xr)-Wn)>0?rr=cr:qn=cr}while(Math.abs(ir)>1e-7&&++Jr<10);return cr}(Jr,li,li+.1,Wn,rr)}(Jr),qn,pi)}}}}(),q=function(){var Pe=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],Qe={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],D],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(gn,On){return function(bn){return 1-D(gn,On)(1-bn)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(gn,On){return function(bn){return bn<.5?D(gn,On)(2*bn)/2:1-D(gn,On)(-2*bn+2)/2}}]},yt={linear:[.25,.25,.75,.75]};for(var Nt in Qe)for(var Dt=0,Qt=Qe[Nt].length;Dt<Qt;Dt++)yt["ease"+Nt+Pe[Dt]]=Qe[Nt][Dt];return yt}();function V(Pe,Qe){if(y.fnc(Pe))return Pe;var yt=Pe.split("(")[0],Nt=q[yt],Dt=_(Pe);switch(yt){case"spring":return O(Pe,Qe);case"cubicBezier":return E(H,Dt);case"steps":return E(B,Dt);default:return y.fnc(Nt)?E(Nt,Dt):E(H,Nt)}}function ne(Pe){try{return document.querySelectorAll(Pe)}catch{return}}var ae=[];function fe(Pe,Qe){for(var yt=ae,Nt=Pe.length,Dt=arguments.length>=2?arguments[1]:void 0,Qt=0;Qt<Nt;Qt++)if(Qt in Pe){var gn=Pe[Qt];Qe.call(Dt,gn,Qt,Pe)&&yt.push(gn)}return(ae=Pe).length=0,yt}function he(Pe,Qe){Qe||(Qe=[]);for(var yt=0,Nt=Pe.length;yt<Nt;yt++){var Dt=Pe[yt];Array.isArray(Dt)?he(Dt,Qe):Qe.push(Dt)}return Qe}function me(Pe){return y.arr(Pe)?Pe:(y.str(Pe)&&(Pe=ne(Pe)||Pe),Pe instanceof NodeList||Pe instanceof HTMLCollection?[].slice.call(Pe):[Pe])}function P(Pe,Qe){return Pe.some(function(yt){return yt===Qe})}function X(Pe){var Qe={};for(var yt in Pe)Qe[yt]=Pe[yt];return Qe}function W(Pe,Qe){var yt=X(Pe);for(var Nt in Pe)yt[Nt]=Qe.hasOwnProperty(Nt)?Qe[Nt]:Pe[Nt];return yt}function te(Pe,Qe){var yt=X(Pe);for(var Nt in Qe)yt[Nt]=y.und(Pe[Nt])?Qe[Nt]:Pe[Nt];return yt}var ce=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g,_e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,ze=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,gt=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,Tt=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;var In=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function sn(Pe){var Qe=In.exec(Pe);if(Qe)return Qe[2]}function Cr(Pe,Qe){return y.fnc(Pe)?Pe(Qe.target,Qe.id,Qe.total):Pe}function Un(Pe,Qe){return Pe.getAttribute(Qe)}function Re(Pe,Qe,yt){if(P([yt,"deg","rad","turn"],sn(Qe)))return Qe;var Dt=p.CSS[Qe+yt];if(!y.und(Dt))return Dt;var gn=document.createElement(Pe.tagName),On=Pe.parentNode&&Pe.parentNode!==document?Pe.parentNode:document.body;On.appendChild(gn),gn.style.position="absolute",gn.style.width=100+yt;var bn=100/gn.offsetWidth;On.removeChild(gn);var Wt=bn*parseFloat(Qe);return p.CSS[Qe+yt]=Wt,Wt}function Oe(Pe,Qe,yt){if(Qe in Pe.style){var Nt=Qe.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Dt=Pe.style[Qe]||getComputedStyle(Pe).getPropertyValue(Nt)||"0";return yt?Re(Pe,Dt,yt):Dt}}function $e(Pe,Qe){return y.dom(Pe)&&!y.inp(Pe)&&(Un(Pe,Qe)||y.svg(Pe)&&Pe[Qe])?"attribute":y.dom(Pe)&&P(u,Qe)?"transform":y.dom(Pe)&&"transform"!==Qe&&Oe(Pe,Qe)?"css":null!=Pe[Qe]?"object":void 0}var Ve=/(\w+)\(([^)]*)\)/g;function Ke(Pe){if(y.dom(Pe)){for(var Nt,Qe=Pe.style.transform||"",yt=new Map;Nt=Ve.exec(Qe);)yt.set(Nt[1],Nt[2]);return yt}}function ut(Pe,Qe,yt,Nt){switch($e(Pe,Qe)){case"transform":return function nt(Pe,Qe,yt,Nt){var Dt=A(Qe,"scale")?1:0+function tr(Pe){return A(Pe,"translate")||"perspective"===Pe?"px":A(Pe,"rotate")||A(Pe,"skew")?"deg":void 0}(Qe),Qt=Ke(Pe).get(Qe)||Dt;return yt&&(yt.transforms.list.set(Qe,Qt),yt.transforms.last=Qe),Nt?Re(Pe,Qt,Nt):Qt}(Pe,Qe,Nt,yt);case"css":return Oe(Pe,Qe,yt);case"attribute":return Un(Pe,Qe);default:return Pe[Qe]||0}}var ht=/^(\*=|\+=|-=)/;function _t(Pe,Qe){var yt=ht.exec(Pe);if(!yt)return Pe;var Nt=sn(Pe)||0,Dt=parseFloat(Qe),Qt=parseFloat(Pe.replace(yt[0],""));switch(yt[0][0]){case"+":return Dt+Qt+Nt;case"-":return Dt-Qt+Nt;case"*":return Dt*Qt+Nt}}var Bt=/\s/g;function Kt(Pe,Qe){if(y.col(Pe))return function un(Pe){return y.rgb(Pe)?function Se(Pe){var Qe=ce.exec(Pe);return Qe?"rgba("+Qe[1]+",1)":Pe}(Pe):y.hex(Pe)?function rt(Pe){var Qe=Pe.replace(_e,function(gn,On,bn,Wt){return On+On+bn+bn+Wt+Wt}),yt=ze.exec(Qe);return"rgba("+parseInt(yt[1],16)+","+parseInt(yt[2],16)+","+parseInt(yt[3],16)+",1)"}(Pe):y.hsl(Pe)?function $t(Pe){var On,bn,Wt,Qe=gt.exec(Pe)||Tt.exec(Pe),yt=parseInt(Qe[1],10)/360,Nt=parseInt(Qe[2],10)/100,Dt=parseInt(Qe[3],10)/100,Qt=Qe[4]||1;function gn(rr,pi,xr){return xr<0&&(xr+=1),xr>1&&(xr-=1),xr<1/6?rr+6*(pi-rr)*xr:xr<.5?pi:xr<2/3?rr+(pi-rr)*(2/3-xr)*6:rr}if(0==Nt)On=bn=Wt=Dt;else{var Wn=Dt<.5?Dt*(1+Nt):Dt+Nt-Dt*Nt,qn=2*Dt-Wn;On=gn(qn,Wn,yt+1/3),bn=gn(qn,Wn,yt),Wt=gn(qn,Wn,yt-1/3)}return"rgba("+255*On+","+255*bn+","+255*Wt+","+Qt+")"}(Pe):void 0}(Pe);var yt=sn(Pe),Nt=yt?Pe.substr(0,Pe.length-yt.length):Pe;return Qe&&!Bt.test(Pe)?Nt+Qe:Nt}function rn(Pe,Qe){return Math.sqrt(Math.pow(Qe.x-Pe.x,2)+Math.pow(Qe.y-Pe.y,2))}function le(Pe){for(var Nt,Qe=Pe.points,yt=0,Dt=0;Dt<Qe.numberOfItems;Dt++){var Qt=Qe.getItem(Dt);Dt>0&&(yt+=rn(Nt,Qt)),Nt=Qt}return yt}function Ye(Pe){if(Pe.getTotalLength)return Pe.getTotalLength();switch(Pe.tagName.toLowerCase()){case"circle":return function mn(Pe){return 2*Math.PI*Un(Pe,"r")}(Pe);case"rect":return function Ce(Pe){return 2*Un(Pe,"width")+2*Un(Pe,"height")}(Pe);case"line":return function ie(Pe){return rn({x:Un(Pe,"x1"),y:Un(Pe,"y1")},{x:Un(Pe,"x2"),y:Un(Pe,"y2")})}(Pe);case"polyline":return le(Pe);case"polygon":return function Fe(Pe){var Qe=Pe.points;return le(Pe)+rn(Qe.getItem(Qe.numberOfItems-1),Qe.getItem(0))}(Pe)}}function qe(Pe,Qe){var yt=Qe||{},Nt=yt.el||function Me(Pe){for(var Qe=Pe.parentNode;y.svg(Qe)&&y.svg((Qe=Qe.parentNode).parentNode););return Qe}(Pe),Dt=Nt.getBoundingClientRect(),Qt=Un(Nt,"viewBox"),gn=Dt.width,On=Dt.height,bn=yt.viewBox||(Qt?Qt.split(" "):[0,0,gn,On]);return{el:Nt,viewBox:bn,x:bn[0]/1,y:bn[1]/1,w:gn/bn[2],h:On/bn[3]}}function ot(Pe,Qe){function yt(On){return void 0===On&&(On=0),Pe.el.getPointAtLength(Qe+On>=1?Qe+On:0)}var Nt=qe(Pe.el,Pe.svg),Dt=yt(),Qt=yt(-1),gn=yt(1);switch(Pe.property){case"x":return(Dt.x-Nt.x)*Nt.w;case"y":return(Dt.y-Nt.y)*Nt.h;case"angle":return 180*Math.atan2(gn.y-Qt.y,gn.x-Qt.x)/Math.PI}}var dt=/-?\d*\.?\d+/g;function St(Pe,Qe){var yt=Kt(y.pth(Pe)?Pe.totalLength:Pe,Qe)+"";return{original:yt,numbers:yt.match(dt)?yt.match(dt).map(Number):[0],strings:y.str(Pe)||Qe?yt.split(dt):[]}}function It(Pe){return fe(Pe?he(y.arr(Pe)?Pe.map(me):me(Pe)):[],function(yt,Nt,Dt){return Dt.indexOf(yt)===Nt})}function Zt(Pe){var Qe=It(Pe);return Qe.map(function(yt,Nt){return{target:yt,id:Nt,total:Qe.length,transforms:{list:Ke(yt)}}})}var Xt=/^spring/;function Vt(Pe,Qe){var yt=X(Qe);if(Xt.test(yt.easing)&&(yt.duration=O(yt.easing)),y.arr(Pe)){var Nt=Pe.length;2!==Nt||y.obj(Pe[0])?y.fnc(Qe.duration)||(yt.duration=Qe.duration/Nt):Pe={value:Pe}}var Qt=y.arr(Pe)?Pe:[Pe];return Qt.map(function(gn,On){var bn=y.obj(gn)&&!y.pth(gn)?gn:{value:gn};return y.und(bn.delay)&&(bn.delay=On?0:Qe.delay),y.und(bn.endDelay)&&(bn.endDelay=On===Qt.length-1?Qe.endDelay:0),bn}).map(function(gn){return te(gn,yt)})}var kt={css:function(Pe,Qe,yt){return Pe.style[Qe]=yt},attribute:function(Pe,Qe,yt){return Pe.setAttribute(Qe,yt)},object:function(Pe,Qe,yt){return Pe[Qe]=yt},transform:function(Pe,Qe,yt,Nt,Dt){if(Nt.list.set(Qe,yt),Qe===Nt.last||Dt){var Qt="";Nt.list.forEach(function(gn,On){Qt+=On+"("+gn+") "}),Pe.style.transform=Qt}}};function Ft(Pe,Qe){for(var yt=Zt(Pe),Nt=0,Dt=yt.length;Nt<Dt;Nt++){var Qt=yt[Nt];for(var gn in Qe){var On=Cr(Qe[gn],Qt),bn=Qt.target,Wt=sn(On),Wn=ut(bn,gn,Wt,Qt),rr=_t(Kt(On,Wt||sn(Wn)),Wn),pi=$e(bn,gn);kt[pi](bn,gn,rr,Qt.transforms,!0)}}}function ln(Pe,Qe){return fe(he(Pe.map(function(yt){return Qe.map(function(Nt){return function jt(Pe,Qe){var yt=$e(Pe.target,Qe.name);if(yt){var Nt=function Ht(Pe,Qe){var yt;return Pe.tweens.map(function(Nt){var Dt=function Mt(Pe,Qe){var yt={};for(var Nt in Pe){var Dt=Cr(Pe[Nt],Qe);y.arr(Dt)&&1===(Dt=Dt.map(function(Qt){return Cr(Qt,Qe)})).length&&(Dt=Dt[0]),yt[Nt]=Dt}return yt.duration=parseFloat(yt.duration),yt.delay=parseFloat(yt.delay),yt}(Nt,Qe),Qt=Dt.value,gn=y.arr(Qt)?Qt[1]:Qt,On=sn(gn),bn=ut(Qe.target,Pe.name,On,Qe),Wt=yt?yt.to.original:bn,Wn=y.arr(Qt)?Qt[0]:Wt,qn=sn(Wn)||sn(bn),rr=On||qn;return y.und(gn)&&(gn=Wt),Dt.from=St(Wn,rr),Dt.to=St(_t(gn,Wn),rr),Dt.start=yt?yt.end:0,Dt.end=Dt.start+Dt.delay+Dt.duration+Dt.endDelay,Dt.easing=V(Dt.easing,Dt.duration),Dt.isPath=y.pth(Qt),Dt.isColor=y.col(Dt.from.original),Dt.isColor&&(Dt.round=1),yt=Dt,Dt})}(Qe,Pe),Dt=Nt[Nt.length-1];return{type:yt,property:Qe.name,animatable:Pe,tweens:Nt,duration:Dt.end,delay:Nt[0].delay,endDelay:Dt.endDelay}}}(yt,Nt)})})),function(yt){return!y.und(yt)})}function vn(Pe,Qe){var yt=Pe.length,Nt=function(Qt){return Qt.timelineOffset?Qt.timelineOffset:0},Dt={};return Dt.duration=yt?Math.max.apply(Math,Pe.map(function(Qt){return Nt(Qt)+Qt.duration})):Qe.duration,Dt.delay=yt?Math.min.apply(Math,Pe.map(function(Qt){return Nt(Qt)+Qt.delay})):Qe.delay,Dt.endDelay=yt?Dt.duration-Math.max.apply(Math,Pe.map(function(Qt){return Nt(Qt)+Qt.duration-Qt.endDelay})):Qe.endDelay,Dt}var Pn,hn=0,xn=[],nr=[],jr=function(){function Pe(){Pn=requestAnimationFrame(Qe)}function Qe(yt){var Nt=xn.length;if(Nt){for(var Dt=0;Dt<Nt;){var Qt=xn[Dt];if(Qt.paused){var gn=xn.indexOf(Qt);gn>-1&&(xn.splice(gn,1),Nt=xn.length)}else Qt.tick(yt);Dt++}Pe()}else Pn=cancelAnimationFrame(Pn)}return Pe}();function ur(Pe){void 0===Pe&&(Pe={});var Dt,Qe=0,yt=0,Nt=0,Qt=0,gn=null;function On(){return window.Promise&&new Promise(function(hr){return gn=hr})}var bn=On(),Wt=function zn(Pe){var Qe=W(s,Pe),yt=W(c,Pe),Nt=function ft(Pe,Qe){var yt=[],Nt=Qe.keyframes;for(var Dt in Nt&&(Qe=te(function We(Pe){for(var Qe=fe(he(Pe.map(function(Qt){return Object.keys(Qt)})),function(Qt){return y.key(Qt)}).reduce(function(Qt,gn){return Qt.indexOf(gn)<0&&Qt.push(gn),Qt},[]),yt={},Nt=function(Qt){var gn=Qe[Qt];yt[gn]=Pe.map(function(On){var bn={};for(var Wt in On)y.key(Wt)?Wt==gn&&(bn.value=On[Wt]):bn[Wt]=On[Wt];return bn})},Dt=0;Dt<Qe.length;Dt++)Nt(Dt);return yt}(Nt),Qe)),Qe)y.key(Dt)&&yt.push({name:Dt,tweens:Vt(Qe[Dt],Pe)});return yt}(yt,Pe),Dt=Zt(Pe.targets),Qt=ln(Dt,Nt),gn=vn(Qt,yt),On=hn;return hn++,te(Qe,{id:On,children:[],animatables:Dt,animations:Qt,duration:gn.duration,delay:gn.delay,endDelay:gn.endDelay})}(Pe);function Wn(){Wt.reversed=!Wt.reversed;for(var hr=0,Ir=Dt.length;hr<Ir;hr++)Dt[hr].reversed=Wt.reversed}function qn(hr){return Wt.reversed?Wt.duration-hr:hr}function rr(){Qe=0,yt=qn(Wt.currentTime)*(1/ur.speed)}function pi(hr,Ir){Ir&&Ir.seek(hr-Ir.timelineOffset)}function ir(hr){for(var Ir=0,Br=Wt.animations,ta=Br.length;Ir<ta;){var ci=Br[Ir],bi=ci.animatable,J=ci.tweens,$=J.length-1,ye=J[$];$&&(ye=fe(J,function(Ci){return hr<Ci.end})[0]||ye);for(var xe=d(hr-ye.start-ye.delay,0,ye.duration)/ye.duration,Ue=isNaN(xe)?1:ye.easing(xe),ct=ye.to.strings,Et=ye.round,an=[],on=ye.to.numbers.length,Ct=void 0,Ut=0;Ut<on;Ut++){var pn=void 0,Bn=ye.to.numbers[Ut],Yn=ye.from.numbers[Ut]||0;pn=ye.isPath?ot(ye.value,Ue*Bn):Yn+Ue*(Bn-Yn),Et&&(ye.isColor&&Ut>2||(pn=Math.round(pn*Et)/Et)),an.push(pn)}var or=ct.length;if(or){Ct=ct[0];for(var Mr=0;Mr<or;Mr++){var vr=ct[Mr+1],ni=an[Mr];isNaN(ni)||(Ct+=vr?ni+vr:ni+" ")}}else Ct=an[0];kt[ci.type](bi.target,ci.property,Ct,bi.transforms),ci.currentValue=Ct,Ir++}}function cr(hr){Wt[hr]&&!Wt.passThrough&&Wt[hr](Wt)}function li(hr){var Ir=Wt.duration,Br=Wt.delay,ta=Ir-Wt.endDelay,ci=qn(hr);Wt.progress=d(ci/Ir*100,0,100),Wt.reversePlayback=ci<Wt.currentTime,Dt&&function xr(hr){if(Wt.reversePlayback)for(var Br=Qt;Br--;)pi(hr,Dt[Br]);else for(var Ir=0;Ir<Qt;Ir++)pi(hr,Dt[Ir])}(ci),!Wt.began&&Wt.currentTime>0&&(Wt.began=!0,cr("begin"),cr("loopBegin")),ci<=Br&&0!==Wt.currentTime&&ir(0),(ci>=ta&&Wt.currentTime!==Ir||!Ir)&&ir(Ir),ci>Br&&ci<ta?(Wt.changeBegan||(Wt.changeBegan=!0,Wt.changeCompleted=!1,cr("changeBegin")),cr("change"),ir(ci)):Wt.changeBegan&&(Wt.changeCompleted=!0,Wt.changeBegan=!1,cr("changeComplete")),Wt.currentTime=d(ci,0,Ir),Wt.began&&cr("update"),hr>=Ir&&(yt=0,function Jr(){Wt.remaining&&!0!==Wt.remaining&&Wt.remaining--}(),Wt.remaining?(Qe=Nt,cr("loopComplete"),cr("loopBegin"),"alternate"===Wt.direction&&Wn()):(Wt.paused=!0,Wt.completed||(Wt.completed=!0,cr("loopComplete"),cr("complete"),"Promise"in window&&(gn(),bn=On()))))}return Wt.reset=function(){var hr=Wt.direction;Wt.passThrough=!1,Wt.currentTime=0,Wt.progress=0,Wt.paused=!0,Wt.began=!1,Wt.changeBegan=!1,Wt.completed=!1,Wt.changeCompleted=!1,Wt.reversePlayback=!1,Wt.reversed="reverse"===hr,Wt.remaining=Wt.loop;for(var Ir=Qt=(Dt=Wt.children).length;Ir--;)Wt.children[Ir].reset();(Wt.reversed&&!0!==Wt.loop||"alternate"===hr&&1===Wt.loop)&&Wt.remaining++,ir(0)},Wt.set=function(hr,Ir){return Ft(hr,Ir),Wt},Wt.tick=function(hr){Nt=hr,Qe||(Qe=Nt),li((Nt+(yt-Qe))*ur.speed)},Wt.seek=function(hr){li(qn(hr))},Wt.pause=function(){Wt.paused=!0,rr()},Wt.play=function(){Wt.paused&&(Wt.paused=!1,xn.push(Wt),rr(),Pn||jr())},Wt.reverse=function(){Wn(),rr()},Wt.restart=function(){Wt.reset(),Wt.play()},Wt.finished=bn,Wt.reset(),Wt.autoplay&&Wt.play(),Wt}function Si(Pe,Qe){for(var yt=Qe.length;yt--;)P(Pe,Qe[yt].animatable.target)&&Qe.splice(yt,1)}document.addEventListener("visibilitychange",function Xr(){if(document.hidden){for(var Pe=0,Qe=xn.length;Pe<Qe;Pe++)activeInstance[Pe].pause();nr=xn.slice(0),xn=[]}else for(var yt=0,Nt=nr.length;yt<Nt;yt++)nr[yt].play()}),ur.version="3.0.0",ur.speed=1,ur.running=xn,ur.remove=function ti(Pe){for(var Qe=It(Pe),yt=xn.length;yt--;){var Nt=xn[yt],Dt=Nt.animations,Qt=Nt.children;Si(Qe,Dt);for(var gn=Qt.length;gn--;){var On=Qt[gn],bn=On.animations;Si(Qe,bn),!bn.length&&!On.children.length&&Qt.splice(gn,1)}!Dt.length&&!Qt.length&&Nt.pause()}},ur.get=ut,ur.set=Ft,ur.convertPx=Re,ur.path=function at(Pe,Qe){var yt=y.str(Pe)?ne(Pe)[0]:Pe,Nt=Qe||100;return function(Dt){return{property:Dt,el:yt,svg:qe(yt),totalLength:Ye(yt)*(Nt/100)}}},ur.setDashoffset=function Pt(Pe){var Qe=Ye(Pe);return Pe.setAttribute("stroke-dasharray",Qe),Qe},ur.stagger=function Pr(Pe,Qe){void 0===Qe&&(Qe={});var yt=Qe.direction||"normal",Nt=Qe.easing?V(Qe.easing):null,Dt=Qe.grid,Qt=Qe.axis,gn=Qe.from||0,On="first"===gn,bn="center"===gn,Wt="last"===gn,Wn=y.arr(Pe),qn=parseFloat(Wn?Pe[0]:Pe),rr=Wn?parseFloat(Pe[1]):0,pi=sn(Wn?Pe[1]:Pe)||0,xr=Qe.start||0+(Wn?qn:0),ir=[],cr=0;return function(Jr,li,hr){if(On&&(gn=0),bn&&(gn=(hr-1)/2),Wt&&(gn=hr-1),!ir.length){for(var Ir=0;Ir<hr;Ir++){if(Dt){var Br=bn?(Dt[0]-1)/2:gn%Dt[0],ta=bn?(Dt[1]-1)/2:Math.floor(gn/Dt[0]),J=Br-Ir%Dt[0],$=ta-Math.floor(Ir/Dt[0]),ye=Math.sqrt(J*J+$*$);"x"===Qt&&(ye=-J),"y"===Qt&&(ye=-$),ir.push(ye)}else ir.push(Math.abs(gn-Ir));cr=Math.max.apply(Math,ir)}Nt&&(ir=ir.map(function(Ue){return Nt(Ue/cr)*cr})),"reverse"===yt&&(ir=ir.map(function(Ue){return Qt?Ue<0?-1*Ue:-Ue:Math.abs(cr-Ue)}))}return xr+(Wn?(rr-qn)/cr:qn)*(Math.round(100*ir[li])/100)+pi}},ur.timeline=function xa(Pe){void 0===Pe&&(Pe={});var Qe=ur(Pe);return Qe.duration=0,Qe.add=function(yt,Nt){var Dt=xn.indexOf(Qe),Qt=Qe.children;function gn(rr){rr.passThrough=!0}Dt>-1&&xn.splice(Dt,1);for(var On=0;On<Qt.length;On++)gn(Qt[On]);var bn=te(yt,W(c,Pe));bn.targets=bn.targets||Pe.targets;var Wt=Qe.duration;bn.autoplay=!1,bn.direction=Qe.direction,bn.timelineOffset=y.und(Nt)?Wt:_t(Nt,Wt),gn(Qe),Qe.seek(bn.timelineOffset);var Wn=ur(bn);gn(Wn),Qt.push(Wn);var qn=vn(Qt,Pe);return Qe.delay=qn.delay,Qe.endDelay=qn.endDelay,Qe.duration=qn.duration,Qe.seek(0),Qe.reset(),Qe.autoplay&&Qe.play(),Qe},Qe},ur.easing=V,ur.penner=q,ur.random=function(Pe,Qe){return Math.floor(Math.random()*(Qe-Pe+1))+Pe},C.exports=ur},{}],57:[function(h,C,m){var s,c;s=this,c=function(s){"use strict";var at=1e3,ot=1001,dt=1002,St=1003,We=1006,Ht=1008,Ft=1009,vn=1012,zn=1014,xn=1015,nr=1016,ur=1020,ti=1022,Pr=1023,yt=1026,Nt=1027,Ba=2300,Fa=2301,Ma=2400,Ta=2401,Pa=2402,qr=3e3,Mo=3001,So=35044,Za=35048,al="300 es";function na(){}Object.assign(na.prototype,{addEventListener:function(t,i){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},hasEventListener:function(t,i){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(i)},removeEventListener:function(t,i){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var o=r.indexOf(i);-1!==o&&r.splice(o,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var n=this._listeners[t.type];if(void 0!==n){t.target=this;for(var r=n.slice(0),o=0,l=r.length;o<l;o++)r[o].call(this,t)}}}});for(var ra=[],Ds=0;Ds<256;Ds++)ra[Ds]=(Ds<16?"0":"")+Ds.toString(16);var ol=1234567,pr={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(ra[255&t]+ra[t>>8&255]+ra[t>>16&255]+ra[t>>24&255]+"-"+ra[255&i]+ra[i>>8&255]+"-"+ra[i>>16&15|64]+ra[i>>24&255]+"-"+ra[63&n|128]+ra[n>>8&255]+"-"+ra[n>>16&255]+ra[n>>24&255]+ra[255&r]+ra[r>>8&255]+ra[r>>16&255]+ra[r>>24&255]).toUpperCase()},clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,r,o){return r+(t-i)*(o-r)/(n-i)},lerp:function(t,i,n){return(1-n)*t+n*i},smoothstep:function(t,i,n){return t<=i?0:t>=n?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:t>=n?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(ol=t%2147483647),((ol=16807*ol%2147483647)-1)/2147483646},degToRad:function(t){return t*pr.DEG2RAD},radToDeg:function(t){return t*pr.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,n,r,o){var l=Math.cos,b=Math.sin,S=l(n/2),L=b(n/2),G=l((i+r)/2),U=b((i+r)/2),F=l((i-r)/2),K=b((i-r)/2),Q=l((r-i)/2),re=b((r-i)/2);switch(o){case"XYX":t.set(S*U,L*F,L*K,S*G);break;case"YZY":t.set(L*K,S*U,L*F,S*G);break;case"ZXZ":t.set(L*F,L*K,S*U,S*G);break;case"XZX":t.set(S*U,L*re,L*Q,S*G);break;case"YXY":t.set(L*Q,S*U,L*re,S*G);break;case"ZYZ":t.set(L*re,L*Q,S*U,S*G);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}};function Wl(a,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function sl(a,t,i){return t&&Wl(a.prototype,t),i&&Wl(a,i),a}function Qn(a,t){a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.__proto__=t}function rs(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}var is,cn=function(){function a(i,n){void 0===i&&(i=0),void 0===n&&(n=0),Object.defineProperty(this,"isVector2",{value:!0}),this.x=i,this.y=n}var t=a.prototype;return t.set=function(n,r){return this.x=n,this.y=r,this},t.setScalar=function(n){return this.x=n,this.y=n,this},t.setX=function(n){return this.x=n,this},t.setY=function(n){return this.y=n,this},t.setComponent=function(n,r){switch(n){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+n)}return this},t.getComponent=function(n){switch(n){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+n)}},t.clone=function(){return new this.constructor(this.x,this.y)},t.copy=function(n){return this.x=n.x,this.y=n.y,this},t.add=function(n,r){return void 0!==r?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,r)):(this.x+=n.x,this.y+=n.y,this)},t.addScalar=function(n){return this.x+=n,this.y+=n,this},t.addVectors=function(n,r){return this.x=n.x+r.x,this.y=n.y+r.y,this},t.addScaledVector=function(n,r){return this.x+=n.x*r,this.y+=n.y*r,this},t.sub=function(n,r){return void 0!==r?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,r)):(this.x-=n.x,this.y-=n.y,this)},t.subScalar=function(n){return this.x-=n,this.y-=n,this},t.subVectors=function(n,r){return this.x=n.x-r.x,this.y=n.y-r.y,this},t.multiply=function(n){return this.x*=n.x,this.y*=n.y,this},t.multiplyScalar=function(n){return this.x*=n,this.y*=n,this},t.divide=function(n){return this.x/=n.x,this.y/=n.y,this},t.divideScalar=function(n){return this.multiplyScalar(1/n)},t.applyMatrix3=function(n){var r=this.x,o=this.y,l=n.elements;return this.x=l[0]*r+l[3]*o+l[6],this.y=l[1]*r+l[4]*o+l[7],this},t.min=function(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this},t.max=function(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this},t.clamp=function(n,r){return this.x=Math.max(n.x,Math.min(r.x,this.x)),this.y=Math.max(n.y,Math.min(r.y,this.y)),this},t.clampScalar=function(n,r){return this.x=Math.max(n,Math.min(r,this.x)),this.y=Math.max(n,Math.min(r,this.y)),this},t.clampLength=function(n,r){var o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(n,Math.min(r,o)))},t.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},t.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},t.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},t.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.dot=function(n){return this.x*n.x+this.y*n.y},t.cross=function(n){return this.x*n.y-this.y*n.x},t.lengthSq=function(){return this.x*this.x+this.y*this.y},t.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},t.normalize=function(){return this.divideScalar(this.length()||1)},t.angle=function(){return Math.atan2(-this.y,-this.x)+Math.PI},t.distanceTo=function(n){return Math.sqrt(this.distanceToSquared(n))},t.distanceToSquared=function(n){var r=this.x-n.x,o=this.y-n.y;return r*r+o*o},t.manhattanDistanceTo=function(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)},t.setLength=function(n){return this.normalize().multiplyScalar(n)},t.lerp=function(n,r){return this.x+=(n.x-this.x)*r,this.y+=(n.y-this.y)*r,this},t.lerpVectors=function(n,r,o){return this.x=n.x+(r.x-n.x)*o,this.y=n.y+(r.y-n.y)*o,this},t.equals=function(n){return n.x===this.x&&n.y===this.y},t.fromArray=function(n,r){return void 0===r&&(r=0),this.x=n[r],this.y=n[r+1],this},t.toArray=function(n,r){return void 0===n&&(n=[]),void 0===r&&(r=0),n[r]=this.x,n[r+1]=this.y,n},t.fromBufferAttribute=function(n,r,o){return void 0!==o&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(r),this.y=n.getY(r),this},t.rotateAround=function(n,r){var o=Math.cos(r),l=Math.sin(r),b=this.x-n.x,S=this.y-n.y;return this.x=b*o-S*l+n.x,this.y=b*l+S*o+n.y,this},t.random=function(){return this.x=Math.random(),this.y=Math.random(),this},sl(a,[{key:"width",get:function(){return this.x},set:function(n){this.x=n}},{key:"height",get:function(){return this.y},set:function(n){this.y=n}}]),a}(),da=function(){function a(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}var t=a.prototype;return t.set=function(n,r,o,l,b,S,L,G,U){var F=this.elements;return F[0]=n,F[1]=l,F[2]=L,F[3]=r,F[4]=b,F[5]=G,F[6]=o,F[7]=S,F[8]=U,this},t.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},t.clone=function(){return(new this.constructor).fromArray(this.elements)},t.copy=function(n){var r=this.elements,o=n.elements;return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],this},t.extractBasis=function(n,r,o){return n.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),o.setFromMatrix3Column(this,2),this},t.setFromMatrix4=function(n){var r=n.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this},t.multiply=function(n){return this.multiplyMatrices(this,n)},t.premultiply=function(n){return this.multiplyMatrices(n,this)},t.multiplyMatrices=function(n,r){var o=n.elements,l=r.elements,b=this.elements,S=o[0],L=o[3],G=o[6],U=o[1],F=o[4],K=o[7],Q=o[2],re=o[5],ve=o[8],oe=l[0],Z=l[3],Te=l[6],Be=l[1],we=l[4],Ae=l[7],Le=l[2],tt=l[5],Ze=l[8];return b[0]=S*oe+L*Be+G*Le,b[3]=S*Z+L*we+G*tt,b[6]=S*Te+L*Ae+G*Ze,b[1]=U*oe+F*Be+K*Le,b[4]=U*Z+F*we+K*tt,b[7]=U*Te+F*Ae+K*Ze,b[2]=Q*oe+re*Be+ve*Le,b[5]=Q*Z+re*we+ve*tt,b[8]=Q*Te+re*Ae+ve*Ze,this},t.multiplyScalar=function(n){var r=this.elements;return r[0]*=n,r[3]*=n,r[6]*=n,r[1]*=n,r[4]*=n,r[7]*=n,r[2]*=n,r[5]*=n,r[8]*=n,this},t.determinant=function(){var n=this.elements,r=n[0],o=n[1],l=n[2],b=n[3],S=n[4],L=n[5],G=n[6],U=n[7],F=n[8];return r*S*F-r*L*U-o*b*F+o*L*G+l*b*U-l*S*G},t.invert=function(){var n=this.elements,r=n[0],o=n[1],l=n[2],b=n[3],S=n[4],L=n[5],G=n[6],U=n[7],F=n[8],K=F*S-L*U,Q=L*G-F*b,re=U*b-S*G,ve=r*K+o*Q+l*re;if(0===ve)return this.set(0,0,0,0,0,0,0,0,0);var oe=1/ve;return n[0]=K*oe,n[1]=(l*U-F*o)*oe,n[2]=(L*o-l*S)*oe,n[3]=Q*oe,n[4]=(F*r-l*G)*oe,n[5]=(l*b-L*r)*oe,n[6]=re*oe,n[7]=(o*G-U*r)*oe,n[8]=(S*r-o*b)*oe,this},t.transpose=function(){var n,r=this.elements;return n=r[1],r[1]=r[3],r[3]=n,n=r[2],r[2]=r[6],r[6]=n,n=r[5],r[5]=r[7],r[7]=n,this},t.getNormalMatrix=function(n){return this.setFromMatrix4(n).copy(this).invert().transpose()},t.transposeIntoArray=function(n){var r=this.elements;return n[0]=r[0],n[1]=r[3],n[2]=r[6],n[3]=r[1],n[4]=r[4],n[5]=r[7],n[6]=r[2],n[7]=r[5],n[8]=r[8],this},t.setUvTransform=function(n,r,o,l,b,S,L){var G=Math.cos(b),U=Math.sin(b);this.set(o*G,o*U,-o*(G*S+U*L)+S+n,-l*U,l*G,-l*(-U*S+G*L)+L+r,0,0,1)},t.scale=function(n,r){var o=this.elements;return o[0]*=n,o[3]*=n,o[6]*=n,o[1]*=r,o[4]*=r,o[7]*=r,this},t.rotate=function(n){var r=Math.cos(n),o=Math.sin(n),l=this.elements,b=l[0],S=l[3],L=l[6],G=l[1],U=l[4],F=l[7];return l[0]=r*b+o*G,l[3]=r*S+o*U,l[6]=r*L+o*F,l[1]=-o*b+r*G,l[4]=-o*S+r*U,l[7]=-o*L+r*F,this},t.translate=function(n,r){var o=this.elements;return o[0]+=n*o[2],o[3]+=n*o[5],o[6]+=n*o[8],o[1]+=r*o[2],o[4]+=r*o[5],o[7]+=r*o[8],this},t.equals=function(n){for(var r=this.elements,o=n.elements,l=0;l<9;l++)if(r[l]!==o[l])return!1;return!0},t.fromArray=function(n,r){void 0===r&&(r=0);for(var o=0;o<9;o++)this.elements[o]=n[o+r];return this},t.toArray=function(n,r){void 0===n&&(n=[]),void 0===r&&(r=0);var o=this.elements;return n[r]=o[0],n[r+1]=o[1],n[r+2]=o[2],n[r+3]=o[3],n[r+4]=o[4],n[r+5]=o[5],n[r+6]=o[6],n[r+7]=o[7],n[r+8]=o[8],n},a}(),Go={getDataURL:function(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;var i;if(t instanceof HTMLCanvasElement)i=t;else{void 0===is&&(is=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),is.width=t.width,is.height=t.height;var n=is.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),i=is}return i.width>2048||i.height>2048?i.toDataURL("image/jpeg",.6):i.toDataURL("image/png")}},Eh=0;function vi(a,t,i,n,r,o,l,b,S,L){void 0===a&&(a=vi.DEFAULT_IMAGE),void 0===t&&(t=vi.DEFAULT_MAPPING),void 0===i&&(i=ot),void 0===n&&(n=ot),void 0===r&&(r=We),void 0===o&&(o=Ht),void 0===l&&(l=Pr),void 0===b&&(b=Ft),void 0===S&&(S=1),void 0===L&&(L=qr),Object.defineProperty(this,"id",{value:Eh++}),this.uuid=pr.generateUUID(),this.name="",this.image=a,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=S,this.format=l,this.internalFormat=null,this.type=b,this.offset=new cn(0,0),this.repeat=new cn(1,1),this.center=new cn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new da,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=L,this.version=0,this.onUpdate=null}function as(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?Go.getDataURL(a):a.data?{data:Array.prototype.slice.call(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}vi.DEFAULT_IMAGE=void 0,vi.DEFAULT_MAPPING=300,vi.prototype=Object.assign(Object.create(na.prototype),{constructor:vi,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=pr.generateUUID()),!i&&void 0===t.images[r.uuid]){var o;if(Array.isArray(r)){o=[];for(var l=0,b=r.length;l<b;l++)o.push(as(r[l].isDataTexture?r[l].image:r[l]))}else o=as(r);t.images[r.uuid]={uuid:r.uuid,url:o}}n.image=r.uuid}return i||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case at:t.x=t.x-Math.floor(t.x);break;case ot:t.x=t.x<0?0:1;break;case dt:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case at:t.y=t.y-Math.floor(t.y);break;case ot:t.y=t.y<0?0:1;break;case dt:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(vi.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});var ui=function(){function a(i,n,r,o){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=1),Object.defineProperty(this,"isVector4",{value:!0}),this.x=i,this.y=n,this.z=r,this.w=o}var t=a.prototype;return t.set=function(n,r,o,l){return this.x=n,this.y=r,this.z=o,this.w=l,this},t.setScalar=function(n){return this.x=n,this.y=n,this.z=n,this.w=n,this},t.setX=function(n){return this.x=n,this},t.setY=function(n){return this.y=n,this},t.setZ=function(n){return this.z=n,this},t.setW=function(n){return this.w=n,this},t.setComponent=function(n,r){switch(n){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;case 3:this.w=r;break;default:throw new Error("index is out of range: "+n)}return this},t.getComponent=function(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+n)}},t.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},t.copy=function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=void 0!==n.w?n.w:1,this},t.add=function(n,r){return void 0!==r?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,r)):(this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this)},t.addScalar=function(n){return this.x+=n,this.y+=n,this.z+=n,this.w+=n,this},t.addVectors=function(n,r){return this.x=n.x+r.x,this.y=n.y+r.y,this.z=n.z+r.z,this.w=n.w+r.w,this},t.addScaledVector=function(n,r){return this.x+=n.x*r,this.y+=n.y*r,this.z+=n.z*r,this.w+=n.w*r,this},t.sub=function(n,r){return void 0!==r?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,r)):(this.x-=n.x,this.y-=n.y,this.z-=n.z,this.w-=n.w,this)},t.subScalar=function(n){return this.x-=n,this.y-=n,this.z-=n,this.w-=n,this},t.subVectors=function(n,r){return this.x=n.x-r.x,this.y=n.y-r.y,this.z=n.z-r.z,this.w=n.w-r.w,this},t.multiplyScalar=function(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this},t.applyMatrix4=function(n){var r=this.x,o=this.y,l=this.z,b=this.w,S=n.elements;return this.x=S[0]*r+S[4]*o+S[8]*l+S[12]*b,this.y=S[1]*r+S[5]*o+S[9]*l+S[13]*b,this.z=S[2]*r+S[6]*o+S[10]*l+S[14]*b,this.w=S[3]*r+S[7]*o+S[11]*l+S[15]*b,this},t.divideScalar=function(n){return this.multiplyScalar(1/n)},t.setAxisAngleFromQuaternion=function(n){this.w=2*Math.acos(n.w);var r=Math.sqrt(1-n.w*n.w);return r<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=n.x/r,this.y=n.y/r,this.z=n.z/r),this},t.setAxisAngleFromRotationMatrix=function(n){var r,o,l,b,S=.01,L=.1,G=n.elements,U=G[0],F=G[4],K=G[8],Q=G[1],re=G[5],ve=G[9],oe=G[2],Z=G[6],Te=G[10];if(Math.abs(F-Q)<S&&Math.abs(K-oe)<S&&Math.abs(ve-Z)<S){if(Math.abs(F+Q)<L&&Math.abs(K+oe)<L&&Math.abs(ve+Z)<L&&Math.abs(U+re+Te-3)<L)return this.set(1,0,0,0),this;r=Math.PI;var Be=(U+1)/2,we=(re+1)/2,Ae=(Te+1)/2,Le=(F+Q)/4,tt=(K+oe)/4,Ze=(ve+Z)/4;return Be>we&&Be>Ae?Be<S?(o=0,l=.707106781,b=.707106781):(l=Le/(o=Math.sqrt(Be)),b=tt/o):we>Ae?we<S?(o=.707106781,l=0,b=.707106781):(o=Le/(l=Math.sqrt(we)),b=Ze/l):Ae<S?(o=.707106781,l=.707106781,b=0):(o=tt/(b=Math.sqrt(Ae)),l=Ze/b),this.set(o,l,b,r),this}var wt=Math.sqrt((Z-ve)*(Z-ve)+(K-oe)*(K-oe)+(Q-F)*(Q-F));return Math.abs(wt)<.001&&(wt=1),this.x=(Z-ve)/wt,this.y=(K-oe)/wt,this.z=(Q-F)/wt,this.w=Math.acos((U+re+Te-1)/2),this},t.min=function(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this.w=Math.min(this.w,n.w),this},t.max=function(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this.w=Math.max(this.w,n.w),this},t.clamp=function(n,r){return this.x=Math.max(n.x,Math.min(r.x,this.x)),this.y=Math.max(n.y,Math.min(r.y,this.y)),this.z=Math.max(n.z,Math.min(r.z,this.z)),this.w=Math.max(n.w,Math.min(r.w,this.w)),this},t.clampScalar=function(n,r){return this.x=Math.max(n,Math.min(r,this.x)),this.y=Math.max(n,Math.min(r,this.y)),this.z=Math.max(n,Math.min(r,this.z)),this.w=Math.max(n,Math.min(r,this.w)),this},t.clampLength=function(n,r){var o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(n,Math.min(r,o)))},t.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},t.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},t.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},t.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},t.dot=function(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w},t.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},t.normalize=function(){return this.divideScalar(this.length()||1)},t.setLength=function(n){return this.normalize().multiplyScalar(n)},t.lerp=function(n,r){return this.x+=(n.x-this.x)*r,this.y+=(n.y-this.y)*r,this.z+=(n.z-this.z)*r,this.w+=(n.w-this.w)*r,this},t.lerpVectors=function(n,r,o){return this.x=n.x+(r.x-n.x)*o,this.y=n.y+(r.y-n.y)*o,this.z=n.z+(r.z-n.z)*o,this.w=n.w+(r.w-n.w)*o,this},t.equals=function(n){return n.x===this.x&&n.y===this.y&&n.z===this.z&&n.w===this.w},t.fromArray=function(n,r){return void 0===r&&(r=0),this.x=n[r],this.y=n[r+1],this.z=n[r+2],this.w=n[r+3],this},t.toArray=function(n,r){return void 0===n&&(n=[]),void 0===r&&(r=0),n[r]=this.x,n[r+1]=this.y,n[r+2]=this.z,n[r+3]=this.w,n},t.fromBufferAttribute=function(n,r,o){return void 0!==o&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(r),this.y=n.getY(r),this.z=n.getZ(r),this.w=n.getW(r),this},t.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},sl(a,[{key:"width",get:function(){return this.z},set:function(n){this.z=n}},{key:"height",get:function(){return this.w},set:function(n){this.w=n}}]),a}();function Sa(a,t,i){this.width=a,this.height=t,this.scissor=new ui(0,0,a,t),this.scissorTest=!1,this.viewport=new ui(0,0,a,t),this.texture=new vi(void 0,(i=i||{}).mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=a,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:We,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function jl(a,t,i){Sa.call(this,a,t,i),this.samples=4}Sa.prototype=Object.assign(Object.create(na.prototype),{constructor:Sa,isWebGLRenderTarget:!0,setSize:function(t,i){(this.width!==t||this.height!==i)&&(this.width=t,this.height=i,this.texture.image.width=t,this.texture.image.height=i,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),jl.prototype=Object.assign(Object.create(Sa.prototype),{constructor:jl,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Sa.prototype.copy.call(this,t),this.samples=t.samples,this}});var Zi=function(){function a(i,n,r,o){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=1),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=i,this._y=n,this._z=r,this._w=o}a.slerp=function(n,r,o,l){return o.copy(n).slerp(r,l)},a.slerpFlat=function(n,r,o,l,b,S,L){var G=o[l+0],U=o[l+1],F=o[l+2],K=o[l+3],Q=b[S+0],re=b[S+1],ve=b[S+2],oe=b[S+3];if(K!==oe||G!==Q||U!==re||F!==ve){var Z=1-L,Te=G*Q+U*re+F*ve+K*oe,Be=Te>=0?1:-1,we=1-Te*Te;if(we>Number.EPSILON){var Ae=Math.sqrt(we),Le=Math.atan2(Ae,Te*Be);Z=Math.sin(Z*Le)/Ae,L=Math.sin(L*Le)/Ae}var tt=L*Be;if(G=G*Z+Q*tt,U=U*Z+re*tt,F=F*Z+ve*tt,K=K*Z+oe*tt,Z===1-L){var Ze=1/Math.sqrt(G*G+U*U+F*F+K*K);G*=Ze,U*=Ze,F*=Ze,K*=Ze}}n[r]=G,n[r+1]=U,n[r+2]=F,n[r+3]=K},a.multiplyQuaternionsFlat=function(n,r,o,l,b,S){var L=o[l],G=o[l+1],U=o[l+2],F=o[l+3],K=b[S],Q=b[S+1],re=b[S+2],ve=b[S+3];return n[r]=L*ve+F*K+G*re-U*Q,n[r+1]=G*ve+F*Q+U*K-L*re,n[r+2]=U*ve+F*re+L*Q-G*K,n[r+3]=F*ve-L*K-G*Q-U*re,n};var t=a.prototype;return t.set=function(n,r,o,l){return this._x=n,this._y=r,this._z=o,this._w=l,this._onChangeCallback(),this},t.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},t.copy=function(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this},t.setFromEuler=function(n,r){if(!n||!n.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var o=n._x,l=n._y,b=n._z,S=n._order,L=Math.cos,G=Math.sin,U=L(o/2),F=L(l/2),K=L(b/2),Q=G(o/2),re=G(l/2),ve=G(b/2);switch(S){case"XYZ":this._x=Q*F*K+U*re*ve,this._y=U*re*K-Q*F*ve,this._z=U*F*ve+Q*re*K,this._w=U*F*K-Q*re*ve;break;case"YXZ":this._x=Q*F*K+U*re*ve,this._y=U*re*K-Q*F*ve,this._z=U*F*ve-Q*re*K,this._w=U*F*K+Q*re*ve;break;case"ZXY":this._x=Q*F*K-U*re*ve,this._y=U*re*K+Q*F*ve,this._z=U*F*ve+Q*re*K,this._w=U*F*K-Q*re*ve;break;case"ZYX":this._x=Q*F*K-U*re*ve,this._y=U*re*K+Q*F*ve,this._z=U*F*ve-Q*re*K,this._w=U*F*K+Q*re*ve;break;case"YZX":this._x=Q*F*K+U*re*ve,this._y=U*re*K+Q*F*ve,this._z=U*F*ve-Q*re*K,this._w=U*F*K-Q*re*ve;break;case"XZY":this._x=Q*F*K-U*re*ve,this._y=U*re*K-Q*F*ve,this._z=U*F*ve+Q*re*K,this._w=U*F*K+Q*re*ve;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+S)}return!1!==r&&this._onChangeCallback(),this},t.setFromAxisAngle=function(n,r){var o=r/2,l=Math.sin(o);return this._x=n.x*l,this._y=n.y*l,this._z=n.z*l,this._w=Math.cos(o),this._onChangeCallback(),this},t.setFromRotationMatrix=function(n){var r=n.elements,o=r[0],l=r[4],b=r[8],S=r[1],L=r[5],G=r[9],U=r[2],F=r[6],K=r[10],Q=o+L+K;if(Q>0){var re=.5/Math.sqrt(Q+1);this._w=.25/re,this._x=(F-G)*re,this._y=(b-U)*re,this._z=(S-l)*re}else if(o>L&&o>K){var ve=2*Math.sqrt(1+o-L-K);this._w=(F-G)/ve,this._x=.25*ve,this._y=(l+S)/ve,this._z=(b+U)/ve}else if(L>K){var oe=2*Math.sqrt(1+L-o-K);this._w=(b-U)/oe,this._x=(l+S)/oe,this._y=.25*oe,this._z=(G+F)/oe}else{var Z=2*Math.sqrt(1+K-o-L);this._w=(S-l)/Z,this._x=(b+U)/Z,this._y=(G+F)/Z,this._z=.25*Z}return this._onChangeCallback(),this},t.setFromUnitVectors=function(n,r){var l=n.dot(r)+1;return l<1e-6?(l=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=l):(this._x=0,this._y=-n.z,this._z=n.y,this._w=l)):(this._x=n.y*r.z-n.z*r.y,this._y=n.z*r.x-n.x*r.z,this._z=n.x*r.y-n.y*r.x,this._w=l),this.normalize()},t.angleTo=function(n){return 2*Math.acos(Math.abs(pr.clamp(this.dot(n),-1,1)))},t.rotateTowards=function(n,r){var o=this.angleTo(n);if(0===o)return this;var l=Math.min(1,r/o);return this.slerp(n,l),this},t.identity=function(){return this.set(0,0,0,1)},t.invert=function(){return this.conjugate()},t.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},t.dot=function(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w},t.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},t.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},t.normalize=function(){var n=this.length();return 0===n?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(n=1/n),this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this},t.multiply=function(n,r){return void 0!==r?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(n,r)):this.multiplyQuaternions(this,n)},t.premultiply=function(n){return this.multiplyQuaternions(n,this)},t.multiplyQuaternions=function(n,r){var o=n._x,l=n._y,b=n._z,S=n._w,L=r._x,G=r._y,U=r._z,F=r._w;return this._x=o*F+S*L+l*U-b*G,this._y=l*F+S*G+b*L-o*U,this._z=b*F+S*U+o*G-l*L,this._w=S*F-o*L-l*G-b*U,this._onChangeCallback(),this},t.slerp=function(n,r){if(0===r)return this;if(1===r)return this.copy(n);var o=this._x,l=this._y,b=this._z,S=this._w,L=S*n._w+o*n._x+l*n._y+b*n._z;if(L<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,L=-L):this.copy(n),L>=1)return this._w=S,this._x=o,this._y=l,this._z=b,this;var G=1-L*L;if(G<=Number.EPSILON){var U=1-r;return this._w=U*S+r*this._w,this._x=U*o+r*this._x,this._y=U*l+r*this._y,this._z=U*b+r*this._z,this.normalize(),this._onChangeCallback(),this}var F=Math.sqrt(G),K=Math.atan2(F,L),Q=Math.sin((1-r)*K)/F,re=Math.sin(r*K)/F;return this._w=S*Q+this._w*re,this._x=o*Q+this._x*re,this._y=l*Q+this._y*re,this._z=b*Q+this._z*re,this._onChangeCallback(),this},t.equals=function(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w},t.fromArray=function(n,r){return void 0===r&&(r=0),this._x=n[r],this._y=n[r+1],this._z=n[r+2],this._w=n[r+3],this._onChangeCallback(),this},t.toArray=function(n,r){return void 0===n&&(n=[]),void 0===r&&(r=0),n[r]=this._x,n[r+1]=this._y,n[r+2]=this._z,n[r+3]=this._w,n},t.fromBufferAttribute=function(n,r){return this._x=n.getX(r),this._y=n.getY(r),this._z=n.getZ(r),this._w=n.getW(r),this},t._onChange=function(n){return this._onChangeCallback=n,this},t._onChangeCallback=function(){},sl(a,[{key:"x",get:function(){return this._x},set:function(n){this._x=n,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(n){this._y=n,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(n){this._z=n,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(n){this._w=n,this._onChangeCallback()}}]),a}(),ke=function(){function a(i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),Object.defineProperty(this,"isVector3",{value:!0}),this.x=i,this.y=n,this.z=r}var t=a.prototype;return t.set=function(n,r,o){return void 0===o&&(o=this.z),this.x=n,this.y=r,this.z=o,this},t.setScalar=function(n){return this.x=n,this.y=n,this.z=n,this},t.setX=function(n){return this.x=n,this},t.setY=function(n){return this.y=n,this},t.setZ=function(n){return this.z=n,this},t.setComponent=function(n,r){switch(n){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;default:throw new Error("index is out of range: "+n)}return this},t.getComponent=function(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+n)}},t.clone=function(){return new this.constructor(this.x,this.y,this.z)},t.copy=function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this},t.add=function(n,r){return void 0!==r?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,r)):(this.x+=n.x,this.y+=n.y,this.z+=n.z,this)},t.addScalar=function(n){return this.x+=n,this.y+=n,this.z+=n,this},t.addVectors=function(n,r){return this.x=n.x+r.x,this.y=n.y+r.y,this.z=n.z+r.z,this},t.addScaledVector=function(n,r){return this.x+=n.x*r,this.y+=n.y*r,this.z+=n.z*r,this},t.sub=function(n,r){return void 0!==r?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,r)):(this.x-=n.x,this.y-=n.y,this.z-=n.z,this)},t.subScalar=function(n){return this.x-=n,this.y-=n,this.z-=n,this},t.subVectors=function(n,r){return this.x=n.x-r.x,this.y=n.y-r.y,this.z=n.z-r.z,this},t.multiply=function(n,r){return void 0!==r?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(n,r)):(this.x*=n.x,this.y*=n.y,this.z*=n.z,this)},t.multiplyScalar=function(n){return this.x*=n,this.y*=n,this.z*=n,this},t.multiplyVectors=function(n,r){return this.x=n.x*r.x,this.y=n.y*r.y,this.z=n.z*r.z,this},t.applyEuler=function(n){return n&&n.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(kr.setFromEuler(n))},t.applyAxisAngle=function(n,r){return this.applyQuaternion(kr.setFromAxisAngle(n,r))},t.applyMatrix3=function(n){var r=this.x,o=this.y,l=this.z,b=n.elements;return this.x=b[0]*r+b[3]*o+b[6]*l,this.y=b[1]*r+b[4]*o+b[7]*l,this.z=b[2]*r+b[5]*o+b[8]*l,this},t.applyNormalMatrix=function(n){return this.applyMatrix3(n).normalize()},t.applyMatrix4=function(n){var r=this.x,o=this.y,l=this.z,b=n.elements,S=1/(b[3]*r+b[7]*o+b[11]*l+b[15]);return this.x=(b[0]*r+b[4]*o+b[8]*l+b[12])*S,this.y=(b[1]*r+b[5]*o+b[9]*l+b[13])*S,this.z=(b[2]*r+b[6]*o+b[10]*l+b[14])*S,this},t.applyQuaternion=function(n){var r=this.x,o=this.y,l=this.z,b=n.x,S=n.y,L=n.z,G=n.w,U=G*r+S*l-L*o,F=G*o+L*r-b*l,K=G*l+b*o-S*r,Q=-b*r-S*o-L*l;return this.x=U*G+Q*-b+F*-L-K*-S,this.y=F*G+Q*-S+K*-b-U*-L,this.z=K*G+Q*-L+U*-S-F*-b,this},t.project=function(n){return this.applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix)},t.unproject=function(n){return this.applyMatrix4(n.projectionMatrixInverse).applyMatrix4(n.matrixWorld)},t.transformDirection=function(n){var r=this.x,o=this.y,l=this.z,b=n.elements;return this.x=b[0]*r+b[4]*o+b[8]*l,this.y=b[1]*r+b[5]*o+b[9]*l,this.z=b[2]*r+b[6]*o+b[10]*l,this.normalize()},t.divide=function(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this},t.divideScalar=function(n){return this.multiplyScalar(1/n)},t.min=function(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this},t.max=function(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this},t.clamp=function(n,r){return this.x=Math.max(n.x,Math.min(r.x,this.x)),this.y=Math.max(n.y,Math.min(r.y,this.y)),this.z=Math.max(n.z,Math.min(r.z,this.z)),this},t.clampScalar=function(n,r){return this.x=Math.max(n,Math.min(r,this.x)),this.y=Math.max(n,Math.min(r,this.y)),this.z=Math.max(n,Math.min(r,this.z)),this},t.clampLength=function(n,r){var o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(n,Math.min(r,o)))},t.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},t.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},t.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},t.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.dot=function(n){return this.x*n.x+this.y*n.y+this.z*n.z},t.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},t.normalize=function(){return this.divideScalar(this.length()||1)},t.setLength=function(n){return this.normalize().multiplyScalar(n)},t.lerp=function(n,r){return this.x+=(n.x-this.x)*r,this.y+=(n.y-this.y)*r,this.z+=(n.z-this.z)*r,this},t.lerpVectors=function(n,r,o){return this.x=n.x+(r.x-n.x)*o,this.y=n.y+(r.y-n.y)*o,this.z=n.z+(r.z-n.z)*o,this},t.cross=function(n,r){return void 0!==r?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(n,r)):this.crossVectors(this,n)},t.crossVectors=function(n,r){var o=n.x,l=n.y,b=n.z,S=r.x,L=r.y,G=r.z;return this.x=l*G-b*L,this.y=b*S-o*G,this.z=o*L-l*S,this},t.projectOnVector=function(n){var r=n.lengthSq();if(0===r)return this.set(0,0,0);var o=n.dot(this)/r;return this.copy(n).multiplyScalar(o)},t.projectOnPlane=function(n){return Hi.copy(this).projectOnVector(n),this.sub(Hi)},t.reflect=function(n){return this.sub(Hi.copy(n).multiplyScalar(2*this.dot(n)))},t.angleTo=function(n){var r=Math.sqrt(this.lengthSq()*n.lengthSq());if(0===r)return Math.PI/2;var o=this.dot(n)/r;return Math.acos(pr.clamp(o,-1,1))},t.distanceTo=function(n){return Math.sqrt(this.distanceToSquared(n))},t.distanceToSquared=function(n){var r=this.x-n.x,o=this.y-n.y,l=this.z-n.z;return r*r+o*o+l*l},t.manhattanDistanceTo=function(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)+Math.abs(this.z-n.z)},t.setFromSpherical=function(n){return this.setFromSphericalCoords(n.radius,n.phi,n.theta)},t.setFromSphericalCoords=function(n,r,o){var l=Math.sin(r)*n;return this.x=l*Math.sin(o),this.y=Math.cos(r)*n,this.z=l*Math.cos(o),this},t.setFromCylindrical=function(n){return this.setFromCylindricalCoords(n.radius,n.theta,n.y)},t.setFromCylindricalCoords=function(n,r,o){return this.x=n*Math.sin(r),this.y=o,this.z=n*Math.cos(r),this},t.setFromMatrixPosition=function(n){var r=n.elements;return this.x=r[12],this.y=r[13],this.z=r[14],this},t.setFromMatrixScale=function(n){var r=this.setFromMatrixColumn(n,0).length(),o=this.setFromMatrixColumn(n,1).length(),l=this.setFromMatrixColumn(n,2).length();return this.x=r,this.y=o,this.z=l,this},t.setFromMatrixColumn=function(n,r){return this.fromArray(n.elements,4*r)},t.setFromMatrix3Column=function(n,r){return this.fromArray(n.elements,3*r)},t.equals=function(n){return n.x===this.x&&n.y===this.y&&n.z===this.z},t.fromArray=function(n,r){return void 0===r&&(r=0),this.x=n[r],this.y=n[r+1],this.z=n[r+2],this},t.toArray=function(n,r){return void 0===n&&(n=[]),void 0===r&&(r=0),n[r]=this.x,n[r+1]=this.y,n[r+2]=this.z,n},t.fromBufferAttribute=function(n,r,o){return void 0!==o&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(r),this.y=n.getY(r),this.z=n.getZ(r),this},t.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this},a}(),Hi=new ke,kr=new Zi,ca=function(){function a(i,n){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==i?i:new ke(1/0,1/0,1/0),this.max=void 0!==n?n:new ke(-1/0,-1/0,-1/0)}var t=a.prototype;return t.set=function(n,r){return this.min.copy(n),this.max.copy(r),this},t.setFromArray=function(n){for(var r=1/0,o=1/0,l=1/0,b=-1/0,S=-1/0,L=-1/0,G=0,U=n.length;G<U;G+=3){var F=n[G],K=n[G+1],Q=n[G+2];F<r&&(r=F),K<o&&(o=K),Q<l&&(l=Q),F>b&&(b=F),K>S&&(S=K),Q>L&&(L=Q)}return this.min.set(r,o,l),this.max.set(b,S,L),this},t.setFromBufferAttribute=function(n){for(var r=1/0,o=1/0,l=1/0,b=-1/0,S=-1/0,L=-1/0,G=0,U=n.count;G<U;G++){var F=n.getX(G),K=n.getY(G),Q=n.getZ(G);F<r&&(r=F),K<o&&(o=K),Q<l&&(l=Q),F>b&&(b=F),K>S&&(S=K),Q>L&&(L=Q)}return this.min.set(r,o,l),this.max.set(b,S,L),this},t.setFromPoints=function(n){this.makeEmpty();for(var r=0,o=n.length;r<o;r++)this.expandByPoint(n[r]);return this},t.setFromCenterAndSize=function(n,r){var o=Is.copy(r).multiplyScalar(.5);return this.min.copy(n).sub(o),this.max.copy(n).add(o),this},t.setFromObject=function(n){return this.makeEmpty(),this.expandByObject(n)},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.min.copy(n.min),this.max.copy(n.max),this},t.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},t.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},t.getCenter=function(n){return void 0===n&&(console.warn("THREE.Box3: .getCenter() target is now required"),n=new ke),this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)},t.getSize=function(n){return void 0===n&&(console.warn("THREE.Box3: .getSize() target is now required"),n=new ke),this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)},t.expandByPoint=function(n){return this.min.min(n),this.max.max(n),this},t.expandByVector=function(n){return this.min.sub(n),this.max.add(n),this},t.expandByScalar=function(n){return this.min.addScalar(-n),this.max.addScalar(n),this},t.expandByObject=function(n){n.updateWorldMatrix(!1,!1);var r=n.geometry;void 0!==r&&(null===r.boundingBox&&r.computeBoundingBox(),Xl.copy(r.boundingBox),Xl.applyMatrix4(n.matrixWorld),this.union(Xl));for(var o=n.children,l=0,b=o.length;l<b;l++)this.expandByObject(o[l]);return this},t.containsPoint=function(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y||n.z<this.min.z||n.z>this.max.z)},t.containsBox=function(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z},t.getParameter=function(n,r){return void 0===r&&(console.warn("THREE.Box3: .getParameter() target is now required"),r=new ke),r.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))},t.intersectsBox=function(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y||n.max.z<this.min.z||n.min.z>this.max.z)},t.intersectsSphere=function(n){return this.clampPoint(n.center,Is),Is.distanceToSquared(n.center)<=n.radius*n.radius},t.intersectsPlane=function(n){var r,o;return n.normal.x>0?(r=n.normal.x*this.min.x,o=n.normal.x*this.max.x):(r=n.normal.x*this.max.x,o=n.normal.x*this.min.x),n.normal.y>0?(r+=n.normal.y*this.min.y,o+=n.normal.y*this.max.y):(r+=n.normal.y*this.max.y,o+=n.normal.y*this.min.y),n.normal.z>0?(r+=n.normal.z*this.min.z,o+=n.normal.z*this.max.z):(r+=n.normal.z*this.max.z,o+=n.normal.z*this.min.z),r<=-n.constant&&o>=-n.constant},t.intersectsTriangle=function(n){if(this.isEmpty())return!1;this.getCenter(Os),ll.subVectors(this.max,Os),os.subVectors(n.a,Os),ss.subVectors(n.b,Os),ls.subVectors(n.c,Os),_o.subVectors(ss,os),Ro.subVectors(ls,ss),zo.subVectors(os,ls);var r=[0,-_o.z,_o.y,0,-Ro.z,Ro.y,0,-zo.z,zo.y,_o.z,0,-_o.x,Ro.z,0,-Ro.x,zo.z,0,-zo.x,-_o.y,_o.x,0,-Ro.y,Ro.x,0,-zo.y,zo.x,0];return!(!Co(r,os,ss,ls,ll)||(r=[1,0,0,0,1,0,0,0,1],!Co(r,os,ss,ls,ll)))&&(cl.crossVectors(_o,Ro),Co(r=[cl.x,cl.y,cl.z],os,ss,ls,ll))},t.clampPoint=function(n,r){return void 0===r&&(console.warn("THREE.Box3: .clampPoint() target is now required"),r=new ke),r.copy(n).clamp(this.min,this.max)},t.distanceToPoint=function(n){return Is.copy(n).clamp(this.min,this.max).sub(n).length()},t.getBoundingSphere=function(n){return void 0===n&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(n.center),n.radius=.5*this.getSize(Is).length(),n},t.intersect=function(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this},t.union=function(n){return this.min.min(n.min),this.max.max(n.max),this},t.applyMatrix4=function(n){return this.isEmpty()||(ma[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),ma[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),ma[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),ma[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),ma[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),ma[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),ma[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),ma[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(ma)),this},t.translate=function(n){return this.min.add(n),this.max.add(n),this},t.equals=function(n){return n.min.equals(this.min)&&n.max.equals(this.max)},a}();function Co(a,t,i,n,r){for(var o=0,l=a.length-3;o<=l;o+=3){Vo.fromArray(a,o);var b=r.x*Math.abs(Vo.x)+r.y*Math.abs(Vo.y)+r.z*Math.abs(Vo.z),S=t.dot(Vo),L=i.dot(Vo),G=n.dot(Vo);if(Math.max(-Math.max(S,L,G),Math.min(S,L,G))>b)return!1}return!0}var ma=[new ke,new ke,new ke,new ke,new ke,new ke,new ke,new ke],Is=new ke,Xl=new ca,os=new ke,ss=new ke,ls=new ke,_o=new ke,Ro=new ke,zo=new ke,Os=new ke,ll=new ke,cl=new ke,Vo=new ke,xh=new ca,ao=function(){function a(i,n){this.center=void 0!==i?i:new ke,this.radius=void 0!==n?n:-1}var t=a.prototype;return t.set=function(n,r){return this.center.copy(n),this.radius=r,this},t.setFromPoints=function(n,r){var o=this.center;void 0!==r?o.copy(r):xh.setFromPoints(n).getCenter(o);for(var l=0,b=0,S=n.length;b<S;b++)l=Math.max(l,o.distanceToSquared(n[b]));return this.radius=Math.sqrt(l),this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.center.copy(n.center),this.radius=n.radius,this},t.isEmpty=function(){return this.radius<0},t.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},t.containsPoint=function(n){return n.distanceToSquared(this.center)<=this.radius*this.radius},t.distanceToPoint=function(n){return n.distanceTo(this.center)-this.radius},t.intersectsSphere=function(n){var r=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=r*r},t.intersectsBox=function(n){return n.intersectsSphere(this)},t.intersectsPlane=function(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius},t.clampPoint=function(n,r){var o=this.center.distanceToSquared(n);return void 0===r&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),r=new ke),r.copy(n),o>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},t.getBoundingBox=function(n){return void 0===n&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),n=new ca),this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)},t.applyMatrix4=function(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this},t.translate=function(n){return this.center.add(n),this},t.equals=function(n){return n.center.equals(this.center)&&n.radius===this.radius},a}(),oo=new ke,ql=new ke,ul=new ke,Lo=new ke,Yl=new ke,hl=new ke,Kl=new ke,cs=function(){function a(i,n){this.origin=void 0!==i?i:new ke,this.direction=void 0!==n?n:new ke(0,0,-1)}var t=a.prototype;return t.set=function(n,r){return this.origin.copy(n),this.direction.copy(r),this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this},t.at=function(n,r){return void 0===r&&(console.warn("THREE.Ray: .at() target is now required"),r=new ke),r.copy(this.direction).multiplyScalar(n).add(this.origin)},t.lookAt=function(n){return this.direction.copy(n).sub(this.origin).normalize(),this},t.recast=function(n){return this.origin.copy(this.at(n,oo)),this},t.closestPointToPoint=function(n,r){void 0===r&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),r=new ke),r.subVectors(n,this.origin);var o=r.dot(this.direction);return o<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(o).add(this.origin)},t.distanceToPoint=function(n){return Math.sqrt(this.distanceSqToPoint(n))},t.distanceSqToPoint=function(n){var r=oo.subVectors(n,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(n):(oo.copy(this.direction).multiplyScalar(r).add(this.origin),oo.distanceToSquared(n))},t.distanceSqToSegment=function(n,r,o,l){ql.copy(n).add(r).multiplyScalar(.5),ul.copy(r).sub(n).normalize(),Lo.copy(this.origin).sub(ql);var K,Q,re,ve,b=.5*n.distanceTo(r),S=-this.direction.dot(ul),L=Lo.dot(this.direction),G=-Lo.dot(ul),U=Lo.lengthSq(),F=Math.abs(1-S*S);if(F>0)if(Q=S*L-G,ve=b*F,(K=S*G-L)>=0)if(Q>=-ve)if(Q<=ve){var oe=1/F;re=(K*=oe)*(K+S*(Q*=oe)+2*L)+Q*(S*K+Q+2*G)+U}else Q=b,re=-(K=Math.max(0,-(S*Q+L)))*K+Q*(Q+2*G)+U;else Q=-b,re=-(K=Math.max(0,-(S*Q+L)))*K+Q*(Q+2*G)+U;else Q<=-ve?re=-(K=Math.max(0,-(-S*b+L)))*K+(Q=K>0?-b:Math.min(Math.max(-b,-G),b))*(Q+2*G)+U:Q<=ve?(K=0,re=(Q=Math.min(Math.max(-b,-G),b))*(Q+2*G)+U):re=-(K=Math.max(0,-(S*b+L)))*K+(Q=K>0?b:Math.min(Math.max(-b,-G),b))*(Q+2*G)+U;else Q=S>0?-b:b,re=-(K=Math.max(0,-(S*Q+L)))*K+Q*(Q+2*G)+U;return o&&o.copy(this.direction).multiplyScalar(K).add(this.origin),l&&l.copy(ul).multiplyScalar(Q).add(ql),re},t.intersectSphere=function(n,r){oo.subVectors(n.center,this.origin);var o=oo.dot(this.direction),l=oo.dot(oo)-o*o,b=n.radius*n.radius;if(l>b)return null;var S=Math.sqrt(b-l),L=o-S,G=o+S;return L<0&&G<0?null:this.at(L<0?G:L,r)},t.intersectsSphere=function(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius},t.distanceToPlane=function(n){var r=n.normal.dot(this.direction);if(0===r)return 0===n.distanceToPoint(this.origin)?0:null;var o=-(this.origin.dot(n.normal)+n.constant)/r;return o>=0?o:null},t.intersectPlane=function(n,r){var o=this.distanceToPlane(n);return null===o?null:this.at(o,r)},t.intersectsPlane=function(n){var r=n.distanceToPoint(this.origin);return 0===r||n.normal.dot(this.direction)*r<0},t.intersectBox=function(n,r){var o,l,b,S,L,G,U=1/this.direction.x,F=1/this.direction.y,K=1/this.direction.z,Q=this.origin;return U>=0?(o=(n.min.x-Q.x)*U,l=(n.max.x-Q.x)*U):(o=(n.max.x-Q.x)*U,l=(n.min.x-Q.x)*U),F>=0?(b=(n.min.y-Q.y)*F,S=(n.max.y-Q.y)*F):(b=(n.max.y-Q.y)*F,S=(n.min.y-Q.y)*F),o>S||b>l||((b>o||o!=o)&&(o=b),(S<l||l!=l)&&(l=S),K>=0?(L=(n.min.z-Q.z)*K,G=(n.max.z-Q.z)*K):(L=(n.max.z-Q.z)*K,G=(n.min.z-Q.z)*K),o>G||L>l)||((L>o||o!=o)&&(o=L),(G<l||l!=l)&&(l=G),l<0)?null:this.at(o>=0?o:l,r)},t.intersectsBox=function(n){return null!==this.intersectBox(n,oo)},t.intersectTriangle=function(n,r,o,l,b){Yl.subVectors(r,n),hl.subVectors(o,n),Kl.crossVectors(Yl,hl);var L,S=this.direction.dot(Kl);if(S>0){if(l)return null;L=1}else{if(!(S<0))return null;L=-1,S=-S}Lo.subVectors(this.origin,n);var G=L*this.direction.dot(hl.crossVectors(Lo,hl));if(G<0)return null;var U=L*this.direction.dot(Yl.cross(Lo));if(U<0||G+U>S)return null;var F=-L*Lo.dot(Kl);return F<0?null:this.at(F/S,b)},t.applyMatrix4=function(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this},t.equals=function(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)},a}(),br=function(){function a(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}var t=a.prototype;return t.set=function(n,r,o,l,b,S,L,G,U,F,K,Q,re,ve,oe,Z){var Te=this.elements;return Te[0]=n,Te[4]=r,Te[8]=o,Te[12]=l,Te[1]=b,Te[5]=S,Te[9]=L,Te[13]=G,Te[2]=U,Te[6]=F,Te[10]=K,Te[14]=Q,Te[3]=re,Te[7]=ve,Te[11]=oe,Te[15]=Z,this},t.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},t.clone=function(){return(new a).fromArray(this.elements)},t.copy=function(n){var r=this.elements,o=n.elements;return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],this},t.copyPosition=function(n){var r=this.elements,o=n.elements;return r[12]=o[12],r[13]=o[13],r[14]=o[14],this},t.extractBasis=function(n,r,o){return n.setFromMatrixColumn(this,0),r.setFromMatrixColumn(this,1),o.setFromMatrixColumn(this,2),this},t.makeBasis=function(n,r,o){return this.set(n.x,r.x,o.x,0,n.y,r.y,o.y,0,n.z,r.z,o.z,0,0,0,0,1),this},t.extractRotation=function(n){var r=this.elements,o=n.elements,l=1/Wo.setFromMatrixColumn(n,0).length(),b=1/Wo.setFromMatrixColumn(n,1).length(),S=1/Wo.setFromMatrixColumn(n,2).length();return r[0]=o[0]*l,r[1]=o[1]*l,r[2]=o[2]*l,r[3]=0,r[4]=o[4]*b,r[5]=o[5]*b,r[6]=o[6]*b,r[7]=0,r[8]=o[8]*S,r[9]=o[9]*S,r[10]=o[10]*S,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},t.makeRotationFromEuler=function(n){n&&n.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=this.elements,o=n.x,l=n.y,b=n.z,S=Math.cos(o),L=Math.sin(o),G=Math.cos(l),U=Math.sin(l),F=Math.cos(b),K=Math.sin(b);if("XYZ"===n.order){var Q=S*F,re=S*K,ve=L*F,oe=L*K;r[0]=G*F,r[4]=-G*K,r[8]=U,r[1]=re+ve*U,r[5]=Q-oe*U,r[9]=-L*G,r[2]=oe-Q*U,r[6]=ve+re*U,r[10]=S*G}else if("YXZ"===n.order){var Z=G*F,Te=G*K,Be=U*F,we=U*K;r[0]=Z+we*L,r[4]=Be*L-Te,r[8]=S*U,r[1]=S*K,r[5]=S*F,r[9]=-L,r[2]=Te*L-Be,r[6]=we+Z*L,r[10]=S*G}else if("ZXY"===n.order){var Ae=G*F,Le=G*K,tt=U*F,Ze=U*K;r[0]=Ae-Ze*L,r[4]=-S*K,r[8]=tt+Le*L,r[1]=Le+tt*L,r[5]=S*F,r[9]=Ze-Ae*L,r[2]=-S*U,r[6]=L,r[10]=S*G}else if("ZYX"===n.order){var wt=S*F,st=S*K,Ge=L*F,vt=L*K;r[0]=G*F,r[4]=Ge*U-st,r[8]=wt*U+vt,r[1]=G*K,r[5]=vt*U+wt,r[9]=st*U-Ge,r[2]=-U,r[6]=L*G,r[10]=S*G}else if("YZX"===n.order){var Je=S*G,je=S*U,At=L*G,Rt=L*U;r[0]=G*F,r[4]=Rt-Je*K,r[8]=At*K+je,r[1]=K,r[5]=S*F,r[9]=-L*F,r[2]=-U*F,r[6]=je*K+At,r[10]=Je-Rt*K}else if("XZY"===n.order){var tn=S*G,en=S*U,Yt=L*G,Gt=L*U;r[0]=G*F,r[4]=-K,r[8]=U*F,r[1]=tn*K+Gt,r[5]=S*F,r[9]=en*K-Yt,r[2]=Yt*K-en,r[6]=L*F,r[10]=Gt*K+tn}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},t.makeRotationFromQuaternion=function(n){return this.compose(Mh,n,Th)},t.lookAt=function(n,r,o){var l=this.elements;return Ca.subVectors(n,r),0===Ca.lengthSq()&&(Ca.z=1),Ca.normalize(),Po.crossVectors(o,Ca),0===Po.lengthSq()&&(1===Math.abs(o.z)?Ca.x+=1e-4:Ca.z+=1e-4,Ca.normalize(),Po.crossVectors(o,Ca)),Po.normalize(),jo.crossVectors(Ca,Po),l[0]=Po.x,l[4]=jo.x,l[8]=Ca.x,l[1]=Po.y,l[5]=jo.y,l[9]=Ca.y,l[2]=Po.z,l[6]=jo.z,l[10]=Ca.z,this},t.multiply=function(n,r){return void 0!==r?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(n,r)):this.multiplyMatrices(this,n)},t.premultiply=function(n){return this.multiplyMatrices(n,this)},t.multiplyMatrices=function(n,r){var o=n.elements,l=r.elements,b=this.elements,S=o[0],L=o[4],G=o[8],U=o[12],F=o[1],K=o[5],Q=o[9],re=o[13],ve=o[2],oe=o[6],Z=o[10],Te=o[14],Be=o[3],we=o[7],Ae=o[11],Le=o[15],tt=l[0],Ze=l[4],wt=l[8],st=l[12],Ge=l[1],vt=l[5],Je=l[9],je=l[13],At=l[2],Rt=l[6],tn=l[10],en=l[14],Yt=l[3],Gt=l[7],yn=l[11],Sn=l[15];return b[0]=S*tt+L*Ge+G*At+U*Yt,b[4]=S*Ze+L*vt+G*Rt+U*Gt,b[8]=S*wt+L*Je+G*tn+U*yn,b[12]=S*st+L*je+G*en+U*Sn,b[1]=F*tt+K*Ge+Q*At+re*Yt,b[5]=F*Ze+K*vt+Q*Rt+re*Gt,b[9]=F*wt+K*Je+Q*tn+re*yn,b[13]=F*st+K*je+Q*en+re*Sn,b[2]=ve*tt+oe*Ge+Z*At+Te*Yt,b[6]=ve*Ze+oe*vt+Z*Rt+Te*Gt,b[10]=ve*wt+oe*Je+Z*tn+Te*yn,b[14]=ve*st+oe*je+Z*en+Te*Sn,b[3]=Be*tt+we*Ge+Ae*At+Le*Yt,b[7]=Be*Ze+we*vt+Ae*Rt+Le*Gt,b[11]=Be*wt+we*Je+Ae*tn+Le*yn,b[15]=Be*st+we*je+Ae*en+Le*Sn,this},t.multiplyScalar=function(n){var r=this.elements;return r[0]*=n,r[4]*=n,r[8]*=n,r[12]*=n,r[1]*=n,r[5]*=n,r[9]*=n,r[13]*=n,r[2]*=n,r[6]*=n,r[10]*=n,r[14]*=n,r[3]*=n,r[7]*=n,r[11]*=n,r[15]*=n,this},t.determinant=function(){var n=this.elements,r=n[0],o=n[4],l=n[8],b=n[12],S=n[1],L=n[5],G=n[9],U=n[13],F=n[2],K=n[6],Q=n[10],re=n[14];return n[3]*(+b*G*K-l*U*K-b*L*Q+o*U*Q+l*L*re-o*G*re)+n[7]*(+r*G*re-r*U*Q+b*S*Q-l*S*re+l*U*F-b*G*F)+n[11]*(+r*U*K-r*L*re-b*S*K+o*S*re+b*L*F-o*U*F)+n[15]*(-l*L*F-r*G*K+r*L*Q+l*S*K-o*S*Q+o*G*F)},t.transpose=function(){var r,n=this.elements;return r=n[1],n[1]=n[4],n[4]=r,r=n[2],n[2]=n[8],n[8]=r,r=n[6],n[6]=n[9],n[9]=r,r=n[3],n[3]=n[12],n[12]=r,r=n[7],n[7]=n[13],n[13]=r,r=n[11],n[11]=n[14],n[14]=r,this},t.setPosition=function(n,r,o){var l=this.elements;return n.isVector3?(l[12]=n.x,l[13]=n.y,l[14]=n.z):(l[12]=n,l[13]=r,l[14]=o),this},t.invert=function(){var n=this.elements,r=n[0],o=n[1],l=n[2],b=n[3],S=n[4],L=n[5],G=n[6],U=n[7],F=n[8],K=n[9],Q=n[10],re=n[11],ve=n[12],oe=n[13],Z=n[14],Te=n[15],Be=K*Z*U-oe*Q*U+oe*G*re-L*Z*re-K*G*Te+L*Q*Te,we=ve*Q*U-F*Z*U-ve*G*re+S*Z*re+F*G*Te-S*Q*Te,Ae=F*oe*U-ve*K*U+ve*L*re-S*oe*re-F*L*Te+S*K*Te,Le=ve*K*G-F*oe*G-ve*L*Q+S*oe*Q+F*L*Z-S*K*Z,tt=r*Be+o*we+l*Ae+b*Le;if(0===tt)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var Ze=1/tt;return n[0]=Be*Ze,n[1]=(oe*Q*b-K*Z*b-oe*l*re+o*Z*re+K*l*Te-o*Q*Te)*Ze,n[2]=(L*Z*b-oe*G*b+oe*l*U-o*Z*U-L*l*Te+o*G*Te)*Ze,n[3]=(K*G*b-L*Q*b-K*l*U+o*Q*U+L*l*re-o*G*re)*Ze,n[4]=we*Ze,n[5]=(F*Z*b-ve*Q*b+ve*l*re-r*Z*re-F*l*Te+r*Q*Te)*Ze,n[6]=(ve*G*b-S*Z*b-ve*l*U+r*Z*U+S*l*Te-r*G*Te)*Ze,n[7]=(S*Q*b-F*G*b+F*l*U-r*Q*U-S*l*re+r*G*re)*Ze,n[8]=Ae*Ze,n[9]=(ve*K*b-F*oe*b-ve*o*re+r*oe*re+F*o*Te-r*K*Te)*Ze,n[10]=(S*oe*b-ve*L*b+ve*o*U-r*oe*U-S*o*Te+r*L*Te)*Ze,n[11]=(F*L*b-S*K*b-F*o*U+r*K*U+S*o*re-r*L*re)*Ze,n[12]=Le*Ze,n[13]=(F*oe*l-ve*K*l+ve*o*Q-r*oe*Q-F*o*Z+r*K*Z)*Ze,n[14]=(ve*L*l-S*oe*l-ve*o*G+r*oe*G+S*o*Z-r*L*Z)*Ze,n[15]=(S*K*l-F*L*l+F*o*G-r*K*G-S*o*Q+r*L*Q)*Ze,this},t.scale=function(n){var r=this.elements,o=n.x,l=n.y,b=n.z;return r[0]*=o,r[4]*=l,r[8]*=b,r[1]*=o,r[5]*=l,r[9]*=b,r[2]*=o,r[6]*=l,r[10]*=b,r[3]*=o,r[7]*=l,r[11]*=b,this},t.getMaxScaleOnAxis=function(){var n=this.elements;return Math.sqrt(Math.max(n[0]*n[0]+n[1]*n[1]+n[2]*n[2],n[4]*n[4]+n[5]*n[5]+n[6]*n[6],n[8]*n[8]+n[9]*n[9]+n[10]*n[10]))},t.makeTranslation=function(n,r,o){return this.set(1,0,0,n,0,1,0,r,0,0,1,o,0,0,0,1),this},t.makeRotationX=function(n){var r=Math.cos(n),o=Math.sin(n);return this.set(1,0,0,0,0,r,-o,0,0,o,r,0,0,0,0,1),this},t.makeRotationY=function(n){var r=Math.cos(n),o=Math.sin(n);return this.set(r,0,o,0,0,1,0,0,-o,0,r,0,0,0,0,1),this},t.makeRotationZ=function(n){var r=Math.cos(n),o=Math.sin(n);return this.set(r,-o,0,0,o,r,0,0,0,0,1,0,0,0,0,1),this},t.makeRotationAxis=function(n,r){var o=Math.cos(r),l=Math.sin(r),b=1-o,S=n.x,L=n.y,G=n.z,U=b*S,F=b*L;return this.set(U*S+o,U*L-l*G,U*G+l*L,0,U*L+l*G,F*L+o,F*G-l*S,0,U*G-l*L,F*G+l*S,b*G*G+o,0,0,0,0,1),this},t.makeScale=function(n,r,o){return this.set(n,0,0,0,0,r,0,0,0,0,o,0,0,0,0,1),this},t.makeShear=function(n,r,o){return this.set(1,r,o,0,n,1,o,0,n,r,1,0,0,0,0,1),this},t.compose=function(n,r,o){var l=this.elements,b=r._x,S=r._y,L=r._z,G=r._w,U=b+b,F=S+S,K=L+L,Q=b*U,re=b*F,ve=b*K,oe=S*F,Z=S*K,Te=L*K,Be=G*U,we=G*F,Ae=G*K,Le=o.x,tt=o.y,Ze=o.z;return l[0]=(1-(oe+Te))*Le,l[1]=(re+Ae)*Le,l[2]=(ve-we)*Le,l[3]=0,l[4]=(re-Ae)*tt,l[5]=(1-(Q+Te))*tt,l[6]=(Z+Be)*tt,l[7]=0,l[8]=(ve+we)*Ze,l[9]=(Z-Be)*Ze,l[10]=(1-(Q+oe))*Ze,l[11]=0,l[12]=n.x,l[13]=n.y,l[14]=n.z,l[15]=1,this},t.decompose=function(n,r,o){var l=this.elements,b=Wo.set(l[0],l[1],l[2]).length(),S=Wo.set(l[4],l[5],l[6]).length(),L=Wo.set(l[8],l[9],l[10]).length();this.determinant()<0&&(b=-b),n.x=l[12],n.y=l[13],n.z=l[14],Na.copy(this);var U=1/b,F=1/S,K=1/L;return Na.elements[0]*=U,Na.elements[1]*=U,Na.elements[2]*=U,Na.elements[4]*=F,Na.elements[5]*=F,Na.elements[6]*=F,Na.elements[8]*=K,Na.elements[9]*=K,Na.elements[10]*=K,r.setFromRotationMatrix(Na),o.x=b,o.y=S,o.z=L,this},t.makePerspective=function(n,r,o,l,b,S){void 0===S&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var L=this.elements,U=2*b/(o-l),F=(r+n)/(r-n),K=(o+l)/(o-l),Q=-(S+b)/(S-b),re=-2*S*b/(S-b);return L[0]=2*b/(r-n),L[4]=0,L[8]=F,L[12]=0,L[1]=0,L[5]=U,L[9]=K,L[13]=0,L[2]=0,L[6]=0,L[10]=Q,L[14]=re,L[3]=0,L[7]=0,L[11]=-1,L[15]=0,this},t.makeOrthographic=function(n,r,o,l,b,S){var L=this.elements,G=1/(r-n),U=1/(o-l),F=1/(S-b),K=(r+n)*G,Q=(o+l)*U,re=(S+b)*F;return L[0]=2*G,L[4]=0,L[8]=0,L[12]=-K,L[1]=0,L[5]=2*U,L[9]=0,L[13]=-Q,L[2]=0,L[6]=0,L[10]=-2*F,L[14]=-re,L[3]=0,L[7]=0,L[11]=0,L[15]=1,this},t.equals=function(n){for(var r=this.elements,o=n.elements,l=0;l<16;l++)if(r[l]!==o[l])return!1;return!0},t.fromArray=function(n,r){void 0===r&&(r=0);for(var o=0;o<16;o++)this.elements[o]=n[o+r];return this},t.toArray=function(n,r){void 0===n&&(n=[]),void 0===r&&(r=0);var o=this.elements;return n[r]=o[0],n[r+1]=o[1],n[r+2]=o[2],n[r+3]=o[3],n[r+4]=o[4],n[r+5]=o[5],n[r+6]=o[6],n[r+7]=o[7],n[r+8]=o[8],n[r+9]=o[9],n[r+10]=o[10],n[r+11]=o[11],n[r+12]=o[12],n[r+13]=o[13],n[r+14]=o[14],n[r+15]=o[15],n},a}(),Wo=new ke,Na=new br,Mh=new ke(0,0,0),Th=new ke(1,1,1),Po=new ke,jo=new ke,Ca=new ke,dl=function(){function a(i,n,r,o){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=a.DefaultOrder),Object.defineProperty(this,"isEuler",{value:!0}),this._x=i,this._y=n,this._z=r,this._order=o}var t=a.prototype;return t.set=function(n,r,o,l){return this._x=n,this._y=r,this._z=o,this._order=l||this._order,this._onChangeCallback(),this},t.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},t.copy=function(n){return this._x=n._x,this._y=n._y,this._z=n._z,this._order=n._order,this._onChangeCallback(),this},t.setFromRotationMatrix=function(n,r,o){var l=pr.clamp,b=n.elements,S=b[0],L=b[4],G=b[8],U=b[1],F=b[5],K=b[9],Q=b[2],re=b[6],ve=b[10];switch(r=r||this._order){case"XYZ":this._y=Math.asin(l(G,-1,1)),Math.abs(G)<.9999999?(this._x=Math.atan2(-K,ve),this._z=Math.atan2(-L,S)):(this._x=Math.atan2(re,F),this._z=0);break;case"YXZ":this._x=Math.asin(-l(K,-1,1)),Math.abs(K)<.9999999?(this._y=Math.atan2(G,ve),this._z=Math.atan2(U,F)):(this._y=Math.atan2(-Q,S),this._z=0);break;case"ZXY":this._x=Math.asin(l(re,-1,1)),Math.abs(re)<.9999999?(this._y=Math.atan2(-Q,ve),this._z=Math.atan2(-L,F)):(this._y=0,this._z=Math.atan2(U,S));break;case"ZYX":this._y=Math.asin(-l(Q,-1,1)),Math.abs(Q)<.9999999?(this._x=Math.atan2(re,ve),this._z=Math.atan2(U,S)):(this._x=0,this._z=Math.atan2(-L,F));break;case"YZX":this._z=Math.asin(l(U,-1,1)),Math.abs(U)<.9999999?(this._x=Math.atan2(-K,F),this._y=Math.atan2(-Q,S)):(this._x=0,this._y=Math.atan2(G,ve));break;case"XZY":this._z=Math.asin(-l(L,-1,1)),Math.abs(L)<.9999999?(this._x=Math.atan2(re,F),this._y=Math.atan2(G,S)):(this._x=Math.atan2(-K,ve),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+r)}return this._order=r,!1!==o&&this._onChangeCallback(),this},t.setFromQuaternion=function(n,r,o){return Yc.makeRotationFromQuaternion(n),this.setFromRotationMatrix(Yc,r,o)},t.setFromVector3=function(n,r){return this.set(n.x,n.y,n.z,r||this._order)},t.reorder=function(n){return Kc.setFromEuler(this),this.setFromQuaternion(Kc,n)},t.equals=function(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._order===this._order},t.fromArray=function(n){return this._x=n[0],this._y=n[1],this._z=n[2],void 0!==n[3]&&(this._order=n[3]),this._onChangeCallback(),this},t.toArray=function(n,r){return void 0===n&&(n=[]),void 0===r&&(r=0),n[r]=this._x,n[r+1]=this._y,n[r+2]=this._z,n[r+3]=this._order,n},t.toVector3=function(n){return n?n.set(this._x,this._y,this._z):new ke(this._x,this._y,this._z)},t._onChange=function(n){return this._onChangeCallback=n,this},t._onChangeCallback=function(){},sl(a,[{key:"x",get:function(){return this._x},set:function(n){this._x=n,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(n){this._y=n,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(n){this._z=n,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(n){this._order=n,this._onChangeCallback()}}]),a}();dl.DefaultOrder="XYZ",dl.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Yc=new br,Kc=new Zi,Ql=function(){function a(){this.mask=1}var t=a.prototype;return t.set=function(n){this.mask=1<<n|0},t.enable=function(n){this.mask|=1<<n|0},t.enableAll=function(){this.mask=-1},t.toggle=function(n){this.mask^=1<<n|0},t.disable=function(n){this.mask&=~(1<<n|0)},t.disableAll=function(){this.mask=0},t.test=function(n){return 0!=(this.mask&n.mask)},a}(),Sh=0,Qc=new ke,us=new Zi,so=new br,fl=new ke,Bs=new ke,Ch=new ke,_h=new Zi,Zc=new ke(1,0,0),Jc=new ke(0,1,0),$c=new ke(0,0,1),Rh={type:"added"},eu={type:"removed"};function Kn(){Object.defineProperty(this,"id",{value:Sh++}),this.uuid=pr.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Kn.DefaultUp.clone();var a=new ke,t=new dl,i=new Zi,n=new ke(1,1,1);t._onChange(function r(){i.setFromEuler(t,!1)}),i._onChange(function o(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new br},normalMatrix:{value:new da}}),this.matrix=new br,this.matrixWorld=new br,this.matrixAutoUpdate=Kn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ql,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Kn.DefaultUp=new ke(0,1,0),Kn.DefaultMatrixAutoUpdate=!0,Kn.prototype=Object.assign(Object.create(na.prototype),{constructor:Kn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,i){return us.setFromAxisAngle(t,i),this.quaternion.multiply(us),this},rotateOnWorldAxis:function(t,i){return us.setFromAxisAngle(t,i),this.quaternion.premultiply(us),this},rotateX:function(t){return this.rotateOnAxis(Zc,t)},rotateY:function(t){return this.rotateOnAxis(Jc,t)},rotateZ:function(t){return this.rotateOnAxis($c,t)},translateOnAxis:function(t,i){return Qc.copy(t).applyQuaternion(this.quaternion),this.position.add(Qc.multiplyScalar(i)),this},translateX:function(t){return this.translateOnAxis(Zc,t)},translateY:function(t){return this.translateOnAxis(Jc,t)},translateZ:function(t){return this.translateOnAxis($c,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(so.copy(this.matrixWorld).invert())},lookAt:function(t,i,n){t.isVector3?fl.copy(t):fl.set(t,i,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Bs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?so.lookAt(Bs,fl,this.up):so.lookAt(fl,Bs,this.up),this.quaternion.setFromRotationMatrix(so),r&&(so.extractRotation(r.matrixWorld),us.setFromRotationMatrix(so),this.quaternion.premultiply(us.invert()))},add:function(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Rh)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(eu)),this},clear:function(){for(var t=0;t<this.children.length;t++){var i=this.children[t];i.parent=null,i.dispatchEvent(eu)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),so.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),so.multiply(t.parent.matrixWorld)),t.applyMatrix4(so),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,i){if(this[t]===i)return this;for(var n=0,r=this.children.length;n<r;n++){var l=this.children[n].getObjectByProperty(t,i);if(void 0!==l)return l}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new ke),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Zi),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bs,t,Ch),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new ke),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bs,_h,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new ke),this.updateWorldMatrix(!0,!1);var i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].traverseVisible(t)}},traverseAncestors:function(t){var i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,i){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i)for(var r=this.children,o=0,l=r.length;o<l;o++)r[o].updateWorldMatrix(!1,!0)},toJSON:function(t){var i=void 0===t||"string"==typeof t,n={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function o(Ze,wt){return void 0===Ze[wt.uuid]&&(Ze[wt.uuid]=wt.toJSON(t)),wt.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=o(t.geometries,this.geometry);var l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){var b=l.shapes;if(Array.isArray(b))for(var S=0,L=b.length;S<L;S++)o(t.shapes,b[S]);else o(t.shapes,b)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var U=[],F=0,K=this.material.length;F<K;F++)U.push(o(t.materials,this.material[F]));r.material=U}else r.material=o(t.materials,this.material);if(this.children.length>0){r.children=[];for(var Q=0;Q<this.children.length;Q++)r.children.push(this.children[Q].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(var re=0;re<this.animations.length;re++)r.animations.push(o(t.animations,this.animations[re]))}if(i){var oe=tt(t.geometries),Z=tt(t.materials),Te=tt(t.textures),Be=tt(t.images),we=tt(t.shapes),Ae=tt(t.skeletons),Le=tt(t.animations);oe.length>0&&(n.geometries=oe),Z.length>0&&(n.materials=Z),Te.length>0&&(n.textures=Te),Be.length>0&&(n.images=Be),we.length>0&&(n.shapes=we),Ae.length>0&&(n.skeletons=Ae),Le.length>0&&(n.animations=Le)}return n.object=r,n;function tt(Ze){var wt=[];for(var st in Ze){var Ge=Ze[st];delete Ge.metadata,wt.push(Ge)}return wt}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(var n=0;n<t.children.length;n++)this.add(t.children[n].clone());return this}});var Zl=new ke,Lh=new ke,Ph=new da,Ja=function(){function a(i,n){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==i?i:new ke(1,0,0),this.constant=void 0!==n?n:0}var t=a.prototype;return t.set=function(n,r){return this.normal.copy(n),this.constant=r,this},t.setComponents=function(n,r,o,l){return this.normal.set(n,r,o),this.constant=l,this},t.setFromNormalAndCoplanarPoint=function(n,r){return this.normal.copy(n),this.constant=-r.dot(this.normal),this},t.setFromCoplanarPoints=function(n,r,o){var l=Zl.subVectors(o,r).cross(Lh.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(l,n),this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.normal.copy(n.normal),this.constant=n.constant,this},t.normalize=function(){var n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this},t.negate=function(){return this.constant*=-1,this.normal.negate(),this},t.distanceToPoint=function(n){return this.normal.dot(n)+this.constant},t.distanceToSphere=function(n){return this.distanceToPoint(n.center)-n.radius},t.projectPoint=function(n,r){return void 0===r&&(console.warn("THREE.Plane: .projectPoint() target is now required"),r=new ke),r.copy(this.normal).multiplyScalar(-this.distanceToPoint(n)).add(n)},t.intersectLine=function(n,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new ke);var o=n.delta(Zl),l=this.normal.dot(o);if(0===l)return 0===this.distanceToPoint(n.start)?r.copy(n.start):void 0;var b=-(n.start.dot(this.normal)+this.constant)/l;return b<0||b>1?void 0:r.copy(o).multiplyScalar(b).add(n.start)},t.intersectsLine=function(n){var r=this.distanceToPoint(n.start),o=this.distanceToPoint(n.end);return r<0&&o>0||o<0&&r>0},t.intersectsBox=function(n){return n.intersectsPlane(this)},t.intersectsSphere=function(n){return n.intersectsPlane(this)},t.coplanarPoint=function(n){return void 0===n&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),n=new ke),n.copy(this.normal).multiplyScalar(-this.constant)},t.applyMatrix4=function(n,r){var o=r||Ph.getNormalMatrix(n),l=this.coplanarPoint(Zl).applyMatrix4(n),b=this.normal.applyMatrix3(o).normalize();return this.constant=-l.dot(b),this},t.translate=function(n){return this.constant-=n.dot(this.normal),this},t.equals=function(n){return n.normal.equals(this.normal)&&n.constant===this.constant},a}(),ka=new ke,lo=new ke,Jl=new ke,co=new ke,hs=new ke,Xo=new ke,tu=new ke,$l=new ke,pl=new ke,ec=new ke,Ha=function(){function a(i,n,r){this.a=void 0!==i?i:new ke,this.b=void 0!==n?n:new ke,this.c=void 0!==r?r:new ke}a.getNormal=function(n,r,o,l){void 0===l&&(console.warn("THREE.Triangle: .getNormal() target is now required"),l=new ke),l.subVectors(o,r),ka.subVectors(n,r),l.cross(ka);var b=l.lengthSq();return b>0?l.multiplyScalar(1/Math.sqrt(b)):l.set(0,0,0)},a.getBarycoord=function(n,r,o,l,b){ka.subVectors(l,r),lo.subVectors(o,r),Jl.subVectors(n,r);var S=ka.dot(ka),L=ka.dot(lo),G=ka.dot(Jl),U=lo.dot(lo),F=lo.dot(Jl),K=S*U-L*L;if(void 0===b&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),b=new ke),0===K)return b.set(-2,-1,-1);var Q=1/K,re=(U*G-L*F)*Q,ve=(S*F-L*G)*Q;return b.set(1-re-ve,ve,re)},a.containsPoint=function(n,r,o,l){return this.getBarycoord(n,r,o,l,co),co.x>=0&&co.y>=0&&co.x+co.y<=1},a.getUV=function(n,r,o,l,b,S,L,G){return this.getBarycoord(n,r,o,l,co),G.set(0,0),G.addScaledVector(b,co.x),G.addScaledVector(S,co.y),G.addScaledVector(L,co.z),G},a.isFrontFacing=function(n,r,o,l){return ka.subVectors(o,r),lo.subVectors(n,r),ka.cross(lo).dot(l)<0};var t=a.prototype;return t.set=function(n,r,o){return this.a.copy(n),this.b.copy(r),this.c.copy(o),this},t.setFromPointsAndIndices=function(n,r,o,l){return this.a.copy(n[r]),this.b.copy(n[o]),this.c.copy(n[l]),this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.a.copy(n.a),this.b.copy(n.b),this.c.copy(n.c),this},t.getArea=function(){return ka.subVectors(this.c,this.b),lo.subVectors(this.a,this.b),.5*ka.cross(lo).length()},t.getMidpoint=function(n){return void 0===n&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),n=new ke),n.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},t.getNormal=function(n){return a.getNormal(this.a,this.b,this.c,n)},t.getPlane=function(n){return void 0===n&&(console.warn("THREE.Triangle: .getPlane() target is now required"),n=new Ja),n.setFromCoplanarPoints(this.a,this.b,this.c)},t.getBarycoord=function(n,r){return a.getBarycoord(n,this.a,this.b,this.c,r)},t.getUV=function(n,r,o,l,b){return a.getUV(n,this.a,this.b,this.c,r,o,l,b)},t.containsPoint=function(n){return a.containsPoint(n,this.a,this.b,this.c)},t.isFrontFacing=function(n){return a.isFrontFacing(this.a,this.b,this.c,n)},t.intersectsBox=function(n){return n.intersectsTriangle(this)},t.closestPointToPoint=function(n,r){void 0===r&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),r=new ke);var S,L,o=this.a,l=this.b,b=this.c;hs.subVectors(l,o),Xo.subVectors(b,o),$l.subVectors(n,o);var G=hs.dot($l),U=Xo.dot($l);if(G<=0&&U<=0)return r.copy(o);pl.subVectors(n,l);var F=hs.dot(pl),K=Xo.dot(pl);if(F>=0&&K<=F)return r.copy(l);var Q=G*K-F*U;if(Q<=0&&G>=0&&F<=0)return S=G/(G-F),r.copy(o).addScaledVector(hs,S);ec.subVectors(n,b);var re=hs.dot(ec),ve=Xo.dot(ec);if(ve>=0&&re<=ve)return r.copy(b);var oe=re*U-G*ve;if(oe<=0&&U>=0&&ve<=0)return L=U/(U-ve),r.copy(o).addScaledVector(Xo,L);var Z=F*ve-re*K;if(Z<=0&&K-F>=0&&re-ve>=0)return tu.subVectors(b,l),L=(K-F)/(K-F+(re-ve)),r.copy(l).addScaledVector(tu,L);var Te=1/(Z+oe+Q);return S=oe*Te,L=Q*Te,r.copy(o).addScaledVector(hs,S).addScaledVector(Xo,L)},t.equals=function(n){return n.a.equals(this.a)&&n.b.equals(this.b)&&n.c.equals(this.c)},a}(),nu={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ua={h:0,s:0,l:0},vl={h:0,s:0,l:0};function tc(a,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?a+6*(t-a)*i:i<.5?t:i<2/3?a+6*(t-a)*(2/3-i):a}function ml(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function gl(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}var Fn=function(){function a(i,n,r){return Object.defineProperty(this,"isColor",{value:!0}),void 0===n&&void 0===r?this.set(i):this.setRGB(i,n,r)}var t=a.prototype;return t.set=function(n){return n&&n.isColor?this.copy(n):"number"==typeof n?this.setHex(n):"string"==typeof n&&this.setStyle(n),this},t.setScalar=function(n){return this.r=n,this.g=n,this.b=n,this},t.setHex=function(n){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(255&n)/255,this},t.setRGB=function(n,r,o){return this.r=n,this.g=r,this.b=o,this},t.setHSL=function(n,r,o){if(n=pr.euclideanModulo(n,1),r=pr.clamp(r,0,1),o=pr.clamp(o,0,1),0===r)this.r=this.g=this.b=o;else{var l=o<=.5?o*(1+r):o+r-o*r,b=2*o-l;this.r=tc(b,l,n+1/3),this.g=tc(b,l,n),this.b=tc(b,l,n-1/3)}return this},t.setStyle=function(n){function r(Q){void 0!==Q&&parseFloat(Q)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}var o;if(o=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(n)){var l,S=o[2];switch(o[1]){case"rgb":case"rgba":if(l=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(S))return this.r=Math.min(255,parseInt(l[1],10))/255,this.g=Math.min(255,parseInt(l[2],10))/255,this.b=Math.min(255,parseInt(l[3],10))/255,r(l[5]),this;if(l=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(S))return this.r=Math.min(100,parseInt(l[1],10))/100,this.g=Math.min(100,parseInt(l[2],10))/100,this.b=Math.min(100,parseInt(l[3],10))/100,r(l[5]),this;break;case"hsl":case"hsla":if(l=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(S)){var L=parseFloat(l[1])/360,G=parseInt(l[2],10)/100,U=parseInt(l[3],10)/100;return r(l[5]),this.setHSL(L,G,U)}}}else if(o=/^\#([A-Fa-f0-9]+)$/.exec(n)){var F=o[1],K=F.length;if(3===K)return this.r=parseInt(F.charAt(0)+F.charAt(0),16)/255,this.g=parseInt(F.charAt(1)+F.charAt(1),16)/255,this.b=parseInt(F.charAt(2)+F.charAt(2),16)/255,this;if(6===K)return this.r=parseInt(F.charAt(0)+F.charAt(1),16)/255,this.g=parseInt(F.charAt(2)+F.charAt(3),16)/255,this.b=parseInt(F.charAt(4)+F.charAt(5),16)/255,this}return n&&n.length>0?this.setColorName(n):this},t.setColorName=function(n){var r=nu[n];return void 0!==r?this.setHex(r):console.warn("THREE.Color: Unknown color "+n),this},t.clone=function(){return new this.constructor(this.r,this.g,this.b)},t.copy=function(n){return this.r=n.r,this.g=n.g,this.b=n.b,this},t.copyGammaToLinear=function(n,r){return void 0===r&&(r=2),this.r=Math.pow(n.r,r),this.g=Math.pow(n.g,r),this.b=Math.pow(n.b,r),this},t.copyLinearToGamma=function(n,r){void 0===r&&(r=2);var o=r>0?1/r:1;return this.r=Math.pow(n.r,o),this.g=Math.pow(n.g,o),this.b=Math.pow(n.b,o),this},t.convertGammaToLinear=function(n){return this.copyGammaToLinear(this,n),this},t.convertLinearToGamma=function(n){return this.copyLinearToGamma(this,n),this},t.copySRGBToLinear=function(n){return this.r=ml(n.r),this.g=ml(n.g),this.b=ml(n.b),this},t.copyLinearToSRGB=function(n){return this.r=gl(n.r),this.g=gl(n.g),this.b=gl(n.b),this},t.convertSRGBToLinear=function(){return this.copySRGBToLinear(this),this},t.convertLinearToSRGB=function(){return this.copyLinearToSRGB(this),this},t.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},t.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},t.getHSL=function(n){void 0===n&&(console.warn("THREE.Color: .getHSL() target is now required"),n={h:0,s:0,l:0});var L,G,r=this.r,o=this.g,l=this.b,b=Math.max(r,o,l),S=Math.min(r,o,l),U=(S+b)/2;if(S===b)L=0,G=0;else{var F=b-S;switch(G=U<=.5?F/(b+S):F/(2-b-S),b){case r:L=(o-l)/F+(o<l?6:0);break;case o:L=(l-r)/F+2;break;case l:L=(r-o)/F+4}L/=6}return n.h=L,n.s=G,n.l=U,n},t.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},t.offsetHSL=function(n,r,o){return this.getHSL(Ua),Ua.h+=n,Ua.s+=r,Ua.l+=o,this.setHSL(Ua.h,Ua.s,Ua.l),this},t.add=function(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this},t.addColors=function(n,r){return this.r=n.r+r.r,this.g=n.g+r.g,this.b=n.b+r.b,this},t.addScalar=function(n){return this.r+=n,this.g+=n,this.b+=n,this},t.sub=function(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this},t.multiply=function(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this},t.multiplyScalar=function(n){return this.r*=n,this.g*=n,this.b*=n,this},t.lerp=function(n,r){return this.r+=(n.r-this.r)*r,this.g+=(n.g-this.g)*r,this.b+=(n.b-this.b)*r,this},t.lerpHSL=function(n,r){this.getHSL(Ua),n.getHSL(vl);var o=pr.lerp(Ua.h,vl.h,r),l=pr.lerp(Ua.s,vl.s,r),b=pr.lerp(Ua.l,vl.l,r);return this.setHSL(o,l,b),this},t.equals=function(n){return n.r===this.r&&n.g===this.g&&n.b===this.b},t.fromArray=function(n,r){return void 0===r&&(r=0),this.r=n[r],this.g=n[r+1],this.b=n[r+2],this},t.toArray=function(n,r){return void 0===n&&(n=[]),void 0===r&&(r=0),n[r]=this.r,n[r+1]=this.g,n[r+2]=this.b,n},t.fromBufferAttribute=function(n,r){return this.r=n.getX(r),this.g=n.getY(r),this.b=n.getZ(r),!0===n.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},t.toJSON=function(){return this.getHex()},a}();Fn.NAMES=nu,Fn.prototype.r=1,Fn.prototype.g=1,Fn.prototype.b=1;var ds=function(){function a(i,n,r,o,l,b){void 0===b&&(b=0),this.a=i,this.b=n,this.c=r,this.normal=o&&o.isVector3?o:new ke,this.vertexNormals=Array.isArray(o)?o:[],this.color=l&&l.isColor?l:new Fn,this.vertexColors=Array.isArray(l)?l:[],this.materialIndex=b}var t=a.prototype;return t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){this.a=n.a,this.b=n.b,this.c=n.c,this.normal.copy(n.normal),this.color.copy(n.color),this.materialIndex=n.materialIndex;for(var r=0,o=n.vertexNormals.length;r<o;r++)this.vertexNormals[r]=n.vertexNormals[r].clone();for(var l=0,b=n.vertexColors.length;l<b;l++)this.vertexColors[l]=n.vertexColors[l].clone();return this},a}(),nc=0;function fr(){Object.defineProperty(this,"id",{value:nc++}),this.uuid=pr.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Ui(a){fr.call(this),this.type="MeshBasicMaterial",this.color=new Fn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(a)}fr.prototype=Object.assign(Object.create(na.prototype),{constructor:fr,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(var i in t){var n=t[i];if(void 0!==n)if("shading"!==i){var r=this[i];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[i]=n:console.warn("THREE."+this.type+": '"+i+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+i+"' parameter is undefined.")}},toJSON:function(t){var i=void 0===t||"string"==typeof t;i&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(b){var S=[];for(var L in b){var G=b[L];delete G.metadata,S.push(G)}return S}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),i){var o=r(t.textures),l=r(t.images);o.length>0&&(n.textures=o),l.length>0&&(n.images=l)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var i=t.clippingPlanes,n=null;if(null!==i){var r=i.length;n=new Array(r);for(var o=0;o!==r;++o)n[o]=i[o].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(fr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),(Ui.prototype=Object.create(fr.prototype)).constructor=Ui,Ui.prototype.isMeshBasicMaterial=!0,Ui.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this};var Yr=new ke,uo=new cn;function Zn(a,t,i){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=a,this.itemSize=t,this.count=void 0!==a?a.length/t:0,this.normalized=!0===i,this.usage=So,this.updateRange={offset:0,count:-1},this.version=0}function ga(a,t,i){Zn.call(this,new Int8Array(a),t,i)}function ya(a,t,i){Zn.call(this,new Uint8Array(a),t,i)}function Fs(a,t,i){Zn.call(this,new Uint8ClampedArray(a),t,i)}function Ns(a,t,i){Zn.call(this,new Int16Array(a),t,i)}function Ga(a,t,i){Zn.call(this,new Uint16Array(a),t,i)}function ks(a,t,i){Zn.call(this,new Int32Array(a),t,i)}function qo(a,t,i){Zn.call(this,new Uint32Array(a),t,i)}function Hs(a,t,i){Zn.call(this,new Uint16Array(a),t,i)}function _n(a,t,i){Zn.call(this,new Float32Array(a),t,i)}function Ne(a,t,i){Zn.call(this,new Float64Array(a),t,i)}Object.defineProperty(Zn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Zn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,i,n){t*=this.itemSize,n*=i.itemSize;for(var r=0,o=this.itemSize;r<o;r++)this.array[t+r]=i.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var i=this.array,n=0,r=0,o=t.length;r<o;r++){var l=t[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),l=new Fn),i[n++]=l.r,i[n++]=l.g,i[n++]=l.b}return this},copyVector2sArray:function(t){for(var i=this.array,n=0,r=0,o=t.length;r<o;r++){var l=t[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),l=new cn),i[n++]=l.x,i[n++]=l.y}return this},copyVector3sArray:function(t){for(var i=this.array,n=0,r=0,o=t.length;r<o;r++){var l=t[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),l=new ke),i[n++]=l.x,i[n++]=l.y,i[n++]=l.z}return this},copyVector4sArray:function(t){for(var i=this.array,n=0,r=0,o=t.length;r<o;r++){var l=t[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),l=new ui),i[n++]=l.x,i[n++]=l.y,i[n++]=l.z,i[n++]=l.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(var i=0,n=this.count;i<n;i++)uo.fromBufferAttribute(this,i),uo.applyMatrix3(t),this.setXY(i,uo.x,uo.y);else if(3===this.itemSize)for(var r=0,o=this.count;r<o;r++)Yr.fromBufferAttribute(this,r),Yr.applyMatrix3(t),this.setXYZ(r,Yr.x,Yr.y,Yr.z);return this},applyMatrix4:function(t){for(var i=0,n=this.count;i<n;i++)Yr.x=this.getX(i),Yr.y=this.getY(i),Yr.z=this.getZ(i),Yr.applyMatrix4(t),this.setXYZ(i,Yr.x,Yr.y,Yr.z);return this},applyNormalMatrix:function(t){for(var i=0,n=this.count;i<n;i++)Yr.x=this.getX(i),Yr.y=this.getY(i),Yr.z=this.getZ(i),Yr.applyNormalMatrix(t),this.setXYZ(i,Yr.x,Yr.y,Yr.z);return this},transformDirection:function(t){for(var i=0,n=this.count;i<n;i++)Yr.x=this.getX(i),Yr.y=this.getY(i),Yr.z=this.getZ(i),Yr.transformDirection(t),this.setXYZ(i,Yr.x,Yr.y,Yr.z);return this},set:function(t,i){return void 0===i&&(i=0),this.array.set(t,i),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,i){return this.array[t*this.itemSize]=i,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,i){return this.array[t*this.itemSize+1]=i,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,i){return this.array[t*this.itemSize+2]=i,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,i){return this.array[t*this.itemSize+3]=i,this},setXY:function(t,i,n){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=n,this},setXYZ:function(t,i,n,r){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,i,n,r,o){return this.array[0+(t*=this.itemSize)]=i,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=o,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(ga.prototype=Object.create(Zn.prototype)).constructor=ga,(ya.prototype=Object.create(Zn.prototype)).constructor=ya,(Fs.prototype=Object.create(Zn.prototype)).constructor=Fs,(Ns.prototype=Object.create(Zn.prototype)).constructor=Ns,(Ga.prototype=Object.create(Zn.prototype)).constructor=Ga,(ks.prototype=Object.create(Zn.prototype)).constructor=ks,(qo.prototype=Object.create(Zn.prototype)).constructor=qo,(Hs.prototype=Object.create(Zn.prototype)).constructor=Hs,Hs.prototype.isFloat16BufferAttribute=!0,(_n.prototype=Object.create(Zn.prototype)).constructor=_n,(Ne.prototype=Object.create(Zn.prototype)).constructor=Ne;var pe=function(){function a(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}var t=a.prototype;return t.computeGroups=function(n){var o,l,r=[],b=void 0,S=n.faces;for(l=0;l<S.length;l++){var L=S[l];L.materialIndex!==b&&(b=L.materialIndex,void 0!==o&&(o.count=3*l-o.start,r.push(o)),o={start:3*l,materialIndex:b})}void 0!==o&&(o.count=3*l-o.start,r.push(o)),this.groups=r},t.fromGeometry=function(n){var U,r=n.faces,o=n.vertices,l=n.faceVertexUvs,b=l[0]&&l[0].length>0,S=l[1]&&l[1].length>0,L=n.morphTargets,G=L.length;if(G>0){U=[];for(var F=0;F<G;F++)U[F]={name:L[F].name,data:[]};this.morphTargets.position=U}var re,K=n.morphNormals,Q=K.length;if(Q>0){re=[];for(var ve=0;ve<Q;ve++)re[ve]={name:K[ve].name,data:[]};this.morphTargets.normal=re}var oe=n.skinIndices,Z=n.skinWeights,Te=oe.length===o.length,Be=Z.length===o.length;o.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var we=0;we<r.length;we++){var Ae=r[we];this.vertices.push(o[Ae.a],o[Ae.b],o[Ae.c]);var Le=Ae.vertexNormals;if(3===Le.length)this.normals.push(Le[0],Le[1],Le[2]);else{var tt=Ae.normal;this.normals.push(tt,tt,tt)}var Ze=Ae.vertexColors;if(3===Ze.length)this.colors.push(Ze[0],Ze[1],Ze[2]);else{var wt=Ae.color;this.colors.push(wt,wt,wt)}if(!0===b){var st=l[0][we];void 0!==st?this.uvs.push(st[0],st[1],st[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",we),this.uvs.push(new cn,new cn,new cn))}if(!0===S){var Ge=l[1][we];void 0!==Ge?this.uvs2.push(Ge[0],Ge[1],Ge[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",we),this.uvs2.push(new cn,new cn,new cn))}for(var vt=0;vt<G;vt++){var Je=L[vt].vertices;U[vt].data.push(Je[Ae.a],Je[Ae.b],Je[Ae.c])}for(var je=0;je<Q;je++){var At=K[je].vertexNormals[we];re[je].data.push(At.a,At.b,At.c)}Te&&this.skinIndices.push(oe[Ae.a],oe[Ae.b],oe[Ae.c]),Be&&this.skinWeights.push(Z[Ae.a],Z[Ae.b],Z[Ae.c])}return this.computeGroups(n),this.verticesNeedUpdate=n.verticesNeedUpdate,this.normalsNeedUpdate=n.normalsNeedUpdate,this.colorsNeedUpdate=n.colorsNeedUpdate,this.uvsNeedUpdate=n.uvsNeedUpdate,this.groupsNeedUpdate=n.groupsNeedUpdate,null!==n.boundingSphere&&(this.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(this.boundingBox=n.boundingBox.clone()),this},a}();function R(a){if(0===a.length)return-1/0;for(var t=a[0],i=1,n=a.length;i<n;++i)a[i]>t&&(t=a[i]);return t}var w={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function x(a,t){return new w[a](t)}var I=1,N=new br,Y=new Kn,se=new ke,de=new ca,ge=new ca,Ee=new ke;function De(){Object.defineProperty(this,"id",{value:I+=2}),this.uuid=pr.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}De.prototype=Object.assign(Object.create(na.prototype),{constructor:De,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return this.index=Array.isArray(t)?new(R(t)>65535?qo:Ga)(t,1):t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,i){return this.attributes[t]=i,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,i,n){void 0===n&&(n=0),this.groups.push({start:t,count:i,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},applyMatrix4:function(t){var i=this.attributes.position;void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new da).getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}var o=this.attributes.tangent;return void 0!==o&&(o.transformDirection(t),o.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return N.makeRotationX(t),this.applyMatrix4(N),this},rotateY:function(t){return N.makeRotationY(t),this.applyMatrix4(N),this},rotateZ:function(t){return N.makeRotationZ(t),this.applyMatrix4(N),this},translate:function(t,i,n){return N.makeTranslation(t,i,n),this.applyMatrix4(N),this},scale:function(t,i,n){return N.makeScale(t,i,n),this.applyMatrix4(N),this},lookAt:function(t){return Y.lookAt(t),Y.updateMatrix(),this.applyMatrix4(Y.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(se).negate(),this.translate(se.x,se.y,se.z),this},setFromObject:function(t){var i=t.geometry;if(t.isPoints||t.isLine){var n=new _n(3*i.vertices.length,3),r=new _n(3*i.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(i.vertices)),this.setAttribute("color",r.copyColorsArray(i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){var o=new _n(i.lineDistances.length,1);this.setAttribute("lineDistance",o.copyArray(i.lineDistances))}null!==i.boundingSphere&&(this.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(this.boundingBox=i.boundingBox.clone())}else t.isMesh&&i&&i.isGeometry&&this.fromGeometry(i);return this},setFromPoints:function(t){for(var i=[],n=0,r=t.length;n<r;n++){var o=t[n];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new _n(i,3)),this},updateFromObject:function(t){var i=t.geometry;if(t.isMesh){var n=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(n=void 0,i.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(i);n.verticesNeedUpdate=i.verticesNeedUpdate,n.normalsNeedUpdate=i.normalsNeedUpdate,n.colorsNeedUpdate=i.colorsNeedUpdate,n.uvsNeedUpdate=i.uvsNeedUpdate,n.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=n}if(!0===i.verticesNeedUpdate){var r=this.attributes.position;void 0!==r&&(r.copyVector3sArray(i.vertices),r.needsUpdate=!0),i.verticesNeedUpdate=!1}if(!0===i.normalsNeedUpdate){var o=this.attributes.normal;void 0!==o&&(o.copyVector3sArray(i.normals),o.needsUpdate=!0),i.normalsNeedUpdate=!1}if(!0===i.colorsNeedUpdate){var l=this.attributes.color;void 0!==l&&(l.copyColorsArray(i.colors),l.needsUpdate=!0),i.colorsNeedUpdate=!1}if(i.uvsNeedUpdate){var b=this.attributes.uv;void 0!==b&&(b.copyVector2sArray(i.uvs),b.needsUpdate=!0),i.uvsNeedUpdate=!1}if(i.lineDistancesNeedUpdate){var S=this.attributes.lineDistance;void 0!==S&&(S.copyArray(i.lineDistances),S.needsUpdate=!0),i.lineDistancesNeedUpdate=!1}return i.groupsNeedUpdate&&(i.computeGroups(t.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new pe).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var i=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new Zn(i,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.setAttribute("normal",new Zn(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(3*t.colors.length);this.setAttribute("color",new Zn(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var o=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new Zn(o,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var l=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new Zn(l,2).copyVector2sArray(t.uvs2))}for(var b in this.groups=t.groups,t.morphTargets){for(var S=[],L=t.morphTargets[b],G=0,U=L.length;G<U;G++){var F=L[G],K=new _n(3*F.data.length,3);K.name=F.name,S.push(K.copyVector3sArray(F.data))}this.morphAttributes[b]=S}if(t.skinIndices.length>0){var Q=new _n(4*t.skinIndices.length,4);this.setAttribute("skinIndex",Q.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var re=new _n(4*t.skinWeights.length,4);this.setAttribute("skinWeight",re.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ca);var t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ke(-1/0,-1/0,-1/0),new ke(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(var n=0,r=i.length;n<r;n++)de.setFromBufferAttribute(i[n]),this.morphTargetsRelative?(Ee.addVectors(this.boundingBox.min,de.min),this.boundingBox.expandByPoint(Ee),Ee.addVectors(this.boundingBox.max,de.max),this.boundingBox.expandByPoint(Ee)):(this.boundingBox.expandByPoint(de.min),this.boundingBox.expandByPoint(de.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ao);var t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ke,1/0);if(t){var n=this.boundingSphere.center;if(de.setFromBufferAttribute(t),i)for(var r=0,o=i.length;r<o;r++)ge.setFromBufferAttribute(i[r]),this.morphTargetsRelative?(Ee.addVectors(de.min,ge.min),de.expandByPoint(Ee),Ee.addVectors(de.max,ge.max),de.expandByPoint(Ee)):(de.expandByPoint(ge.min),de.expandByPoint(ge.max));de.getCenter(n);for(var b=0,S=0,L=t.count;S<L;S++)Ee.fromBufferAttribute(t,S),b=Math.max(b,n.distanceToSquared(Ee));if(i)for(var G=0,U=i.length;G<U;G++)for(var F=i[G],K=this.morphTargetsRelative,Q=0,re=F.count;Q<re;Q++)Ee.fromBufferAttribute(F,Q),K&&(se.fromBufferAttribute(t,Q),Ee.add(se)),b=Math.max(b,n.distanceToSquared(Ee));this.boundingSphere.radius=Math.sqrt(b),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,i=this.getAttribute("position");if(void 0!==i){var n=this.getAttribute("normal");if(void 0===n)n=new Zn(new Float32Array(3*i.count),3),this.setAttribute("normal",n);else for(var r=0,o=n.count;r<o;r++)n.setXYZ(r,0,0,0);var l=new ke,b=new ke,S=new ke,L=new ke,G=new ke,U=new ke,F=new ke,K=new ke;if(t)for(var Q=0,re=t.count;Q<re;Q+=3){var ve=t.getX(Q+0),oe=t.getX(Q+1),Z=t.getX(Q+2);l.fromBufferAttribute(i,ve),b.fromBufferAttribute(i,oe),S.fromBufferAttribute(i,Z),F.subVectors(S,b),K.subVectors(l,b),F.cross(K),L.fromBufferAttribute(n,ve),G.fromBufferAttribute(n,oe),U.fromBufferAttribute(n,Z),L.add(F),G.add(F),U.add(F),n.setXYZ(ve,L.x,L.y,L.z),n.setXYZ(oe,G.x,G.y,G.z),n.setXYZ(Z,U.x,U.y,U.z)}else for(var Te=0,Be=i.count;Te<Be;Te+=3)l.fromBufferAttribute(i,Te+0),b.fromBufferAttribute(i,Te+1),S.fromBufferAttribute(i,Te+2),F.subVectors(S,b),K.subVectors(l,b),F.cross(K),n.setXYZ(Te+0,F.x,F.y,F.z),n.setXYZ(Te+1,F.x,F.y,F.z),n.setXYZ(Te+2,F.x,F.y,F.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,i){if(t&&t.isBufferGeometry){void 0===i&&(i=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var l=n[r].array,b=t.attributes[r],S=b.array,L=b.itemSize*i,G=Math.min(S.length,l.length-L),U=0,F=L;U<G;U++,F++)l[F]=S[U];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)Ee.fromBufferAttribute(t,i),Ee.normalize(),t.setXYZ(i,Ee.x,Ee.y,Ee.z)},toNonIndexed:function(){function t(Be,we){for(var Ae=Be.array,Le=Be.itemSize,tt=Be.normalized,Ze=new Ae.constructor(we.length*Le),wt=0,st=0,Ge=0,vt=we.length;Ge<vt;Ge++){wt=we[Ge]*Le;for(var Je=0;Je<Le;Je++)Ze[st++]=Ae[wt++]}return new Zn(Ze,Le,tt)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var i=new De,n=this.index.array,r=this.attributes;for(var o in r){var b=t(r[o],n);i.setAttribute(o,b)}var S=this.morphAttributes;for(var L in S){for(var G=[],U=S[L],F=0,K=U.length;F<K;F++){var re=t(U[F],n);G.push(re)}i.morphAttributes[L]=G}i.morphTargetsRelative=this.morphTargetsRelative;for(var ve=this.groups,oe=0,Z=ve.length;oe<Z;oe++){var Te=ve[oe];i.addGroup(Te.start,Te.count,Te.materialIndex)}return i},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var i=this.parameters;for(var n in i)void 0!==i[n]&&(t[n]=i[n]);return t}t.data={attributes:{}};var r=this.index;null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var o=this.attributes;for(var l in o){var b=o[l],S=b.toJSON(t.data);""!==b.name&&(S.name=b.name),t.data.attributes[l]=S}var L={},G=!1;for(var U in this.morphAttributes){for(var F=this.morphAttributes[U],K=[],Q=0,re=F.length;Q<re;Q++){var ve=F[Q],oe=ve.toJSON(t.data);""!==ve.name&&(oe.name=ve.name),K.push(oe)}K.length>0&&(L[U]=K,G=!0)}G&&(t.data.morphAttributes=L,t.data.morphTargetsRelative=this.morphTargetsRelative);var Z=this.groups;Z.length>0&&(t.data.groups=JSON.parse(JSON.stringify(Z)));var Te=this.boundingSphere;return null!==Te&&(t.data.boundingSphere={center:Te.center.toArray(),radius:Te.radius}),t},clone:function(){return(new De).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var i={};this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone(i));var r=t.attributes;for(var o in r)this.setAttribute(o,r[o].clone(i));var b=t.morphAttributes;for(var S in b){for(var L=[],G=b[S],U=0,F=G.length;U<F;U++)L.push(G[U].clone(i));this.morphAttributes[S]=L}this.morphTargetsRelative=t.morphTargetsRelative;for(var K=t.groups,Q=0,re=K.length;Q<re;Q++){var ve=K[Q];this.addGroup(ve.start,ve.count,ve.materialIndex)}var oe=t.boundingBox;null!==oe&&(this.boundingBox=oe.clone());var Z=t.boundingSphere;return null!==Z&&(this.boundingSphere=Z.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ie=new br,He=new cs,it=new ao,mt=new ke,bt=new ke,pt=new ke,zt=new ke,Lt=new ke,dn=new ke,fn=new ke,An=new ke,Tn=new ke,Vn=new cn,Jn=new cn,Nn=new cn,Mn=new ke,Tr=new ke;function kn(a,t){Kn.call(this),this.type="Mesh",this.geometry=void 0!==a?a:new De,this.material=void 0!==t?t:new Ui,this.updateMorphTargets()}function $r(a,t,i,n,r,o,l,b){if(null===(1===t.side?n.intersectTriangle(l,o,r,!0,b):n.intersectTriangle(r,o,l,2!==t.side,b)))return null;Tr.copy(b),Tr.applyMatrix4(a.matrixWorld);var L=i.ray.origin.distanceTo(Tr);return L<i.near||L>i.far?null:{distance:L,point:Tr.clone(),object:a}}function Ur(a,t,i,n,r,o,l,b,S,L,G,U){mt.fromBufferAttribute(r,L),bt.fromBufferAttribute(r,G),pt.fromBufferAttribute(r,U);var F=a.morphTargetInfluences;if(t.morphTargets&&o&&F){fn.set(0,0,0),An.set(0,0,0),Tn.set(0,0,0);for(var K=0,Q=o.length;K<Q;K++){var re=F[K],ve=o[K];0!==re&&(zt.fromBufferAttribute(ve,L),Lt.fromBufferAttribute(ve,G),dn.fromBufferAttribute(ve,U),l?(fn.addScaledVector(zt,re),An.addScaledVector(Lt,re),Tn.addScaledVector(dn,re)):(fn.addScaledVector(zt.sub(mt),re),An.addScaledVector(Lt.sub(bt),re),Tn.addScaledVector(dn.sub(pt),re)))}mt.add(fn),bt.add(An),pt.add(Tn)}a.isSkinnedMesh&&(a.boneTransform(L,mt),a.boneTransform(G,bt),a.boneTransform(U,pt));var oe=$r(a,t,i,n,mt,bt,pt,Mn);if(oe){b&&(Vn.fromBufferAttribute(b,L),Jn.fromBufferAttribute(b,G),Nn.fromBufferAttribute(b,U),oe.uv=Ha.getUV(Mn,mt,bt,pt,Vn,Jn,Nn,new cn)),S&&(Vn.fromBufferAttribute(S,L),Jn.fromBufferAttribute(S,G),Nn.fromBufferAttribute(S,U),oe.uv2=Ha.getUV(Mn,mt,bt,pt,Vn,Jn,Nn,new cn));var Z=new ds(L,G,U);Ha.getNormal(mt,bt,pt,Z.normal),oe.face=Z}return oe}kn.prototype=Object.assign(Object.create(Kn.prototype),{constructor:kn,isMesh:!0,copy:function(t){return Kn.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){var i=t.morphAttributes,n=Object.keys(i);if(n.length>0){var r=i[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var o=0,l=r.length;o<l;o++){var b=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=o}}}}else{var S=t.morphTargets;void 0!==S&&S.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,i){var l,n=this.geometry,r=this.material,o=this.matrixWorld;if(void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),it.copy(n.boundingSphere),it.applyMatrix4(o),!1!==t.ray.intersectsSphere(it)&&(Ie.copy(o).invert(),He.copy(t.ray).applyMatrix4(Ie),null===n.boundingBox||!1!==He.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var b=n.index,S=n.attributes.position,L=n.morphAttributes.position,G=n.morphTargetsRelative,U=n.attributes.uv,F=n.attributes.uv2,K=n.groups,Q=n.drawRange;if(null!==b)if(Array.isArray(r))for(var re=0,ve=K.length;re<ve;re++)for(var oe=K[re],Z=r[oe.materialIndex],we=Math.max(oe.start,Q.start),Ae=Math.min(oe.start+oe.count,Q.start+Q.count);we<Ae;we+=3){var Le=b.getX(we),tt=b.getX(we+1),Ze=b.getX(we+2);(l=Ur(this,Z,t,He,S,L,G,U,F,Le,tt,Ze))&&(l.faceIndex=Math.floor(we/3),l.face.materialIndex=oe.materialIndex,i.push(l))}else for(var Ge=Math.max(0,Q.start),vt=Math.min(b.count,Q.start+Q.count);Ge<vt;Ge+=3){var Je=b.getX(Ge),je=b.getX(Ge+1),At=b.getX(Ge+2);(l=Ur(this,r,t,He,S,L,G,U,F,Je,je,At))&&(l.faceIndex=Math.floor(Ge/3),i.push(l))}else if(void 0!==S)if(Array.isArray(r))for(var Rt=0,tn=K.length;Rt<tn;Rt++)for(var en=K[Rt],Yt=r[en.materialIndex],Sn=Math.max(en.start,Q.start),er=Math.min(en.start+en.count,Q.start+Q.count);Sn<er;Sn+=3)(l=Ur(this,Yt,t,He,S,L,G,U,F,Sn,Sn+1,Sn+2))&&(l.faceIndex=Math.floor(Sn/3),l.face.materialIndex=en.materialIndex,i.push(l));else for(var Rr=Math.max(0,Q.start),yr=Math.min(S.count,Q.start+Q.count);Rr<yr;Rr+=3)(l=Ur(this,r,t,He,S,L,G,U,F,Rr,Rr+1,Rr+2))&&(l.faceIndex=Math.floor(Rr/3),i.push(l))}else if(n.isGeometry){var Ri,Pi=Array.isArray(r),$i=n.vertices,qi=n.faces,lt=n.faceVertexUvs[0];lt.length>0&&(Ri=lt);for(var et=0,Dn=qi.length;et<Dn;et++){var wn=qi[et],mr=Pi?r[wn.materialIndex]:r;if(void 0!==mr){var xt=$i[wn.a],Xn=$i[wn.b],Hn=$i[wn.c];if(l=$r(this,mr,t,He,xt,Xn,Hn,Mn)){if(Ri&&Ri[et]){var lr=Ri[et];Vn.copy(lr[0]),Jn.copy(lr[1]),Nn.copy(lr[2]),l.uv=Ha.getUV(Mn,xt,Xn,Hn,Vn,Jn,Nn,new cn)}l.face=wn,l.faceIndex=et,i.push(l)}}}}}});var gr=function(a){function t(i,n,r,o,l,b){var S;void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===l&&(l=1),void 0===b&&(b=1),(S=a.call(this)||this).type="BoxBufferGeometry",S.parameters={width:i,height:n,depth:r,widthSegments:o,heightSegments:l,depthSegments:b};var L=rs(S);o=Math.floor(o),l=Math.floor(l),b=Math.floor(b);var G=[],U=[],F=[],K=[],Q=0,re=0;function ve(oe,Z,Te,Be,we,Ae,Le,tt,Ze,wt,st){for(var Ge=Ae/Ze,vt=Le/wt,Je=Ae/2,je=Le/2,At=tt/2,Rt=Ze+1,tn=wt+1,en=0,Yt=0,Gt=new ke,yn=0;yn<tn;yn++)for(var Sn=yn*vt-je,er=0;er<Rt;er++)Gt[oe]=(er*Ge-Je)*Be,Gt[Z]=Sn*we,Gt[Te]=At,U.push(Gt.x,Gt.y,Gt.z),Gt[oe]=0,Gt[Z]=0,Gt[Te]=tt>0?1:-1,F.push(Gt.x,Gt.y,Gt.z),K.push(er/Ze),K.push(1-yn/wt),en+=1;for(var Nr=0;Nr<wt;Nr++)for(var wr=0;wr<Ze;wr++){var Ln=Q+wr+Rt*(Nr+1),Rr=Q+(wr+1)+Rt*(Nr+1),yr=Q+(wr+1)+Rt*Nr;G.push(Q+wr+Rt*Nr,Ln,yr),G.push(Ln,Rr,yr),Yt+=6}L.addGroup(re,Yt,st),re+=Yt,Q+=en}return ve("z","y","x",-1,-1,r,n,i,b,l,0),ve("z","y","x",1,-1,r,n,-i,b,l,1),ve("x","z","y",1,1,i,r,n,o,b,2),ve("x","z","y",1,-1,i,r,-n,o,b,3),ve("x","y","z",1,-1,i,n,r,o,l,4),ve("x","y","z",-1,-1,i,n,-r,o,l,5),S.setIndex(G),S.setAttribute("position",new _n(U,3)),S.setAttribute("normal",new _n(F,3)),S.setAttribute("uv",new _n(K,2)),S}return Qn(t,a),t}(De);function Fr(a){var t={};for(var i in a)for(var n in t[i]={},a[i]){var r=a[i][n];t[i][n]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?r.clone():Array.isArray(r)?r.slice():r}return t}function $n(a){for(var t={},i=0;i<a.length;i++){var n=Fr(a[i]);for(var r in n)t[r]=n[r]}return t}var Or={clone:Fr,merge:$n};function Kr(a){fr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function xi(){Kn.call(this),this.type="Camera",this.matrixWorldInverse=new br,this.projectionMatrix=new br,this.projectionMatrixInverse=new br}function dr(a,t,i,n){void 0===a&&(a=50),void 0===t&&(t=1),void 0===i&&(i=.1),void 0===n&&(n=2e3),xi.call(this),this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function hi(a,t,i){if(Kn.call(this),this.type="CubeCamera",!0===i.isWebGLCubeRenderTarget){this.renderTarget=i;var n=new dr(90,1,a,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new ke(1,0,0)),this.add(n);var r=new dr(90,1,a,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ke(-1,0,0)),this.add(r);var o=new dr(90,1,a,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new ke(0,1,0)),this.add(o);var l=new dr(90,1,a,t);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new ke(0,-1,0)),this.add(l);var b=new dr(90,1,a,t);b.layers=this.layers,b.up.set(0,-1,0),b.lookAt(new ke(0,0,1)),this.add(b);var S=new dr(90,1,a,t);S.layers=this.layers,S.up.set(0,-1,0),S.lookAt(new ke(0,0,-1)),this.add(S),this.update=function(L,G){null===this.parent&&this.updateMatrixWorld();var U=L.xr.enabled,F=L.getRenderTarget();L.xr.enabled=!1;var K=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,L.setRenderTarget(i,0),L.render(G,n),L.setRenderTarget(i,1),L.render(G,r),L.setRenderTarget(i,2),L.render(G,o),L.setRenderTarget(i,3),L.render(G,l),L.setRenderTarget(i,4),L.render(G,b),i.texture.generateMipmaps=K,L.setRenderTarget(i,5),L.render(G,S),L.setRenderTarget(F),L.xr.enabled=U}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function ai(a,t,i,n,r,o,l,b,S,L){vi.call(this,a=void 0!==a?a:[],t=void 0!==t?t:301,i,n,r,o,l=void 0!==l?l:ti,b,S,L),this.flipY=!1,this._needsFlipEnvMap=!0}function Di(a,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),Sa.call(this,a,a,t),this.texture=new ai(void 0,(t=t||{}).mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}function Gi(a,t,i,n,r,o,l,b,S,L,G,U){vi.call(this,null,o,l,b,S,L,n,r,G,U),this.image={data:a||null,width:t||1,height:i||1},this.magFilter=void 0!==S?S:St,this.minFilter=void 0!==L?L:St,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}(Kr.prototype=Object.create(fr.prototype)).constructor=Kr,Kr.prototype.isShaderMaterial=!0,Kr.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=Fr(a.uniforms),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.lights=a.lights,this.clipping=a.clipping,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this},Kr.prototype.toJSON=function(a){var t=fr.prototype.toJSON.call(this,a);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;t.uniforms[i]=r&&r.isTexture?{type:"t",value:r.toJSON(a).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var o={};for(var l in this.extensions)!0===this.extensions[l]&&(o[l]=!0);return Object.keys(o).length>0&&(t.extensions=o),t},xi.prototype=Object.assign(Object.create(Kn.prototype),{constructor:xi,isCamera:!0,copy:function(t,i){return Kn.prototype.copy.call(this,t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new ke),this.updateWorldMatrix(!0,!1);var i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()},updateMatrixWorld:function(t){Kn.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,i){Kn.prototype.updateWorldMatrix.call(this,t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),dr.prototype=Object.assign(Object.create(xi.prototype),{constructor:dr,isPerspectiveCamera:!0,copy:function(t,i){return xi.prototype.copy.call(this,t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var i=.5*this.getFilmHeight()/t;this.fov=2*pr.RAD2DEG*Math.atan(i),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*pr.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*pr.RAD2DEG*Math.atan(Math.tan(.5*pr.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,i,n,r,o,l){this.aspect=t/i,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,i=t*Math.tan(.5*pr.DEG2RAD*this.fov)/this.zoom,n=2*i,r=this.aspect*n,o=-.5*r,l=this.view;if(null!==this.view&&this.view.enabled){var b=l.fullWidth,S=l.fullHeight;o+=l.offsetX*r/b,i-=l.offsetY*n/S,r*=l.width/b,n*=l.height/S}var L=this.filmOffset;0!==L&&(o+=t*L/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,i,i-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){var i=Kn.prototype.toJSON.call(this,t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,null!==this.view&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}),(hi.prototype=Object.create(Kn.prototype)).constructor=hi,(ai.prototype=Object.create(vi.prototype)).constructor=ai,ai.prototype.isCubeTexture=!0,Object.defineProperty(ai.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),(Di.prototype=Object.create(Sa.prototype)).constructor=Di,Di.prototype.isWebGLCubeRenderTarget=!0,Di.prototype.fromEquirectangularTexture=function(a,t){this.texture.type=t.type,this.texture.format=Pr,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",i_fragmentShader="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",n=new gr(5,5,5),r=new Kr({name:"CubemapFromEquirect",uniforms:Fr(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;var o=new kn(n,r),l=t.minFilter;return t.minFilter===Ht&&(t.minFilter=We),new hi(1,10,this).update(a,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this},Di.prototype.clear=function(a,t,i,n){for(var r=a.getRenderTarget(),o=0;o<6;o++)a.setRenderTarget(this,o),a.clear(t,i,n);a.setRenderTarget(r)},(Gi.prototype=Object.create(vi.prototype)).constructor=Gi,Gi.prototype.isDataTexture=!0;var oi=new ao,pa=new ke,wi=function(){function a(i,n,r,o,l,b){this.planes=[void 0!==i?i:new Ja,void 0!==n?n:new Ja,void 0!==r?r:new Ja,void 0!==o?o:new Ja,void 0!==l?l:new Ja,void 0!==b?b:new Ja]}var t=a.prototype;return t.set=function(n,r,o,l,b,S){var L=this.planes;return L[0].copy(n),L[1].copy(r),L[2].copy(o),L[3].copy(l),L[4].copy(b),L[5].copy(S),this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){for(var r=this.planes,o=0;o<6;o++)r[o].copy(n.planes[o]);return this},t.setFromProjectionMatrix=function(n){var r=this.planes,o=n.elements,l=o[0],b=o[1],S=o[2],L=o[3],G=o[4],U=o[5],F=o[6],K=o[7],Q=o[8],re=o[9],ve=o[10],oe=o[11],Z=o[12],Te=o[13],Be=o[14],we=o[15];return r[0].setComponents(L-l,K-G,oe-Q,we-Z).normalize(),r[1].setComponents(L+l,K+G,oe+Q,we+Z).normalize(),r[2].setComponents(L+b,K+U,oe+re,we+Te).normalize(),r[3].setComponents(L-b,K-U,oe-re,we-Te).normalize(),r[4].setComponents(L-S,K-F,oe-ve,we-Be).normalize(),r[5].setComponents(L+S,K+F,oe+ve,we+Be).normalize(),this},t.intersectsObject=function(n){var r=n.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),oi.copy(r.boundingSphere).applyMatrix4(n.matrixWorld),this.intersectsSphere(oi)},t.intersectsSprite=function(n){return oi.center.set(0,0,0),oi.radius=.7071067811865476,oi.applyMatrix4(n.matrixWorld),this.intersectsSphere(oi)},t.intersectsSphere=function(n){for(var r=this.planes,o=n.center,l=-n.radius,b=0;b<6;b++)if(r[b].distanceToPoint(o)<l)return!1;return!0},t.intersectsBox=function(n){for(var r=this.planes,o=0;o<6;o++){var l=r[o];if(pa.x=l.normal.x>0?n.max.x:n.min.x,pa.y=l.normal.y>0?n.max.y:n.min.y,pa.z=l.normal.z>0?n.max.z:n.min.z,l.distanceToPoint(pa)<0)return!1}return!0},t.containsPoint=function(n){for(var r=this.planes,o=0;o<6;o++)if(r[o].distanceToPoint(n)<0)return!1;return!0},a}();function Ji(){var a=null,t=!1,i=null,n=null;function r(o,l){i(o,l),n=a.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=a.requestAnimationFrame(r),t=!0)},stop:function(){a.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(l){i=l},setContext:function(l){a=l}}}function Ii(a,t){var i=t.isWebGL2,n=new WeakMap;return{get:function l(L){return L.isInterleavedBufferAttribute&&(L=L.data),n.get(L)},remove:function b(L){L.isInterleavedBufferAttribute&&(L=L.data);var G=n.get(L);G&&(a.deleteBuffer(G.buffer),n.delete(L))},update:function S(L,G){if(L.isGLBufferAttribute){var U=n.get(L);(!U||U.version<L.version)&&n.set(L,{buffer:L.buffer,type:L.type,bytesPerElement:L.elementSize,version:L.version})}else{L.isInterleavedBufferAttribute&&(L=L.data);var F=n.get(L);void 0===F?n.set(L,function r(L,G){var U=L.array,F=L.usage,K=a.createBuffer();a.bindBuffer(G,K),a.bufferData(G,U,F),L.onUploadCallback();var Q=5126;return U instanceof Float32Array?Q=5126:U instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):U instanceof Uint16Array?L.isFloat16BufferAttribute?i?Q=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):Q=5123:U instanceof Int16Array?Q=5122:U instanceof Uint32Array?Q=5125:U instanceof Int32Array?Q=5124:U instanceof Int8Array?Q=5120:U instanceof Uint8Array&&(Q=5121),{buffer:K,type:Q,bytesPerElement:U.BYTES_PER_ELEMENT,version:L.version}}(L,G)):F.version<L.version&&(function o(L,G,U){var F=G.array,K=G.updateRange;a.bindBuffer(U,L),-1===K.count?a.bufferSubData(U,0,F):(i?a.bufferSubData(U,K.offset*F.BYTES_PER_ELEMENT,F,K.offset,K.count):a.bufferSubData(U,K.offset*F.BYTES_PER_ELEMENT,F.subarray(K.offset,K.offset+K.count)),K.count=-1)}(F.buffer,L,G),F.version=L.version)}}}}var ia=function(a){function t(i,n,r,o){var l;void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=1),(l=a.call(this)||this).type="PlaneBufferGeometry",l.parameters={width:i,height:n,widthSegments:r,heightSegments:o};for(var b=i/2,S=n/2,L=Math.floor(r),G=Math.floor(o),U=L+1,F=G+1,K=i/L,Q=n/G,re=[],ve=[],oe=[],Z=[],Te=0;Te<F;Te++)for(var Be=Te*Q-S,we=0;we<U;we++)ve.push(we*K-b,-Be,0),oe.push(0,0,1),Z.push(we/L),Z.push(1-Te/G);for(var Le=0;Le<G;Le++)for(var tt=0;tt<L;tt++){var wt=tt+U*(Le+1),st=tt+1+U*(Le+1),Ge=tt+1+U*Le;re.push(tt+U*Le,wt,Ge),re.push(wt,st,Ge)}return l.setIndex(re),l.setAttribute("position",new _n(ve,3)),l.setAttribute("normal",new _n(oe,3)),l.setAttribute("uv",new _n(Z,2)),l}return Qn(t,a),t}(De),Vr={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney\u2019s reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)\u22c5G(v) / 4(n\u22c5l)(n\u22c5v)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney\u2019s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Ag\xfcera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor.xyz *= color.xyz;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\n\t\tvec2 f = fract( uv );\n\n\t\tuv += 0.5 - f;\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\n\t\t}\n\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\n\t\tuv *= texelSize;\n\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x += texelSize;\n\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.y += texelSize;\n\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x -= texelSize;\n\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tvec3 tm = mix( tl, tr, f.x );\n\n\t\tvec3 bm = mix( bl, br, f.x );\n\n\t\treturn mix( tm, bm, f.y );\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= r1 ) {\n\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\n\t\t} else if ( roughness >= r4 ) {\n\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\n\t\t} else if ( roughness >= r5 ) {\n\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\n\t\t} else if ( roughness >= r6 ) {\n\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n\n#ifdef DOUBLE_SIDED\n\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n\n#endif\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//\ty Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim\t\t:= ( 4 , 2 )\n\t\t//\t# #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\n\t#endif\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmissionmap_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\n#endif\n",transmissionmap_pars_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform sampler2D transmissionMap;\n\n#endif\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transmission model\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},Cn={common:{diffuse:{value:new Fn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new da},uv2Transform:{value:new da},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new cn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Fn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Fn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new da}},sprite:{diffuse:{value:new Fn(15658734)},opacity:{value:1},center:{value:new cn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new da}}},fo={basic:{uniforms:$n([Cn.common,Cn.specularmap,Cn.envmap,Cn.aomap,Cn.lightmap,Cn.fog]),vertexShader:Vr.meshbasic_vert,fragmentShader:Vr.meshbasic_frag},lambert:{uniforms:$n([Cn.common,Cn.specularmap,Cn.envmap,Cn.aomap,Cn.lightmap,Cn.emissivemap,Cn.fog,Cn.lights,{emissive:{value:new Fn(0)}}]),vertexShader:Vr.meshlambert_vert,fragmentShader:Vr.meshlambert_frag},phong:{uniforms:$n([Cn.common,Cn.specularmap,Cn.envmap,Cn.aomap,Cn.lightmap,Cn.emissivemap,Cn.bumpmap,Cn.normalmap,Cn.displacementmap,Cn.fog,Cn.lights,{emissive:{value:new Fn(0)},specular:{value:new Fn(1118481)},shininess:{value:30}}]),vertexShader:Vr.meshphong_vert,fragmentShader:Vr.meshphong_frag},standard:{uniforms:$n([Cn.common,Cn.envmap,Cn.aomap,Cn.lightmap,Cn.emissivemap,Cn.bumpmap,Cn.normalmap,Cn.displacementmap,Cn.roughnessmap,Cn.metalnessmap,Cn.fog,Cn.lights,{emissive:{value:new Fn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vr.meshphysical_vert,fragmentShader:Vr.meshphysical_frag},toon:{uniforms:$n([Cn.common,Cn.aomap,Cn.lightmap,Cn.emissivemap,Cn.bumpmap,Cn.normalmap,Cn.displacementmap,Cn.gradientmap,Cn.fog,Cn.lights,{emissive:{value:new Fn(0)}}]),vertexShader:Vr.meshtoon_vert,fragmentShader:Vr.meshtoon_frag},matcap:{uniforms:$n([Cn.common,Cn.bumpmap,Cn.normalmap,Cn.displacementmap,Cn.fog,{matcap:{value:null}}]),vertexShader:Vr.meshmatcap_vert,fragmentShader:Vr.meshmatcap_frag},points:{uniforms:$n([Cn.points,Cn.fog]),vertexShader:Vr.points_vert,fragmentShader:Vr.points_frag},dashed:{uniforms:$n([Cn.common,Cn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vr.linedashed_vert,fragmentShader:Vr.linedashed_frag},depth:{uniforms:$n([Cn.common,Cn.displacementmap]),vertexShader:Vr.depth_vert,fragmentShader:Vr.depth_frag},normal:{uniforms:$n([Cn.common,Cn.bumpmap,Cn.normalmap,Cn.displacementmap,{opacity:{value:1}}]),vertexShader:Vr.normal_vert,fragmentShader:Vr.normal_frag},sprite:{uniforms:$n([Cn.sprite,Cn.fog]),vertexShader:Vr.sprite_vert,fragmentShader:Vr.sprite_frag},background:{uniforms:{uvTransform:{value:new da},t2D:{value:null}},vertexShader:Vr.background_vert,fragmentShader:Vr.background_frag},cube:{uniforms:$n([Cn.envmap,{opacity:{value:1}}]),vertexShader:Vr.cube_vert,fragmentShader:Vr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vr.equirect_vert,fragmentShader:Vr.equirect_frag},distanceRGBA:{uniforms:$n([Cn.common,Cn.displacementmap,{referencePosition:{value:new ke},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vr.distanceRGBA_vert,fragmentShader:Vr.distanceRGBA_frag},shadow:{uniforms:$n([Cn.lights,Cn.fog,{color:{value:new Fn(0)},opacity:{value:1}}]),vertexShader:Vr.shadow_vert,fragmentShader:Vr.shadow_frag}};function Xm(a,t,i,n,r){var b,S,o=new Fn(0),l=0,L=null,G=0,U=null;function K(Q,re){i.buffers.color.setClear(Q.r,Q.g,Q.b,re,r)}return{getClearColor:function(){return o},setClearColor:function(re,ve){void 0===ve&&(ve=1),o.set(re),K(o,l=ve)},getClearAlpha:function(){return l},setClearAlpha:function(re){K(o,l=re)},render:function F(Q,re,ve,oe){var Z=!0===re.isScene?re.background:null;Z&&Z.isTexture&&(Z=t.get(Z));var Te=a.xr,Be=Te.getSession&&Te.getSession();Be&&"additive"===Be.environmentBlendMode&&(Z=null),null===Z?K(o,l):Z&&Z.isColor&&(K(Z,1),oe=!0),(a.autoClear||oe)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),Z&&(Z.isCubeTexture||Z.isWebGLCubeRenderTarget||306===Z.mapping)?(void 0===S&&((S=new kn(new gr(1,1,1),new Kr({name:"BackgroundCubeMaterial",uniforms:Fr(fo.cube.uniforms),vertexShader:fo.cube.vertexShader,fragmentShader:fo.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),S.geometry.deleteAttribute("uv"),S.onBeforeRender=function(we,Ae,Le){this.matrixWorld.copyPosition(Le.matrixWorld)},Object.defineProperty(S.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(S)),Z.isWebGLCubeRenderTarget&&(Z=Z.texture),S.material.uniforms.envMap.value=Z,S.material.uniforms.flipEnvMap.value=Z.isCubeTexture&&Z._needsFlipEnvMap?-1:1,(L!==Z||G!==Z.version||U!==a.toneMapping)&&(S.material.needsUpdate=!0,L=Z,G=Z.version,U=a.toneMapping),Q.unshift(S,S.geometry,S.material,0,0,null)):Z&&Z.isTexture&&(void 0===b&&((b=new kn(new ia(2,2),new Kr({name:"BackgroundMaterial",uniforms:Fr(fo.background.uniforms),vertexShader:fo.background.vertexShader,fragmentShader:fo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(b.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(b)),b.material.uniforms.t2D.value=Z,!0===Z.matrixAutoUpdate&&Z.updateMatrix(),b.material.uniforms.uvTransform.value.copy(Z.matrix),(L!==Z||G!==Z.version||U!==a.toneMapping)&&(b.material.needsUpdate=!0,L=Z,G=Z.version,U=a.toneMapping),Q.unshift(b,b.geometry,b.material,0,0,null))}}}function qm(a,t,i,n){var r=a.getParameter(34921),o=n.isWebGL2?null:t.get("OES_vertex_array_object"),l=n.isWebGL2||null!==o,b={},S=re(null),L=S;function F(vt){return n.isWebGL2?a.bindVertexArray(vt):o.bindVertexArrayOES(vt)}function K(vt){return n.isWebGL2?a.deleteVertexArray(vt):o.deleteVertexArrayOES(vt)}function re(vt){for(var Je=[],je=[],At=[],Rt=0;Rt<r;Rt++)Je[Rt]=0,je[Rt]=0,At[Rt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Je,enabledAttributes:je,attributeDivisors:At,object:vt,attributes:{},index:null}}function Z(){for(var vt=L.newAttributes,Je=0,je=vt.length;Je<je;Je++)vt[Je]=0}function Te(vt){Be(vt,0)}function Be(vt,Je){var At=L.enabledAttributes,Rt=L.attributeDivisors;L.newAttributes[vt]=1,0===At[vt]&&(a.enableVertexAttribArray(vt),At[vt]=1),Rt[vt]!==Je&&((n.isWebGL2?a:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](vt,Je),Rt[vt]=Je)}function we(){for(var vt=L.newAttributes,Je=L.enabledAttributes,je=0,At=Je.length;je<At;je++)Je[je]!==vt[je]&&(a.disableVertexAttribArray(je),Je[je]=0)}function Ae(vt,Je,je,At,Rt,tn){!0!==n.isWebGL2||5124!==je&&5125!==je?a.vertexAttribPointer(vt,Je,je,At,Rt,tn):a.vertexAttribIPointer(vt,Je,je,Rt,tn)}function st(){Ge(),L!==S&&F((L=S).object)}function Ge(){S.geometry=null,S.program=null,S.wireframe=!1}return{setup:function G(vt,Je,je,At,Rt){var tn=!1;if(l){var en=function Q(vt,Je,je){var At=!0===je.wireframe,Rt=b[vt.id];void 0===Rt&&(b[vt.id]=Rt={});var tn=Rt[Je.id];void 0===tn&&(Rt[Je.id]=tn={});var en=tn[At];return void 0===en&&(en=re(function U(){return n.isWebGL2?a.createVertexArray():o.createVertexArrayOES()}()),tn[At]=en),en}(At,je,Je);L!==en&&F((L=en).object),tn=function ve(vt,Je){var je=L.attributes,At=vt.attributes,Rt=0;for(var tn in At){var en=je[tn],Yt=At[tn];if(void 0===en||en.attribute!==Yt||en.data!==Yt.data)return!0;Rt++}return L.attributesNum!==Rt||L.index!==Je}(At,Rt),tn&&function oe(vt,Je){var je={},At=vt.attributes,Rt=0;for(var tn in At){var en=At[tn],Yt={};Yt.attribute=en,en.data&&(Yt.data=en.data),je[tn]=Yt,Rt++}L.attributes=je,L.attributesNum=Rt,L.index=Je}(At,Rt)}else{var Yt=!0===Je.wireframe;(L.geometry!==At.id||L.program!==je.id||L.wireframe!==Yt)&&(L.geometry=At.id,L.program=je.id,L.wireframe=Yt,tn=!0)}!0===vt.isInstancedMesh&&(tn=!0),null!==Rt&&i.update(Rt,34963),tn&&(function Le(vt,Je,je,At){if(!1!==n.isWebGL2||!vt.isInstancedMesh&&!At.isInstancedBufferGeometry||null!==t.get("ANGLE_instanced_arrays")){Z();var Rt=At.attributes,tn=je.getAttributes(),en=Je.defaultAttributeValues;for(var Yt in tn){var Gt=tn[Yt];if(Gt>=0){var yn=Rt[Yt];if(void 0!==yn){var Sn=yn.normalized,er=yn.itemSize,Jt=i.get(yn);if(void 0===Jt)continue;var Nr=Jt.buffer,wr=Jt.type,Er=Jt.bytesPerElement;if(yn.isInterleavedBufferAttribute){var Ln=yn.data,Rr=Ln.stride,yr=yn.offset;Ln&&Ln.isInstancedInterleavedBuffer?(Be(Gt,Ln.meshPerAttribute),void 0===At._maxInstanceCount&&(At._maxInstanceCount=Ln.meshPerAttribute*Ln.count)):Te(Gt),a.bindBuffer(34962,Nr),Ae(Gt,er,wr,Sn,Rr*Er,yr*Er)}else yn.isInstancedBufferAttribute?(Be(Gt,yn.meshPerAttribute),void 0===At._maxInstanceCount&&(At._maxInstanceCount=yn.meshPerAttribute*yn.count)):Te(Gt),a.bindBuffer(34962,Nr),Ae(Gt,er,wr,Sn,0,0)}else if("instanceMatrix"===Yt){var mi=i.get(vt.instanceMatrix);if(void 0===mi)continue;var Gr=mi.buffer,Ai=mi.type;Be(Gt+0,1),Be(Gt+1,1),Be(Gt+2,1),Be(Gt+3,1),a.bindBuffer(34962,Gr),a.vertexAttribPointer(Gt+0,4,Ai,!1,64,0),a.vertexAttribPointer(Gt+1,4,Ai,!1,64,16),a.vertexAttribPointer(Gt+2,4,Ai,!1,64,32),a.vertexAttribPointer(Gt+3,4,Ai,!1,64,48)}else if("instanceColor"===Yt){var Pi=i.get(vt.instanceColor);if(void 0===Pi)continue;var $i=Pi.buffer,qi=Pi.type;Be(Gt,1),a.bindBuffer(34962,$i),a.vertexAttribPointer(Gt,3,qi,!1,12,0)}else if(void 0!==en){var Ri=en[Yt];if(void 0!==Ri)switch(Ri.length){case 2:a.vertexAttrib2fv(Gt,Ri);break;case 3:a.vertexAttrib3fv(Gt,Ri);break;case 4:a.vertexAttrib4fv(Gt,Ri);break;default:a.vertexAttrib1fv(Gt,Ri)}}}}we()}}(vt,Je,je,At),null!==Rt&&a.bindBuffer(34963,i.get(Rt).buffer))},reset:st,resetDefaultState:Ge,dispose:function tt(){for(var vt in st(),b){var Je=b[vt];for(var je in Je){var At=Je[je];for(var Rt in At)K(At[Rt].object),delete At[Rt];delete Je[je]}delete b[vt]}},releaseStatesOfGeometry:function Ze(vt){if(void 0!==b[vt.id]){var Je=b[vt.id];for(var je in Je){var At=Je[je];for(var Rt in At)K(At[Rt].object),delete At[Rt];delete Je[je]}delete b[vt.id]}},releaseStatesOfProgram:function wt(vt){for(var Je in b){var je=b[Je];if(void 0!==je[vt.id]){var At=je[vt.id];for(var Rt in At)K(At[Rt].object),delete At[Rt];delete je[vt.id]}}},initAttributes:Z,enableAttribute:Te,disableUnusedAttributes:we}}function Ym(a,t,i,n){var o,r=n.isWebGL2;this.setMode=function l(L){o=L},this.render=function b(L,G){a.drawArrays(o,L,G),i.update(G,o,1)},this.renderInstances=function S(L,G,U){if(0!==U){var F,K;if(r)F=a,K="drawArraysInstanced";else if(K="drawArraysInstancedANGLE",null===(F=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");F[K](o,L,G,U),i.update(G,o,U)}}}function Km(a,t,i){var n;function o(Ae){if("highp"===Ae){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Ae="mediump"}return"mediump"===Ae&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var l=typeof WebGL2RenderingContext<"u"&&a instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&a instanceof WebGL2ComputeRenderingContext,b=void 0!==i.precision?i.precision:"highp",S=o(b);S!==b&&(console.warn("THREE.WebGLRenderer:",b,"not supported, using",S,"instead."),b=S);var L=!0===i.logarithmicDepthBuffer,G=a.getParameter(34930),U=a.getParameter(35660),F=a.getParameter(3379),K=a.getParameter(34076),Q=a.getParameter(34921),re=a.getParameter(36347),ve=a.getParameter(36348),oe=a.getParameter(36349),Z=U>0,Te=l||!!t.get("OES_texture_float");return{isWebGL2:l,getMaxAnisotropy:function r(){if(void 0!==n)return n;var Ae=t.get("EXT_texture_filter_anisotropic");return n=null!==Ae?a.getParameter(Ae.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:o,precision:b,logarithmicDepthBuffer:L,maxTextures:G,maxVertexTextures:U,maxTextureSize:F,maxCubemapSize:K,maxAttributes:Q,maxVertexUniforms:re,maxVaryings:ve,maxFragmentUniforms:oe,vertexTextures:Z,floatFragmentTextures:Te,floatVertexTextures:Z&&Te,maxSamples:l?a.getParameter(36183):0}}function Qm(a){var t=this,i=null,n=0,r=!1,o=!1,l=new Ja,b=new da,S={value:null,needsUpdate:!1};function L(){S.value!==i&&(S.value=i,S.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function G(U,F,K,Q){var re=null!==U?U.length:0,ve=null;if(0!==re){if(ve=S.value,!0!==Q||null===ve){var oe=K+4*re,Z=F.matrixWorldInverse;b.getNormalMatrix(Z),(null===ve||ve.length<oe)&&(ve=new Float32Array(oe));for(var Te=0,Be=K;Te!==re;++Te,Be+=4)l.copy(U[Te]).applyMatrix4(Z,b),l.normal.toArray(ve,Be),ve[Be+3]=l.constant}S.value=ve,S.needsUpdate=!0}return t.numPlanes=re,t.numIntersection=0,ve}this.uniform=S,this.numPlanes=0,this.numIntersection=0,this.init=function(U,F,K){var Q=0!==U.length||F||0!==n||r;return r=F,i=G(U,K,0),n=U.length,Q},this.beginShadows=function(){o=!0,G(null)},this.endShadows=function(){o=!1,L()},this.setState=function(U,F,K){var Q=U.clippingPlanes,re=U.clipIntersection,ve=U.clipShadows,oe=a.get(U);if(!r||null===Q||0===Q.length||o&&!ve)o?G(null):L();else{var Z=o?0:n,Te=4*Z,Be=oe.clippingState||null;S.value=Be,Be=G(Q,F,Te,K);for(var we=0;we!==Te;++we)Be[we]=i[we];oe.clippingState=Be,this.numIntersection=re?this.numPlanes:0,this.numPlanes+=Z}}}function Zm(a){var t=new WeakMap;function i(l,b){return 303===b?l.mapping=301:304===b&&(l.mapping=302),l}function r(l){var b=l.target;b.removeEventListener("dispose",r);var S=t.get(b);void 0!==S&&(t.delete(b),S.dispose())}return{get:function n(l){if(l&&l.isTexture){var b=l.mapping;if(303===b||304===b){if(t.has(l))return i(t.get(l).texture,l.mapping);var L=l.image;if(L&&L.height>0){var G=a.getRenderList(),U=a.getRenderTarget(),F=a.getRenderState(),K=new Di(L.height/2);return K.fromEquirectangularTexture(a,l),t.set(l,K),a.setRenderTarget(U),a.setRenderList(G),a.setRenderState(F),l.addEventListener("dispose",r),i(K.texture,l.mapping)}return null}}return l},dispose:function o(){t=new WeakMap}}}function Jm(a){var t={};return{has:function(n){if(void 0!==t[n])return null!==t[n];var r;switch(n){case"WEBGL_depth_texture":r=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=a.getExtension(n)}return t[n]=r,null!==r},get:function(n){return this.has(n)||console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]}}}function $m(a,t,i,n){var r=new WeakMap,o=new WeakMap;function l(U){var F=U.target,K=r.get(F);for(var Q in null!==K.index&&t.remove(K.index),K.attributes)t.remove(K.attributes[Q]);F.removeEventListener("dispose",l),r.delete(F);var re=o.get(K);re&&(t.remove(re),o.delete(K)),n.releaseStatesOfGeometry(K),!0===F.isInstancedBufferGeometry&&delete F._maxInstanceCount,i.memory.geometries--}function L(U){var F=[],K=U.index,Q=U.attributes.position,re=0;if(null!==K){var ve=K.array;re=K.version;for(var oe=0,Z=ve.length;oe<Z;oe+=3){var Te=ve[oe+0],Be=ve[oe+1],we=ve[oe+2];F.push(Te,Be,Be,we,we,Te)}}else{re=Q.version;for(var Le=0,tt=Q.array.length/3-1;Le<tt;Le+=3){var Ze=Le+0,wt=Le+1,st=Le+2;F.push(Ze,wt,wt,st,st,Ze)}}var Ge=new(R(F)>65535?qo:Ga)(F,1);Ge.version=re;var vt=o.get(U);vt&&t.remove(vt),o.set(U,Ge)}return{get:function b(U,F){var K=r.get(F);return K||(F.addEventListener("dispose",l),F.isBufferGeometry?K=F:F.isGeometry&&(void 0===F._bufferGeometry&&(F._bufferGeometry=(new De).setFromObject(U)),K=F._bufferGeometry),r.set(F,K),i.memory.geometries++,K)},update:function S(U){var F=U.attributes;for(var K in F)t.update(F[K],34962);var Q=U.morphAttributes;for(var re in Q)for(var ve=Q[re],oe=0,Z=ve.length;oe<Z;oe++)t.update(ve[oe],34962)},getWireframeAttribute:function G(U){var F=o.get(U);if(F){var K=U.index;null!==K&&F.version<K.version&&L(U)}else L(U);return o.get(U)}}}function eg(a,t,i,n){var o,b,S,r=n.isWebGL2;this.setMode=function l(F){o=F},this.setIndex=function L(F){b=F.type,S=F.bytesPerElement},this.render=function G(F,K){a.drawElements(o,K,b,F*S),i.update(K,o,1)},this.renderInstances=function U(F,K,Q){if(0!==Q){var re,ve;if(r)re=a,ve="drawElementsInstanced";else if(ve="drawElementsInstancedANGLE",null===(re=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");re[ve](o,K,b,F*S,Q),i.update(K,o,Q)}}}function tg(a){var i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function r(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function n(o,l,b){switch(i.calls++,l){case 4:i.triangles+=b*(o/3);break;case 1:i.lines+=b*(o/2);break;case 3:i.lines+=b*(o-1);break;case 2:i.lines+=b*o;break;case 0:i.points+=b*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l)}}}}function ng(a,t){return a[0]-t[0]}function rg(a,t){return Math.abs(t[1])-Math.abs(a[1])}function ig(a){for(var t={},i=new Float32Array(8),n=[],r=0;r<8;r++)n[r]=[r,0];return{update:function o(l,b,S,L){var G=l.morphTargetInfluences,U=void 0===G?0:G.length,F=t[b.id];if(void 0===F){F=[];for(var K=0;K<U;K++)F[K]=[K,0];t[b.id]=F}for(var Q=0;Q<U;Q++){var re=F[Q];re[0]=Q,re[1]=G[Q]}F.sort(rg);for(var ve=0;ve<8;ve++)ve<U&&F[ve][1]?(n[ve][0]=F[ve][0],n[ve][1]=F[ve][1]):(n[ve][0]=Number.MAX_SAFE_INTEGER,n[ve][1]=0);n.sort(ng);for(var oe=S.morphTargets&&b.morphAttributes.position,Z=S.morphNormals&&b.morphAttributes.normal,Te=0,Be=0;Be<8;Be++){var we=n[Be],Ae=we[0],Le=we[1];Ae!==Number.MAX_SAFE_INTEGER&&Le?(oe&&b.getAttribute("morphTarget"+Be)!==oe[Ae]&&b.setAttribute("morphTarget"+Be,oe[Ae]),Z&&b.getAttribute("morphNormal"+Be)!==Z[Ae]&&b.setAttribute("morphNormal"+Be,Z[Ae]),i[Be]=Le,Te+=Le):(oe&&!0===b.hasAttribute("morphTarget"+Be)&&b.deleteAttribute("morphTarget"+Be),Z&&!0===b.hasAttribute("morphNormal"+Be)&&b.deleteAttribute("morphNormal"+Be),i[Be]=0)}var tt=b.morphTargetsRelative?1:1-Te;L.getUniforms().setValue(a,"morphTargetBaseInfluence",tt),L.getUniforms().setValue(a,"morphTargetInfluences",i)}}}function ag(a,t,i,n){var r=new WeakMap;return{update:function o(b){var S=n.render.frame,L=b.geometry,G=t.get(b,L);return r.get(G)!==S&&(L.isGeometry&&G.updateFromObject(b),t.update(G),r.set(G,S)),b.isInstancedMesh&&(i.update(b.instanceMatrix,34962),null!==b.instanceColor&&i.update(b.instanceColor,34962)),G},dispose:function l(){r=new WeakMap}}}function bl(a,t,i,n){void 0===a&&(a=null),void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=1),vi.call(this,null),this.image={data:a,width:t,height:i,depth:n},this.magFilter=St,this.minFilter=St,this.wrapR=ot,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function wl(a,t,i,n){void 0===a&&(a=null),void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=1),vi.call(this,null),this.image={data:a,width:t,height:i,depth:n},this.magFilter=St,this.minFilter=St,this.wrapR=ot,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}fo.physical={uniforms:$n([fo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new cn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Fn(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Vr.meshphysical_vert,fragmentShader:Vr.meshphysical_frag},(bl.prototype=Object.create(vi.prototype)).constructor=bl,bl.prototype.isDataTexture2DArray=!0,(wl.prototype=Object.create(vi.prototype)).constructor=wl,wl.prototype.isDataTexture3D=!0;var Zd=new vi,og=new bl,sg=new wl,Jd=new ai,$d=[],ef=[],tf=new Float32Array(16),nf=new Float32Array(9),rf=new Float32Array(4);function El(a,t,i){var n=a[0];if(n<=0||n>0)return a;var r=t*i,o=$d[r];if(void 0===o&&(o=new Float32Array(r),$d[r]=o),0!==t){n.toArray(o,0);for(var l=1,b=0;l!==t;++l)a[l].toArray(o,b+=i)}return o}function $a(a,t){if(a.length!==t.length)return!1;for(var i=0,n=a.length;i<n;i++)if(a[i]!==t[i])return!1;return!0}function za(a,t){for(var i=0,n=t.length;i<n;i++)a[i]=t[i]}function af(a,t){var i=ef[t];void 0===i&&(i=new Int32Array(t),ef[t]=i);for(var n=0;n!==t;++n)i[n]=a.allocateTextureUnit();return i}function lg(a,t){var i=this.cache;i[0]!==t&&(a.uniform1f(this.addr,t),i[0]=t)}function cg(a,t){var i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(a.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if($a(i,t))return;a.uniform2fv(this.addr,t),za(i,t)}}function ug(a,t){var i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(a.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(a.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if($a(i,t))return;a.uniform3fv(this.addr,t),za(i,t)}}function hg(a,t){var i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(a.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if($a(i,t))return;a.uniform4fv(this.addr,t),za(i,t)}}function dg(a,t){var i=this.cache,n=t.elements;if(void 0===n){if($a(i,t))return;a.uniformMatrix2fv(this.addr,!1,t),za(i,t)}else{if($a(i,n))return;rf.set(n),a.uniformMatrix2fv(this.addr,!1,rf),za(i,n)}}function fg(a,t){var i=this.cache,n=t.elements;if(void 0===n){if($a(i,t))return;a.uniformMatrix3fv(this.addr,!1,t),za(i,t)}else{if($a(i,n))return;nf.set(n),a.uniformMatrix3fv(this.addr,!1,nf),za(i,n)}}function pg(a,t){var i=this.cache,n=t.elements;if(void 0===n){if($a(i,t))return;a.uniformMatrix4fv(this.addr,!1,t),za(i,t)}else{if($a(i,n))return;tf.set(n),a.uniformMatrix4fv(this.addr,!1,tf),za(i,n)}}function vg(a,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(a.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(t||Zd,r)}function mg(a,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(a.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||og,r)}function gg(a,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(a.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||sg,r)}function yg(a,t,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(a.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(t||Jd,r)}function Ag(a,t){var i=this.cache;i[0]!==t&&(a.uniform1i(this.addr,t),i[0]=t)}function bg(a,t){var i=this.cache;$a(i,t)||(a.uniform2iv(this.addr,t),za(i,t))}function wg(a,t){var i=this.cache;$a(i,t)||(a.uniform3iv(this.addr,t),za(i,t))}function Eg(a,t){var i=this.cache;$a(i,t)||(a.uniform4iv(this.addr,t),za(i,t))}function xg(a,t){var i=this.cache;i[0]!==t&&(a.uniform1ui(this.addr,t),i[0]=t)}function Tg(a,t){a.uniform1fv(this.addr,t)}function Sg(a,t){a.uniform1iv(this.addr,t)}function Cg(a,t){a.uniform2iv(this.addr,t)}function _g(a,t){a.uniform3iv(this.addr,t)}function Rg(a,t){a.uniform4iv(this.addr,t)}function Lg(a,t){var i=El(t,this.size,2);a.uniform2fv(this.addr,i)}function Pg(a,t){var i=El(t,this.size,3);a.uniform3fv(this.addr,i)}function Dg(a,t){var i=El(t,this.size,4);a.uniform4fv(this.addr,i)}function Ig(a,t){var i=El(t,this.size,4);a.uniformMatrix2fv(this.addr,!1,i)}function Og(a,t){var i=El(t,this.size,9);a.uniformMatrix3fv(this.addr,!1,i)}function Bg(a,t){var i=El(t,this.size,16);a.uniformMatrix4fv(this.addr,!1,i)}function Fg(a,t,i){var n=t.length,r=af(i,n);a.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.safeSetTexture2D(t[o]||Zd,r[o])}function Ng(a,t,i){var n=t.length,r=af(i,n);a.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.safeSetTextureCube(t[o]||Jd,r[o])}function Hg(a,t,i){this.id=a,this.addr=i,this.cache=[],this.setValue=function Mg(a){switch(a){case 5126:return lg;case 35664:return cg;case 35665:return ug;case 35666:return hg;case 35674:return dg;case 35675:return fg;case 35676:return pg;case 5124:case 35670:return Ag;case 35667:case 35671:return bg;case 35668:case 35672:return wg;case 35669:case 35673:return Eg;case 5125:return xg;case 35678:case 36198:case 36298:case 36306:case 35682:return vg;case 35679:case 36299:case 36307:return gg;case 35680:case 36300:case 36308:case 36293:return yg;case 36289:case 36303:case 36311:case 36292:return mg}}(t.type)}function of(a,t,i){this.id=a,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function kg(a){switch(a){case 5126:return Tg;case 35664:return Lg;case 35665:return Pg;case 35666:return Dg;case 35674:return Ig;case 35675:return Og;case 35676:return Bg;case 5124:case 35670:return Sg;case 35667:case 35671:return Cg;case 35668:case 35672:return _g;case 35669:case 35673:return Rg;case 35678:case 36198:case 36298:case 36306:case 35682:return Fg;case 35680:case 36300:case 36308:case 36293:return Ng}}(t.type)}function sf(a){this.id=a,this.seq=[],this.map={}}of.prototype.updateCache=function(a){var t=this.cache;a instanceof Float32Array&&t.length!==a.length&&(this.cache=new Float32Array(a.length)),za(t,a)},sf.prototype.setValue=function(a,t,i){for(var n=this.seq,r=0,o=n.length;r!==o;++r){var l=n[r];l.setValue(a,t[l.id],i)}};var Hh=/([\w\d_]+)(\])?(\[|\.)?/g;function lf(a,t){a.seq.push(t),a.map[t.id]=t}function Ug(a,t,i){var n=a.name,r=n.length;for(Hh.lastIndex=0;;){var o=Hh.exec(n),b=o[1],L=o[3];if("]"===o[2]&&(b|=0),void 0===L||"["===L&&Hh.lastIndex+2===r){lf(i,void 0===L?new Hg(b,a,t):new of(b,a,t));break}var U=i.map[b];void 0===U&&lf(i,U=new sf(b)),i=U}}function ys(a,t){this.seq=[],this.map={};for(var i=a.getProgramParameter(t,35718),n=0;n<i;++n){var r=a.getActiveUniform(t,n);Ug(r,a.getUniformLocation(t,r.name),this)}}function cf(a,t,i){var n=a.createShader(t);return a.shaderSource(n,i),a.compileShader(n),n}ys.prototype.setValue=function(a,t,i,n){var r=this.map[t];void 0!==r&&r.setValue(a,i,n)},ys.prototype.setOptional=function(a,t,i){var n=t[i];void 0!==n&&this.setValue(a,i,n)},ys.upload=function(a,t,i,n){for(var r=0,o=t.length;r!==o;++r){var l=t[r],b=i[l.id];!1!==b.needsUpdate&&l.setValue(a,b.value,n)}},ys.seqWithValue=function(a,t){for(var i=[],n=0,r=a.length;n!==r;++n){var o=a[n];o.id in t&&i.push(o)}return i};var Gg=0;function uf(a){switch(a){case qr:return["Linear","( value )"];case Mo:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function hf(a,t,i){var n=a.getShaderParameter(t,35713),r=a.getShaderInfoLog(t).trim();return n&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+function zg(a){for(var t=a.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(a.getShaderSource(t))}function sc(a,t){var i=uf(t);return"vec4 "+a+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Vg(a,t){var i=uf(t);return"vec4 "+a+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Wg(a,t){var i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+a+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function lc(a){return""!==a}function df(a,t){return a.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ff(a,t){return a.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Yg=/^[ \t]*#include +<([\w\d./]+)>/gm;function Uh(a){return a.replace(Yg,Kg)}function Kg(a,t){var i=Vr[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Uh(i)}var Qg=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Zg=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function pf(a){return a.replace(Zg,vf).replace(Qg,Jg)}function Jg(a,t,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),vf(0,t,i,n)}function vf(a,t,i,n){for(var r="",o=parseInt(t);o<parseInt(i);o++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function mf(a){var t="precision "+a.precision+" float;\nprecision "+a.precision+" int;";return"highp"===a.precision?t+="\n#define HIGH_PRECISION":"mediump"===a.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===a.precision&&(t+="\n#define LOW_PRECISION"),t}function r0(a,t,i,n){var ve,oe,r=a.getContext(),o=i.defines,l=i.vertexShader,b=i.fragmentShader,S=function $g(a){var t="SHADOWMAP_TYPE_BASIC";return 1===a.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===a.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===a.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(i),L=function e0(a){var t="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),G=function t0(a){var t="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(i),U=function n0(a){var t="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),F=a.gammaFactor>0?a.gammaFactor:1,K=i.isWebGL2?"":function jg(a){return[a.extensionDerivatives||a.envMapCubeUV||a.bumpMap||a.tangentSpaceNormalMap||a.clearcoatNormalMap||a.flatShading||"physical"===a.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(a.extensionFragDepth||a.logarithmicDepthBuffer)&&a.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",a.extensionDrawBuffers&&a.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(a.extensionShaderTextureLOD||a.envMap)&&a.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(lc).join("\n")}(i),Q=function Xg(a){var t=[];for(var i in a){var n=a[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(o),re=r.createProgram(),Z=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((ve=[Q].filter(lc).join("\n")).length>0&&(ve+="\n"),(oe=[K,Q].filter(lc).join("\n")).length>0&&(oe+="\n")):(ve=[mf(i),"#define SHADER_NAME "+i.shaderName,Q,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+F,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+G:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+S:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(lc).join("\n"),oe=[K,mf(i),"#define SHADER_NAME "+i.shaderName,Q,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+F,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+L:"",i.envMap?"#define "+G:"",i.envMap?"#define "+U:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+S:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Vr.tonemapping_pars_fragment:"",0!==i.toneMapping?Wg("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",Vr.encodings_pars_fragment,i.map?sc("mapTexelToLinear",i.mapEncoding):"",i.matcap?sc("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?sc("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?sc("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?sc("lightMapTexelToLinear",i.lightMapEncoding):"",Vg("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(lc).join("\n")),l=ff(l=df(l=Uh(l),i),i),b=ff(b=df(b=Uh(b),i),i),l=pf(l),b=pf(b),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(Z="#version 300 es\n",ve=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+ve,oe=["#define varying in",i.glslVersion===al?"":"out highp vec4 pc_fragColor;",i.glslVersion===al?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+oe);var Je,je,Be=Z+oe+b,we=cf(r,35633,Z+ve+l),Ae=cf(r,35632,Be);if(r.attachShader(re,we),r.attachShader(re,Ae),void 0!==i.index0AttributeName?r.bindAttribLocation(re,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(re,0,"position"),r.linkProgram(re),a.debug.checkShaderErrors){var Le=r.getProgramInfoLog(re).trim(),tt=r.getShaderInfoLog(we).trim(),Ze=r.getShaderInfoLog(Ae).trim(),wt=!0,st=!0;if(!1===r.getProgramParameter(re,35714)){wt=!1;var Ge=hf(r,we,"vertex"),vt=hf(r,Ae,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(re,35715),"gl.getProgramInfoLog",Le,Ge,vt)}else""!==Le?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Le):(""===tt||""===Ze)&&(st=!1);st&&(this.diagnostics={runnable:wt,programLog:Le,vertexShader:{log:tt,prefix:ve},fragmentShader:{log:Ze,prefix:oe}})}return r.deleteShader(we),r.deleteShader(Ae),this.getUniforms=function(){return void 0===Je&&(Je=new ys(r,re)),Je},this.getAttributes=function(){return void 0===je&&(je=function qg(a,t){for(var i={},n=a.getProgramParameter(t,35721),r=0;r<n;r++){var l=a.getActiveAttrib(t,r).name;i[l]=a.getAttribLocation(t,l)}return i}(r,re)),je},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(re),this.program=void 0},this.name=i.shaderName,this.id=Gg++,this.cacheKey=t,this.usedTimes=1,this.program=re,this.vertexShader=we,this.fragmentShader=Ae,this}function i0(a,t,i,n,r,o){var l=[],b=n.isWebGL2,S=n.logarithmicDepthBuffer,L=n.floatVertexTextures,G=n.maxVertexUniforms,U=n.vertexTextures,F=n.precision,K={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},Q=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function ve(Ae){var Le;return Ae?Ae.isTexture?Le=Ae.encoding:Ae.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),Le=Ae.texture.encoding):Le=qr,Le}return{getParameters:function oe(Ae,Le,tt,Ze,wt){var At,Rt,st=Ze.fog,vt=t.get(Ae.envMap||(Ae.isMeshStandardMaterial?Ze.environment:null)),Je=K[Ae.type],je=wt.isSkinnedMesh?function re(Ae){var tt=Ae.skeleton.bones;if(L)return 1024;var wt=Math.floor((G-20)/4),st=Math.min(wt,tt.length);return st<tt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+tt.length+" bones. This GPU supports "+st+"."),0):st}(wt):0;if(null!==Ae.precision&&(F=n.getMaxPrecision(Ae.precision))!==Ae.precision&&console.warn("THREE.WebGLProgram.getParameters:",Ae.precision,"not supported, using",F,"instead."),Je){var tn=fo[Je];At=tn.vertexShader,Rt=tn.fragmentShader}else At=Ae.vertexShader,Rt=Ae.fragmentShader;var en=a.getRenderTarget();return{isWebGL2:b,shaderID:Je,shaderName:Ae.type,vertexShader:At,fragmentShader:Rt,defines:Ae.defines,isRawShaderMaterial:!0===Ae.isRawShaderMaterial,glslVersion:Ae.glslVersion,precision:F,instancing:!0===wt.isInstancedMesh,instancingColor:!0===wt.isInstancedMesh&&null!==wt.instanceColor,supportsVertexTextures:U,outputEncoding:null!==en?ve(en.texture):a.outputEncoding,map:!!Ae.map,mapEncoding:ve(Ae.map),matcap:!!Ae.matcap,matcapEncoding:ve(Ae.matcap),envMap:!!vt,envMapMode:vt&&vt.mapping,envMapEncoding:ve(vt),envMapCubeUV:!!vt&&(306===vt.mapping||307===vt.mapping),lightMap:!!Ae.lightMap,lightMapEncoding:ve(Ae.lightMap),aoMap:!!Ae.aoMap,emissiveMap:!!Ae.emissiveMap,emissiveMapEncoding:ve(Ae.emissiveMap),bumpMap:!!Ae.bumpMap,normalMap:!!Ae.normalMap,objectSpaceNormalMap:1===Ae.normalMapType,tangentSpaceNormalMap:0===Ae.normalMapType,clearcoatMap:!!Ae.clearcoatMap,clearcoatRoughnessMap:!!Ae.clearcoatRoughnessMap,clearcoatNormalMap:!!Ae.clearcoatNormalMap,displacementMap:!!Ae.displacementMap,roughnessMap:!!Ae.roughnessMap,metalnessMap:!!Ae.metalnessMap,specularMap:!!Ae.specularMap,alphaMap:!!Ae.alphaMap,gradientMap:!!Ae.gradientMap,sheen:!!Ae.sheen,transmissionMap:!!Ae.transmissionMap,combine:Ae.combine,vertexTangents:Ae.normalMap&&Ae.vertexTangents,vertexColors:Ae.vertexColors,vertexUvs:!!(Ae.map||Ae.bumpMap||Ae.normalMap||Ae.specularMap||Ae.alphaMap||Ae.emissiveMap||Ae.roughnessMap||Ae.metalnessMap||Ae.clearcoatMap||Ae.clearcoatRoughnessMap||Ae.clearcoatNormalMap||Ae.displacementMap||Ae.transmissionMap),uvsVertexOnly:!(Ae.map||Ae.bumpMap||Ae.normalMap||Ae.specularMap||Ae.alphaMap||Ae.emissiveMap||Ae.roughnessMap||Ae.metalnessMap||Ae.clearcoatNormalMap||Ae.transmissionMap||!Ae.displacementMap),fog:!!st,useFog:Ae.fog,fogExp2:st&&st.isFogExp2,flatShading:Ae.flatShading,sizeAttenuation:Ae.sizeAttenuation,logarithmicDepthBuffer:S,skinning:Ae.skinning&&je>0,maxBones:je,useVertexTexture:L,morphTargets:Ae.morphTargets,morphNormals:Ae.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:Le.directional.length,numPointLights:Le.point.length,numSpotLights:Le.spot.length,numRectAreaLights:Le.rectArea.length,numHemiLights:Le.hemi.length,numDirLightShadows:Le.directionalShadowMap.length,numPointLightShadows:Le.pointShadowMap.length,numSpotLightShadows:Le.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:Ae.dithering,shadowMapEnabled:a.shadowMap.enabled&&tt.length>0,shadowMapType:a.shadowMap.type,toneMapping:Ae.toneMapped?a.toneMapping:0,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:Ae.premultipliedAlpha,alphaTest:Ae.alphaTest,doubleSided:2===Ae.side,flipSided:1===Ae.side,depthPacking:void 0!==Ae.depthPacking&&Ae.depthPacking,index0AttributeName:Ae.index0AttributeName,extensionDerivatives:Ae.extensions&&Ae.extensions.derivatives,extensionFragDepth:Ae.extensions&&Ae.extensions.fragDepth,extensionDrawBuffers:Ae.extensions&&Ae.extensions.drawBuffers,extensionShaderTextureLOD:Ae.extensions&&Ae.extensions.shaderTextureLOD,rendererExtensionFragDepth:b||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:b||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:b||i.has("EXT_shader_texture_lod"),customProgramCacheKey:Ae.customProgramCacheKey()}},getProgramCacheKey:function Z(Ae){var Le=[];if(Ae.shaderID?Le.push(Ae.shaderID):(Le.push(Ae.fragmentShader),Le.push(Ae.vertexShader)),void 0!==Ae.defines)for(var tt in Ae.defines)Le.push(tt),Le.push(Ae.defines[tt]);if(!1===Ae.isRawShaderMaterial){for(var Ze=0;Ze<Q.length;Ze++)Le.push(Ae[Q[Ze]]);Le.push(a.outputEncoding),Le.push(a.gammaFactor)}return Le.push(Ae.customProgramCacheKey),Le.join()},getUniforms:function Te(Ae){var Le=K[Ae.type];return Le?Or.clone(fo[Le].uniforms):Ae.uniforms},acquireProgram:function Be(Ae,Le){for(var tt,Ze=0,wt=l.length;Ze<wt;Ze++){var st=l[Ze];if(st.cacheKey===Le){++(tt=st).usedTimes;break}}return void 0===tt&&(tt=new r0(a,Le,Ae,r),l.push(tt)),tt},releaseProgram:function we(Ae){if(0==--Ae.usedTimes){var Le=l.indexOf(Ae);l[Le]=l[l.length-1],l.pop(),Ae.destroy()}},programs:l}}function a0(){var a=new WeakMap;return{get:function t(o){var l=a.get(o);return void 0===l&&a.set(o,l={}),l},remove:function i(o){a.delete(o)},update:function n(o,l,b){a.get(o)[l]=b},dispose:function r(){a=new WeakMap}}}function o0(a,t){return a.groupOrder!==t.groupOrder?a.groupOrder-t.groupOrder:a.renderOrder!==t.renderOrder?a.renderOrder-t.renderOrder:a.program!==t.program?a.program.id-t.program.id:a.material.id!==t.material.id?a.material.id-t.material.id:a.z!==t.z?a.z-t.z:a.id-t.id}function s0(a,t){return a.groupOrder!==t.groupOrder?a.groupOrder-t.groupOrder:a.renderOrder!==t.renderOrder?a.renderOrder-t.renderOrder:a.z!==t.z?t.z-a.z:a.id-t.id}function gf(a){var t=[],i=0,n=[],r=[],o={id:-1};function b(F,K,Q,re,ve,oe){var Z=t[i],Te=a.get(Q);return void 0===Z?t[i]=Z={id:F.id,object:F,geometry:K,material:Q,program:Te.program||o,groupOrder:re,renderOrder:F.renderOrder,z:ve,group:oe}:(Z.id=F.id,Z.object=F,Z.geometry=K,Z.material=Q,Z.program=Te.program||o,Z.groupOrder=re,Z.renderOrder=F.renderOrder,Z.z=ve,Z.group=oe),i++,Z}return{opaque:n,transparent:r,init:function l(){i=0,n.length=0,r.length=0},push:function S(F,K,Q,re,ve,oe){var Z=b(F,K,Q,re,ve,oe);(!0===Q.transparent?r:n).push(Z)},unshift:function L(F,K,Q,re,ve,oe){var Z=b(F,K,Q,re,ve,oe);(!0===Q.transparent?r:n).unshift(Z)},finish:function U(){for(var F=i,K=t.length;F<K;F++){var Q=t[F];if(null===Q.id)break;Q.id=null,Q.object=null,Q.geometry=null,Q.material=null,Q.program=null,Q.group=null}},sort:function G(F,K){n.length>1&&n.sort(F||o0),r.length>1&&r.sort(K||s0)}}}function l0(a){var t=new WeakMap;return{get:function i(r,o){var b,l=t.get(r);return void 0===l?(b=new gf(a),t.set(r,new WeakMap),t.get(r).set(o,b)):void 0===(b=l.get(o))&&(b=new gf(a),l.set(o,b)),b},dispose:function n(){t=new WeakMap}}}function c0(){var a={};return{get:function(i){if(void 0!==a[i.id])return a[i.id];var n;switch(i.type){case"DirectionalLight":n={direction:new ke,color:new Fn};break;case"SpotLight":n={position:new ke,direction:new ke,color:new Fn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ke,color:new Fn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ke,skyColor:new Fn,groundColor:new Fn};break;case"RectAreaLight":n={color:new Fn,position:new ke,halfWidth:new ke,halfHeight:new ke}}return a[i.id]=n,n}}}var h0=0;function d0(a,t){return(t.castShadow?1:0)-(a.castShadow?1:0)}function f0(a,t){for(var i=new c0,n=function u0(){var a={};return{get:function(i){if(void 0!==a[i.id])return a[i.id];var n;switch(i.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new cn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new cn,shadowCameraNear:1,shadowCameraFar:1e3}}return a[i.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},o=0;o<9;o++)r.probe.push(new ke);var l=new ke,b=new br,S=new br;return{setup:function L(G,U,F){for(var K=0,Q=0,re=0,ve=0;ve<9;ve++)r.probe[ve].set(0,0,0);var oe=0,Z=0,Te=0,Be=0,we=0,Ae=0,Le=0,tt=0,Ze=F.matrixWorldInverse;G.sort(d0);for(var wt=0,st=G.length;wt<st;wt++){var Ge=G[wt],vt=Ge.color,Je=Ge.intensity,je=Ge.distance,At=Ge.shadow&&Ge.shadow.map?Ge.shadow.map.texture:null;if(Ge.isAmbientLight)K+=vt.r*Je,Q+=vt.g*Je,re+=vt.b*Je;else if(Ge.isLightProbe)for(var Rt=0;Rt<9;Rt++)r.probe[Rt].addScaledVector(Ge.sh.coefficients[Rt],Je);else if(Ge.isDirectionalLight){var tn=i.get(Ge);if(tn.color.copy(Ge.color).multiplyScalar(Ge.intensity),tn.direction.setFromMatrixPosition(Ge.matrixWorld),l.setFromMatrixPosition(Ge.target.matrixWorld),tn.direction.sub(l),tn.direction.transformDirection(Ze),Ge.castShadow){var en=Ge.shadow,Yt=n.get(Ge);Yt.shadowBias=en.bias,Yt.shadowNormalBias=en.normalBias,Yt.shadowRadius=en.radius,Yt.shadowMapSize=en.mapSize,r.directionalShadow[oe]=Yt,r.directionalShadowMap[oe]=At,r.directionalShadowMatrix[oe]=Ge.shadow.matrix,Ae++}r.directional[oe]=tn,oe++}else if(Ge.isSpotLight){var Gt=i.get(Ge);if(Gt.position.setFromMatrixPosition(Ge.matrixWorld),Gt.position.applyMatrix4(Ze),Gt.color.copy(vt).multiplyScalar(Je),Gt.distance=je,Gt.direction.setFromMatrixPosition(Ge.matrixWorld),l.setFromMatrixPosition(Ge.target.matrixWorld),Gt.direction.sub(l),Gt.direction.transformDirection(Ze),Gt.coneCos=Math.cos(Ge.angle),Gt.penumbraCos=Math.cos(Ge.angle*(1-Ge.penumbra)),Gt.decay=Ge.decay,Ge.castShadow){var yn=Ge.shadow,Sn=n.get(Ge);Sn.shadowBias=yn.bias,Sn.shadowNormalBias=yn.normalBias,Sn.shadowRadius=yn.radius,Sn.shadowMapSize=yn.mapSize,r.spotShadow[Te]=Sn,r.spotShadowMap[Te]=At,r.spotShadowMatrix[Te]=Ge.shadow.matrix,tt++}r.spot[Te]=Gt,Te++}else if(Ge.isRectAreaLight){var er=i.get(Ge);er.color.copy(vt).multiplyScalar(Je),er.position.setFromMatrixPosition(Ge.matrixWorld),er.position.applyMatrix4(Ze),S.identity(),b.copy(Ge.matrixWorld),b.premultiply(Ze),S.extractRotation(b),er.halfWidth.set(.5*Ge.width,0,0),er.halfHeight.set(0,.5*Ge.height,0),er.halfWidth.applyMatrix4(S),er.halfHeight.applyMatrix4(S),r.rectArea[Be]=er,Be++}else if(Ge.isPointLight){var Jt=i.get(Ge);if(Jt.position.setFromMatrixPosition(Ge.matrixWorld),Jt.position.applyMatrix4(Ze),Jt.color.copy(Ge.color).multiplyScalar(Ge.intensity),Jt.distance=Ge.distance,Jt.decay=Ge.decay,Ge.castShadow){var Nr=Ge.shadow,wr=n.get(Ge);wr.shadowBias=Nr.bias,wr.shadowNormalBias=Nr.normalBias,wr.shadowRadius=Nr.radius,wr.shadowMapSize=Nr.mapSize,wr.shadowCameraNear=Nr.camera.near,wr.shadowCameraFar=Nr.camera.far,r.pointShadow[Z]=wr,r.pointShadowMap[Z]=At,r.pointShadowMatrix[Z]=Ge.shadow.matrix,Le++}r.point[Z]=Jt,Z++}else if(Ge.isHemisphereLight){var Er=i.get(Ge);Er.direction.setFromMatrixPosition(Ge.matrixWorld),Er.direction.transformDirection(Ze),Er.direction.normalize(),Er.skyColor.copy(Ge.color).multiplyScalar(Je),Er.groundColor.copy(Ge.groundColor).multiplyScalar(Je),r.hemi[we]=Er,we++}}Be>0&&(t.isWebGL2||!0===a.has("OES_texture_float_linear")?(r.rectAreaLTC1=Cn.LTC_FLOAT_1,r.rectAreaLTC2=Cn.LTC_FLOAT_2):!0===a.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Cn.LTC_HALF_1,r.rectAreaLTC2=Cn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=K,r.ambient[1]=Q,r.ambient[2]=re;var Ln=r.hash;(Ln.directionalLength!==oe||Ln.pointLength!==Z||Ln.spotLength!==Te||Ln.rectAreaLength!==Be||Ln.hemiLength!==we||Ln.numDirectionalShadows!==Ae||Ln.numPointShadows!==Le||Ln.numSpotShadows!==tt)&&(r.directional.length=oe,r.spot.length=Te,r.rectArea.length=Be,r.point.length=Z,r.hemi.length=we,r.directionalShadow.length=Ae,r.directionalShadowMap.length=Ae,r.pointShadow.length=Le,r.pointShadowMap.length=Le,r.spotShadow.length=tt,r.spotShadowMap.length=tt,r.directionalShadowMatrix.length=Ae,r.pointShadowMatrix.length=Le,r.spotShadowMatrix.length=tt,Ln.directionalLength=oe,Ln.pointLength=Z,Ln.spotLength=Te,Ln.rectAreaLength=Be,Ln.hemiLength=we,Ln.numDirectionalShadows=Ae,Ln.numPointShadows=Le,Ln.numSpotShadows=tt,r.version=h0++)},state:r}}function yf(a,t){var i=new f0(a,t),n=[],r=[];return{init:function o(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function S(G){i.setup(n,r,G)},pushLight:function l(G){n.push(G)},pushShadow:function b(G){r.push(G)}}}function p0(a,t){var i=new WeakMap;return{get:function n(o,l){var b;return!1===i.has(o)?(b=new yf(a,t),i.set(o,new WeakMap),i.get(o).set(l,b)):!1===i.get(o).has(l)?(b=new yf(a,t),i.get(o).set(l,b)):b=i.get(o).get(l),b},dispose:function r(){i=new WeakMap}}}function As(a){fr.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(a)}function bs(a){fr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new ke,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(a)}function Af(a,t,i){var n=new wi,r=new cn,o=new cn,l=new ui,b=[],S=[],L={},G={0:1,1:0,2:2},U=new Kr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new cn},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n\t\t#ifdef HORIZONAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),F=U.clone();F.defines.HORIZONAL_PASS=1;var K=new De;K.setAttribute("position",new Zn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var Q=new kn(K,U),re=this;function ve(we,Ae){var Le=t.update(Q);U.uniforms.shadow_pass.value=we.map.texture,U.uniforms.resolution.value=we.mapSize,U.uniforms.radius.value=we.radius,a.setRenderTarget(we.mapPass),a.clear(),a.renderBufferDirect(Ae,null,Le,U,Q,null),F.uniforms.shadow_pass.value=we.mapPass.texture,F.uniforms.resolution.value=we.mapSize,F.uniforms.radius.value=we.radius,a.setRenderTarget(we.map),a.clear(),a.renderBufferDirect(Ae,null,Le,F,Q,null)}function oe(we,Ae,Le){var tt=we<<0|Ae<<1|Le<<2,Ze=b[tt];return void 0===Ze&&(Ze=new As({depthPacking:3201,morphTargets:we,skinning:Ae}),b[tt]=Ze),Ze}function Z(we,Ae,Le){var tt=we<<0|Ae<<1|Le<<2,Ze=S[tt];return void 0===Ze&&(Ze=new bs({morphTargets:we,skinning:Ae}),S[tt]=Ze),Ze}function Te(we,Ae,Le,tt,Ze,wt,st){var Ge=null,vt=oe,Je=we.customDepthMaterial;if(!0===tt.isPointLight&&(vt=Z,Je=we.customDistanceMaterial),void 0===Je){var je=!1;!0===Le.morphTargets&&(je=Ae.morphAttributes&&Ae.morphAttributes.position&&Ae.morphAttributes.position.length>0);var At=!1;!0===we.isSkinnedMesh&&(!0===Le.skinning?At=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",we)),Ge=vt(je,At,!0===we.isInstancedMesh)}else Ge=Je;if(a.localClippingEnabled&&!0===Le.clipShadows&&0!==Le.clippingPlanes.length){var tn=Ge.uuid,en=Le.uuid,Yt=L[tn];void 0===Yt&&(L[tn]=Yt={});var Gt=Yt[en];void 0===Gt&&(Gt=Ge.clone(),Yt[en]=Gt),Ge=Gt}return Ge.visible=Le.visible,Ge.wireframe=Le.wireframe,Ge.side=3===st?null!==Le.shadowSide?Le.shadowSide:Le.side:null!==Le.shadowSide?Le.shadowSide:G[Le.side],Ge.clipShadows=Le.clipShadows,Ge.clippingPlanes=Le.clippingPlanes,Ge.clipIntersection=Le.clipIntersection,Ge.wireframeLinewidth=Le.wireframeLinewidth,Ge.linewidth=Le.linewidth,!0===tt.isPointLight&&!0===Ge.isMeshDistanceMaterial&&(Ge.referencePosition.setFromMatrixPosition(tt.matrixWorld),Ge.nearDistance=Ze,Ge.farDistance=wt),Ge}function Be(we,Ae,Le,tt,Ze){if(!1!==we.visible){if(we.layers.test(Ae.layers)&&(we.isMesh||we.isLine||we.isPoints)&&(we.castShadow||we.receiveShadow&&3===Ze)&&(!we.frustumCulled||n.intersectsObject(we))){we.modelViewMatrix.multiplyMatrices(Le.matrixWorldInverse,we.matrixWorld);var st=t.update(we),Ge=we.material;if(Array.isArray(Ge))for(var vt=st.groups,Je=0,je=vt.length;Je<je;Je++){var At=vt[Je],Rt=Ge[At.materialIndex];if(Rt&&Rt.visible){var tn=Te(we,st,Rt,tt,Le.near,Le.far,Ze);a.renderBufferDirect(Le,null,st,tn,we,At)}}else if(Ge.visible){var en=Te(we,st,Ge,tt,Le.near,Le.far,Ze);a.renderBufferDirect(Le,null,st,en,we,null)}}for(var Yt=we.children,Gt=0,yn=Yt.length;Gt<yn;Gt++)Be(Yt[Gt],Ae,Le,tt,Ze)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(we,Ae,Le){if(!1!==re.enabled&&(!1!==re.autoUpdate||!1!==re.needsUpdate)&&0!==we.length){var tt=a.getRenderTarget(),Ze=a.getActiveCubeFace(),wt=a.getActiveMipmapLevel(),st=a.state;st.setBlending(0),st.buffers.color.setClear(1,1,1,1),st.buffers.depth.setTest(!0),st.setScissorTest(!1);for(var Ge=0,vt=we.length;Ge<vt;Ge++){var Je=we[Ge],je=Je.shadow;if(void 0!==je){if(!1!==je.autoUpdate||!1!==je.needsUpdate){r.copy(je.mapSize);var At=je.getFrameExtents();if(r.multiply(At),o.copy(je.mapSize),(r.x>i||r.y>i)&&(r.x>i&&(o.x=Math.floor(i/At.x),r.x=o.x*At.x,je.mapSize.x=o.x),r.y>i&&(o.y=Math.floor(i/At.y),r.y=o.y*At.y,je.mapSize.y=o.y)),null===je.map&&!je.isPointLightShadow&&3===this.type){var Rt={minFilter:We,magFilter:We,format:Pr};je.map=new Sa(r.x,r.y,Rt),je.map.texture.name=Je.name+".shadowMap",je.mapPass=new Sa(r.x,r.y,Rt),je.camera.updateProjectionMatrix()}null===je.map&&(je.map=new Sa(r.x,r.y,{minFilter:St,magFilter:St,format:Pr}),je.map.texture.name=Je.name+".shadowMap",je.camera.updateProjectionMatrix()),a.setRenderTarget(je.map),a.clear();for(var en=je.getViewportCount(),Yt=0;Yt<en;Yt++){var Gt=je.getViewport(Yt);l.set(o.x*Gt.x,o.y*Gt.y,o.x*Gt.z,o.y*Gt.w),st.viewport(l),je.updateMatrices(Je,Yt),n=je.getFrustum(),Be(Ae,Le,je.camera,Je,this.type)}!je.isPointLightShadow&&3===this.type&&ve(je,Le),je.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",Je,"has no shadow.")}re.needsUpdate=!1,a.setRenderTarget(tt,Ze,wt)}}}function g0(a,t,i){var n,r,o=i.isWebGL2,L=new function l(){var xt=!1,Xn=new ui,Hn=null,lr=new ui(0,0,0,0);return{setMask:function(En){Hn!==En&&!xt&&(a.colorMask(En,En,En,En),Hn=En)},setLocked:function(En){xt=En},setClear:function(En,Lr,Hr,Vi,Ti){!0===Ti&&(En*=Vi,Lr*=Vi,Hr*=Vi),Xn.set(En,Lr,Hr,Vi),!1===lr.equals(Xn)&&(a.clearColor(En,Lr,Hr,Vi),lr.copy(Xn))},reset:function(){xt=!1,Hn=null,lr.set(-1,0,0,0)}}},G=new function b(){var xt=!1,Xn=null,Hn=null,lr=null;return{setTest:function(En){En?yn(2929):Sn(2929)},setMask:function(En){Xn!==En&&!xt&&(a.depthMask(En),Xn=En)},setFunc:function(En){if(Hn!==En){if(En)switch(En){case 0:a.depthFunc(512);break;case 1:a.depthFunc(519);break;case 2:a.depthFunc(513);break;case 3:default:a.depthFunc(515);break;case 4:a.depthFunc(514);break;case 5:a.depthFunc(518);break;case 6:a.depthFunc(516);break;case 7:a.depthFunc(517)}else a.depthFunc(515);Hn=En}},setLocked:function(En){xt=En},setClear:function(En){lr!==En&&(a.clearDepth(En),lr=En)},reset:function(){xt=!1,Xn=null,Hn=null,lr=null}}},U=new function S(){var xt=!1,Xn=null,Hn=null,lr=null,Gn=null,En=null,Lr=null,Hr=null,Vi=null;return{setTest:function(si){xt||(si?yn(2960):Sn(2960))},setMask:function(si){Xn!==si&&!xt&&(a.stencilMask(si),Xn=si)},setFunc:function(si,gi,Yi){(Hn!==si||lr!==gi||Gn!==Yi)&&(a.stencilFunc(si,gi,Yi),Hn=si,lr=gi,Gn=Yi)},setOp:function(si,gi,Yi){(En!==si||Lr!==gi||Hr!==Yi)&&(a.stencilOp(si,gi,Yi),En=si,Lr=gi,Hr=Yi)},setLocked:function(si){xt=si},setClear:function(si){Vi!==si&&(a.clearStencil(si),Vi=si)},reset:function(){xt=!1,Xn=null,Hn=null,lr=null,Gn=null,En=null,Lr=null,Hr=null,Vi=null}}},F={},K=null,Q=null,re=null,ve=null,oe=null,Z=null,Te=null,Be=null,we=null,Ae=!1,Le=null,tt=null,Ze=null,wt=null,st=null,Ge=a.getParameter(35661),vt=!1,Je=0,je=a.getParameter(7938);-1!==je.indexOf("WebGL")?(Je=parseFloat(/^WebGL\ ([0-9])/.exec(je)[1]),vt=Je>=1):-1!==je.indexOf("OpenGL ES")&&(Je=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(je)[1]),vt=Je>=2);var At=null,Rt={},tn=new ui,en=new ui;function Yt(xt,Xn,Hn){var lr=new Uint8Array(4),Gn=a.createTexture();a.bindTexture(xt,Gn),a.texParameteri(xt,10241,9728),a.texParameteri(xt,10240,9728);for(var En=0;En<Hn;En++)a.texImage2D(Xn+En,0,6408,1,1,0,6408,5121,lr);return Gn}var Gt={};function yn(xt){!0!==F[xt]&&(a.enable(xt),F[xt]=!0)}function Sn(xt){!1!==F[xt]&&(a.disable(xt),F[xt]=!1)}Gt[3553]=Yt(3553,3553,1),Gt[34067]=Yt(34067,34069,6),L.setClear(0,0,0,1),G.setClear(1),U.setClear(0),yn(2929),G.setFunc(3),Rr(!1),yr(1),yn(2884),Er(0);var Jt=((n={})[100]=32774,n[101]=32778,n[102]=32779,n);if(o)Jt[103]=32775,Jt[104]=32776;else{var Nr=t.get("EXT_blend_minmax");null!==Nr&&(Jt[103]=Nr.MIN_EXT,Jt[104]=Nr.MAX_EXT)}var wr=((r={})[200]=0,r[201]=1,r[202]=768,r[204]=770,r[210]=776,r[208]=774,r[206]=772,r[203]=769,r[205]=771,r[209]=775,r[207]=773,r);function Er(xt,Xn,Hn,lr,Gn,En,Lr,Hr){if(0!==xt){if(Q||(yn(3042),Q=!0),5===xt)Gn=Gn||Xn,En=En||Hn,Lr=Lr||lr,(Xn!==ve||Gn!==Te)&&(a.blendEquationSeparate(Jt[Xn],Jt[Gn]),ve=Xn,Te=Gn),(Hn!==oe||lr!==Z||En!==Be||Lr!==we)&&(a.blendFuncSeparate(wr[Hn],wr[lr],wr[En],wr[Lr]),oe=Hn,Z=lr,Be=En,we=Lr),re=xt,Ae=null;else if(xt!==re||Hr!==Ae){if((100!==ve||100!==Te)&&(a.blendEquation(32774),ve=100,Te=100),Hr)switch(xt){case 1:a.blendFuncSeparate(1,771,1,771);break;case 2:a.blendFunc(1,1);break;case 3:a.blendFuncSeparate(0,0,769,771);break;case 4:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",xt)}else switch(xt){case 1:a.blendFuncSeparate(770,771,1,771);break;case 2:a.blendFunc(770,1);break;case 3:a.blendFunc(0,769);break;case 4:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",xt)}oe=null,Z=null,Be=null,we=null,re=xt,Ae=Hr}}else Q&&(Sn(3042),Q=!1)}function Rr(xt){Le!==xt&&(a.frontFace(xt?2304:2305),Le=xt)}function yr(xt){0!==xt?(yn(2884),xt!==tt&&a.cullFace(1===xt?1029:2===xt?1028:1032)):Sn(2884),tt=xt}function Gr(xt,Xn,Hn){xt?(yn(32823),(wt!==Xn||st!==Hn)&&(a.polygonOffset(Xn,Hn),wt=Xn,st=Hn)):Sn(32823)}function Pi(xt){void 0===xt&&(xt=33984+Ge-1),At!==xt&&(a.activeTexture(xt),At=xt)}return{buffers:{color:L,depth:G,stencil:U},enable:yn,disable:Sn,useProgram:function er(xt){return K!==xt&&(a.useProgram(xt),K=xt,!0)},setBlending:Er,setMaterial:function Ln(xt,Xn){2===xt.side?Sn(2884):yn(2884);var Hn=1===xt.side;Xn&&(Hn=!Hn),Rr(Hn),1===xt.blending&&!1===xt.transparent?Er(0):Er(xt.blending,xt.blendEquation,xt.blendSrc,xt.blendDst,xt.blendEquationAlpha,xt.blendSrcAlpha,xt.blendDstAlpha,xt.premultipliedAlpha),G.setFunc(xt.depthFunc),G.setTest(xt.depthTest),G.setMask(xt.depthWrite),L.setMask(xt.colorWrite);var lr=xt.stencilWrite;U.setTest(lr),lr&&(U.setMask(xt.stencilWriteMask),U.setFunc(xt.stencilFunc,xt.stencilRef,xt.stencilFuncMask),U.setOp(xt.stencilFail,xt.stencilZFail,xt.stencilZPass)),Gr(xt.polygonOffset,xt.polygonOffsetFactor,xt.polygonOffsetUnits)},setFlipSided:Rr,setCullFace:yr,setLineWidth:function mi(xt){xt!==Ze&&(vt&&a.lineWidth(xt),Ze=xt)},setPolygonOffset:Gr,setScissorTest:function Ai(xt){xt?yn(3089):Sn(3089)},activeTexture:Pi,bindTexture:function $i(xt,Xn){null===At&&Pi();var Hn=Rt[At];void 0===Hn&&(Rt[At]=Hn={type:void 0,texture:void 0}),(Hn.type!==xt||Hn.texture!==Xn)&&(a.bindTexture(xt,Xn||Gt[xt]),Hn.type=xt,Hn.texture=Xn)},unbindTexture:function qi(){var xt=Rt[At];void 0!==xt&&void 0!==xt.type&&(a.bindTexture(xt.type,null),xt.type=void 0,xt.texture=void 0)},compressedTexImage2D:function Ri(){try{a.compressedTexImage2D.apply(a,arguments)}catch(xt){console.error("THREE.WebGLState:",xt)}},texImage2D:function lt(){try{a.texImage2D.apply(a,arguments)}catch(xt){console.error("THREE.WebGLState:",xt)}},texImage3D:function et(){try{a.texImage3D.apply(a,arguments)}catch(xt){console.error("THREE.WebGLState:",xt)}},scissor:function Dn(xt){!1===tn.equals(xt)&&(a.scissor(xt.x,xt.y,xt.z,xt.w),tn.copy(xt))},viewport:function wn(xt){!1===en.equals(xt)&&(a.viewport(xt.x,xt.y,xt.z,xt.w),en.copy(xt))},reset:function mr(){F={},At=null,Rt={},K=null,Q=null,re=null,ve=null,oe=null,Z=null,Te=null,Be=null,we=null,Ae=!1,Le=null,tt=null,Ze=null,wt=null,st=null,L.reset(),G.reset(),U.reset()}}}function y0(a,t,i,n,r,o,l){var b,S,re,L=r.isWebGL2,G=r.maxTextures,U=r.maxCubemapSize,F=r.maxTextureSize,K=r.maxSamples,Q=new WeakMap,ve=!1;try{ve=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function oe(lt,et){return ve?new OffscreenCanvas(lt,et):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function Z(lt,et,Dn,wn){var mr=1;if((lt.width>wn||lt.height>wn)&&(mr=wn/Math.max(lt.width,lt.height)),mr<1||!0===et){if(typeof HTMLImageElement<"u"&&lt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&lt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&lt instanceof ImageBitmap){var xt=et?pr.floorPowerOfTwo:Math.floor,Xn=xt(mr*lt.width),Hn=xt(mr*lt.height);void 0===re&&(re=oe(Xn,Hn));var lr=Dn?oe(Xn,Hn):re;return lr.width=Xn,lr.height=Hn,lr.getContext("2d").drawImage(lt,0,0,Xn,Hn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+lt.width+"x"+lt.height+") to ("+Xn+"x"+Hn+")."),lr}return"data"in lt&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+lt.width+"x"+lt.height+")."),lt}return lt}function Te(lt){return pr.isPowerOfTwo(lt.width)&&pr.isPowerOfTwo(lt.height)}function we(lt,et){return lt.generateMipmaps&&et&&lt.minFilter!==St&&lt.minFilter!==We}function Ae(lt,et,Dn,wn){a.generateMipmap(lt),n.get(et).__maxMipLevel=Math.log(Math.max(Dn,wn))*Math.LOG2E}function Le(lt,et,Dn){if(!1===L)return et;if(null!==lt){if(void 0!==a[lt])return a[lt];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+lt+"'")}var wn=et;return 6403===et&&(5126===Dn&&(wn=33326),5131===Dn&&(wn=33325),5121===Dn&&(wn=33321)),6407===et&&(5126===Dn&&(wn=34837),5131===Dn&&(wn=34843),5121===Dn&&(wn=32849)),6408===et&&(5126===Dn&&(wn=34836),5131===Dn&&(wn=34842),5121===Dn&&(wn=32856)),(33325===wn||33326===wn||34842===wn||34836===wn)&&t.get("EXT_color_buffer_float"),wn}function tt(lt){return lt===St||1004===lt||1005===lt?9728:9729}function Ze(lt){var et=lt.target;et.removeEventListener("dispose",Ze),function st(lt){var et=n.get(lt);void 0!==et.__webglInit&&(a.deleteTexture(et.__webglTexture),n.remove(lt))}(et),et.isVideoTexture&&Q.delete(et),l.memory.textures--}function wt(lt){var et=lt.target;et.removeEventListener("dispose",wt),function Ge(lt){var et=n.get(lt),Dn=n.get(lt.texture);if(lt){if(void 0!==Dn.__webglTexture&&a.deleteTexture(Dn.__webglTexture),lt.depthTexture&&lt.depthTexture.dispose(),lt.isWebGLCubeRenderTarget)for(var wn=0;wn<6;wn++)a.deleteFramebuffer(et.__webglFramebuffer[wn]),et.__webglDepthbuffer&&a.deleteRenderbuffer(et.__webglDepthbuffer[wn]);else a.deleteFramebuffer(et.__webglFramebuffer),et.__webglDepthbuffer&&a.deleteRenderbuffer(et.__webglDepthbuffer),et.__webglMultisampledFramebuffer&&a.deleteFramebuffer(et.__webglMultisampledFramebuffer),et.__webglColorRenderbuffer&&a.deleteRenderbuffer(et.__webglColorRenderbuffer),et.__webglDepthRenderbuffer&&a.deleteRenderbuffer(et.__webglDepthRenderbuffer);n.remove(lt.texture),n.remove(lt)}}(et),l.memory.textures--}var vt=0;function At(lt,et){var Dn=n.get(lt);if(lt.isVideoTexture&&function Ai(lt){var et=l.render.frame;Q.get(lt)!==et&&(Q.set(lt,et),lt.update())}(lt),lt.version>0&&Dn.__version!==lt.version){var wn=lt.image;if(void 0===wn)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==wn.complete)return void er(Dn,lt,et);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+et),i.bindTexture(3553,Dn.__webglTexture)}function en(lt,et){var Dn=n.get(lt);lt.version>0&&Dn.__version!==lt.version?function Jt(lt,et,Dn){if(6===et.image.length){Sn(lt,et),i.activeTexture(33984+Dn),i.bindTexture(34067,lt.__webglTexture),a.pixelStorei(37440,et.flipY);for(var wn=et&&(et.isCompressedTexture||et.image[0].isCompressedTexture),mr=et.image[0]&&et.image[0].isDataTexture,xt=[],Xn=0;Xn<6;Xn++)xt[Xn]=wn||mr?mr?et.image[Xn].image:et.image[Xn]:Z(et.image[Xn],!1,!0,U);var Hr,Hn=xt[0],lr=Te(Hn)||L,Gn=o.convert(et.format),En=o.convert(et.type),Lr=Le(et.internalFormat,Gn,En);if(yn(34067,et,lr),wn){for(var Vi=0;Vi<6;Vi++){Hr=xt[Vi].mipmaps;for(var Ti=0;Ti<Hr.length;Ti++){var si=Hr[Ti];et.format!==Pr&&et.format!==ti?null!==Gn?i.compressedTexImage2D(34069+Vi,Ti,Lr,si.width,si.height,0,si.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+Vi,Ti,Lr,si.width,si.height,0,Gn,En,si.data)}}lt.__maxMipLevel=Hr.length-1}else{Hr=et.mipmaps;for(var gi=0;gi<6;gi++)if(mr){i.texImage2D(34069+gi,0,Lr,xt[gi].width,xt[gi].height,0,Gn,En,xt[gi].data);for(var Yi=0;Yi<Hr.length;Yi++){var Rs=Hr[Yi].image[gi].image;i.texImage2D(34069+gi,Yi+1,Lr,Rs.width,Rs.height,0,Gn,En,Rs.data)}}else{i.texImage2D(34069+gi,0,Lr,Gn,En,xt[gi]);for(var wo=0;wo<Hr.length;wo++)i.texImage2D(34069+gi,wo+1,Lr,Gn,En,Hr[wo].image[gi])}lt.__maxMipLevel=Hr.length}we(et,lr)&&Ae(34067,et,Hn.width,Hn.height),lt.__version=et.version,et.onUpdate&&et.onUpdate(et)}}(Dn,lt,et):(i.activeTexture(33984+et),i.bindTexture(34067,Dn.__webglTexture))}var Yt=((b={})[at]=10497,b[ot]=33071,b[dt]=33648,b),Gt=((S={})[St]=9728,S[1004]=9984,S[1005]=9986,S[We]=9729,S[1007]=9985,S[Ht]=9987,S);function yn(lt,et,Dn){Dn?(a.texParameteri(lt,10242,Yt[et.wrapS]),a.texParameteri(lt,10243,Yt[et.wrapT]),(32879===lt||35866===lt)&&a.texParameteri(lt,32882,Yt[et.wrapR]),a.texParameteri(lt,10240,Gt[et.magFilter]),a.texParameteri(lt,10241,Gt[et.minFilter])):(a.texParameteri(lt,10242,33071),a.texParameteri(lt,10243,33071),(32879===lt||35866===lt)&&a.texParameteri(lt,32882,33071),(et.wrapS!==ot||et.wrapT!==ot)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(lt,10240,tt(et.magFilter)),a.texParameteri(lt,10241,tt(et.minFilter)),et.minFilter!==St&&et.minFilter!==We&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var wn=t.get("EXT_texture_filter_anisotropic");if(wn){if(et.type===xn&&null===t.get("OES_texture_float_linear")||et.type===nr&&null===(L||t.get("OES_texture_half_float_linear")))return;(et.anisotropy>1||n.get(et).__currentAnisotropy)&&(a.texParameterf(lt,wn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(et.anisotropy,r.getMaxAnisotropy())),n.get(et).__currentAnisotropy=et.anisotropy)}}function Sn(lt,et){void 0===lt.__webglInit&&(lt.__webglInit=!0,et.addEventListener("dispose",Ze),lt.__webglTexture=a.createTexture(),l.memory.textures++)}function er(lt,et,Dn){var wn=3553;et.isDataTexture2DArray&&(wn=35866),et.isDataTexture3D&&(wn=32879),Sn(lt,et),i.activeTexture(33984+Dn),i.bindTexture(wn,lt.__webglTexture),a.pixelStorei(37440,et.flipY),a.pixelStorei(37441,et.premultiplyAlpha),a.pixelStorei(3317,et.unpackAlignment);var mr=function Be(lt){return!L&&(lt.wrapS!==ot||lt.wrapT!==ot||lt.minFilter!==St&&lt.minFilter!==We)}(et)&&!1===Te(et.image),xt=Z(et.image,mr,!1,F),Xn=Te(xt)||L,Hn=o.convert(et.format),lr=o.convert(et.type),Gn=Le(et.internalFormat,Hn,lr);yn(wn,et,Xn);var En,Lr=et.mipmaps;if(et.isDepthTexture)Gn=6402,L?Gn=et.type===xn?36012:et.type===zn?33190:et.type===ur?35056:33189:et.type===xn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),et.format===yt&&6402===Gn&&et.type!==vn&&et.type!==zn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),et.type=vn,lr=o.convert(et.type)),et.format===Nt&&6402===Gn&&(Gn=34041,et.type!==ur&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),et.type=ur,lr=o.convert(et.type))),i.texImage2D(3553,0,Gn,xt.width,xt.height,0,Hn,lr,null);else if(et.isDataTexture)if(Lr.length>0&&Xn){for(var Hr=0,Vi=Lr.length;Hr<Vi;Hr++)i.texImage2D(3553,Hr,Gn,(En=Lr[Hr]).width,En.height,0,Hn,lr,En.data);et.generateMipmaps=!1,lt.__maxMipLevel=Lr.length-1}else i.texImage2D(3553,0,Gn,xt.width,xt.height,0,Hn,lr,xt.data),lt.__maxMipLevel=0;else if(et.isCompressedTexture){for(var Ti=0,si=Lr.length;Ti<si;Ti++)En=Lr[Ti],et.format!==Pr&&et.format!==ti?null!==Hn?i.compressedTexImage2D(3553,Ti,Gn,En.width,En.height,0,En.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,Ti,Gn,En.width,En.height,0,Hn,lr,En.data);lt.__maxMipLevel=Lr.length-1}else if(et.isDataTexture2DArray)i.texImage3D(35866,0,Gn,xt.width,xt.height,xt.depth,0,Hn,lr,xt.data),lt.__maxMipLevel=0;else if(et.isDataTexture3D)i.texImage3D(32879,0,Gn,xt.width,xt.height,xt.depth,0,Hn,lr,xt.data),lt.__maxMipLevel=0;else if(Lr.length>0&&Xn){for(var gi=0,Yi=Lr.length;gi<Yi;gi++)i.texImage2D(3553,gi,Gn,Hn,lr,En=Lr[gi]);et.generateMipmaps=!1,lt.__maxMipLevel=Lr.length-1}else i.texImage2D(3553,0,Gn,Hn,lr,xt),lt.__maxMipLevel=0;we(et,Xn)&&Ae(wn,et,xt.width,xt.height),lt.__version=et.version,et.onUpdate&&et.onUpdate(et)}function Nr(lt,et,Dn,wn){var mr=o.convert(et.texture.format),xt=o.convert(et.texture.type),Xn=Le(et.texture.internalFormat,mr,xt);i.texImage2D(wn,0,Xn,et.width,et.height,0,mr,xt,null),a.bindFramebuffer(36160,lt),a.framebufferTexture2D(36160,Dn,wn,n.get(et.texture).__webglTexture,0),a.bindFramebuffer(36160,null)}function wr(lt,et,Dn){if(a.bindRenderbuffer(36161,lt),et.depthBuffer&&!et.stencilBuffer){var wn=33189;if(Dn){var mr=et.depthTexture;mr&&mr.isDepthTexture&&(mr.type===xn?wn=36012:mr.type===zn&&(wn=33190));var xt=Gr(et);a.renderbufferStorageMultisample(36161,xt,wn,et.width,et.height)}else a.renderbufferStorage(36161,wn,et.width,et.height);a.framebufferRenderbuffer(36160,36096,36161,lt)}else if(et.depthBuffer&&et.stencilBuffer){if(Dn){var Xn=Gr(et);a.renderbufferStorageMultisample(36161,Xn,35056,et.width,et.height)}else a.renderbufferStorage(36161,34041,et.width,et.height);a.framebufferRenderbuffer(36160,33306,36161,lt)}else{var Hn=o.convert(et.texture.format),lr=o.convert(et.texture.type),Gn=Le(et.texture.internalFormat,Hn,lr);if(Dn){var En=Gr(et);a.renderbufferStorageMultisample(36161,En,Gn,et.width,et.height)}else a.renderbufferStorage(36161,Gn,et.width,et.height)}a.bindRenderbuffer(36161,null)}function Gr(lt){return L&&lt.isWebGLMultisampleRenderTarget?Math.min(K,lt.samples):0}var Pi=!1,$i=!1;this.allocateTextureUnit=function je(){var lt=vt;return lt>=G&&console.warn("THREE.WebGLTextures: Trying to use "+lt+" texture units while this GPU supports only "+G),vt+=1,lt},this.resetTextureUnits=function Je(){vt=0},this.setTexture2D=At,this.setTexture2DArray=function Rt(lt,et){var Dn=n.get(lt);lt.version>0&&Dn.__version!==lt.version?er(Dn,lt,et):(i.activeTexture(33984+et),i.bindTexture(35866,Dn.__webglTexture))},this.setTexture3D=function tn(lt,et){var Dn=n.get(lt);lt.version>0&&Dn.__version!==lt.version?er(Dn,lt,et):(i.activeTexture(33984+et),i.bindTexture(32879,Dn.__webglTexture))},this.setTextureCube=en,this.setupRenderTarget=function Rr(lt){var et=n.get(lt),Dn=n.get(lt.texture);lt.addEventListener("dispose",wt),Dn.__webglTexture=a.createTexture(),l.memory.textures++;var wn=!0===lt.isWebGLCubeRenderTarget,mr=!0===lt.isWebGLMultisampleRenderTarget,xt=Te(lt)||L;if(L&&lt.texture.format===ti&&(lt.texture.type===xn||lt.texture.type===nr)&&(lt.texture.format=Pr,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),wn){et.__webglFramebuffer=[];for(var Xn=0;Xn<6;Xn++)et.__webglFramebuffer[Xn]=a.createFramebuffer()}else if(et.__webglFramebuffer=a.createFramebuffer(),mr)if(L){et.__webglMultisampledFramebuffer=a.createFramebuffer(),et.__webglColorRenderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,et.__webglColorRenderbuffer);var Hn=o.convert(lt.texture.format),lr=o.convert(lt.texture.type),Gn=Le(lt.texture.internalFormat,Hn,lr),En=Gr(lt);a.renderbufferStorageMultisample(36161,En,Gn,lt.width,lt.height),a.bindFramebuffer(36160,et.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064,36161,et.__webglColorRenderbuffer),a.bindRenderbuffer(36161,null),lt.depthBuffer&&(et.__webglDepthRenderbuffer=a.createRenderbuffer(),wr(et.__webglDepthRenderbuffer,lt,!0)),a.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(wn){i.bindTexture(34067,Dn.__webglTexture),yn(34067,lt.texture,xt);for(var Lr=0;Lr<6;Lr++)Nr(et.__webglFramebuffer[Lr],lt,36064,34069+Lr);we(lt.texture,xt)&&Ae(34067,lt.texture,lt.width,lt.height),i.bindTexture(34067,null)}else i.bindTexture(3553,Dn.__webglTexture),yn(3553,lt.texture,xt),Nr(et.__webglFramebuffer,lt,36064,3553),we(lt.texture,xt)&&Ae(3553,lt.texture,lt.width,lt.height),i.bindTexture(3553,null);lt.depthBuffer&&function Ln(lt){var et=n.get(lt),Dn=!0===lt.isWebGLCubeRenderTarget;if(lt.depthTexture){if(Dn)throw new Error("target.depthTexture not supported in Cube render targets");!function Er(lt,et){if(et&&et.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(a.bindFramebuffer(36160,lt),!et.depthTexture||!et.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(et.depthTexture).__webglTexture||et.depthTexture.image.width!==et.width||et.depthTexture.image.height!==et.height)&&(et.depthTexture.image.width=et.width,et.depthTexture.image.height=et.height,et.depthTexture.needsUpdate=!0),At(et.depthTexture,0);var wn=n.get(et.depthTexture).__webglTexture;if(et.depthTexture.format===yt)a.framebufferTexture2D(36160,36096,3553,wn,0);else{if(et.depthTexture.format!==Nt)throw new Error("Unknown depthTexture format");a.framebufferTexture2D(36160,33306,3553,wn,0)}}(et.__webglFramebuffer,lt)}else if(Dn){et.__webglDepthbuffer=[];for(var wn=0;wn<6;wn++)a.bindFramebuffer(36160,et.__webglFramebuffer[wn]),et.__webglDepthbuffer[wn]=a.createRenderbuffer(),wr(et.__webglDepthbuffer[wn],lt,!1)}else a.bindFramebuffer(36160,et.__webglFramebuffer),et.__webglDepthbuffer=a.createRenderbuffer(),wr(et.__webglDepthbuffer,lt,!1);a.bindFramebuffer(36160,null)}(lt)},this.updateRenderTargetMipmap=function yr(lt){var et=lt.texture;if(we(et,Te(lt)||L)){var wn=lt.isWebGLCubeRenderTarget?34067:3553,mr=n.get(et).__webglTexture;i.bindTexture(wn,mr),Ae(wn,et,lt.width,lt.height),i.bindTexture(wn,null)}},this.updateMultisampleRenderTarget=function mi(lt){if(lt.isWebGLMultisampleRenderTarget)if(L){var et=n.get(lt);a.bindFramebuffer(36008,et.__webglMultisampledFramebuffer),a.bindFramebuffer(36009,et.__webglFramebuffer);var Dn=lt.width,wn=lt.height,mr=16384;lt.depthBuffer&&(mr|=256),lt.stencilBuffer&&(mr|=1024),a.blitFramebuffer(0,0,Dn,wn,0,0,Dn,wn,mr,9728),a.bindFramebuffer(36160,et.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function qi(lt,et){lt&&lt.isWebGLRenderTarget&&(!1===Pi&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Pi=!0),lt=lt.texture),At(lt,et)},this.safeSetTextureCube=function Ri(lt,et){lt&&lt.isWebGLCubeRenderTarget&&(!1===$i&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),$i=!0),lt=lt.texture),en(lt,et)}}function bf(a,t,i){var n=i.isWebGL2;return{convert:function r(o){var l;if(o===Ft)return 5121;if(1017===o)return 32819;if(1018===o)return 32820;if(1019===o)return 33635;if(1010===o)return 5120;if(1011===o)return 5122;if(o===vn)return 5123;if(1013===o)return 5124;if(o===zn)return 5125;if(o===xn)return 5126;if(o===nr)return n?5131:null!==(l=t.get("OES_texture_half_float"))?l.HALF_FLOAT_OES:null;if(1021===o)return 6406;if(o===ti)return 6407;if(o===Pr)return 6408;if(1024===o)return 6409;if(1025===o)return 6410;if(o===yt)return 6402;if(o===Nt)return 34041;if(1028===o)return 6403;if(1029===o)return 36244;if(1030===o)return 33319;if(1031===o)return 33320;if(1032===o)return 36248;if(1033===o)return 36249;if(33776===o||33777===o||33778===o||33779===o){if(null===(l=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===o)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===o)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===o)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===o)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===o||35841===o||35842===o||35843===o){if(null===(l=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===o)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===o)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===o)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===o)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===o)return null!==(l=t.get("WEBGL_compressed_texture_etc1"))?l.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===o||37496===o)&&null!==(l=t.get("WEBGL_compressed_texture_etc"))){if(37492===o)return l.COMPRESSED_RGB8_ETC2;if(37496===o)return l.COMPRESSED_RGBA8_ETC2_EAC}return 37808===o||37809===o||37810===o||37811===o||37812===o||37813===o||37814===o||37815===o||37816===o||37817===o||37818===o||37819===o||37820===o||37821===o||37840===o||37841===o||37842===o||37843===o||37844===o||37845===o||37846===o||37847===o||37848===o||37849===o||37850===o||37851===o||37852===o||37853===o?null!==(l=t.get("WEBGL_compressed_texture_astc"))?o:null:36492===o?null!==(l=t.get("EXT_texture_compression_bptc"))?o:null:o===ur?n?34042:null!==(l=t.get("WEBGL_depth_texture"))?l.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Yo(){Kn.call(this),this.type="Group"}function cc(a){void 0===a&&(a=[]),dr.call(this),this.cameras=a}(As.prototype=Object.create(fr.prototype)).constructor=As,As.prototype.isMeshDepthMaterial=!0,As.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.depthPacking=a.depthPacking,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this},(bs.prototype=Object.create(fr.prototype)).constructor=bs,bs.prototype.isMeshDistanceMaterial=!0,bs.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.referencePosition.copy(a.referencePosition),this.nearDistance=a.nearDistance,this.farDistance=a.farDistance,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this},Yo.prototype=Object.assign(Object.create(Kn.prototype),{constructor:Yo,isGroup:!0}),cc.prototype=Object.assign(Object.create(dr.prototype),{constructor:cc,isArrayCamera:!0});var wf=new ke,Ef=new ke;function xf(a){var t,i,n=this,r=null,o=null,l=null,b=[],S=new br,L=new br,G=1,U="local-floor";typeof window<"u"&&"VRFrameData"in window&&(o=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",Be,!1));var F=new br,K=new Zi,Q=new ke,re=new dr;re.viewport=new ui,re.layers.enable(1);var ve=new dr;ve.viewport=new ui,ve.layers.enable(2);var oe=new cc([re,ve]);oe.layers.enable(1),oe.layers.enable(2);var Te,Z=new cn;function Be(){if(n.isPresenting=null!==r&&!0===r.isPresenting){var Ge=r.getEyeParameters("left");t=2*Ge.renderWidth*G,i=Ge.renderHeight*G,Te=a.getPixelRatio(),a.getSize(Z),a.setDrawingBufferSize(t,i,1),re.viewport.set(0,0,t/2,i),ve.viewport.set(t/2,0,t/2,i),wt.start(),n.dispatchEvent({type:"sessionstart"})}else n.enabled&&a.setDrawingBufferSize(Z.width,Z.height,Te),wt.stop(),n.dispatchEvent({type:"sessionend"})}var we=[],Ae=[];function Le(st){for(var Ge=navigator.getGamepads&&navigator.getGamepads(),vt=0,Je=Ge.length;vt<Je;vt++){var je=Ge[vt];if(je&&("Daydream Controller"===je.id||"Gear VR Controller"===je.id||"Oculus Go Controller"===je.id||"OpenVR Gamepad"===je.id||je.id.startsWith("Oculus Touch")||je.id.startsWith("HTC Vive Focus")||je.id.startsWith("Spatial Controller"))){var At=je.hand;if(0===st&&(""===At||"right"===At)||1===st&&"left"===At)return je}}}function Ze(st,Ge){null!==Ge&&4===Ge.length&&st.set(Ge[0]*t,Ge[1]*i,Ge[2]*t,Ge[3]*i)}this.enabled=!1,this.getController=function(st){var Ge=b[st];return void 0===Ge&&((Ge=new Yo).matrixAutoUpdate=!1,Ge.visible=!1,b[st]=Ge),Ge},this.getDevice=function(){return r},this.setDevice=function(st){void 0!==st&&(r=st),wt.setContext(st)},this.setFramebufferScaleFactor=function(st){G=st},this.setReferenceSpaceType=function(st){U=st},this.setPoseTarget=function(st){void 0!==st&&(l=st)},this.getCamera=function(st){var Ge="local-floor"===U?1.6:0;if(r.depthNear=st.near,r.depthFar=st.far,r.getFrameData(o),"local-floor"===U){var vt=r.stageParameters;vt?S.fromArray(vt.sittingToStandingTransform):S.makeTranslation(0,Ge,0)}var Je=o.pose,je=null!==l?l:st;je.matrix.copy(S),je.matrix.decompose(je.position,je.quaternion,je.scale),null!==Je.orientation&&(K.fromArray(Je.orientation),je.quaternion.multiply(K)),null!==Je.position&&(K.setFromRotationMatrix(S),Q.fromArray(Je.position),Q.applyQuaternion(K),je.position.add(Q)),je.updateMatrixWorld();for(var At=je.children,Rt=0,tn=At.length;Rt<tn;Rt++)At[Rt].updateMatrixWorld(!0);re.near=st.near,ve.near=st.near,re.far=st.far,ve.far=st.far,re.matrixWorldInverse.fromArray(o.leftViewMatrix),ve.matrixWorldInverse.fromArray(o.rightViewMatrix),L.getInverse(S),"local-floor"===U&&(re.matrixWorldInverse.multiply(L),ve.matrixWorldInverse.multiply(L));var en=je.parent;null!==en&&(F.getInverse(en.matrixWorld),re.matrixWorldInverse.multiply(F),ve.matrixWorldInverse.multiply(F)),re.matrixWorld.getInverse(re.matrixWorldInverse),ve.matrixWorld.getInverse(ve.matrixWorldInverse),re.projectionMatrix.fromArray(o.leftProjectionMatrix),ve.projectionMatrix.fromArray(o.rightProjectionMatrix),function A0(a,t,i){wf.setFromMatrixPosition(t.matrixWorld),Ef.setFromMatrixPosition(i.matrixWorld);var n=wf.distanceTo(Ef),r=t.projectionMatrix.elements,o=i.projectionMatrix.elements,l=r[14]/(r[10]-1),b=r[14]/(r[10]+1),S=(r[9]+1)/r[5],L=(r[9]-1)/r[5],G=(r[8]-1)/r[0],U=(o[8]+1)/o[0],F=l*G,K=l*U,Q=n/(-G+U),re=Q*-G;t.matrixWorld.decompose(a.position,a.quaternion,a.scale),a.translateX(re),a.translateZ(Q),a.matrixWorld.compose(a.position,a.quaternion,a.scale),a.matrixWorldInverse.getInverse(a.matrixWorld);var ve=l+Q,oe=b+Q;a.projectionMatrix.makePerspective(F-re,K+(n-re),S*b/oe*ve,L*b/oe*ve,ve,oe)}(oe,re,ve);var Yt=r.getLayers();if(Yt.length){var Gt=Yt[0];Ze(re.viewport,Gt.leftBounds),Ze(ve.viewport,Gt.rightBounds)}return function tt(){for(var st=0;st<b.length;st++){var Ge=b[st],vt=Le(st);if(void 0!==vt&&void 0!==vt.pose){if(null===vt.pose)return;var Je=vt.pose;!1===Je.hasPosition&&Ge.position.set(.2,-.6,-.05),null!==Je.position&&Ge.position.fromArray(Je.position),null!==Je.orientation&&Ge.quaternion.fromArray(Je.orientation),Ge.matrix.compose(Ge.position,Ge.quaternion,Ge.scale),Ge.matrix.premultiply(S),Ge.matrix.decompose(Ge.position,Ge.quaternion,Ge.scale),Ge.matrixWorldNeedsUpdate=!0,Ge.visible=!0;var je="Daydream Controller"===vt.id?0:1;void 0===we[st]&&(we[st]=!1),we[st]!==vt.buttons[je].pressed&&(we[st]=vt.buttons[je].pressed,!0===we[st]?Ge.dispatchEvent({type:"selectstart"}):(Ge.dispatchEvent({type:"selectend"}),Ge.dispatchEvent({type:"select"}))),je=2,void 0===Ae[st]&&(Ae[st]=!1),void 0!==vt.buttons[je]&&Ae[st]!==vt.buttons[je].pressed&&(Ae[st]=vt.buttons[je].pressed,!0===Ae[st]?Ge.dispatchEvent({type:"squeezestart"}):(Ge.dispatchEvent({type:"squeezeend"}),Ge.dispatchEvent({type:"squeeze"})))}else Ge.visible=!1}}(),oe},this.getStandingMatrix=function(){return S},this.isPresenting=!1;var wt=new Ji;this.setAnimationLoop=function(st){wt.setAnimationLoop(st),this.isPresenting&&wt.start()},this.submitFrame=function(){this.isPresenting&&r.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",Be)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function uc(){this._targetRay=null,this._grip=null,this._hand=null}function Mf(a,t){var F,i=this,n=null,r=1,o=null,l="local-floor",b=null,S=null,L=[],G=new Map,U=[],K=new dr;K.layers.enable(1),K.viewport=new ui;var Q=new dr;Q.layers.enable(2),Q.viewport=new ui;var re=[K,Q],ve=new cc;ve.layers.enable(1),ve.layers.enable(2);var oe=null,Z=null;function Te(Je){var je=G.get(Je.inputSource);je&&je.dispatchEvent({type:Je.type,data:Je.inputSource})}function Be(){G.forEach(function(Je,je){Je.disconnect(je)}),G.clear(),a.setFramebuffer(null),a.setRenderTarget(a.getRenderTarget()),vt.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function we(Je){o=Je,vt.setContext(n),vt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function Ae(Je){for(var je=n.inputSources,At=0;At<L.length;At++)G.set(je[At],L[At]);for(var Rt=0;Rt<Je.removed.length;Rt++){var tn=Je.removed[Rt],en=G.get(tn);en&&(en.dispatchEvent({type:"disconnected",data:tn}),G.delete(tn))}for(var Yt=0;Yt<Je.added.length;Yt++){var Gt=Je.added[Yt],yn=G.get(Gt);yn&&yn.dispatchEvent({type:"connected",data:Gt})}}this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.getCameraPose=function(){return b},this.getController=function(Je){var je=L[index];return void 0===je&&(je=new uc,L[index]=je),je.getTargetRaySpace()},this.getControllerGrip=function(Je){var je=L[Je];return void 0===je&&(je=new uc,L[Je]=je),je.getGripSpace()},this.getHand=function(Je){var je=L[Je];return void 0===je&&(je=new uc,L[Je]=je),je.getHandSpace()},this.setFramebufferScaleFactor=function(Je){r=Je,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Je){l=Je,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return n},this.addLayer=function(Je){!window.XRWebGLBinding||!this.layersEnabled||!n||(U.push(Je),n.updateRenderState({layers:U}))},this.removeLayer=function(Je){!window.XRWebGLBinding||!this.layersEnabled||!n||(U.splice(U.indexOf(Je),1),n.updateRenderState({layers:U}))},this.setSession=function(Je){if(null!==(n=Je)){n.addEventListener("select",Te),n.addEventListener("selectstart",Te),n.addEventListener("selectend",Te),n.addEventListener("squeeze",Te),n.addEventListener("squeezestart",Te),n.addEventListener("squeezeend",Te),n.addEventListener("end",Be);var je=t.getContextAttributes();!0!==je.xrCompatible&&t.makeXRCompatible(),F=new XRWebGLLayer(n,t,{antialias:je.antialias,alpha:je.alpha,depth:je.depth,stencil:je.stencil,framebufferScaleFactor:r}),window.XRWebGLBinding&&this.layersEnabled?this.addLayer(F):n.updateRenderState({baseLayer:F}),n.requestReferenceSpace(l).then(we),n.addEventListener("inputsourceschange",Ae)}};var Le=new ke,tt=new ke;function wt(Je,je){null===je?Je.matrixWorld.copy(Je.matrix):Je.matrixWorld.multiplyMatrices(je.matrixWorld,Je.matrix),Je.matrixWorldInverse.copy(Je.matrixWorld).invert()}this.setPoseTarget=function(Je){void 0!==Je&&(S=Je)},this.getCamera=function(Je){ve.near=Q.near=K.near=Je.near,ve.far=Q.far=K.far=Je.far,(oe!==ve.near||Z!==ve.far)&&(n.updateRenderState({depthNear:ve.near,depthFar:ve.far}),oe=ve.near,Z=ve.far);var je=Je.parent,At=ve.cameras,Rt=S||Je;wt(ve,je);for(var tn=0;tn<At.length;tn++)wt(At[tn],je);Rt.matrixWorld.copy(ve.matrixWorld);for(var en=Rt.children,Yt=0,Gt=en.length;Yt<Gt;Yt++)en[Yt].updateMatrixWorld(!0);return 2===At.length?function Ze(Je,je,At){Le.setFromMatrixPosition(je.matrixWorld),tt.setFromMatrixPosition(At.matrixWorld);var Rt=Le.distanceTo(tt),tn=je.projectionMatrix.elements,en=At.projectionMatrix.elements,Yt=tn[14]/(tn[10]-1),Gt=tn[14]/(tn[10]+1),yn=(tn[9]+1)/tn[5],Sn=(tn[9]-1)/tn[5],er=(tn[8]-1)/tn[0],Jt=(en[8]+1)/en[0],Nr=Yt*er,wr=Yt*Jt,Er=Rt/(-er+Jt),Ln=Er*-er;je.matrixWorld.decompose(Je.position,Je.quaternion,Je.scale),Je.translateX(Ln),Je.translateZ(Er),Je.matrixWorld.compose(Je.position,Je.quaternion,Je.scale),Je.matrixWorldInverse.copy(Je.matrixWorld).invert();var Rr=Yt+Er,yr=Gt+Er;Je.projectionMatrix.makePerspective(Nr-Ln,wr+(Rt-Ln),yn*Gt/yr*Rr,Sn*Gt/yr*Rr,Rr,yr)}(ve,K,Q):ve.projectionMatrix.copy(K.projectionMatrix),ve};var st=null,vt=new Ji;vt.setAnimationLoop(function Ge(Je,je){if(null!==(b=je.getViewerPose(o))){var At=b.views;a.setFramebuffer(F.framebuffer);var Rt=!1;At.length!==ve.cameras.length&&(ve.cameras.length=0,Rt=!0);for(var tn=0;tn<At.length;tn++){var en=At[tn],Yt=F.getViewport(en),Gt=re[tn];Gt.matrix.fromArray(en.transform.matrix),Gt.projectionMatrix.fromArray(en.projectionMatrix),Gt.viewport.set(Yt.x,Yt.y,Yt.width,Yt.height),0===tn&&ve.matrix.copy(Gt.matrix),!0===Rt&&ve.cameras.push(Gt)}}for(var yn=n.inputSources,Sn=0;Sn<L.length;Sn++)L[Sn].update(yn[Sn],je,o);st&&st(Je,je)}),this.setAnimationLoop=function(Je){st=Je},this.dispose=function(){}}function b0(a){function n(oe,Z){oe.opacity.value=Z.opacity,Z.color&&oe.diffuse.value.copy(Z.color),Z.emissive&&oe.emissive.value.copy(Z.emissive).multiplyScalar(Z.emissiveIntensity),Z.map&&(oe.map.value=Z.map),Z.alphaMap&&(oe.alphaMap.value=Z.alphaMap),Z.specularMap&&(oe.specularMap.value=Z.specularMap);var we,Ae,Te=a.get(Z).envMap;if(Te){oe.envMap.value=Te,oe.flipEnvMap.value=Te.isCubeTexture&&Te._needsFlipEnvMap?-1:1,oe.reflectivity.value=Z.reflectivity,oe.refractionRatio.value=Z.refractionRatio;var Be=a.get(Te).__maxMipLevel;void 0!==Be&&(oe.maxMipLevel.value=Be)}Z.lightMap&&(oe.lightMap.value=Z.lightMap,oe.lightMapIntensity.value=Z.lightMapIntensity),Z.aoMap&&(oe.aoMap.value=Z.aoMap,oe.aoMapIntensity.value=Z.aoMapIntensity),Z.map?we=Z.map:Z.specularMap?we=Z.specularMap:Z.displacementMap?we=Z.displacementMap:Z.normalMap?we=Z.normalMap:Z.bumpMap?we=Z.bumpMap:Z.roughnessMap?we=Z.roughnessMap:Z.metalnessMap?we=Z.metalnessMap:Z.alphaMap?we=Z.alphaMap:Z.emissiveMap?we=Z.emissiveMap:Z.clearcoatMap?we=Z.clearcoatMap:Z.clearcoatNormalMap?we=Z.clearcoatNormalMap:Z.clearcoatRoughnessMap&&(we=Z.clearcoatRoughnessMap),void 0!==we&&(we.isWebGLRenderTarget&&(we=we.texture),!0===we.matrixAutoUpdate&&we.updateMatrix(),oe.uvTransform.value.copy(we.matrix)),Z.aoMap?Ae=Z.aoMap:Z.lightMap&&(Ae=Z.lightMap),void 0!==Ae&&(Ae.isWebGLRenderTarget&&(Ae=Ae.texture),!0===Ae.matrixAutoUpdate&&Ae.updateMatrix(),oe.uv2Transform.value.copy(Ae.matrix))}function U(oe,Z){oe.roughness.value=Z.roughness,oe.metalness.value=Z.metalness,Z.roughnessMap&&(oe.roughnessMap.value=Z.roughnessMap),Z.metalnessMap&&(oe.metalnessMap.value=Z.metalnessMap),Z.emissiveMap&&(oe.emissiveMap.value=Z.emissiveMap),Z.bumpMap&&(oe.bumpMap.value=Z.bumpMap,oe.bumpScale.value=Z.bumpScale,1===Z.side&&(oe.bumpScale.value*=-1)),Z.normalMap&&(oe.normalMap.value=Z.normalMap,oe.normalScale.value.copy(Z.normalScale),1===Z.side&&oe.normalScale.value.negate()),Z.displacementMap&&(oe.displacementMap.value=Z.displacementMap,oe.displacementScale.value=Z.displacementScale,oe.displacementBias.value=Z.displacementBias),a.get(Z).envMap&&(oe.envMapIntensity.value=Z.envMapIntensity)}return{refreshFogUniforms:function t(oe,Z){oe.fogColor.value.copy(Z.color),Z.isFog?(oe.fogNear.value=Z.near,oe.fogFar.value=Z.far):Z.isFogExp2&&(oe.fogDensity.value=Z.density)},refreshMaterialUniforms:function i(oe,Z,Te,Be){Z.isMeshBasicMaterial?n(oe,Z):Z.isMeshLambertMaterial?(n(oe,Z),function S(oe,Z){Z.emissiveMap&&(oe.emissiveMap.value=Z.emissiveMap)}(oe,Z)):Z.isMeshToonMaterial?(n(oe,Z),function G(oe,Z){Z.gradientMap&&(oe.gradientMap.value=Z.gradientMap),Z.emissiveMap&&(oe.emissiveMap.value=Z.emissiveMap),Z.bumpMap&&(oe.bumpMap.value=Z.bumpMap,oe.bumpScale.value=Z.bumpScale,1===Z.side&&(oe.bumpScale.value*=-1)),Z.normalMap&&(oe.normalMap.value=Z.normalMap,oe.normalScale.value.copy(Z.normalScale),1===Z.side&&oe.normalScale.value.negate()),Z.displacementMap&&(oe.displacementMap.value=Z.displacementMap,oe.displacementScale.value=Z.displacementScale,oe.displacementBias.value=Z.displacementBias)}(oe,Z)):Z.isMeshPhongMaterial?(n(oe,Z),function L(oe,Z){oe.specular.value.copy(Z.specular),oe.shininess.value=Math.max(Z.shininess,1e-4),Z.emissiveMap&&(oe.emissiveMap.value=Z.emissiveMap),Z.bumpMap&&(oe.bumpMap.value=Z.bumpMap,oe.bumpScale.value=Z.bumpScale,1===Z.side&&(oe.bumpScale.value*=-1)),Z.normalMap&&(oe.normalMap.value=Z.normalMap,oe.normalScale.value.copy(Z.normalScale),1===Z.side&&oe.normalScale.value.negate()),Z.displacementMap&&(oe.displacementMap.value=Z.displacementMap,oe.displacementScale.value=Z.displacementScale,oe.displacementBias.value=Z.displacementBias)}(oe,Z)):Z.isMeshStandardMaterial?(n(oe,Z),Z.isMeshPhysicalMaterial?function F(oe,Z){U(oe,Z),oe.reflectivity.value=Z.reflectivity,oe.clearcoat.value=Z.clearcoat,oe.clearcoatRoughness.value=Z.clearcoatRoughness,Z.sheen&&oe.sheen.value.copy(Z.sheen),Z.clearcoatMap&&(oe.clearcoatMap.value=Z.clearcoatMap),Z.clearcoatRoughnessMap&&(oe.clearcoatRoughnessMap.value=Z.clearcoatRoughnessMap),Z.clearcoatNormalMap&&(oe.clearcoatNormalScale.value.copy(Z.clearcoatNormalScale),oe.clearcoatNormalMap.value=Z.clearcoatNormalMap,1===Z.side&&oe.clearcoatNormalScale.value.negate()),oe.transmission.value=Z.transmission,Z.transmissionMap&&(oe.transmissionMap.value=Z.transmissionMap)}(oe,Z):U(oe,Z)):Z.isMeshMatcapMaterial?(n(oe,Z),function K(oe,Z){Z.matcap&&(oe.matcap.value=Z.matcap),Z.bumpMap&&(oe.bumpMap.value=Z.bumpMap,oe.bumpScale.value=Z.bumpScale,1===Z.side&&(oe.bumpScale.value*=-1)),Z.normalMap&&(oe.normalMap.value=Z.normalMap,oe.normalScale.value.copy(Z.normalScale),1===Z.side&&oe.normalScale.value.negate()),Z.displacementMap&&(oe.displacementMap.value=Z.displacementMap,oe.displacementScale.value=Z.displacementScale,oe.displacementBias.value=Z.displacementBias)}(oe,Z)):Z.isMeshDepthMaterial?(n(oe,Z),function Q(oe,Z){Z.displacementMap&&(oe.displacementMap.value=Z.displacementMap,oe.displacementScale.value=Z.displacementScale,oe.displacementBias.value=Z.displacementBias)}(oe,Z)):Z.isMeshDistanceMaterial?(n(oe,Z),function re(oe,Z){Z.displacementMap&&(oe.displacementMap.value=Z.displacementMap,oe.displacementScale.value=Z.displacementScale,oe.displacementBias.value=Z.displacementBias),oe.referencePosition.value.copy(Z.referencePosition),oe.nearDistance.value=Z.nearDistance,oe.farDistance.value=Z.farDistance}(oe,Z)):Z.isMeshNormalMaterial?(n(oe,Z),function ve(oe,Z){Z.bumpMap&&(oe.bumpMap.value=Z.bumpMap,oe.bumpScale.value=Z.bumpScale,1===Z.side&&(oe.bumpScale.value*=-1)),Z.normalMap&&(oe.normalMap.value=Z.normalMap,oe.normalScale.value.copy(Z.normalScale),1===Z.side&&oe.normalScale.value.negate()),Z.displacementMap&&(oe.displacementMap.value=Z.displacementMap,oe.displacementScale.value=Z.displacementScale,oe.displacementBias.value=Z.displacementBias)}(oe,Z)):Z.isLineBasicMaterial?(function r(oe,Z){oe.diffuse.value.copy(Z.color),oe.opacity.value=Z.opacity}(oe,Z),Z.isLineDashedMaterial&&function o(oe,Z){oe.dashSize.value=Z.dashSize,oe.totalSize.value=Z.dashSize+Z.gapSize,oe.scale.value=Z.scale}(oe,Z)):Z.isPointsMaterial?function l(oe,Z,Te,Be){var we;oe.diffuse.value.copy(Z.color),oe.opacity.value=Z.opacity,oe.size.value=Z.size*Te,oe.scale.value=.5*Be,Z.map&&(oe.map.value=Z.map),Z.alphaMap&&(oe.alphaMap.value=Z.alphaMap),Z.map?we=Z.map:Z.alphaMap&&(we=Z.alphaMap),void 0!==we&&(!0===we.matrixAutoUpdate&&we.updateMatrix(),oe.uvTransform.value.copy(we.matrix))}(oe,Z,Te,Be):Z.isSpriteMaterial?function b(oe,Z){var Te;oe.diffuse.value.copy(Z.color),oe.opacity.value=Z.opacity,oe.rotation.value=Z.rotation,Z.map&&(oe.map.value=Z.map),Z.alphaMap&&(oe.alphaMap.value=Z.alphaMap),Z.map?Te=Z.map:Z.alphaMap&&(Te=Z.alphaMap),void 0!==Te&&(!0===Te.matrixAutoUpdate&&Te.updateMatrix(),oe.uvTransform.value.copy(Te.matrix))}(oe,Z):Z.isShadowMaterial?(oe.color.value.copy(Z.color),oe.opacity.value=Z.opacity):Z.isShaderMaterial&&(Z.uniformsNeedUpdate=!1)}}}function hc(a){var t=void 0!==(a=a||{}).canvas?a.canvas:function w0(){var a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return a.style.display="block",a}(),i=void 0!==a.context?a.context:null,n=void 0!==a.alpha&&a.alpha,r=void 0===a.depth||a.depth,o=void 0===a.stencil||a.stencil,l=void 0!==a.antialias&&a.antialias,b=void 0===a.premultipliedAlpha||a.premultipliedAlpha,S=void 0!==a.preserveDrawingBuffer&&a.preserveDrawingBuffer,L=void 0!==a.powerPreference?a.powerPreference:"default",G=void 0!==a.failIfMajorPerformanceCaveat&&a.failIfMajorPerformanceCaveat,U=null,F=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=qr,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var K=this,Q=!1,re=null,ve=0,oe=0,Z=null,Te=null,Be=-1,we=null,Ae=null,Le=new ui,tt=new ui,Ze=null,wt=t.width,st=t.height,Ge=1,vt=null,Je=null,je=new ui(0,0,wt,st),At=new ui(0,0,wt,st),Rt=!1,tn=new wi,en=!1,Yt=!1,Gt=new br,yn=new ke,Sn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function er(){return null===Z?Ge:1}var Ln,Rr,yr,mi,Gr,Ai,Pi,$i,qi,Ri,lt,et,Dn,wn,mr,xt,Xn,Hn,lr,Gn,En,Jt=i;function Nr(Xe,qt){for(var Ot=0;Ot<Xe.length;Ot++){var Rn=t.getContext(Xe[Ot],qt);if(null!==Rn)return Rn}return null}try{var wr={alpha:n,depth:r,stencil:o,antialias:l,premultipliedAlpha:b,preserveDrawingBuffer:S,powerPreference:L,failIfMajorPerformanceCaveat:G};if(t.addEventListener("webglcontextlost",Ti,!1),t.addEventListener("webglcontextrestored",si,!1),null===Jt){var Er=["webgl2","webgl","experimental-webgl"];if(!0===K.isWebGL1Renderer&&Er.shift(),null===(Jt=Nr(Er,wr)))throw Nr(Er)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Jt.getShaderPrecisionFormat&&(Jt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Xe){throw console.error("THREE.WebGLRenderer: "+Xe.message),Xe}function Lr(){Ln=new Jm(Jt),!1===(Rr=new Km(Jt,Ln,a)).isWebGL2&&(Ln.get("WEBGL_depth_texture"),Ln.get("OES_texture_float"),Ln.get("OES_texture_half_float"),Ln.get("OES_texture_half_float_linear"),Ln.get("OES_standard_derivatives"),Ln.get("OES_element_index_uint"),Ln.get("OES_vertex_array_object"),Ln.get("ANGLE_instanced_arrays")),Ln.get("OES_texture_float_linear"),Gn=new bf(Jt,Ln,Rr),(yr=new g0(Jt,Ln,Rr)).scissor(tt.copy(At).multiplyScalar(Ge).floor()),yr.viewport(Le.copy(je).multiplyScalar(Ge).floor()),mi=new tg(Jt),Gr=new a0,Ai=new y0(Jt,Ln,yr,Gr,Rr,Gn,mi),Pi=new Zm(K),$i=new Ii(Jt,Rr),En=new qm(Jt,Ln,$i,Rr),qi=new $m(Jt,$i,mi,En),Ri=new ag(Jt,qi,$i,mi),Xn=new ig(Jt),mr=new Qm(Gr),lt=new i0(K,Pi,Ln,Rr,En,mr),et=new b0(Gr),Dn=new l0(Gr),wn=new p0(Ln,Rr),xt=new Xm(K,Pi,yr,Ri,b),Hn=new Ym(Jt,Ln,mi,Rr),lr=new eg(Jt,Ln,mi,Rr),mi.programs=lt.programs,K.capabilities=Rr,K.extensions=Ln,K.properties=Gr,K.renderLists=Dn,K.state=yr,K.info=mi}Lr();var Hr=typeof navigator<"u"&&"xr"in navigator?new Mf(K,Jt):new xf(K);this.xr=Hr;var Vi=new Af(K,Ri,Rr.maxTextureSize);function Ti(Xe){Xe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Q=!0}function si(){console.log("THREE.WebGLRenderer: Context Restored."),Q=!1,Lr()}function gi(Xe){var qt=Xe.target;qt.removeEventListener("dispose",gi),function Yi(Xe){Ul(Xe),Gr.remove(Xe)}(qt)}function Ul(Xe){var qt=Gr.get(Xe).program;void 0!==qt&&lt.releaseProgram(qt)}this.shadowMap=Vi,this.getContext=function(){return Jt},this.getContextAttributes=function(){return Jt.getContextAttributes()},this.forceContextLoss=function(){var Xe=Ln.get("WEBGL_lose_context");Xe&&Xe.loseContext()},this.forceContextRestore=function(){var Xe=Ln.get("WEBGL_lose_context");Xe&&Xe.restoreContext()},this.getPixelRatio=function(){return Ge},this.setPixelRatio=function(Xe){void 0!==Xe&&(Ge=Xe,this.setSize(wt,st,!1))},this.getSize=function(Xe){return void 0===Xe&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),Xe=new cn),Xe.set(wt,st)},this.setSize=function(Xe,qt,Ot){Hr.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(wt=Xe,st=qt,t.width=Math.floor(Xe*Ge),t.height=Math.floor(qt*Ge),!1!==Ot&&(t.style.width=Xe+"px",t.style.height=qt+"px"),this.setViewport(0,0,Xe,qt))},this.getDrawingBufferSize=function(Xe){return void 0===Xe&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),Xe=new cn),Xe.set(wt*Ge,st*Ge).floor()},this.setDrawingBufferSize=function(Xe,qt,Ot){wt=Xe,st=qt,Ge=Ot,t.width=Math.floor(Xe*Ot),t.height=Math.floor(qt*Ot),this.setViewport(0,0,Xe,qt)},this.getCurrentViewport=function(Xe){return void 0===Xe&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),Xe=new ui),Xe.copy(Le)},this.getViewport=function(Xe){return Xe.copy(je)},this.setViewport=function(Xe,qt,Ot,nn){Xe.isVector4?je.set(Xe.x,Xe.y,Xe.z,Xe.w):je.set(Xe,qt,Ot,nn),yr.viewport(Le.copy(je).multiplyScalar(Ge).floor())},this.getScissor=function(Xe){return Xe.copy(At)},this.setScissor=function(Xe,qt,Ot,nn){Xe.isVector4?At.set(Xe.x,Xe.y,Xe.z,Xe.w):At.set(Xe,qt,Ot,nn),yr.scissor(tt.copy(At).multiplyScalar(Ge).floor())},this.getScissorTest=function(){return Rt},this.setScissorTest=function(Xe){yr.setScissorTest(Rt=Xe)},this.setOpaqueSort=function(Xe){vt=Xe},this.setTransparentSort=function(Xe){Je=Xe},this.getClearColor=function(){return xt.getClearColor()},this.setClearColor=function(){xt.setClearColor.apply(xt,arguments)},this.getClearAlpha=function(){return xt.getClearAlpha()},this.setClearAlpha=function(){xt.setClearAlpha.apply(xt,arguments)},this.clear=function(Xe,qt,Ot){var nn=0;(void 0===Xe||Xe)&&(nn|=16384),(void 0===qt||qt)&&(nn|=256),(void 0===Ot||Ot)&&(nn|=1024),Jt.clear(nn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ti,!1),t.removeEventListener("webglcontextrestored",si,!1),Dn.dispose(),wn.dispose(),Gr.dispose(),Pi.dispose(),Ri.dispose(),En.dispose(),Hr.dispose(),ko.stop()},this.renderBufferImmediate=function(Xe,qt){En.initAttributes();var Ot=Gr.get(Xe);Xe.hasPositions&&!Ot.position&&(Ot.position=Jt.createBuffer()),Xe.hasNormals&&!Ot.normal&&(Ot.normal=Jt.createBuffer()),Xe.hasUvs&&!Ot.uv&&(Ot.uv=Jt.createBuffer()),Xe.hasColors&&!Ot.color&&(Ot.color=Jt.createBuffer());var nn=qt.getAttributes();Xe.hasPositions&&(Jt.bindBuffer(34962,Ot.position),Jt.bufferData(34962,Xe.positionArray,35048),En.enableAttribute(nn.position),Jt.vertexAttribPointer(nn.position,3,5126,!1,0,0)),Xe.hasNormals&&(Jt.bindBuffer(34962,Ot.normal),Jt.bufferData(34962,Xe.normalArray,35048),En.enableAttribute(nn.normal),Jt.vertexAttribPointer(nn.normal,3,5126,!1,0,0)),Xe.hasUvs&&(Jt.bindBuffer(34962,Ot.uv),Jt.bufferData(34962,Xe.uvArray,35048),En.enableAttribute(nn.uv),Jt.vertexAttribPointer(nn.uv,2,5126,!1,0,0)),Xe.hasColors&&(Jt.bindBuffer(34962,Ot.color),Jt.bufferData(34962,Xe.colorArray,35048),En.enableAttribute(nn.color),Jt.vertexAttribPointer(nn.color,3,5126,!1,0,0)),En.disableUnusedAttributes(),Jt.drawArrays(4,0,Xe.count),Xe.count=0},this.renderBufferDirect=function(Xe,qt,Ot,nn,Rn,Qr){null===qt&&(qt=Sn);var zr=Rn.isMesh&&Rn.matrixWorld.determinant()<0,yi=Fc(Xe,qt,nn,Rn);yr.setMaterial(nn,zr);var Sr=Ot.index,Ki=Ot.attributes.position;if(null===Sr){if(void 0===Ki||0===Ki.count)return}else if(0===Sr.count)return;var Ni=1;!0===nn.wireframe&&(Sr=qi.getWireframeAttribute(Ot),Ni=2),(nn.morphTargets||nn.morphNormals)&&Xn.update(Rn,Ot,nn,yi),En.setup(Rn,nn,yi,Ot,Sr);var Qi,ar=Hn;null!==Sr&&(Qi=$i.get(Sr),(ar=lr).setIndex(Qi));var ua=null!==Sr?Sr.count:Ki.count,ha=Ot.drawRange.start*Ni,di=Ot.drawRange.count*Ni,ea=null!==Qr?Qr.start*Ni:0,ei=null!==Qr?Qr.count*Ni:1/0,Dr=Math.max(ha,ea),fi=Math.min(ua,ha+di,ea+ei)-1,Wr=Math.max(0,fi-Dr+1);if(0!==Wr){if(Rn.isMesh)!0===nn.wireframe?(yr.setLineWidth(nn.wireframeLinewidth*er()),ar.setMode(1)):ar.setMode(4);else if(Rn.isLine){var Zr=nn.linewidth;void 0===Zr&&(Zr=1),yr.setLineWidth(Zr*er()),ar.setMode(Rn.isLineSegments?1:Rn.isLineLoop?2:3)}else Rn.isPoints?ar.setMode(0):Rn.isSprite&&ar.setMode(4);if(Rn.isInstancedMesh)ar.renderInstances(Dr,Wr,Rn.count);else if(Ot.isInstancedBufferGeometry){var Bi=Math.min(Ot.instanceCount,Ot._maxInstanceCount);ar.renderInstances(Dr,Wr,Bi)}else ar.render(Dr,Wr)}},this.compile=function(Xe,qt){(F=wn.get(Xe,qt)).init(),Xe.traverseVisible(function(nn){nn.isLight&&nn.layers.test(qt.layers)&&(F.pushLight(nn),nn.castShadow&&F.pushShadow(nn))}),F.setupLights(qt);var Ot=new WeakMap;Xe.traverse(function(nn){var Rn=nn.material;if(Rn)if(Array.isArray(Rn))for(var Qr=0;Qr<Rn.length;Qr++){var zr=Rn[Qr];!1===Ot.has(zr)&&(qa(zr,Xe,nn),Ot.set(zr))}else!1===Ot.has(Rn)&&(qa(Rn,Xe,nn),Ot.set(Rn))})};var Xe,wo=null,ko=new Ji;function ts(Xe,qt,Ot,nn){if(!1!==Xe.visible){if(Xe.layers.test(qt.layers))if(Xe.isGroup)Ot=Xe.renderOrder;else if(Xe.isLOD)!0===Xe.autoUpdate&&Xe.update(qt);else if(Xe.isLight)F.pushLight(Xe),Xe.castShadow&&F.pushShadow(Xe);else if(Xe.isSprite){if(!Xe.frustumCulled||tn.intersectsSprite(Xe)){nn&&yn.setFromMatrixPosition(Xe.matrixWorld).applyMatrix4(Gt);var Qr=Ri.update(Xe),zr=Xe.material;zr.visible&&U.push(Xe,Qr,zr,Ot,yn.z,null)}}else if(Xe.isImmediateRenderObject)nn&&yn.setFromMatrixPosition(Xe.matrixWorld).applyMatrix4(Gt),U.push(Xe,null,Xe.material,Ot,yn.z,null);else if((Xe.isMesh||Xe.isLine||Xe.isPoints)&&(Xe.isSkinnedMesh&&Xe.skeleton.frame!==mi.render.frame&&(Xe.skeleton.update(),Xe.skeleton.frame=mi.render.frame),!Xe.frustumCulled||tn.intersectsObject(Xe))){nn&&yn.setFromMatrixPosition(Xe.matrixWorld).applyMatrix4(Gt);var yi=Ri.update(Xe),Sr=Xe.material;if(Array.isArray(Sr))for(var Ki=yi.groups,Ni=0,Qi=Ki.length;Ni<Qi;Ni++){var ar=Ki[Ni],ua=Sr[ar.materialIndex];ua&&ua.visible&&U.push(Xe,yi,ua,Ot,yn.z,ar)}else Sr.visible&&U.push(Xe,yi,Sr,Ot,yn.z,null)}for(var ha=Xe.children,di=0,ea=ha.length;di<ea;di++)ts(ha[di],qt,Ot,nn)}}function Ls(Xe,qt,Ot){for(var nn=!0===qt.isScene?qt.overrideMaterial:null,Rn=0,Qr=Xe.length;Rn<Qr;Rn++){var zr=Xe[Rn],yi=zr.object,Sr=zr.geometry,Ki=null===nn?zr.material:nn,Ni=zr.group;if(Ot.isArrayCamera){Ae=Ot;for(var Qi=Ot.cameras,ar=0,ua=Qi.length;ar<ua;ar++){var ha=Qi[ar];yi.layers.test(ha.layers)&&(yr.viewport(Le.copy(ha.viewport)),F.setupLights(ha),tl(yi,qt,ha,Sr,Ki,Ni))}}else Ae=null,tl(yi,qt,Ot,Sr,Ki,Ni)}}function tl(Xe,qt,Ot,nn,Rn,Qr){if(Xe.onBeforeRender(K,qt,Ot,nn,Rn,Qr),F=wn.get(qt,Ae||Ot),Xe.modelViewMatrix.multiplyMatrices(Ot.matrixWorldInverse,Xe.matrixWorld),Xe.normalMatrix.getNormalMatrix(Xe.modelViewMatrix),Xe.isImmediateRenderObject){var zr=Fc(Ot,qt,Rn,Xe);yr.setMaterial(Rn),En.reset(),function Rs(Xe,qt){Xe.render(function(Ot){K.renderBufferImmediate(Ot,qt)})}(Xe,zr)}else K.renderBufferDirect(Ot,qt,nn,Rn,Xe,Qr);Xe.onAfterRender(K,qt,Ot,nn,Rn,Qr),F=wn.get(qt,Ae||Ot)}function qa(Xe,qt,Ot){!0!==qt.isScene&&(qt=Sn);var nn=Gr.get(Xe),Rn=F.state.lights,zr=Rn.state.version,yi=lt.getParameters(Xe,Rn.state,F.state.shadowsArray,qt,Ot),Sr=lt.getProgramCacheKey(yi),Ki=nn.program,Ni=!0;if(void 0===Ki)Xe.addEventListener("dispose",gi);else if(Ki.cacheKey!==Sr)Ul(Xe);else if(nn.lightsStateVersion!==zr)Ni=!1;else{if(void 0!==yi.shaderID)return void(nn.envMap=Pi.get(Xe.envMap||(Xe.isMeshStandardMaterial?qt.environment:null)));Ni=!1}Ni&&(yi.uniforms=lt.getUniforms(Xe),Xe.onBeforeCompile(yi,K),Ki=lt.acquireProgram(yi,Sr),nn.program=Ki,nn.uniforms=yi.uniforms,nn.outputEncoding=yi.outputEncoding);var ar=nn.uniforms;(!Xe.isShaderMaterial&&!Xe.isRawShaderMaterial||!0===Xe.clipping)&&(nn.numClippingPlanes=mr.numPlanes,nn.numIntersection=mr.numIntersection,ar.clippingPlanes=mr.uniform),nn.environment=Xe.isMeshStandardMaterial?qt.environment:null,nn.fog=qt.fog,nn.envMap=Pi.get(Xe.envMap||nn.environment),nn.needsLights=function ah(Xe){return Xe.isMeshLambertMaterial||Xe.isMeshToonMaterial||Xe.isMeshPhongMaterial||Xe.isMeshStandardMaterial||Xe.isShadowMaterial||Xe.isShaderMaterial&&!0===Xe.lights}(Xe),nn.lightsStateVersion=zr,nn.needsLights&&(ar.ambientLightColor.value=Rn.state.ambient,ar.lightProbe.value=Rn.state.probe,ar.directionalLights.value=Rn.state.directional,ar.directionalLightShadows.value=Rn.state.directionalShadow,ar.spotLights.value=Rn.state.spot,ar.spotLightShadows.value=Rn.state.spotShadow,ar.rectAreaLights.value=Rn.state.rectArea,ar.ltc_1.value=Rn.state.rectAreaLTC1,ar.ltc_2.value=Rn.state.rectAreaLTC2,ar.pointLights.value=Rn.state.point,ar.pointLightShadows.value=Rn.state.pointShadow,ar.hemisphereLights.value=Rn.state.hemi,ar.directionalShadowMap.value=Rn.state.directionalShadowMap,ar.directionalShadowMatrix.value=Rn.state.directionalShadowMatrix,ar.spotShadowMap.value=Rn.state.spotShadowMap,ar.spotShadowMatrix.value=Rn.state.spotShadowMatrix,ar.pointShadowMap.value=Rn.state.pointShadowMap,ar.pointShadowMatrix.value=Rn.state.pointShadowMatrix);var ua=nn.program.getUniforms(),ha=ys.seqWithValue(ua.seq,ar);nn.uniformsList=ha}function Fc(Xe,qt,Ot,nn){!0!==qt.isScene&&(qt=Sn),Ai.resetTextureUnits();var Rn=qt.fog,Qr=Ot.isMeshStandardMaterial?qt.environment:null,zr=null===Z?K.outputEncoding:Z.texture.encoding,yi=Pi.get(Ot.envMap||Qr),Sr=Gr.get(Ot),Ki=F.state.lights;!0!==en||!0!==Yt&&Xe===we||mr.setState(Ot,Xe,Xe===we&&Ot.id===Be),Ot.version===Sr.__version?(Ot.fog&&Sr.fog!==Rn||Sr.environment!==Qr||Sr.needsLights&&Sr.lightsStateVersion!==Ki.state.version||void 0!==Sr.numClippingPlanes&&(Sr.numClippingPlanes!==mr.numPlanes||Sr.numIntersection!==mr.numIntersection)||Sr.outputEncoding!==zr||Sr.envMap!==yi)&&qa(Ot,qt,nn):(qa(Ot,qt,nn),Sr.__version=Ot.version);var Qi=!1,ar=!1,ua=!1,ha=Sr.program,di=ha.getUniforms(),ea=Sr.uniforms;if(yr.useProgram(ha.program)&&(Qi=!0,ar=!0,ua=!0),Ot.id!==Be&&(Be=Ot.id,ar=!0),Qi||we!==Xe){if(di.setValue(Jt,"projectionMatrix",Xe.projectionMatrix),Rr.logarithmicDepthBuffer&&di.setValue(Jt,"logDepthBufFC",2/(Math.log(Xe.far+1)/Math.LN2)),we!==Xe&&(we=Xe,ar=!0,ua=!0),Ot.isShaderMaterial||Ot.isMeshPhongMaterial||Ot.isMeshToonMaterial||Ot.isMeshStandardMaterial||Ot.envMap){var ei=di.map.cameraPosition;void 0!==ei&&ei.setValue(Jt,yn.setFromMatrixPosition(Xe.matrixWorld))}(Ot.isMeshPhongMaterial||Ot.isMeshToonMaterial||Ot.isMeshLambertMaterial||Ot.isMeshBasicMaterial||Ot.isMeshStandardMaterial||Ot.isShaderMaterial)&&di.setValue(Jt,"isOrthographic",!0===Xe.isOrthographicCamera),(Ot.isMeshPhongMaterial||Ot.isMeshToonMaterial||Ot.isMeshLambertMaterial||Ot.isMeshBasicMaterial||Ot.isMeshStandardMaterial||Ot.isShaderMaterial||Ot.isShadowMaterial||Ot.skinning)&&di.setValue(Jt,"viewMatrix",Xe.matrixWorldInverse)}if(Ot.skinning){di.setOptional(Jt,nn,"bindMatrix"),di.setOptional(Jt,nn,"bindMatrixInverse");var Dr=nn.skeleton;if(Dr)if(Rr.floatVertexTextures){if(null===Dr.boneTexture){var Wr=Math.sqrt(4*Dr.bones.length);Wr=pr.ceilPowerOfTwo(Wr),Wr=Math.max(Wr,4);var Zr=new Float32Array(Wr*Wr*4);Zr.set(Dr.boneMatrices);var Bi=new Gi(Zr,Wr,Wr,Pr,xn);Dr.boneMatrices=Zr,Dr.boneTexture=Bi,Dr.boneTextureSize=Wr}di.setValue(Jt,"boneTexture",Dr.boneTexture,Ai),di.setValue(Jt,"boneTextureSize",Dr.boneTextureSize)}else di.setOptional(Jt,Dr,"boneMatrices")}return(ar||Sr.receiveShadow!==nn.receiveShadow)&&(Sr.receiveShadow=nn.receiveShadow,di.setValue(Jt,"receiveShadow",nn.receiveShadow)),ar&&(di.setValue(Jt,"toneMappingExposure",K.toneMappingExposure),Sr.needsLights&&function Nc(Xe,qt){Xe.ambientLightColor.needsUpdate=qt,Xe.lightProbe.needsUpdate=qt,Xe.directionalLights.needsUpdate=qt,Xe.directionalLightShadows.needsUpdate=qt,Xe.pointLights.needsUpdate=qt,Xe.pointLightShadows.needsUpdate=qt,Xe.spotLights.needsUpdate=qt,Xe.spotLightShadows.needsUpdate=qt,Xe.rectAreaLights.needsUpdate=qt,Xe.hemisphereLights.needsUpdate=qt}(ea,ua),Rn&&Ot.fog&&et.refreshFogUniforms(ea,Rn),et.refreshMaterialUniforms(ea,Ot,Ge,st),ys.upload(Jt,Sr.uniformsList,ea,Ai)),Ot.isShaderMaterial&&!0===Ot.uniformsNeedUpdate&&(ys.upload(Jt,Sr.uniformsList,ea,Ai),Ot.uniformsNeedUpdate=!1),Ot.isSpriteMaterial&&di.setValue(Jt,"center",nn.center),di.setValue(Jt,"modelViewMatrix",nn.modelViewMatrix),di.setValue(Jt,"normalMatrix",nn.normalMatrix),di.setValue(Jt,"modelMatrix",nn.matrixWorld),ha}ko.setAnimationLoop(function es(Xe){Hr.isPresenting||wo&&wo(Xe)}),typeof window<"u"&&ko.setContext(window),this.setAnimationLoop=function(Xe){wo=Xe,Hr.setAnimationLoop(Xe),null===Xe?ko.stop():ko.start()},this.render=function(Xe,qt){var Ot,nn;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Ot=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),nn=arguments[3]),void 0===qt||!0===qt.isCamera){if(!0!==Q){En.resetDefaultState(),Be=-1,we=null,!0===Xe.autoUpdate&&Xe.updateMatrixWorld(),null===qt.parent&&qt.updateMatrixWorld(),!0===Hr.enabled&&!0===Hr.isPresenting&&(qt=Hr.getCamera(qt)),!0===Xe.isScene&&Xe.onBeforeRender(K,Xe,qt,Ot||Z),(F=wn.get(Xe,qt)).init(),Gt.multiplyMatrices(qt.projectionMatrix,qt.matrixWorldInverse),tn.setFromProjectionMatrix(Gt),en=mr.init(this.clippingPlanes,Yt=this.localClippingEnabled,qt),(U=Dn.get(Xe,qt)).init(),ts(Xe,qt,0,K.sortObjects),U.finish(),!0===K.sortObjects&&U.sort(vt,Je),!0===en&&mr.beginShadows();var Rn=F.state.shadowsArray;Vi.render(Rn,Xe,qt),F.setupLights(qt),!0===en&&mr.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==Ot&&this.setRenderTarget(Ot),xt.render(U,Xe,qt,nn);var Qr=U.opaque,zr=U.transparent;Qr.length>0&&Ls(Qr,Xe,qt),zr.length>0&&Ls(zr,Xe,qt),!0===Xe.isScene&&Xe.onAfterRender(K,Xe,qt),null!==Z&&(Ai.updateRenderTargetMipmap(Z),Ai.updateMultisampleRenderTarget(Z)),yr.buffers.depth.setTest(!0),yr.buffers.depth.setMask(!0),yr.buffers.color.setMask(!0),yr.setPolygonOffset(!1),Hr.enabled&&Hr.submitFrame&&Hr.submitFrame(),U=null,F=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setTexture2D=(Xe=!1,function(Ot,nn){Ot&&Ot.isWebGLRenderTarget&&(Xe||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Xe=!0),Ot=Ot.texture),Ai.setTexture2D(Ot,nn)}),this.setFramebuffer=function(Xe){re!==Xe&&null===Z&&Jt.bindFramebuffer(36160,Xe),re=Xe},this.getActiveCubeFace=function(){return ve},this.getActiveMipmapLevel=function(){return oe},this.getRenderList=function(){return U},this.setRenderList=function(Xe){U=Xe},this.getRenderState=function(){return F},this.setRenderState=function(Xe){F=Xe},this.getRenderTarget=function(){return Z},this.setRenderTarget=function(Xe,qt,Ot){void 0===qt&&(qt=0),void 0===Ot&&(Ot=0),Z=Xe,ve=qt,oe=Ot,Xe&&void 0===Gr.get(Xe).__webglFramebuffer&&Ai.setupRenderTarget(Xe);var nn=re,Rn=!1;if(Xe){var Qr=Gr.get(Xe).__webglFramebuffer;Xe.isWebGLCubeRenderTarget?(nn=Qr[qt],Rn=!0):nn=Xe.isWebGLMultisampleRenderTarget?Gr.get(Xe).__webglMultisampledFramebuffer:Qr,Le.copy(Xe.viewport),tt.copy(Xe.scissor),Ze=Xe.scissorTest}else Le.copy(je).multiplyScalar(Ge).floor(),tt.copy(At).multiplyScalar(Ge).floor(),Ze=Rt;if(Te!==nn&&(Jt.bindFramebuffer(36160,nn),Te=nn),yr.viewport(Le),yr.scissor(tt),yr.setScissorTest(Ze),Rn){var zr=Gr.get(Xe.texture);Jt.framebufferTexture2D(36160,36064,34069+qt,zr.__webglTexture,Ot)}},this.readRenderTargetPixels=function(Xe,qt,Ot,nn,Rn,Qr,zr){if(Xe&&Xe.isWebGLRenderTarget){var yi=Gr.get(Xe).__webglFramebuffer;if(Xe.isWebGLCubeRenderTarget&&void 0!==zr&&(yi=yi[zr]),yi){var Sr=!1;yi!==Te&&(Jt.bindFramebuffer(36160,yi),Sr=!0);try{var Ki=Xe.texture,Ni=Ki.format,Qi=Ki.type;if(Ni!==Pr&&Gn.convert(Ni)!==Jt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(Qi===Ft||Gn.convert(Qi)===Jt.getParameter(35738)||Qi===xn&&(Rr.isWebGL2||Ln.get("OES_texture_float")||Ln.get("WEBGL_color_buffer_float"))||Qi===nr&&Ln.get(Rr.isWebGL2?"EXT_color_buffer_float":"EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===Jt.checkFramebufferStatus(36160)?qt>=0&&qt<=Xe.width-nn&&Ot>=0&&Ot<=Xe.height-Rn&&Jt.readPixels(qt,Ot,nn,Rn,Gn.convert(Ni),Gn.convert(Qi),Qr):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Sr&&Jt.bindFramebuffer(36160,Te)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(Xe,qt,Ot){void 0===Ot&&(Ot=0);var nn=Math.pow(2,-Ot),Rn=Math.floor(qt.image.width*nn),Qr=Math.floor(qt.image.height*nn),zr=Gn.convert(qt.format);Ai.setTexture2D(qt,0),Jt.copyTexImage2D(3553,Ot,zr,Xe.x,Xe.y,Rn,Qr,0),yr.unbindTexture()},this.copyTextureToTexture=function(Xe,qt,Ot,nn){void 0===nn&&(nn=0);var Rn=qt.image.width,Qr=qt.image.height,zr=Gn.convert(Ot.format),yi=Gn.convert(Ot.type);Ai.setTexture2D(Ot,0),Jt.pixelStorei(37440,Ot.flipY),Jt.pixelStorei(37441,Ot.premultiplyAlpha),Jt.pixelStorei(3317,Ot.unpackAlignment),qt.isDataTexture?Jt.texSubImage2D(3553,nn,Xe.x,Xe.y,Rn,Qr,zr,yi,qt.image.data):qt.isCompressedTexture?Jt.compressedTexSubImage2D(3553,nn,Xe.x,Xe.y,qt.mipmaps[0].width,qt.mipmaps[0].height,zr,qt.mipmaps[0].data):Jt.texSubImage2D(3553,nn,Xe.x,Xe.y,zr,yi,qt.image),0===nn&&Ot.generateMipmaps&&Jt.generateMipmap(3553),yr.unbindTexture()},this.initTexture=function(Xe){Ai.setTexture2D(Xe,0),yr.unbindTexture()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Gh(a){hc.call(this,a)}Object.assign(xf.prototype,na.prototype),Object.assign(uc.prototype,{constructor:uc,getHandSpace:function(){if(null===this._hand&&(this._hand=new Yo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(var t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){var i=new Yo;i.matrixAutoUpdate=!1,i.visible=!1,this._hand.joints.push(i),this._hand.add(i)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Yo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Yo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,i,n){var r=null,o=null,l=null,b=this._targetRay,S=this._grip,L=this._hand;if(t&&"visible-blurred"!==i.session.visibilityState)if(L&&t.hand){l=!0;for(var G=0;G<=window.XRHand.LITTLE_PHALANX_TIP;G++)if(t.hand[G]){var U=i.getJointPose(t.hand[G],n),F=L.joints[G];null!==U&&(F.matrix.fromArray(U.transform.matrix),F.matrix.decompose(F.position,F.rotation,F.scale),F.jointRadius=U.radius),F.visible=null!==U;var K=L.joints[window.XRHand.INDEX_PHALANX_TIP],Q=L.joints[window.XRHand.THUMB_PHALANX_TIP],re=K.position.distanceTo(Q.position);L.inputState.pinching&&re>.025?(L.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!L.inputState.pinching&&re<=.015&&(L.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==b&&null!==(r=i.getPose(t.targetRaySpace,n))&&(b.matrix.fromArray(r.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale)),null!==S&&t.gripSpace&&null!==(o=i.getPose(t.gripSpace,n))&&(S.matrix.fromArray(o.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale));return null!==b&&(b.visible=null!==r),null!==S&&(S.visible=null!==o),null!==L&&(L.visible=null!==l),this}}),Object.assign(Mf.prototype,na.prototype),Gh.prototype=Object.assign(Object.create(hc.prototype),{constructor:Gh,isWebGL1Renderer:!0});var Tf=function(){function a(i,n){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Fn(i),this.density=void 0!==n?n:25e-5}var t=a.prototype;return t.clone=function(){return new a(this.color,this.density)},t.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},a}(),Sf=function(){function a(i,n,r){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Fn(i),this.near=void 0!==n?n:1,this.far=void 0!==r?r:1e3}var t=a.prototype;return t.clone=function(){return new a(this.color,this.near,this.far)},t.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},a}(),zh=function(a){function t(){var n;return n=a.call(this)||this,Object.defineProperty(rs(n),"isScene",{value:!0}),n.type="Scene",n.background=null,n.environment=null,n.fog=null,n.overrideMaterial=null,n.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:rs(n)})),n}Qn(t,a);var i=t.prototype;return i.copy=function(r,o){return a.prototype.copy.call(this,r,o),null!==r.background&&(this.background=r.background.clone()),null!==r.environment&&(this.environment=r.environment.clone()),null!==r.fog&&(this.fog=r.fog.clone()),null!==r.overrideMaterial&&(this.overrideMaterial=r.overrideMaterial.clone()),this.autoUpdate=r.autoUpdate,this.matrixAutoUpdate=r.matrixAutoUpdate,this},i.toJSON=function(r){var o=a.prototype.toJSON.call(this,r);return null!==this.background&&(o.object.background=this.background.toJSON(r)),null!==this.environment&&(o.object.environment=this.environment.toJSON(r)),null!==this.fog&&(o.object.fog=this.fog.toJSON()),o},t}(Kn);function Va(a,t){this.array=a,this.stride=t,this.count=void 0!==a?a.length/t:0,this.usage=So,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=pr.generateUUID()}Object.defineProperty(Va.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Va.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,i,n){t*=this.stride,n*=i.stride;for(var r=0,o=this.stride;r<o;r++)this.array[t+r]=i.array[n+r];return this},set:function(t,i){return void 0===i&&(i=0),this.array.set(t,i),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=pr.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var n=new Va(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return n.setUsage(this.usage),n},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=pr.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var Gs=new ke;function ws(a,t,i,n){this.name="",this.data=a,this.itemSize=t,this.offset=i,this.normalized=!0===n}function Es(a){fr.call(this),this.type="SpriteMaterial",this.color=new Fn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(a)}Object.defineProperties(ws.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(ws.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var i=0,n=this.data.count;i<n;i++)Gs.x=this.getX(i),Gs.y=this.getY(i),Gs.z=this.getZ(i),Gs.applyMatrix4(t),this.setXYZ(i,Gs.x,Gs.y,Gs.z);return this},setX:function(t,i){return this.data.array[t*this.data.stride+this.offset]=i,this},setY:function(t,i){return this.data.array[t*this.data.stride+this.offset+1]=i,this},setZ:function(t,i){return this.data.array[t*this.data.stride+this.offset+2]=i,this},setW:function(t,i){return this.data.array[t*this.data.stride+this.offset+3]=i,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,i,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=n,this},setXYZ:function(t,i,n,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,i,n,r,o){return this.data.array[(t=t*this.data.stride+this.offset)+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=o,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var i=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,o=0;o<this.itemSize;o++)i.push(this.data.array[r+o]);return new Zn(new this.array.constructor(i),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ws(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var i=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,o=0;o<this.itemSize;o++)i.push(this.data.array[r+o]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),(Es.prototype=Object.create(fr.prototype)).constructor=Es,Es.prototype.isSpriteMaterial=!0,Es.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this};var xl,dc=new ke,Ml=new ke,Tl=new ke,Sl=new cn,fc=new cn,Cf=new br,cu=new ke,pc=new ke,uu=new ke,_f=new cn,Vh=new cn,Rf=new cn;function vc(a){if(Kn.call(this),this.type="Sprite",void 0===xl){xl=new De;var i=new Va(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);xl.setIndex([0,1,2,0,2,3]),xl.setAttribute("position",new ws(i,3,0,!1)),xl.setAttribute("uv",new ws(i,2,3,!1))}this.geometry=xl,this.material=void 0!==a?a:new Es,this.center=new cn(.5,.5)}function hu(a,t,i,n,r,o){Sl.subVectors(a,i).addScalar(.5).multiply(n),void 0!==r?(fc.x=o*Sl.x-r*Sl.y,fc.y=r*Sl.x+o*Sl.y):fc.copy(Sl),a.copy(t),a.x+=fc.x,a.y+=fc.y,a.applyMatrix4(Cf)}vc.prototype=Object.assign(Object.create(Kn.prototype),{constructor:vc,isSprite:!0,raycast:function(t,i){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ml.setFromMatrixScale(this.matrixWorld),Cf.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Tl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ml.multiplyScalar(-Tl.z);var r,o,n=this.material.rotation;0!==n&&(o=Math.cos(n),r=Math.sin(n));var l=this.center;hu(cu.set(-.5,-.5,0),Tl,l,Ml,r,o),hu(pc.set(.5,-.5,0),Tl,l,Ml,r,o),hu(uu.set(.5,.5,0),Tl,l,Ml,r,o),_f.set(0,0),Vh.set(1,0),Rf.set(1,1);var b=t.ray.intersectTriangle(cu,pc,uu,!1,dc);if(null!==b||(hu(pc.set(-.5,.5,0),Tl,l,Ml,r,o),Vh.set(0,1),null!==(b=t.ray.intersectTriangle(cu,uu,pc,!1,dc)))){var S=t.ray.origin.distanceTo(dc);S<t.near||S>t.far||i.push({distance:S,point:dc.clone(),uv:Ha.getUV(dc,cu,pc,uu,_f,Vh,Rf,new cn),face:null,object:this})}},copy:function(t){return Kn.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});var a,t,i,n,r,du=new ke,Lf=new ke;function mc(){Kn.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function gc(a,t){a&&a.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),kn.call(this,a,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new br,this.bindMatrixInverse=new br}function yc(){Kn.call(this),this.type="Bone"}mc.prototype=Object.assign(Object.create(Kn.prototype),{constructor:mc,isLOD:!0,copy:function(t){Kn.prototype.copy.call(this,t,!1);for(var i=t.levels,n=0,r=i.length;n<r;n++){var o=i[n];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,i){void 0===i&&(i=0),i=Math.abs(i);var r,n=this.levels;for(r=0;r<n.length&&!(i<n[r].distance);r++);return n.splice(r,0,{distance:i,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){var i=this.levels;if(i.length>0){var n,r;for(n=1,r=i.length;n<r&&!(t<i[n].distance);n++);return i[n-1].object}return null},raycast:function(t,i){if(this.levels.length>0){du.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(du);this.getObjectForDistance(r).raycast(t,i)}},update:function(t){var i=this.levels;if(i.length>1){du.setFromMatrixPosition(t.matrixWorld),Lf.setFromMatrixPosition(this.matrixWorld);var r,o,n=du.distanceTo(Lf)/t.zoom;for(i[0].object.visible=!0,r=1,o=i.length;r<o&&n>=i[r].distance;r++)i[r-1].object.visible=!1,i[r].object.visible=!0;for(this._currentLevel=r-1;r<o;r++)i[r].object.visible=!1}},toJSON:function(t){var i=Kn.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(i.object.autoUpdate=!1),i.object.levels=[];for(var n=this.levels,r=0,o=n.length;r<o;r++){var l=n[r];i.object.levels.push({object:l.object.uuid,distance:l.distance})}return i}}),gc.prototype=Object.assign(Object.create(kn.prototype),{constructor:gc,isSkinnedMesh:!0,copy:function(t){return kn.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,i){this.skeleton=t,void 0===i&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new ui,i=this.geometry.attributes.skinWeight,n=0,r=i.count;n<r;n++){t.x=i.getX(n),t.y=i.getY(n),t.z=i.getZ(n),t.w=i.getW(n);var o=1/t.manhattanLength();o!==1/0?t.multiplyScalar(o):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){kn.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:(a=new ke,t=new ui,i=new ui,n=new ke,r=new br,function(o,l){var b=this.skeleton,S=this.geometry;t.fromBufferAttribute(S.attributes.skinIndex,o),i.fromBufferAttribute(S.attributes.skinWeight,o),a.fromBufferAttribute(S.attributes.position,o).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(var L=0;L<4;L++){var G=i.getComponent(L);if(0!==G){var U=t.getComponent(L);r.multiplyMatrices(b.bones[U].matrixWorld,b.boneInverses[U]),l.addScaledVector(n.copy(a).applyMatrix4(r),G)}}return l.applyMatrix4(this.bindMatrixInverse)})}),yc.prototype=Object.assign(Object.create(Kn.prototype),{constructor:yc,isBone:!0});var Pf=new br,E0=new br;function Ac(a,t){void 0===a&&(a=[]),void 0===t&&(t=[]),this.uuid=pr.generateUUID(),this.bones=a.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Ac.prototype,{init:function(){var t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===i.length)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new br)}},calculateInverses:function(){this.boneInverses.length=0;for(var t=0,i=this.bones.length;t<i;t++){var n=new br;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}},pose:function(){for(var t=0,i=this.bones.length;t<i;t++){var n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(var r=0,o=this.bones.length;r<o;r++){var l=this.bones[r];l&&(l.parent&&l.parent.isBone?(l.matrix.copy(l.parent.matrixWorld).invert(),l.matrix.multiply(l.matrixWorld)):l.matrix.copy(l.matrixWorld),l.matrix.decompose(l.position,l.quaternion,l.scale))}},update:function(){for(var t=this.bones,i=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,o=0,l=t.length;o<l;o++)Pf.multiplyMatrices(t[o]?t[o].matrixWorld:E0,i[o]),Pf.toArray(n,16*o);null!==r&&(r.needsUpdate=!0)},clone:function(){return new Ac(this.bones,this.boneInverses)},getBoneByName:function(t){for(var i=0,n=this.bones.length;i<n;i++){var r=this.bones[i];if(r.name===t)return r}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,i){this.uuid=t.uuid;for(var n=0,r=t.bones.length;n<r;n++){var o=t.bones[n],l=i[o];void 0===l&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),l=new yc),this.bones.push(l),this.boneInverses.push((new br).fromArray(t.boneInverses[n]))}return this.init(),this},toJSON:function(){var t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;for(var i=this.bones,n=this.boneInverses,r=0,o=i.length;r<o;r++)t.bones.push(i[r].uuid),t.boneInverses.push(n[r].toArray());return t}});var Df=new br,If=new br,fu=[],bc=new kn;function pu(a,t,i){kn.call(this,a,t),this.instanceMatrix=new Zn(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function Fi(a){fr.call(this),this.type="LineBasicMaterial",this.color=new Fn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(a)}pu.prototype=Object.assign(Object.create(kn.prototype),{constructor:pu,isInstancedMesh:!0,copy:function(t){return kn.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},getColorAt:function(t,i){i.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,i){i.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,i){var n=this.matrixWorld,r=this.count;if(bc.geometry=this.geometry,bc.material=this.material,void 0!==bc.material)for(var o=0;o<r;o++){this.getMatrixAt(o,Df),If.multiplyMatrices(n,Df),bc.matrixWorld=If,bc.raycast(t,fu);for(var l=0,b=fu.length;l<b;l++){var S=fu[l];S.instanceId=o,S.object=this,i.push(S)}fu.length=0}},setColorAt:function(t,i){null===this.instanceColor&&(this.instanceColor=new Zn(new Float32Array(3*this.count),3)),i.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,i){i.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),(Fi.prototype=Object.create(fr.prototype)).constructor=Fi,Fi.prototype.isLineBasicMaterial=!0,Fi.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.morphTargets=a.morphTargets,this};var Of=new ke,Bf=new ke,Ff=new br,vu=new cs,mu=new ao;function eo(a,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Kn.call(this),this.type="Line",this.geometry=void 0!==a?a:new De,this.material=void 0!==t?t:new Fi,this.updateMorphTargets()}eo.prototype=Object.assign(Object.create(Kn.prototype),{constructor:eo,isLine:!0,copy:function(t){return Kn.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var i=t.attributes.position,n=[0],r=1,o=i.count;r<o;r++)Of.fromBufferAttribute(i,r-1),Bf.fromBufferAttribute(i,r),n[r]=n[r-1],n[r]+=Of.distanceTo(Bf);t.setAttribute("lineDistance",new _n(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var l=t.vertices,b=t.lineDistances;b[0]=0;for(var S=1,L=l.length;S<L;S++)b[S]=b[S-1],b[S]+=l[S-1].distanceTo(l[S])}return this},raycast:function(t,i){var n=this.geometry,r=this.matrixWorld,o=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),mu.copy(n.boundingSphere),mu.applyMatrix4(r),mu.radius+=o,!1!==t.ray.intersectsSphere(mu)){Ff.copy(r).invert(),vu.copy(t.ray).applyMatrix4(Ff);var l=o/((this.scale.x+this.scale.y+this.scale.z)/3),b=l*l,S=new ke,L=new ke,G=new ke,U=new ke,F=this.isLineSegments?2:1;if(n.isBufferGeometry){var K=n.index,re=n.attributes.position;if(null!==K)for(var ve=K.array,oe=0,Z=ve.length-1;oe<Z;oe+=F){var Be=ve[oe+1];if(S.fromBufferAttribute(re,ve[oe]),L.fromBufferAttribute(re,Be),!(vu.distanceSqToSegment(S,L,U,G)>b)){U.applyMatrix4(this.matrixWorld);var Ae=t.ray.origin.distanceTo(U);Ae<t.near||Ae>t.far||i.push({distance:Ae,point:G.clone().applyMatrix4(this.matrixWorld),index:oe,face:null,faceIndex:null,object:this})}}else for(var Le=0,tt=re.count-1;Le<tt;Le+=F)if(S.fromBufferAttribute(re,Le),L.fromBufferAttribute(re,Le+1),!(vu.distanceSqToSegment(S,L,U,G)>b)){U.applyMatrix4(this.matrixWorld);var wt=t.ray.origin.distanceTo(U);wt<t.near||wt>t.far||i.push({distance:wt,point:G.clone().applyMatrix4(this.matrixWorld),index:Le,face:null,faceIndex:null,object:this})}}else if(n.isGeometry)for(var st=n.vertices,Ge=st.length,vt=0;vt<Ge-1;vt+=F)if(!(vu.distanceSqToSegment(st[vt],st[vt+1],U,G)>b)){U.applyMatrix4(this.matrixWorld);var je=t.ray.origin.distanceTo(U);je<t.near||je>t.far||i.push({distance:je,point:G.clone().applyMatrix4(this.matrixWorld),index:vt,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){var i=t.morphAttributes,n=Object.keys(i);if(n.length>0){var r=i[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var o=0,l=r.length;o<l;o++){var b=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=o}}}}else{var S=t.morphTargets;void 0!==S&&S.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var gu=new ke,yu=new ke;function _a(a,t){eo.call(this,a,t),this.type="LineSegments"}function Au(a,t){eo.call(this,a,t),this.type="LineLoop"}function po(a){fr.call(this),this.type="PointsMaterial",this.color=new Fn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(a)}_a.prototype=Object.assign(Object.create(eo.prototype),{constructor:_a,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var i=t.attributes.position,n=[],r=0,o=i.count;r<o;r+=2)gu.fromBufferAttribute(i,r),yu.fromBufferAttribute(i,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+gu.distanceTo(yu);t.setAttribute("lineDistance",new _n(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(var l=t.vertices,b=t.lineDistances,S=0,L=l.length;S<L;S+=2)gu.copy(l[S]),yu.copy(l[S+1]),b[S]=0===S?0:b[S-1],b[S+1]=b[S]+gu.distanceTo(yu);return this}}),Au.prototype=Object.assign(Object.create(eo.prototype),{constructor:Au,isLineLoop:!0}),(po.prototype=Object.create(fr.prototype)).constructor=po,po.prototype.isPointsMaterial=!0,po.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.morphTargets=a.morphTargets,this};var Nf=new br,Wh=new cs,bu=new ao,wu=new ke;function Cl(a,t){Kn.call(this),this.type="Points",this.geometry=void 0!==a?a:new De,this.material=void 0!==t?t:new po,this.updateMorphTargets()}function jh(a,t,i,n,r,o,l){var b=Wh.distanceSqToPoint(a);if(b<i){var S=new ke;Wh.closestPointToPoint(a,S),S.applyMatrix4(n);var L=r.ray.origin.distanceTo(S);if(L<r.near||L>r.far)return;o.push({distance:L,distanceToRay:Math.sqrt(b),point:S,index:t,face:null,object:l})}}function Xh(a,t,i,n,r,o,l,b,S){vi.call(this,a,t,i,n,r,o,l,b,S),this.format=void 0!==l?l:ti,this.minFilter=void 0!==o?o:We,this.magFilter=void 0!==r?r:We,this.generateMipmaps=!1;var L=this;"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(function G(){L.needsUpdate=!0,a.requestVideoFrameCallback(G)})}function _l(a,t,i,n,r,o,l,b,S,L,G,U){vi.call(this,null,o,l,b,S,L,n,r,G,U),this.image={width:t,height:i},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1}function wc(a,t,i,n,r,o,l,b,S){vi.call(this,a,t,i,n,r,o,l,b,S),this.needsUpdate=!0}function Ec(a,t,i,n,r,o,l,b,S,L){if((L=void 0!==L?L:yt)!==yt&&L!==Nt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&L===yt&&(i=vn),void 0===i&&L===Nt&&(i=ur),vi.call(this,null,n,r,o,l,b,L,i,S),this.image={width:a,height:t},this.magFilter=void 0!==l?l:St,this.minFilter=void 0!==b?b:St,this.flipY=!1,this.generateMipmaps=!1}Cl.prototype=Object.assign(Object.create(Kn.prototype),{constructor:Cl,isPoints:!0,copy:function(t){return Kn.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,i){var n=this.geometry,r=this.matrixWorld,o=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),bu.copy(n.boundingSphere),bu.applyMatrix4(r),bu.radius+=o,!1!==t.ray.intersectsSphere(bu)){Nf.copy(r).invert(),Wh.copy(t.ray).applyMatrix4(Nf);var l=o/((this.scale.x+this.scale.y+this.scale.z)/3),b=l*l;if(n.isBufferGeometry){var S=n.index,G=n.attributes.position;if(null!==S)for(var U=S.array,F=0,K=U.length;F<K;F++){var Q=U[F];wu.fromBufferAttribute(G,Q),jh(wu,Q,b,r,t,i,this)}else for(var re=0,ve=G.count;re<ve;re++)wu.fromBufferAttribute(G,re),jh(wu,re,b,r,t,i,this)}else for(var oe=n.vertices,Z=0,Te=oe.length;Z<Te;Z++)jh(oe[Z],Z,b,r,t,i,this)}},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){var i=t.morphAttributes,n=Object.keys(i);if(n.length>0){var r=i[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var o=0,l=r.length;o<l;o++){var b=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=o}}}}else{var S=t.morphTargets;void 0!==S&&S.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),Xh.prototype=Object.assign(Object.create(vi.prototype),{constructor:Xh,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){var t=this.image;0=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(_l.prototype=Object.create(vi.prototype)).constructor=_l,_l.prototype.isCompressedTexture=!0,(wc.prototype=Object.create(vi.prototype)).constructor=wc,wc.prototype.isCanvasTexture=!0,(Ec.prototype=Object.create(vi.prototype)).constructor=Ec,Ec.prototype.isDepthTexture=!0;var x0=0,Do=new br,qh=new Kn,Eu=new ke;function Mi(){Object.defineProperty(this,"id",{value:x0+=2}),this.uuid=pr.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Mi.prototype=Object.assign(Object.create(na.prototype),{constructor:Mi,isGeometry:!0,applyMatrix4:function(t){for(var i=(new da).getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(t);for(var l=0,b=this.faces.length;l<b;l++){var S=this.faces[l];S.normal.applyMatrix3(i).normalize();for(var L=0,G=S.vertexNormals.length;L<G;L++)S.vertexNormals[L].applyMatrix3(i).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Do.makeRotationX(t),this.applyMatrix4(Do),this},rotateY:function(t){return Do.makeRotationY(t),this.applyMatrix4(Do),this},rotateZ:function(t){return Do.makeRotationZ(t),this.applyMatrix4(Do),this},translate:function(t,i,n){return Do.makeTranslation(t,i,n),this.applyMatrix4(Do),this},scale:function(t,i,n){return Do.makeScale(t,i,n),this.applyMatrix4(Do),this},lookAt:function(t){return qh.lookAt(t),qh.updateMatrix(),this.applyMatrix4(qh.matrix),this},fromBufferGeometry:function(t){var i=this,n=null!==t.index?t.index:void 0,r=t.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var o=r.position,l=r.normal,b=r.color,S=r.uv,L=r.uv2;void 0!==L&&(this.faceVertexUvs[1]=[]);for(var G=0;G<o.count;G++)i.vertices.push((new ke).fromBufferAttribute(o,G)),void 0!==b&&i.colors.push((new Fn).fromBufferAttribute(b,G));function U(we,Ae,Le,tt){var Ze=void 0===b?[]:[i.colors[we].clone(),i.colors[Ae].clone(),i.colors[Le].clone()],wt=void 0===l?[]:[(new ke).fromBufferAttribute(l,we),(new ke).fromBufferAttribute(l,Ae),(new ke).fromBufferAttribute(l,Le)],st=new ds(we,Ae,Le,wt,Ze,tt);i.faces.push(st),void 0!==S&&i.faceVertexUvs[0].push([(new cn).fromBufferAttribute(S,we),(new cn).fromBufferAttribute(S,Ae),(new cn).fromBufferAttribute(S,Le)]),void 0!==L&&i.faceVertexUvs[1].push([(new cn).fromBufferAttribute(L,we),(new cn).fromBufferAttribute(L,Ae),(new cn).fromBufferAttribute(L,Le)])}var F=t.groups;if(F.length>0)for(var K=0;K<F.length;K++)for(var Q=F[K],re=Q.start,oe=re,Z=re+Q.count;oe<Z;oe+=3)void 0!==n?U(n.getX(oe),n.getX(oe+1),n.getX(oe+2),Q.materialIndex):U(oe,oe+1,oe+2,Q.materialIndex);else if(void 0!==n)for(var Te=0;Te<n.count;Te+=3)U(n.getX(Te),n.getX(Te+1),n.getX(Te+2));else for(var Be=0;Be<o.count;Be+=3)U(Be,Be+1,Be+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Eu).negate(),this.translate(Eu.x,Eu.y,Eu.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,i=this.boundingSphere.radius,n=0===i?1:1/i,r=new br;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var t=new ke,i=new ke,n=0,r=this.faces.length;n<r;n++){var o=this.faces[n],l=this.vertices[o.a],b=this.vertices[o.b];t.subVectors(this.vertices[o.c],b),i.subVectors(l,b),t.cross(i),t.normalize(),o.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);for(var i=new Array(this.vertices.length),n=0,r=this.vertices.length;n<r;n++)i[n]=new ke;if(t)for(var o=new ke,l=new ke,b=0,S=this.faces.length;b<S;b++){var L=this.faces[b],G=this.vertices[L.a],U=this.vertices[L.b];o.subVectors(this.vertices[L.c],U),l.subVectors(G,U),o.cross(l),i[L.a].add(o),i[L.b].add(o),i[L.c].add(o)}else{this.computeFaceNormals();for(var K=0,Q=this.faces.length;K<Q;K++){var re=this.faces[K];i[re.a].add(re.normal),i[re.b].add(re.normal),i[re.c].add(re.normal)}}for(var ve=0,oe=this.vertices.length;ve<oe;ve++)i[ve].normalize();for(var Z=0,Te=this.faces.length;Z<Te;Z++){var Be=this.faces[Z],we=Be.vertexNormals;3===we.length?(we[0].copy(i[Be.a]),we[1].copy(i[Be.b]),we[2].copy(i[Be.c])):(we[0]=i[Be.a].clone(),we[1]=i[Be.b].clone(),we[2]=i[Be.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(var t=0,i=this.faces.length;t<i;t++){var n=this.faces[t],r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(var t=0,i=this.faces.length;t<i;t++){var n=this.faces[t];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(var r=0,o=n.vertexNormals.length;r<o;r++)n.__originalVertexNormals[r]?n.__originalVertexNormals[r].copy(n.vertexNormals[r]):n.__originalVertexNormals[r]=n.vertexNormals[r].clone()}var l=new Mi;l.faces=this.faces;for(var b=0,S=this.morphTargets.length;b<S;b++){if(!this.morphNormals[b]){this.morphNormals[b]={},this.morphNormals[b].faceNormals=[],this.morphNormals[b].vertexNormals=[];for(var L=this.morphNormals[b].faceNormals,G=this.morphNormals[b].vertexNormals,U=0,F=this.faces.length;U<F;U++){var K=new ke,Q={a:new ke,b:new ke,c:new ke};L.push(K),G.push(Q)}}var re=this.morphNormals[b];l.vertices=this.morphTargets[b].vertices,l.computeFaceNormals(),l.computeVertexNormals();for(var ve=0,oe=this.faces.length;ve<oe;ve++){var Z=this.faces[ve],Be=re.vertexNormals[ve];re.faceNormals[ve].copy(Z.normal),Be.a.copy(Z.vertexNormals[0]),Be.b.copy(Z.vertexNormals[1]),Be.c.copy(Z.vertexNormals[2])}}for(var we=0,Ae=this.faces.length;we<Ae;we++){var Le=this.faces[we];Le.normal=Le.__originalFaceNormal,Le.vertexNormals=Le.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ca),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ao),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,i,n){if(void 0===n&&(n=0),t&&t.isGeometry){var r,o=this.vertices.length,l=this.vertices,b=t.vertices,S=this.faces,L=t.faces,G=this.colors,U=t.colors;void 0!==i&&(r=(new da).getNormalMatrix(i));for(var F=0,K=b.length;F<K;F++){var re=b[F].clone();void 0!==i&&re.applyMatrix4(i),l.push(re)}for(var ve=0,oe=U.length;ve<oe;ve++)G.push(U[ve].clone());for(var Z=0,Te=L.length;Z<Te;Z++){var Be=L[Z],we=void 0,Le=Be.vertexNormals,tt=Be.vertexColors,Ze=new ds(Be.a+o,Be.b+o,Be.c+o);Ze.normal.copy(Be.normal),void 0!==r&&Ze.normal.applyMatrix3(r).normalize();for(var wt=0,st=Le.length;wt<st;wt++)we=Le[wt].clone(),void 0!==r&&we.applyMatrix3(r).normalize(),Ze.vertexNormals.push(we);Ze.color.copy(Be.color);for(var Ge=0,vt=tt.length;Ge<vt;Ge++)Ze.vertexColors.push(tt[Ge].clone());Ze.materialIndex=Be.materialIndex+n,S.push(Ze)}for(var Je=0,je=t.faceVertexUvs.length;Je<je;Je++){var At=t.faceVertexUvs[Je];void 0===this.faceVertexUvs[Je]&&(this.faceVertexUvs[Je]=[]);for(var Rt=0,tn=At.length;Rt<tn;Rt++){for(var en=At[Rt],Yt=[],Gt=0,yn=en.length;Gt<yn;Gt++)Yt.push(en[Gt].clone());this.faceVertexUvs[Je].push(Yt)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(t){void 0===t&&(t=4);for(var i={},n=[],r=[],o=Math.pow(10,t),l=0,b=this.vertices.length;l<b;l++){var S=this.vertices[l],L=Math.round(S.x*o)+"_"+Math.round(S.y*o)+"_"+Math.round(S.z*o);void 0===i[L]?(i[L]=l,n.push(this.vertices[l]),r[l]=n.length-1):r[l]=r[i[L]]}for(var G=[],U=0,F=this.faces.length;U<F;U++){var K=this.faces[U];K.a=r[K.a],K.b=r[K.b],K.c=r[K.c];for(var Q=[K.a,K.b,K.c],re=0;re<3;re++)if(Q[re]===Q[(re+1)%3]){G.push(U);break}}for(var ve=G.length-1;ve>=0;ve--){var oe=G[ve];this.faces.splice(oe,1);for(var Z=0,Te=this.faceVertexUvs.length;Z<Te;Z++)this.faceVertexUvs[Z].splice(oe,1)}var Be=this.vertices.length-n.length;return this.vertices=n,Be},setFromPoints:function(t){this.vertices=[];for(var i=0,n=t.length;i<n;i++){var r=t[i];this.vertices.push(new ke(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,i=t.length,n=0;n<i;n++)t[n]._id=n;t.sort(function r(U,F){return U.materialIndex-F.materialIndex});var b,S,o=this.faceVertexUvs[0],l=this.faceVertexUvs[1];o&&o.length===i&&(b=[]),l&&l.length===i&&(S=[]);for(var L=0;L<i;L++){var G=t[L]._id;b&&b.push(o[G]),S&&S.push(l[G])}b&&(this.faceVertexUvs[0]=b),S&&(this.faceVertexUvs[1]=S)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var i=this.parameters;for(var n in i)void 0!==i[n]&&(t[n]=i[n]);return t}for(var r=[],o=0;o<this.vertices.length;o++){var l=this.vertices[o];r.push(l.x,l.y,l.z)}for(var b=[],S=[],L={},G=[],U={},F=[],K={},Q=0;Q<this.faces.length;Q++){var re=this.faces[Q],Z=void 0!==this.faceVertexUvs[0][Q],Te=re.normal.length()>0,Be=re.vertexNormals.length>0,we=1!==re.color.r||1!==re.color.g||1!==re.color.b,Ae=re.vertexColors.length>0,Le=0;if(Le=st(Le,0,0),Le=st(Le,1,!0),Le=st(Le,2,!1),Le=st(Le,3,Z),Le=st(Le,4,Te),Le=st(Le,5,Be),Le=st(Le,6,we),Le=st(Le,7,Ae),b.push(Le),b.push(re.a,re.b,re.c),b.push(re.materialIndex),Z){var tt=this.faceVertexUvs[0][Q];b.push(Je(tt[0]),Je(tt[1]),Je(tt[2]))}if(Te&&b.push(Ge(re.normal)),Be){var Ze=re.vertexNormals;b.push(Ge(Ze[0]),Ge(Ze[1]),Ge(Ze[2]))}if(we&&b.push(vt(re.color)),Ae){var wt=re.vertexColors;b.push(vt(wt[0]),vt(wt[1]),vt(wt[2]))}}function st(je,At,Rt){return Rt?je|1<<At:je&~(1<<At)}function Ge(je){var At=je.x.toString()+je.y.toString()+je.z.toString();return void 0!==L[At]||(L[At]=S.length/3,S.push(je.x,je.y,je.z)),L[At]}function vt(je){var At=je.r.toString()+je.g.toString()+je.b.toString();return void 0!==U[At]||(U[At]=G.length,G.push(je.getHex())),U[At]}function Je(je){var At=je.x.toString()+je.y.toString();return void 0!==K[At]||(K[At]=F.length/2,F.push(je.x,je.y)),K[At]}return t.data={},t.data.vertices=r,t.data.normals=S,G.length>0&&(t.data.colors=G),F.length>0&&(t.data.uvs=[F]),t.data.faces=b,t},clone:function(){return(new Mi).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;for(var i=t.vertices,n=0,r=i.length;n<r;n++)this.vertices.push(i[n].clone());for(var o=t.colors,l=0,b=o.length;l<b;l++)this.colors.push(o[l].clone());for(var S=t.faces,L=0,G=S.length;L<G;L++)this.faces.push(S[L].clone());for(var U=0,F=t.faceVertexUvs.length;U<F;U++){var K=t.faceVertexUvs[U];void 0===this.faceVertexUvs[U]&&(this.faceVertexUvs[U]=[]);for(var Q=0,re=K.length;Q<re;Q++){for(var ve=K[Q],oe=[],Z=0,Te=ve.length;Z<Te;Z++)oe.push(ve[Z].clone());this.faceVertexUvs[U].push(oe)}}for(var we=t.morphTargets,Ae=0,Le=we.length;Ae<Le;Ae++){var tt={};if(tt.name=we[Ae].name,void 0!==we[Ae].vertices){tt.vertices=[];for(var Ze=0,wt=we[Ae].vertices.length;Ze<wt;Ze++)tt.vertices.push(we[Ae].vertices[Ze].clone())}if(void 0!==we[Ae].normals){tt.normals=[];for(var st=0,Ge=we[Ae].normals.length;st<Ge;st++)tt.normals.push(we[Ae].normals[st].clone())}this.morphTargets.push(tt)}for(var vt=t.morphNormals,Je=0,je=vt.length;Je<je;Je++){var At={};if(void 0!==vt[Je].vertexNormals){At.vertexNormals=[];for(var Rt=0,tn=vt[Je].vertexNormals.length;Rt<tn;Rt++){var en=vt[Je].vertexNormals[Rt],Yt={};Yt.a=en.a.clone(),Yt.b=en.b.clone(),Yt.c=en.c.clone(),At.vertexNormals.push(Yt)}}if(void 0!==vt[Je].faceNormals){At.faceNormals=[];for(var Gt=0,yn=vt[Je].faceNormals.length;Gt<yn;Gt++)At.faceNormals.push(vt[Je].faceNormals[Gt].clone())}this.morphNormals.push(At)}for(var Sn=t.skinWeights,er=0,Jt=Sn.length;er<Jt;er++)this.skinWeights.push(Sn[er].clone());for(var Nr=t.skinIndices,wr=0,Er=Nr.length;wr<Er;wr++)this.skinIndices.push(Nr[wr].clone());for(var Ln=t.lineDistances,Rr=0,yr=Ln.length;Rr<yr;Rr++)this.lineDistances.push(Ln[Rr]);var mi=t.boundingBox;null!==mi&&(this.boundingBox=mi.clone());var Gr=t.boundingSphere;return null!==Gr&&(this.boundingSphere=Gr.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Yh=function(a){function t(i,n,r,o,l,b){var S;return(S=a.call(this)||this).type="BoxGeometry",S.parameters={width:i,height:n,depth:r,widthSegments:o,heightSegments:l,depthSegments:b},S.fromBufferGeometry(new gr(i,n,r,o,l,b)),S.mergeVertices(),S}return Qn(t,a),t}(Mi),Kh=function(a){function t(i,n,r,o){var l;void 0===i&&(i=1),void 0===n&&(n=8),void 0===r&&(r=0),void 0===o&&(o=2*Math.PI),(l=a.call(this)||this).type="CircleBufferGeometry",l.parameters={radius:i,segments:n,thetaStart:r,thetaLength:o},n=Math.max(3,n);var b=[],S=[],L=[],G=[],U=new ke,F=new cn;S.push(0,0,0),L.push(0,0,1),G.push(.5,.5);for(var K=0,Q=3;K<=n;K++,Q+=3){var re=r+K/n*o;U.x=i*Math.cos(re),U.y=i*Math.sin(re),S.push(U.x,U.y,U.z),L.push(0,0,1),F.x=(S[Q]/i+1)/2,F.y=(S[Q+1]/i+1)/2,G.push(F.x,F.y)}for(var ve=1;ve<=n;ve++)b.push(ve,ve+1,0);return l.setIndex(b),l.setAttribute("position",new _n(S,3)),l.setAttribute("normal",new _n(L,3)),l.setAttribute("uv",new _n(G,2)),l}return Qn(t,a),t}(De),kf=function(a){function t(i,n,r,o){var l;return(l=a.call(this)||this).type="CircleGeometry",l.parameters={radius:i,segments:n,thetaStart:r,thetaLength:o},l.fromBufferGeometry(new Kh(i,n,r,o)),l.mergeVertices(),l}return Qn(t,a),t}(Mi),xc=function(a){function t(i,n,r,o,l,b,S,L){var G;void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=8),void 0===l&&(l=1),void 0===b&&(b=!1),void 0===S&&(S=0),void 0===L&&(L=2*Math.PI),(G=a.call(this)||this).type="CylinderBufferGeometry",G.parameters={radiusTop:i,radiusBottom:n,height:r,radialSegments:o,heightSegments:l,openEnded:b,thetaStart:S,thetaLength:L};var U=rs(G);o=Math.floor(o),l=Math.floor(l);var F=[],K=[],Q=[],re=[],ve=0,oe=[],Z=r/2,Te=0;function we(Ae){for(var Le=ve,tt=new cn,Ze=new ke,wt=0,st=!0===Ae?i:n,Ge=!0===Ae?1:-1,vt=1;vt<=o;vt++)K.push(0,Z*Ge,0),Q.push(0,Ge,0),re.push(.5,.5),ve++;for(var Je=ve,je=0;je<=o;je++){var Rt=je/o*L+S,tn=Math.cos(Rt),en=Math.sin(Rt);Ze.x=st*en,Ze.y=Z*Ge,Ze.z=st*tn,K.push(Ze.x,Ze.y,Ze.z),Q.push(0,Ge,0),tt.x=.5*tn+.5,tt.y=.5*en*Ge+.5,re.push(tt.x,tt.y),ve++}for(var Yt=0;Yt<o;Yt++){var Gt=Le+Yt,yn=Je+Yt;!0===Ae?F.push(yn,yn+1,Gt):F.push(yn+1,yn,Gt),wt+=3}U.addGroup(Te,wt,!0===Ae?1:2),Te+=wt}return function Be(){for(var Ae=new ke,Le=new ke,tt=0,Ze=(n-i)/r,wt=0;wt<=l;wt++){for(var st=[],Ge=wt/l,vt=Ge*(n-i)+i,Je=0;Je<=o;Je++){var je=Je/o,At=je*L+S,Rt=Math.sin(At),tn=Math.cos(At);Le.x=vt*Rt,Le.y=-Ge*r+Z,Le.z=vt*tn,K.push(Le.x,Le.y,Le.z),Ae.set(Rt,Ze,tn).normalize(),Q.push(Ae.x,Ae.y,Ae.z),re.push(je,1-Ge),st.push(ve++)}oe.push(st)}for(var en=0;en<o;en++)for(var Yt=0;Yt<l;Yt++){var yn=oe[Yt+1][en],Sn=oe[Yt+1][en+1],er=oe[Yt][en+1];F.push(oe[Yt][en],yn,er),F.push(yn,Sn,er),tt+=6}U.addGroup(Te,tt,0),Te+=tt}(),!1===b&&(i>0&&we(!0),n>0&&we(!1)),G.setIndex(F),G.setAttribute("position",new _n(K,3)),G.setAttribute("normal",new _n(Q,3)),G.setAttribute("uv",new _n(re,2)),G}return Qn(t,a),t}(De),Qh=function(a){function t(i,n,r,o,l,b,S,L){var G;return(G=a.call(this)||this).type="CylinderGeometry",G.parameters={radiusTop:i,radiusBottom:n,height:r,radialSegments:o,heightSegments:l,openEnded:b,thetaStart:S,thetaLength:L},G.fromBufferGeometry(new xc(i,n,r,o,l,b,S,L)),G.mergeVertices(),G}return Qn(t,a),t}(Mi),Hf=function(a){function t(i,n,r,o,l,b,S){var L;return(L=a.call(this,0,i,n,r,o,l,b,S)||this).type="ConeGeometry",L.parameters={radius:i,height:n,radialSegments:r,heightSegments:o,openEnded:l,thetaStart:b,thetaLength:S},L}return Qn(t,a),t}(Qh),Uf=function(a){function t(i,n,r,o,l,b,S){var L;return void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=8),void 0===o&&(o=1),void 0===l&&(l=!1),void 0===b&&(b=0),void 0===S&&(S=2*Math.PI),(L=a.call(this,0,i,n,r,o,l,b,S)||this).type="ConeBufferGeometry",L.parameters={radius:i,height:n,radialSegments:r,heightSegments:o,openEnded:l,thetaStart:b,thetaLength:S},L}return Qn(t,a),t}(xc),zs=function(a){function t(i,n,r,o){var l;void 0===r&&(r=1),void 0===o&&(o=0),(l=a.call(this)||this).type="PolyhedronBufferGeometry",l.parameters={vertices:i,indices:n,radius:r,detail:o};var b=[],S=[];function G(Be,we,Ae,Le){for(var tt=Le+1,Ze=[],wt=0;wt<=tt;wt++){Ze[wt]=[];for(var st=Be.clone().lerp(Ae,wt/tt),Ge=we.clone().lerp(Ae,wt/tt),vt=tt-wt,Je=0;Je<=vt;Je++)Ze[wt][Je]=0===Je&&wt===tt?st:st.clone().lerp(Ge,Je/vt)}for(var je=0;je<tt;je++)for(var At=0;At<2*(tt-je)-1;At++){var Rt=Math.floor(At/2);At%2==0?(Q(Ze[je][Rt+1]),Q(Ze[je+1][Rt]),Q(Ze[je][Rt])):(Q(Ze[je][Rt+1]),Q(Ze[je+1][Rt+1]),Q(Ze[je+1][Rt]))}}function Q(Be){b.push(Be.x,Be.y,Be.z)}function re(Be,we){var Ae=3*Be;we.x=i[Ae+0],we.y=i[Ae+1],we.z=i[Ae+2]}function oe(Be,we,Ae,Le){Le<0&&1===Be.x&&(S[we]=Be.x-1),0===Ae.x&&0===Ae.z&&(S[we]=Le/2/Math.PI+.5)}function Z(Be){return Math.atan2(Be.z,-Be.x)}function Te(Be){return Math.atan2(-Be.y,Math.sqrt(Be.x*Be.x+Be.z*Be.z))}return function L(Be){for(var we=new ke,Ae=new ke,Le=new ke,tt=0;tt<n.length;tt+=3)re(n[tt+0],we),re(n[tt+1],Ae),re(n[tt+2],Le),G(we,Ae,Le,Be)}(o),function U(Be){for(var we=new ke,Ae=0;Ae<b.length;Ae+=3)we.x=b[Ae+0],we.y=b[Ae+1],we.z=b[Ae+2],we.normalize().multiplyScalar(Be),b[Ae+0]=we.x,b[Ae+1]=we.y,b[Ae+2]=we.z}(r),function F(){for(var Be=new ke,we=0;we<b.length;we+=3){Be.x=b[we+0],Be.y=b[we+1],Be.z=b[we+2];var Ae=Z(Be)/2/Math.PI+.5,Le=Te(Be)/Math.PI+.5;S.push(Ae,1-Le)}(function ve(){for(var Be=new ke,we=new ke,Ae=new ke,Le=new ke,tt=new cn,Ze=new cn,wt=new cn,st=0,Ge=0;st<b.length;st+=9,Ge+=6){Be.set(b[st+0],b[st+1],b[st+2]),we.set(b[st+3],b[st+4],b[st+5]),Ae.set(b[st+6],b[st+7],b[st+8]),tt.set(S[Ge+0],S[Ge+1]),Ze.set(S[Ge+2],S[Ge+3]),wt.set(S[Ge+4],S[Ge+5]),Le.copy(Be).add(we).add(Ae).divideScalar(3);var vt=Z(Le);oe(tt,Ge+0,Be,vt),oe(Ze,Ge+2,we,vt),oe(wt,Ge+4,Ae,vt)}})(),function K(){for(var Be=0;Be<S.length;Be+=6){var we=S[Be+0],Ae=S[Be+2],Le=S[Be+4],tt=Math.max(we,Ae,Le),Ze=Math.min(we,Ae,Le);tt>.9&&Ze<.1&&(we<.2&&(S[Be+0]+=1),Ae<.2&&(S[Be+2]+=1),Le<.2&&(S[Be+4]+=1))}}()}(),l.setAttribute("position",new _n(b,3)),l.setAttribute("normal",new _n(b.slice(),3)),l.setAttribute("uv",new _n(S,2)),0===o?l.computeVertexNormals():l.normalizeNormals(),l}return Qn(t,a),t}(De),Zh=function(a){function t(i,n){var r;void 0===i&&(i=1),void 0===n&&(n=0);var o=(1+Math.sqrt(5))/2,l=1/o;return(r=a.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-l,-o,0,-l,o,0,l,-o,0,l,o,-l,-o,0,-l,o,0,l,-o,0,l,o,0,-o,0,-l,o,0,-l,-o,0,l,o,0,l],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],i,n)||this).type="DodecahedronBufferGeometry",r.parameters={radius:i,detail:n},r}return Qn(t,a),t}(zs),Gf=function(a){function t(i,n){var r;return(r=a.call(this)||this).type="DodecahedronGeometry",r.parameters={radius:i,detail:n},r.fromBufferGeometry(new Zh(i,n)),r.mergeVertices(),r}return Qn(t,a),t}(Mi),xu=new ke,Mu=new ke,Jh=new ke,Rl=new Ha,$h=function(a){function t(i,n){var r;(r=a.call(this)||this).type="EdgesGeometry",r.parameters={thresholdAngle:n},n=void 0!==n?n:1,i.isGeometry&&(i=(new De).fromGeometry(i));for(var l=Math.pow(10,4),b=Math.cos(pr.DEG2RAD*n),S=i.getIndex(),L=i.getAttribute("position"),G=S?S.count:L.count,U=[0,0,0],F=["a","b","c"],K=new Array(3),Q={},re=[],ve=0;ve<G;ve+=3){S?(U[0]=S.getX(ve),U[1]=S.getX(ve+1),U[2]=S.getX(ve+2)):(U[0]=ve,U[1]=ve+1,U[2]=ve+2);var oe=Rl.a,Z=Rl.b,Te=Rl.c;if(oe.fromBufferAttribute(L,U[0]),Z.fromBufferAttribute(L,U[1]),Te.fromBufferAttribute(L,U[2]),Rl.getNormal(Jh),K[0]=Math.round(oe.x*l)+","+Math.round(oe.y*l)+","+Math.round(oe.z*l),K[1]=Math.round(Z.x*l)+","+Math.round(Z.y*l)+","+Math.round(Z.z*l),K[2]=Math.round(Te.x*l)+","+Math.round(Te.y*l)+","+Math.round(Te.z*l),K[0]!==K[1]&&K[1]!==K[2]&&K[2]!==K[0])for(var Be=0;Be<3;Be++){var we=(Be+1)%3,Ae=K[Be],Le=K[we],tt=Rl[F[Be]],Ze=Rl[F[we]],wt=Ae+"_"+Le,st=Le+"_"+Ae;st in Q&&Q[st]?(Jh.dot(Q[st].normal)<=b&&(re.push(tt.x,tt.y,tt.z),re.push(Ze.x,Ze.y,Ze.z)),Q[st]=null):wt in Q||(Q[wt]={index0:U[Be],index1:U[we],normal:Jh.clone()})}}for(var Ge in Q)if(Q[Ge]){var vt=Q[Ge],je=vt.index1;xu.fromBufferAttribute(L,vt.index0),Mu.fromBufferAttribute(L,je),re.push(xu.x,xu.y,xu.z),re.push(Mu.x,Mu.y,Mu.z)}return r.setAttribute("position",new _n(re,3)),r}return Qn(t,a),t}(De);function zf(a,t,i,n,r){var o,l;if(r===function U0(a,t,i,n){for(var r=0,o=t,l=i-n;o<i;o+=n)r+=(a[l]-a[o])*(a[o+1]+a[l+1]),l=o;return r}(a,t,i,n)>0)for(o=t;o<i;o+=n)l=jf(o,a[o],a[o+1],l);else for(o=i-n;o>=t;o-=n)l=jf(o,a[o],a[o+1],l);return l&&Tu(l,l.next)&&(Sc(l),l=l.next),l}function xs(a,t){if(!a)return a;t||(t=a);var n,i=a;do{if(n=!1,i.steiner||!Tu(i,i.next)&&0!==zi(i.prev,i,i.next))i=i.next;else{if(Sc(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function Mc(a,t,i,n,r,o,l){if(a){!l&&o&&function O0(a,t,i,n){var r=a;do{null===r.z&&(r.z=ed(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==a);r.prevZ.nextZ=null,r.prevZ=null,function B0(a){var t,i,n,r,o,l,b,S,L=1;do{for(i=a,a=null,o=null,l=0;i;){for(l++,n=i,b=0,t=0;t<L&&(b++,n=n.nextZ);t++);for(S=L;b>0||S>0&&n;)0!==b&&(0===S||!n||i.z<=n.z)?(r=i,i=i.nextZ,b--):(r=n,n=n.nextZ,S--),o?o.nextZ=r:a=r,r.prevZ=o,o=r;i=n}o.nextZ=null,L*=2}while(l>1)}(r)}(a,n,r,o);for(var S,L,b=a;a.prev!==a.next;)if(S=a.prev,L=a.next,o?S0(a,n,r,o):T0(a))t.push(S.i/i),t.push(a.i/i),t.push(L.i/i),Sc(a),a=L.next,b=L.next;else if((a=L)===b){l?1===l?Mc(a=C0(xs(a),t,i),t,i,n,r,o,2):2===l&&_0(a,t,i,n,r,o):Mc(xs(a),t,i,n,r,o,1);break}}}function T0(a){var t=a.prev,i=a,n=a.next;if(zi(t,i,n)>=0)return!1;for(var r=a.next.next;r!==a.prev;){if(Ll(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&zi(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function S0(a,t,i,n){var r=a.prev,o=a,l=a.next;if(zi(r,o,l)>=0)return!1;for(var L=r.x>o.x?r.x>l.x?r.x:l.x:o.x>l.x?o.x:l.x,G=r.y>o.y?r.y>l.y?r.y:l.y:o.y>l.y?o.y:l.y,U=ed(r.x<o.x?r.x<l.x?r.x:l.x:o.x<l.x?o.x:l.x,r.y<o.y?r.y<l.y?r.y:l.y:o.y<l.y?o.y:l.y,t,i,n),F=ed(L,G,t,i,n),K=a.prevZ,Q=a.nextZ;K&&K.z>=U&&Q&&Q.z<=F;){if(K!==a.prev&&K!==a.next&&Ll(r.x,r.y,o.x,o.y,l.x,l.y,K.x,K.y)&&zi(K.prev,K,K.next)>=0||(K=K.prevZ,Q!==a.prev&&Q!==a.next&&Ll(r.x,r.y,o.x,o.y,l.x,l.y,Q.x,Q.y)&&zi(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;K&&K.z>=U;){if(K!==a.prev&&K!==a.next&&Ll(r.x,r.y,o.x,o.y,l.x,l.y,K.x,K.y)&&zi(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;Q&&Q.z<=F;){if(Q!==a.prev&&Q!==a.next&&Ll(r.x,r.y,o.x,o.y,l.x,l.y,Q.x,Q.y)&&zi(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function C0(a,t,i){var n=a;do{var r=n.prev,o=n.next.next;!Tu(r,o)&&Vf(r,n,n.next,o)&&Tc(r,o)&&Tc(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),Sc(n),Sc(n.next),n=a=o),n=n.next}while(n!==a);return xs(n)}function _0(a,t,i,n,r,o){var l=a;do{for(var b=l.next.next;b!==l.prev;){if(l.i!==b.i&&N0(l,b)){var S=Wf(l,b);return l=xs(l,l.next),S=xs(S,S.next),Mc(l,t,i,n,r,o),void Mc(S,t,i,n,r,o)}b=b.next}l=l.next}while(l!==a)}function L0(a,t){return a.x-t.x}function P0(a,t){if(t=function D0(a,t){var l,i=t,n=a.x,r=a.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var b=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(b<=n&&b>o){if(o=b,b===n){if(r===i.y)return i;if(r===i.next.y)return i.next}l=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!l)return null;if(n===o)return l;var F,S=l,L=l.x,G=l.y,U=1/0;i=l;do{n>=i.x&&i.x>=L&&n!==i.x&&Ll(r<G?n:o,r,L,G,r<G?o:n,r,i.x,i.y)&&(F=Math.abs(r-i.y)/(n-i.x),Tc(i,a)&&(F<U||F===U&&(i.x>l.x||i.x===l.x&&I0(l,i)))&&(l=i,U=F)),i=i.next}while(i!==S);return l}(a,t),t){var i=Wf(t,a);xs(t,t.next),xs(i,i.next)}}function I0(a,t){return zi(a.prev,a,t.prev)<0&&zi(t.next,a,a.next)<0}function ed(a,t,i,n,r){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-i)*r)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function F0(a){var t=a,i=a;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==a);return i}function Ll(a,t,i,n,r,o,l,b){return(r-l)*(t-b)-(a-l)*(o-b)>=0&&(a-l)*(n-b)-(i-l)*(t-b)>=0&&(i-l)*(o-b)-(r-l)*(n-b)>=0}function N0(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function k0(a,t){var i=a;do{if(i.i!==a.i&&i.next.i!==a.i&&i.i!==t.i&&i.next.i!==t.i&&Vf(i,i.next,a,t))return!0;i=i.next}while(i!==a);return!1}(a,t)&&(Tc(a,t)&&Tc(t,a)&&function H0(a,t){var i=a,n=!1,r=(a.x+t.x)/2,o=(a.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==a);return n}(a,t)&&(zi(a.prev,a,t.prev)||zi(a,t.prev,t))||Tu(a,t)&&zi(a.prev,a,a.next)>0&&zi(t.prev,t,t.next)>0)}function zi(a,t,i){return(t.y-a.y)*(i.x-t.x)-(t.x-a.x)*(i.y-t.y)}function Tu(a,t){return a.x===t.x&&a.y===t.y}function Vf(a,t,i,n){var r=Cu(zi(a,t,i)),o=Cu(zi(a,t,n)),l=Cu(zi(i,n,a)),b=Cu(zi(i,n,t));return!!(r!==o&&l!==b||0===r&&Su(a,i,t)||0===o&&Su(a,n,t)||0===l&&Su(i,a,n)||0===b&&Su(i,t,n))}function Su(a,t,i){return t.x<=Math.max(a.x,i.x)&&t.x>=Math.min(a.x,i.x)&&t.y<=Math.max(a.y,i.y)&&t.y>=Math.min(a.y,i.y)}function Cu(a){return a>0?1:a<0?-1:0}function Tc(a,t){return zi(a.prev,a,a.next)<0?zi(a,t,a.next)>=0&&zi(a,a.prev,t)>=0:zi(a,t,a.prev)<0||zi(a,a.next,t)<0}function Wf(a,t){var i=new td(a.i,a.x,a.y),n=new td(t.i,t.x,t.y),r=a.next,o=t.prev;return a.next=t,t.prev=a,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function jf(a,t,i,n){var r=new td(a,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Sc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function td(a,t,i){this.i=a,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Ko={area:function(t){for(var i=t.length,n=0,r=i-1,o=0;o<i;r=o++)n+=t[r].x*t[o].y-t[o].x*t[r].y;return.5*n},isClockWise:function(t){return Ko.area(t)<0},triangulateShape:function(t,i){var n=[],r=[],o=[];Xf(t),qf(n,t);var l=t.length;i.forEach(Xf);for(var b=0;b<i.length;b++)r.push(l),l+=i[b].length,qf(n,i[b]);for(var S=function(t,i,n){n=n||2;var S,L,G,U,F,K,Q,r=i&&i.length,o=r?i[0]*n:t.length,l=zf(t,0,o,n,!0),b=[];if(!l||l.next===l.prev)return b;if(r&&(l=function R0(a,t,i,n){var o,l,L,r=[];for(o=0,l=t.length;o<l;o++)(L=zf(a,t[o]*n,o<l-1?t[o+1]*n:a.length,n,!1))===L.next&&(L.steiner=!0),r.push(F0(L));for(r.sort(L0),o=0;o<r.length;o++)P0(r[o],i),i=xs(i,i.next);return i}(t,i,l,n)),t.length>80*n){S=G=t[0],L=U=t[1];for(var re=n;re<o;re+=n)(F=t[re])<S&&(S=F),(K=t[re+1])<L&&(L=K),F>G&&(G=F),K>U&&(U=K);Q=0!==(Q=Math.max(G-S,U-L))?1/Q:0}return Mc(l,b,n,S,L,Q),b}(n,r),L=0;L<S.length;L+=3)o.push(S.slice(L,L+3));return o}};function Xf(a){var t=a.length;t>2&&a[t-1].equals(a[0])&&a.pop()}function qf(a,t){for(var i=0;i<t.length;i++)a.push(t[i].x),a.push(t[i].y)}var Cc=function(a){function t(n,r){var o;(o=a.call(this)||this).type="ExtrudeBufferGeometry",o.parameters={shapes:n,options:r},n=Array.isArray(n)?n:[n];for(var l=rs(o),b=[],S=[],L=0,G=n.length;L<G;L++)F(n[L]);function F(K){var Q=[],re=void 0!==r.curveSegments?r.curveSegments:12,ve=void 0!==r.steps?r.steps:1,oe=void 0!==r.depth?r.depth:100,Z=void 0===r.bevelEnabled||r.bevelEnabled,Te=void 0!==r.bevelThickness?r.bevelThickness:6,Be=void 0!==r.bevelSize?r.bevelSize:Te-2,we=void 0!==r.bevelOffset?r.bevelOffset:0,Ae=void 0!==r.bevelSegments?r.bevelSegments:3,Le=r.extrudePath,tt=void 0!==r.UVGenerator?r.UVGenerator:G0;void 0!==r.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),oe=r.amount);var Ze,st,Ge,vt,Je,wt=!1;Le&&(Ze=Le.getSpacedPoints(ve),wt=!0,Z=!1,st=Le.computeFrenetFrames(ve,!1),Ge=new ke,vt=new ke,Je=new ke),Z||(Ae=0,Te=0,Be=0,we=0);var je=K.extractPoints(re),At=je.shape,Rt=je.holes;if(!Ko.isClockWise(At)){At=At.reverse();for(var en=0,Yt=Rt.length;en<Yt;en++){var Gt=Rt[en];Ko.isClockWise(Gt)&&(Rt[en]=Gt.reverse())}}for(var yn=Ko.triangulateShape(At,Rt),Sn=At,er=0,Jt=Rt.length;er<Jt;er++)At=At.concat(Rt[er]);function wr(ei,Dr,fi){return Dr||console.error("THREE.ExtrudeGeometry: vec does not exist"),Dr.clone().multiplyScalar(fi).add(ei)}var Er=At.length,Ln=yn.length;function Rr(ei,Dr,fi){var Wr,Zr,Bi,wa=ei.x-Dr.x,Ea=ei.y-Dr.y,La=fi.x-ei.x,Ya=fi.y-ei.y,ns=wa*wa+Ea*Ea;if(Math.abs(wa*Ya-Ea*La)>Number.EPSILON){var oh=Math.sqrt(ns),Yp=Math.sqrt(La*La+Ya*Ya),Kp=Dr.x-Ea/oh,Qp=Dr.y+wa/oh,Zp=((fi.x-Ya/Yp-Kp)*Ya-(fi.y+La/Yp-Qp)*La)/(wa*Ya-Ea*La),Jp=(Wr=Kp+wa*Zp-ei.x)*Wr+(Zr=Qp+Ea*Zp-ei.y)*Zr;if(Jp<=2)return new cn(Wr,Zr);Bi=Math.sqrt(Jp/2)}else{var sh=!1;wa>Number.EPSILON?La>Number.EPSILON&&(sh=!0):wa<-Number.EPSILON?La<-Number.EPSILON&&(sh=!0):Math.sign(Ea)===Math.sign(Ya)&&(sh=!0),sh?(Wr=-Ea,Zr=wa,Bi=Math.sqrt(ns)):(Wr=wa,Zr=Ea,Bi=Math.sqrt(ns/2))}return new cn(Wr/Bi,Zr/Bi)}for(var yr=[],mi=0,Gr=Sn.length,Ai=Gr-1,Pi=mi+1;mi<Gr;mi++,Ai++,Pi++)Ai===Gr&&(Ai=0),Pi===Gr&&(Pi=0),yr[mi]=Rr(Sn[mi],Sn[Ai],Sn[Pi]);for(var qi,$i=[],Ri=yr.concat(),lt=0,et=Rt.length;lt<et;lt++){var Dn=Rt[lt];qi=[];for(var wn=0,mr=Dn.length,xt=mr-1,Xn=wn+1;wn<mr;wn++,xt++,Xn++)xt===mr&&(xt=0),Xn===mr&&(Xn=0),qi[wn]=Rr(Dn[wn],Dn[xt],Dn[Xn]);$i.push(qi),Ri=Ri.concat(qi)}for(var Hn=0;Hn<Ae;Hn++){for(var lr=Hn/Ae,Gn=Te*Math.cos(lr*Math.PI/2),En=Be*Math.sin(lr*Math.PI/2)+we,Lr=0,Hr=Sn.length;Lr<Hr;Lr++){var Vi=wr(Sn[Lr],yr[Lr],En);ar(Vi.x,Vi.y,-Gn)}for(var Ti=0,si=Rt.length;Ti<si;Ti++){var gi=Rt[Ti];qi=$i[Ti];for(var Yi=0,Ul=gi.length;Yi<Ul;Yi++){var Rs=wr(gi[Yi],qi[Yi],En);ar(Rs.x,Rs.y,-Gn)}}}for(var wo=Be+we,es=0;es<Er;es++){var ko=Z?wr(At[es],Ri[es],wo):At[es];wt?(vt.copy(st.normals[0]).multiplyScalar(ko.x),Ge.copy(st.binormals[0]).multiplyScalar(ko.y),Je.copy(Ze[0]).add(vt).add(Ge),ar(Je.x,Je.y,Je.z)):ar(ko.x,ko.y,0)}for(var ts=1;ts<=ve;ts++)for(var Ls=0;Ls<Er;Ls++){var tl=Z?wr(At[Ls],Ri[Ls],wo):At[Ls];wt?(vt.copy(st.normals[ts]).multiplyScalar(tl.x),Ge.copy(st.binormals[ts]).multiplyScalar(tl.y),Je.copy(Ze[ts]).add(vt).add(Ge),ar(Je.x,Je.y,Je.z)):ar(tl.x,tl.y,oe/ve*ts)}for(var qa=Ae-1;qa>=0;qa--){for(var Fc=qa/Ae,Nc=Te*Math.cos(Fc*Math.PI/2),ah=Be*Math.sin(Fc*Math.PI/2)+we,Xe=0,qt=Sn.length;Xe<qt;Xe++){var Ot=wr(Sn[Xe],yr[Xe],ah);ar(Ot.x,Ot.y,oe+Nc)}for(var nn=0,Rn=Rt.length;nn<Rn;nn++){var Qr=Rt[nn];qi=$i[nn];for(var zr=0,yi=Qr.length;zr<yi;zr++){var Sr=wr(Qr[zr],qi[zr],ah);wt?ar(Sr.x,Sr.y+Ze[ve-1].y,Ze[ve-1].x+Nc):ar(Sr.x,Sr.y,oe+Nc)}}}function Qi(ei,Dr){for(var fi=ei.length;--fi>=0;){var Wr=fi,Zr=fi-1;Zr<0&&(Zr=ei.length-1);for(var Bi=0,wa=ve+2*Ae;Bi<wa;Bi++){var Ea=Er*Bi,La=Er*(Bi+1);ha(Dr+Wr+Ea,Dr+Zr+Ea,Dr+Zr+La,Dr+Wr+La)}}}function ar(ei,Dr,fi){Q.push(ei),Q.push(Dr),Q.push(fi)}function ua(ei,Dr,fi){di(ei),di(Dr),di(fi);var Wr=b.length/3,Zr=tt.generateTopUV(l,b,Wr-3,Wr-2,Wr-1);ea(Zr[0]),ea(Zr[1]),ea(Zr[2])}function ha(ei,Dr,fi,Wr){di(ei),di(Dr),di(Wr),di(Dr),di(fi),di(Wr);var Zr=b.length/3,Bi=tt.generateSideWallUV(l,b,Zr-6,Zr-3,Zr-2,Zr-1);ea(Bi[0]),ea(Bi[1]),ea(Bi[3]),ea(Bi[1]),ea(Bi[2]),ea(Bi[3])}function di(ei){b.push(Q[3*ei+0]),b.push(Q[3*ei+1]),b.push(Q[3*ei+2])}function ea(ei){S.push(ei.x),S.push(ei.y)}(function Ki(){var ei=b.length/3;if(Z){for(var Dr=0,fi=Er*Dr,Wr=0;Wr<Ln;Wr++){var Zr=yn[Wr];ua(Zr[2]+fi,Zr[1]+fi,Zr[0]+fi)}fi=Er*(Dr=ve+2*Ae);for(var Bi=0;Bi<Ln;Bi++){var wa=yn[Bi];ua(wa[0]+fi,wa[1]+fi,wa[2]+fi)}}else{for(var Ea=0;Ea<Ln;Ea++){var La=yn[Ea];ua(La[2],La[1],La[0])}for(var Ya=0;Ya<Ln;Ya++){var ns=yn[Ya];ua(ns[0]+Er*ve,ns[1]+Er*ve,ns[2]+Er*ve)}}l.addGroup(ei,b.length/3-ei,0)})(),function Ni(){var ei=b.length/3,Dr=0;Qi(Sn,Dr),Dr+=Sn.length;for(var fi=0,Wr=Rt.length;fi<Wr;fi++){var Zr=Rt[fi];Qi(Zr,Dr),Dr+=Zr.length}l.addGroup(ei,b.length/3-ei,1)}()}return o.setAttribute("position",new _n(b,3)),o.setAttribute("uv",new _n(S,2)),o.computeVertexNormals(),o}return Qn(t,a),t.prototype.toJSON=function(){var r=De.prototype.toJSON.call(this);return function z0(a,t,i){if(i.shapes=[],Array.isArray(a))for(var n=0,r=a.length;n<r;n++)i.shapes.push(a[n].uuid);else i.shapes.push(a.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,r)},t}(De),G0={generateTopUV:function(t,i,n,r,o){var S=i[3*r],L=i[3*r+1],G=i[3*o],U=i[3*o+1];return[new cn(i[3*n],i[3*n+1]),new cn(S,L),new cn(G,U)]},generateSideWallUV:function(t,i,n,r,o,l){var b=i[3*n],S=i[3*n+1],L=i[3*n+2],G=i[3*r],U=i[3*r+1],F=i[3*r+2],K=i[3*o],Q=i[3*o+1],re=i[3*o+2],ve=i[3*l],oe=i[3*l+1],Z=i[3*l+2];return Math.abs(S-U)<.01?[new cn(b,1-L),new cn(G,1-F),new cn(K,1-re),new cn(ve,1-Z)]:[new cn(S,1-L),new cn(U,1-F),new cn(Q,1-re),new cn(oe,1-Z)]}},nd=function(a){function t(n,r){var o;return(o=a.call(this)||this).type="ExtrudeGeometry",o.parameters={shapes:n,options:r},o.fromBufferGeometry(new Cc(n,r)),o.mergeVertices(),o}return Qn(t,a),t.prototype.toJSON=function(){var r=a.prototype.toJSON.call(this);return function V0(a,t,i){if(i.shapes=[],Array.isArray(a))for(var n=0,r=a.length;n<r;n++)i.shapes.push(a[n].uuid);else i.shapes.push(a.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,r)},t}(Mi),rd=function(a){function t(i,n){var r;void 0===i&&(i=1),void 0===n&&(n=0);var o=(1+Math.sqrt(5))/2;return(r=a.call(this,[-1,o,0,1,o,0,-1,-o,0,1,-o,0,0,-1,o,0,1,o,0,-1,-o,0,1,-o,o,0,-1,o,0,1,-o,0,-1,-o,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,n)||this).type="IcosahedronBufferGeometry",r.parameters={radius:i,detail:n},r}return Qn(t,a),t}(zs),Yf=function(a){function t(i,n){var r;return(r=a.call(this)||this).type="IcosahedronGeometry",r.parameters={radius:i,detail:n},r.fromBufferGeometry(new rd(i,n)),r.mergeVertices(),r}return Qn(t,a),t}(Mi),id=function(a){function t(i,n,r,o){var l;void 0===n&&(n=12),void 0===r&&(r=0),void 0===o&&(o=2*Math.PI),(l=a.call(this)||this).type="LatheBufferGeometry",l.parameters={points:i,segments:n,phiStart:r,phiLength:o},n=Math.floor(n),o=pr.clamp(o,0,2*Math.PI);for(var b=[],S=[],L=[],G=1/n,U=new ke,F=new cn,K=0;K<=n;K++)for(var Q=r+K*G*o,re=Math.sin(Q),ve=Math.cos(Q),oe=0;oe<=i.length-1;oe++)U.x=i[oe].x*re,U.y=i[oe].y,U.z=i[oe].x*ve,S.push(U.x,U.y,U.z),F.x=K/n,F.y=oe/(i.length-1),L.push(F.x,F.y);for(var Z=0;Z<n;Z++)for(var Te=0;Te<i.length-1;Te++){var Be=Te+Z*i.length,Ae=Be+i.length,Le=Be+i.length+1,tt=Be+1;b.push(Be,Ae,tt),b.push(Ae,Le,tt)}if(l.setIndex(b),l.setAttribute("position",new _n(S,3)),l.setAttribute("uv",new _n(L,2)),l.computeVertexNormals(),o===2*Math.PI)for(var Ze=l.attributes.normal.array,wt=new ke,st=new ke,Ge=new ke,vt=n*i.length*3,Je=0,je=0;Je<i.length;Je++,je+=3)wt.x=Ze[je+0],wt.y=Ze[je+1],wt.z=Ze[je+2],st.x=Ze[vt+je+0],st.y=Ze[vt+je+1],st.z=Ze[vt+je+2],Ge.addVectors(wt,st).normalize(),Ze[je+0]=Ze[vt+je+0]=Ge.x,Ze[je+1]=Ze[vt+je+1]=Ge.y,Ze[je+2]=Ze[vt+je+2]=Ge.z;return l}return Qn(t,a),t}(De),Kf=function(a){function t(i,n,r,o){var l;return(l=a.call(this)||this).type="LatheGeometry",l.parameters={points:i,segments:n,phiStart:r,phiLength:o},l.fromBufferGeometry(new id(i,n,r,o)),l.mergeVertices(),l}return Qn(t,a),t}(Mi),_u=function(a){function t(i,n){var r;return void 0===i&&(i=1),void 0===n&&(n=0),(r=a.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],i,n)||this).type="OctahedronBufferGeometry",r.parameters={radius:i,detail:n},r}return Qn(t,a),t}(zs),Qf=function(a){function t(i,n){var r;return(r=a.call(this)||this).type="OctahedronGeometry",r.parameters={radius:i,detail:n},r.fromBufferGeometry(new _u(i,n)),r.mergeVertices(),r}return Qn(t,a),t}(Mi);function Pl(a,t,i){De.call(this),this.type="ParametricBufferGeometry",this.parameters={func:a,slices:t,stacks:i};var n=[],r=[],o=[],l=[],b=1e-5,S=new ke,L=new ke,G=new ke,U=new ke,F=new ke;a.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var K=t+1,Q=0;Q<=i;Q++)for(var re=Q/i,ve=0;ve<=t;ve++){var oe=ve/t;a(oe,re,L),r.push(L.x,L.y,L.z),oe-b>=0?(a(oe-b,re,G),U.subVectors(L,G)):(a(oe+b,re,G),U.subVectors(G,L)),re-b>=0?(a(oe,re-b,G),F.subVectors(L,G)):(a(oe,re+b,G),F.subVectors(G,L)),S.crossVectors(U,F).normalize(),o.push(S.x,S.y,S.z),l.push(oe,re)}for(var Z=0;Z<i;Z++)for(var Te=0;Te<t;Te++){var we=Z*K+Te+1,Ae=(Z+1)*K+Te+1,Le=(Z+1)*K+Te;n.push(Z*K+Te,we,Le),n.push(we,Ae,Le)}this.setIndex(n),this.setAttribute("position",new _n(r,3)),this.setAttribute("normal",new _n(o,3)),this.setAttribute("uv",new _n(l,2))}function _c(a,t,i){Mi.call(this),this.type="ParametricGeometry",this.parameters={func:a,slices:t,stacks:i},this.fromBufferGeometry(new Pl(a,t,i)),this.mergeVertices()}(Pl.prototype=Object.create(De.prototype)).constructor=Pl,(_c.prototype=Object.create(Mi.prototype)).constructor=_c;var Zf=function(a){function t(i,n,r,o){var l;return(l=a.call(this)||this).type="PlaneGeometry",l.parameters={width:i,height:n,widthSegments:r,heightSegments:o},l.fromBufferGeometry(new ia(i,n,r,o)),l.mergeVertices(),l}return Qn(t,a),t}(Mi),Jf=function(a){function t(i,n,r,o){var l;return(l=a.call(this)||this).type="PolyhedronGeometry",l.parameters={vertices:i,indices:n,radius:r,detail:o},l.fromBufferGeometry(new zs(i,n,r,o)),l.mergeVertices(),l}return Qn(t,a),t}(Mi),ad=function(a){function t(i,n,r,o,l,b){var S;void 0===i&&(i=.5),void 0===n&&(n=1),void 0===r&&(r=8),void 0===o&&(o=1),void 0===l&&(l=0),void 0===b&&(b=2*Math.PI),(S=a.call(this)||this).type="RingBufferGeometry",S.parameters={innerRadius:i,outerRadius:n,thetaSegments:r,phiSegments:o,thetaStart:l,thetaLength:b},r=Math.max(3,r);for(var L=[],G=[],U=[],F=[],K=i,Q=(n-i)/(o=Math.max(1,o)),re=new ke,ve=new cn,oe=0;oe<=o;oe++){for(var Z=0;Z<=r;Z++){var Te=l+Z/r*b;re.x=K*Math.cos(Te),re.y=K*Math.sin(Te),G.push(re.x,re.y,re.z),U.push(0,0,1),ve.x=(re.x/n+1)/2,ve.y=(re.y/n+1)/2,F.push(ve.x,ve.y)}K+=Q}for(var Be=0;Be<o;Be++)for(var we=Be*(r+1),Ae=0;Ae<r;Ae++){var Le=Ae+we,Ze=Le+r+1,wt=Le+r+2,st=Le+1;L.push(Le,Ze,st),L.push(Ze,wt,st)}return S.setIndex(L),S.setAttribute("position",new _n(G,3)),S.setAttribute("normal",new _n(U,3)),S.setAttribute("uv",new _n(F,2)),S}return Qn(t,a),t}(De),$f=function(a){function t(i,n,r,o,l,b){var S;return(S=a.call(this)||this).type="RingGeometry",S.parameters={innerRadius:i,outerRadius:n,thetaSegments:r,phiSegments:o,thetaStart:l,thetaLength:b},S.fromBufferGeometry(new ad(i,n,r,o,l,b)),S.mergeVertices(),S}return Qn(t,a),t}(Mi),od=function(a){function t(n,r){var o;void 0===r&&(r=12),(o=a.call(this)||this).type="ShapeBufferGeometry",o.parameters={shapes:n,curveSegments:r};var l=[],b=[],S=[],L=[],G=0,U=0;if(!1===Array.isArray(n))K(n);else for(var F=0;F<n.length;F++)K(n[F]),o.addGroup(G,U,F),G+=U,U=0;function K(Q){var re=b.length/3,ve=Q.extractPoints(r),oe=ve.shape,Z=ve.holes;!1===Ko.isClockWise(oe)&&(oe=oe.reverse());for(var Te=0,Be=Z.length;Te<Be;Te++){var we=Z[Te];!0===Ko.isClockWise(we)&&(Z[Te]=we.reverse())}for(var Ae=Ko.triangulateShape(oe,Z),Le=0,tt=Z.length;Le<tt;Le++)oe=oe.concat(Z[Le]);for(var wt=0,st=oe.length;wt<st;wt++){var Ge=oe[wt];b.push(Ge.x,Ge.y,0),S.push(0,0,1),L.push(Ge.x,Ge.y)}for(var vt=0,Je=Ae.length;vt<Je;vt++){var je=Ae[vt];l.push(je[0]+re,je[1]+re,je[2]+re),U+=3}}return o.setIndex(l),o.setAttribute("position",new _n(b,3)),o.setAttribute("normal",new _n(S,3)),o.setAttribute("uv",new _n(L,2)),o}return Qn(t,a),t.prototype.toJSON=function(){var r=De.prototype.toJSON.call(this);return function W0(a,t){if(t.shapes=[],Array.isArray(a))for(var i=0,n=a.length;i<n;i++)t.shapes.push(a[i].uuid);else t.shapes.push(a.uuid);return t}(this.parameters.shapes,r)},t}(De),sd=function(a){function t(n,r){var o;return(o=a.call(this)||this).type="ShapeGeometry","object"==typeof r&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),r=r.curveSegments),o.parameters={shapes:n,curveSegments:r},o.fromBufferGeometry(new od(n,r)),o.mergeVertices(),o}return Qn(t,a),t.prototype.toJSON=function(){var r=Mi.prototype.toJSON.call(this);return function j0(a,t){if(t.shapes=[],Array.isArray(a))for(var i=0,n=a.length;i<n;i++)t.shapes.push(a[i].uuid);else t.shapes.push(a.uuid);return t}(this.parameters.shapes,r)},t}(Mi),Ru=function(a){function t(i,n,r,o,l,b,S){var L;void 0===i&&(i=1),void 0===n&&(n=8),void 0===r&&(r=6),void 0===o&&(o=0),void 0===l&&(l=2*Math.PI),void 0===b&&(b=0),void 0===S&&(S=Math.PI),(L=a.call(this)||this).type="SphereBufferGeometry",L.parameters={radius:i,widthSegments:n,heightSegments:r,phiStart:o,phiLength:l,thetaStart:b,thetaLength:S},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));for(var G=Math.min(b+S,Math.PI),U=0,F=[],K=new ke,Q=new ke,re=[],ve=[],oe=[],Z=[],Te=0;Te<=r;Te++){var Be=[],we=Te/r,Ae=0;0==Te&&0==b?Ae=.5/n:Te==r&&G==Math.PI&&(Ae=-.5/n);for(var Le=0;Le<=n;Le++){var tt=Le/n;K.x=-i*Math.cos(o+tt*l)*Math.sin(b+we*S),K.y=i*Math.cos(b+we*S),K.z=i*Math.sin(o+tt*l)*Math.sin(b+we*S),ve.push(K.x,K.y,K.z),Q.copy(K).normalize(),oe.push(Q.x,Q.y,Q.z),Z.push(tt+Ae,1-we),Be.push(U++)}F.push(Be)}for(var Ze=0;Ze<r;Ze++)for(var wt=0;wt<n;wt++){var Ge=F[Ze][wt],vt=F[Ze+1][wt],Je=F[Ze+1][wt+1];(0!==Ze||b>0)&&re.push(F[Ze][wt+1],Ge,Je),(Ze!==r-1||G<Math.PI)&&re.push(Ge,vt,Je)}return L.setIndex(re),L.setAttribute("position",new _n(ve,3)),L.setAttribute("normal",new _n(oe,3)),L.setAttribute("uv",new _n(Z,2)),L}return Qn(t,a),t}(De),ep=function(a){function t(i,n,r,o,l,b,S){var L;return(L=a.call(this)||this).type="SphereGeometry",L.parameters={radius:i,widthSegments:n,heightSegments:r,phiStart:o,phiLength:l,thetaStart:b,thetaLength:S},L.fromBufferGeometry(new Ru(i,n,r,o,l,b,S)),L.mergeVertices(),L}return Qn(t,a),t}(Mi),ld=function(a){function t(i,n){var r;return void 0===i&&(i=1),void 0===n&&(n=0),(r=a.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],i,n)||this).type="TetrahedronBufferGeometry",r.parameters={radius:i,detail:n},r}return Qn(t,a),t}(zs),tp=function(a){function t(i,n){var r;return(r=a.call(this)||this).type="TetrahedronGeometry",r.parameters={radius:i,detail:n},r.fromBufferGeometry(new ld(i,n)),r.mergeVertices(),r}return Qn(t,a),t}(Mi),cd=function(a){function t(i,n){var r;void 0===n&&(n={});var o=n.font;if(!o||!o.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new De||rs(r);var l=o.generateShapes(i,n.size);return n.depth=void 0!==n.height?n.height:50,void 0===n.bevelThickness&&(n.bevelThickness=10),void 0===n.bevelSize&&(n.bevelSize=8),void 0===n.bevelEnabled&&(n.bevelEnabled=!1),(r=a.call(this,l,n)||this).type="TextBufferGeometry",r}return Qn(t,a),t}(Cc),np=function(a){function t(i,n){var r;return(r=a.call(this)||this).type="TextGeometry",r.parameters={text:i,parameters:n},r.fromBufferGeometry(new cd(i,n)),r.mergeVertices(),r}return Qn(t,a),t}(Mi),ud=function(a){function t(i,n,r,o,l){var b;void 0===i&&(i=1),void 0===n&&(n=.4),void 0===r&&(r=8),void 0===o&&(o=6),void 0===l&&(l=2*Math.PI),(b=a.call(this)||this).type="TorusBufferGeometry",b.parameters={radius:i,tube:n,radialSegments:r,tubularSegments:o,arc:l},r=Math.floor(r),o=Math.floor(o);for(var S=[],L=[],G=[],U=[],F=new ke,K=new ke,Q=new ke,re=0;re<=r;re++)for(var ve=0;ve<=o;ve++){var oe=ve/o*l,Z=re/r*Math.PI*2;K.x=(i+n*Math.cos(Z))*Math.cos(oe),K.y=(i+n*Math.cos(Z))*Math.sin(oe),K.z=n*Math.sin(Z),L.push(K.x,K.y,K.z),F.x=i*Math.cos(oe),F.y=i*Math.sin(oe),Q.subVectors(K,F).normalize(),G.push(Q.x,Q.y,Q.z),U.push(ve/o),U.push(re/r)}for(var Te=1;Te<=r;Te++)for(var Be=1;Be<=o;Be++){var Ae=(o+1)*(Te-1)+Be-1,Le=(o+1)*(Te-1)+Be,tt=(o+1)*Te+Be;S.push((o+1)*Te+Be-1,Ae,tt),S.push(Ae,Le,tt)}return b.setIndex(S),b.setAttribute("position",new _n(L,3)),b.setAttribute("normal",new _n(G,3)),b.setAttribute("uv",new _n(U,2)),b}return Qn(t,a),t}(De),rp=function(a){function t(i,n,r,o,l){var b;return(b=a.call(this)||this).type="TorusGeometry",b.parameters={radius:i,tube:n,radialSegments:r,tubularSegments:o,arc:l},b.fromBufferGeometry(new ud(i,n,r,o,l)),b.mergeVertices(),b}return Qn(t,a),t}(Mi),hd=function(a){function t(i,n,r,o,l,b){var S;void 0===i&&(i=1),void 0===n&&(n=.4),void 0===r&&(r=64),void 0===o&&(o=8),void 0===l&&(l=2),void 0===b&&(b=3),(S=a.call(this)||this).type="TorusKnotBufferGeometry",S.parameters={radius:i,tube:n,tubularSegments:r,radialSegments:o,p:l,q:b},r=Math.floor(r),o=Math.floor(o);for(var L=[],G=[],U=[],F=[],K=new ke,Q=new ke,re=new ke,ve=new ke,oe=new ke,Z=new ke,Te=new ke,Be=0;Be<=r;++Be){var we=Be/r*l*Math.PI*2;At(we,l,b,i,re),At(we+.01,l,b,i,ve),Z.subVectors(ve,re),Te.addVectors(ve,re),oe.crossVectors(Z,Te),Te.crossVectors(oe,Z),oe.normalize(),Te.normalize();for(var Ae=0;Ae<=o;++Ae){var Le=Ae/o*Math.PI*2,tt=-n*Math.cos(Le),Ze=n*Math.sin(Le);K.x=re.x+(tt*Te.x+Ze*oe.x),K.y=re.y+(tt*Te.y+Ze*oe.y),K.z=re.z+(tt*Te.z+Ze*oe.z),G.push(K.x,K.y,K.z),Q.subVectors(K,re).normalize(),U.push(Q.x,Q.y,Q.z),F.push(Be/r),F.push(Ae/o)}}for(var wt=1;wt<=r;wt++)for(var st=1;st<=o;st++){var vt=(o+1)*wt+(st-1),Je=(o+1)*wt+st,je=(o+1)*(wt-1)+st;L.push((o+1)*(wt-1)+(st-1),vt,je),L.push(vt,Je,je)}function At(Rt,tn,en,Yt,Gt){var yn=Math.cos(Rt),Sn=Math.sin(Rt),er=en/tn*Rt,Jt=Math.cos(er);Gt.x=Yt*(2+Jt)*.5*yn,Gt.y=Yt*(2+Jt)*Sn*.5,Gt.z=Yt*Math.sin(er)*.5}return S.setIndex(L),S.setAttribute("position",new _n(G,3)),S.setAttribute("normal",new _n(U,3)),S.setAttribute("uv",new _n(F,2)),S}return Qn(t,a),t}(De),ip=function(a){function t(i,n,r,o,l,b,S){var L;return(L=a.call(this)||this).type="TorusKnotGeometry",L.parameters={radius:i,tube:n,tubularSegments:r,radialSegments:o,p:l,q:b},void 0!==S&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),L.fromBufferGeometry(new hd(i,n,r,o,l,b)),L.mergeVertices(),L}return Qn(t,a),t}(Mi),dd=function(a){function t(n,r,o,l,b){var S;void 0===r&&(r=64),void 0===o&&(o=1),void 0===l&&(l=8),void 0===b&&(b=!1),(S=a.call(this)||this).type="TubeBufferGeometry",S.parameters={path:n,tubularSegments:r,radius:o,radialSegments:l,closed:b};var L=n.computeFrenetFrames(r,b);S.tangents=L.tangents,S.normals=L.normals,S.binormals=L.binormals;var G=new ke,U=new ke,F=new cn,K=new ke,Q=[],re=[],ve=[],oe=[];function Te(Ae){K=n.getPointAt(Ae/r,K);for(var Le=L.normals[Ae],tt=L.binormals[Ae],Ze=0;Ze<=l;Ze++){var wt=Ze/l*Math.PI*2,st=Math.sin(wt),Ge=-Math.cos(wt);U.x=Ge*Le.x+st*tt.x,U.y=Ge*Le.y+st*tt.y,U.z=Ge*Le.z+st*tt.z,U.normalize(),re.push(U.x,U.y,U.z),G.x=K.x+o*U.x,G.y=K.y+o*U.y,G.z=K.z+o*U.z,Q.push(G.x,G.y,G.z)}}return function Z(){for(var Ae=0;Ae<r;Ae++)Te(Ae);Te(!1===b?r:0),function we(){for(var Ae=0;Ae<=r;Ae++)for(var Le=0;Le<=l;Le++)F.x=Ae/r,F.y=Le/l,ve.push(F.x,F.y)}(),function Be(){for(var Ae=1;Ae<=r;Ae++)for(var Le=1;Le<=l;Le++){var Ze=(l+1)*Ae+(Le-1),wt=(l+1)*Ae+Le,st=(l+1)*(Ae-1)+Le;oe.push((l+1)*(Ae-1)+(Le-1),Ze,st),oe.push(Ze,wt,st)}}()}(),S.setIndex(oe),S.setAttribute("position",new _n(Q,3)),S.setAttribute("normal",new _n(re,3)),S.setAttribute("uv",new _n(ve,2)),S}return Qn(t,a),t.prototype.toJSON=function(){var r=De.prototype.toJSON.call(this);return r.path=this.parameters.path.toJSON(),r},t}(De),ap=function(a){function t(i,n,r,o,l,b){var S;(S=a.call(this)||this).type="TubeGeometry",S.parameters={path:i,tubularSegments:n,radius:r,radialSegments:o,closed:l},void 0!==b&&console.warn("THREE.TubeGeometry: taper has been removed.");var L=new dd(i,n,r,o,l);return S.tangents=L.tangents,S.normals=L.normals,S.binormals=L.binormals,S.fromBufferGeometry(L),S.mergeVertices(),S}return Qn(t,a),t}(Mi),fd=function(a){function t(i){var n;(n=a.call(this)||this).type="WireframeGeometry";var r=[],o=[0,0],l={},b=["a","b","c"];if(i&&i.isGeometry){for(var S=i.faces,L=0,G=S.length;L<G;L++)for(var U=S[L],F=0;F<3;F++){var K=U[b[F]],Q=U[b[(F+1)%3]];o[0]=Math.min(K,Q),o[1]=Math.max(K,Q);var re=o[0]+","+o[1];void 0===l[re]&&(l[re]={index1:o[0],index2:o[1]})}for(var ve in l){var oe=l[ve],Z=i.vertices[oe.index1];r.push(Z.x,Z.y,Z.z),r.push((Z=i.vertices[oe.index2]).x,Z.y,Z.z)}}else if(i&&i.isBufferGeometry){var Te=new ke;if(null!==i.index){var Be=i.attributes.position,we=i.index,Ae=i.groups;0===Ae.length&&(Ae=[{start:0,count:we.count,materialIndex:0}]);for(var Le=0,tt=Ae.length;Le<tt;++Le)for(var Ze=Ae[Le],wt=Ze.start,Ge=wt,vt=wt+Ze.count;Ge<vt;Ge+=3)for(var Je=0;Je<3;Je++){var je=we.getX(Ge+Je),At=we.getX(Ge+(Je+1)%3);o[0]=Math.min(je,At),o[1]=Math.max(je,At);var Rt=o[0]+","+o[1];void 0===l[Rt]&&(l[Rt]={index1:o[0],index2:o[1]})}for(var tn in l){var en=l[tn];Te.fromBufferAttribute(Be,en.index1),r.push(Te.x,Te.y,Te.z),Te.fromBufferAttribute(Be,en.index2),r.push(Te.x,Te.y,Te.z)}}else for(var Yt=i.attributes.position,Gt=0,yn=Yt.count/3;Gt<yn;Gt++)for(var Sn=0;Sn<3;Sn++)Te.fromBufferAttribute(Yt,3*Gt+Sn),r.push(Te.x,Te.y,Te.z),Te.fromBufferAttribute(Yt,3*Gt+(Sn+1)%3),r.push(Te.x,Te.y,Te.z)}return n.setAttribute("position",new _n(r,3)),n}return Qn(t,a),t}(De),Ra=Object.freeze({__proto__:null,BoxGeometry:Yh,BoxBufferGeometry:gr,CircleGeometry:kf,CircleBufferGeometry:Kh,ConeGeometry:Hf,ConeBufferGeometry:Uf,CylinderGeometry:Qh,CylinderBufferGeometry:xc,DodecahedronGeometry:Gf,DodecahedronBufferGeometry:Zh,EdgesGeometry:$h,ExtrudeGeometry:nd,ExtrudeBufferGeometry:Cc,IcosahedronGeometry:Yf,IcosahedronBufferGeometry:rd,LatheGeometry:Kf,LatheBufferGeometry:id,OctahedronGeometry:Qf,OctahedronBufferGeometry:_u,ParametricGeometry:_c,ParametricBufferGeometry:Pl,PlaneGeometry:Zf,PlaneBufferGeometry:ia,PolyhedronGeometry:Jf,PolyhedronBufferGeometry:zs,RingGeometry:$f,RingBufferGeometry:ad,ShapeGeometry:sd,ShapeBufferGeometry:od,SphereGeometry:ep,SphereBufferGeometry:Ru,TetrahedronGeometry:tp,TetrahedronBufferGeometry:ld,TextGeometry:np,TextBufferGeometry:cd,TorusGeometry:rp,TorusBufferGeometry:ud,TorusKnotGeometry:ip,TorusKnotBufferGeometry:hd,TubeGeometry:ap,TubeBufferGeometry:dd,WireframeGeometry:fd});function Vs(a){fr.call(this),this.type="ShadowMaterial",this.color=new Fn(0),this.transparent=!0,this.setValues(a)}function Qo(a){Kr.call(this,a),this.type="RawShaderMaterial"}function Io(a){fr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Fn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(a)}function Ms(a){Io.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new cn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(i){this.reflectivity=pr.clamp(2.5*(i-1)/(i+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(a)}function Ts(a){fr.call(this),this.type="MeshPhongMaterial",this.color=new Fn(16777215),this.specular=new Fn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function Ws(a){fr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Fn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function js(a){fr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function Xs(a){fr.call(this),this.type="MeshLambertMaterial",this.color=new Fn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function qs(a){fr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Fn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new cn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function Ys(a){Fi.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}(Vs.prototype=Object.create(fr.prototype)).constructor=Vs,Vs.prototype.isShadowMaterial=!0,Vs.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this},(Qo.prototype=Object.create(Kr.prototype)).constructor=Qo,Qo.prototype.isRawShaderMaterial=!0,(Io.prototype=Object.create(fr.prototype)).constructor=Io,Io.prototype.isMeshStandardMaterial=!0,Io.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapIntensity=a.envMapIntensity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.vertexTangents=a.vertexTangents,this},(Ms.prototype=Object.create(Io.prototype)).constructor=Ms,Ms.prototype.isMeshPhysicalMaterial=!0,Ms.prototype.copy=function(a){return Io.prototype.copy.call(this,a),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.reflectivity=a.reflectivity,this.sheen=a.sheen?(this.sheen||new Fn).copy(a.sheen):null,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this},(Ts.prototype=Object.create(fr.prototype)).constructor=Ts,Ts.prototype.isMeshPhongMaterial=!0,Ts.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},(Ws.prototype=Object.create(fr.prototype)).constructor=Ws,Ws.prototype.isMeshToonMaterial=!0,Ws.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},(js.prototype=Object.create(fr.prototype)).constructor=js,js.prototype.isMeshNormalMaterial=!0,js.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},(Xs.prototype=Object.create(fr.prototype)).constructor=Xs,Xs.prototype.isMeshLambertMaterial=!0,Xs.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},(qs.prototype=Object.create(fr.prototype)).constructor=qs,qs.prototype.isMeshMatcapMaterial=!0,qs.prototype.copy=function(a){return fr.prototype.copy.call(this,a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},(Ys.prototype=Object.create(Fi.prototype)).constructor=Ys,Ys.prototype.isLineDashedMaterial=!0,Ys.prototype.copy=function(a){return Fi.prototype.copy.call(this,a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this};var X0=Object.freeze({__proto__:null,ShadowMaterial:Vs,SpriteMaterial:Es,RawShaderMaterial:Qo,ShaderMaterial:Kr,PointsMaterial:po,MeshPhysicalMaterial:Ms,MeshStandardMaterial:Io,MeshPhongMaterial:Ts,MeshToonMaterial:Ws,MeshNormalMaterial:js,MeshLambertMaterial:Xs,MeshDepthMaterial:As,MeshDistanceMaterial:bs,MeshBasicMaterial:Ui,MeshMatcapMaterial:qs,LineDashedMaterial:Ys,LineBasicMaterial:Fi,Material:fr}),Oi={arraySlice:function(t,i,n){return Oi.isTypedArray(t)?new t.constructor(t.subarray(i,void 0!==n?n:t.length)):t.slice(i,n)},convertArray:function(t,i,n){return!t||!n&&t.constructor===i?t:"number"==typeof i.BYTES_PER_ELEMENT?new i(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var n=t.length,r=new Array(n),o=0;o!==n;++o)r[o]=o;return r.sort(function i(l,b){return t[l]-t[b]}),r},sortedArray:function(t,i,n){for(var r=t.length,o=new t.constructor(r),l=0,b=0;b!==r;++l)for(var S=n[l]*i,L=0;L!==i;++L)o[b++]=t[S+L];return o},flattenJSON:function(t,i,n,r){for(var o=1,l=t[0];void 0!==l&&void 0===l[r];)l=t[o++];if(void 0!==l){var b=l[r];if(void 0!==b)if(Array.isArray(b))do{void 0!==(b=l[r])&&(i.push(l.time),n.push.apply(n,b)),l=t[o++]}while(void 0!==l);else if(void 0!==b.toArray)do{void 0!==(b=l[r])&&(i.push(l.time),b.toArray(n,n.length)),l=t[o++]}while(void 0!==l);else do{void 0!==(b=l[r])&&(i.push(l.time),n.push(b)),l=t[o++]}while(void 0!==l)}},subclip:function(t,i,n,r,o){void 0===o&&(o=30);var l=t.clone();l.name=i;for(var b=[],S=0;S<l.tracks.length;++S){for(var L=l.tracks[S],G=L.getValueSize(),U=[],F=[],K=0;K<L.times.length;++K){var Q=L.times[K]*o;if(!(Q<n||Q>=r)){U.push(L.times[K]);for(var re=0;re<G;++re)F.push(L.values[K*G+re])}}0!==U.length&&(L.times=Oi.convertArray(U,L.times.constructor),L.values=Oi.convertArray(F,L.values.constructor),b.push(L))}l.tracks=b;for(var ve=1/0,oe=0;oe<l.tracks.length;++oe)ve>l.tracks[oe].times[0]&&(ve=l.tracks[oe].times[0]);for(var Z=0;Z<l.tracks.length;++Z)l.tracks[Z].shift(-1*ve);return l.resetDuration(),l},makeClipAdditive:function(t,i,n,r){void 0===i&&(i=0),void 0===n&&(n=t),void 0===r&&(r=30),r<=0&&(r=30);for(var o=n.tracks.length,l=i/r,b=function(U){var F=n.tracks[U],K=F.ValueTypeName;if("bool"===K||"string"===K)return"continue";var Q=t.tracks.find(function(tn){return tn.name===F.name&&tn.ValueTypeName===K});if(void 0===Q)return"continue";var re=0,ve=F.getValueSize();F.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(re=ve/3);var oe=0,Z=Q.getValueSize();Q.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(oe=Z/3);var Te=F.times.length-1,Be=void 0;if(l<=F.times[0])Be=Oi.arraySlice(F.values,re,ve-re);else if(l>=F.times[Te]){var Le=Te*ve+re;Be=Oi.arraySlice(F.values,Le,Le+ve-re)}else{var Ze=F.createInterpolant(),wt=re,st=ve-re;Ze.evaluate(l),Be=Oi.arraySlice(Ze.resultBuffer,wt,st)}"quaternion"===K&&(new Zi).fromArray(Be).normalize().conjugate().toArray(Be);for(var vt=Q.times.length,Je=0;Je<vt;++Je){var je=Je*Z+oe;if("quaternion"===K)Zi.multiplyQuaternionsFlat(Q.values,je,Be,0,Q.values,je);else for(var At=Z-2*oe,Rt=0;Rt<At;++Rt)Q.values[je+Rt]-=Be[Rt]}},S=0;S<o;++S)b(S);return t.blendMode=2501,t}};function Wa(a,t,i,n){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function Lu(a,t,i,n){Wa.call(this,a,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Rc(a,t,i,n){Wa.call(this,a,t,i,n)}function Pu(a,t,i,n){Wa.call(this,a,t,i,n)}function va(a,t,i,n){if(void 0===a)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=Oi.convertArray(t,this.TimeBufferType),this.values=Oi.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function Du(a,t,i){va.call(this,a,t,i)}function Iu(a,t,i,n){va.call(this,a,t,i,n)}function Dl(a,t,i,n){va.call(this,a,t,i,n)}function Ou(a,t,i,n){Wa.call(this,a,t,i,n)}function Lc(a,t,i,n){va.call(this,a,t,i,n)}function Bu(a,t,i,n){va.call(this,a,t,i,n)}function Il(a,t,i,n){va.call(this,a,t,i,n)}function ja(a,t,i,n){this.name=a,this.tracks=i,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==n?n:2500,this.uuid=pr.generateUUID(),this.duration<0&&this.resetDuration()}function Y0(a){if(void 0===a.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function q0(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Dl;case"vector":case"vector2":case"vector3":case"vector4":return Il;case"color":return Iu;case"quaternion":return Lc;case"bool":case"boolean":return Du;case"string":return Bu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}(a.type);if(void 0===a.times){var i=[],n=[];Oi.flattenJSON(a.keys,i,n,"value"),a.times=i,a.values=n}return void 0!==t.parse?t.parse(a):new t(a.name,a.times,a.values,a.interpolation)}Object.assign(Wa.prototype,{evaluate:function(t){var i=this.parameterPositions,n=this._cachedIndex,r=i[n],o=i[n-1];e:{t:{var l;n:{r:if(!(t<r)){for(var b=n+2;;){if(void 0===r){if(t<o)break r;return this._cachedIndex=n=i.length,this.afterEnd_(n-1,t,o)}if(n===b)break;if(o=r,t<(r=i[++n]))break t}l=i.length;break n}if(t>=o)break e;var S=i[1];t<S&&(n=2,o=S);for(var L=n-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===L)break;if(r=o,t>=(o=i[--n-1]))break t}l=n,n=0}for(;n<l;){var G=n+l>>>1;t<i[G]?l=G:n=G+1}if(r=i[n],void 0===(o=i[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return this._cachedIndex=n=i.length,this.afterEnd_(n-1,o,t)}this._cachedIndex=n,this.intervalChanged_(n,o,r)}return this.interpolate_(n,o,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=t*r,l=0;l!==r;++l)i[l]=n[o+l];return i},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Wa.prototype,{beforeStart_:Wa.prototype.copySampleValue_,afterEnd_:Wa.prototype.copySampleValue_}),Lu.prototype=Object.assign(Object.create(Wa.prototype),{constructor:Lu,DefaultSettings_:{endingStart:Ma,endingEnd:Ma},intervalChanged_:function(t,i,n){var r=this.parameterPositions,o=t-2,l=t+1,b=r[o],S=r[l];if(void 0===b)switch(this.getSettings_().endingStart){case Ta:o=t,b=2*i-n;break;case Pa:b=i+r[o=r.length-2]-r[o+1];break;default:o=t,b=n}if(void 0===S)switch(this.getSettings_().endingEnd){case Ta:l=t,S=2*n-i;break;case Pa:l=1,S=n+r[1]-r[0];break;default:l=t-1,S=i}var L=.5*(n-i),G=this.valueSize;this._weightPrev=L/(i-b),this._weightNext=L/(S-n),this._offsetPrev=o*G,this._offsetNext=l*G},interpolate_:function(t,i,n,r){for(var o=this.resultBuffer,l=this.sampleValues,b=this.valueSize,S=t*b,L=S-b,G=this._offsetPrev,U=this._offsetNext,F=this._weightPrev,K=this._weightNext,Q=(n-i)/(r-i),re=Q*Q,ve=re*Q,oe=-F*ve+2*F*re-F*Q,Z=(1+F)*ve+(-1.5-2*F)*re+(-.5+F)*Q+1,Te=(-1-K)*ve+(1.5+K)*re+.5*Q,Be=K*ve-K*re,we=0;we!==b;++we)o[we]=oe*l[G+we]+Z*l[L+we]+Te*l[S+we]+Be*l[U+we];return o}}),Rc.prototype=Object.assign(Object.create(Wa.prototype),{constructor:Rc,interpolate_:function(t,i,n,r){for(var o=this.resultBuffer,l=this.sampleValues,b=this.valueSize,S=t*b,L=S-b,G=(n-i)/(r-i),U=1-G,F=0;F!==b;++F)o[F]=l[L+F]*U+l[S+F]*G;return o}}),Pu.prototype=Object.assign(Object.create(Wa.prototype),{constructor:Pu,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(va,{toJSON:function(t){var n,i=t.constructor;if(void 0!==i.toJSON)n=i.toJSON(t);else{n={name:t.name,times:Oi.convertArray(t.times,Array),values:Oi.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(n.interpolation=r)}return n.type=t.ValueTypeName,n}}),Object.assign(va.prototype,{constructor:va,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Fa,InterpolantFactoryMethodDiscrete:function(t){return new Pu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Rc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Lu(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var i;switch(t){case Ba:i=this.InterpolantFactoryMethodDiscrete;break;case Fa:i=this.InterpolantFactoryMethodLinear;break;case 2302:i=this.InterpolantFactoryMethodSmooth}if(void 0===i){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=i,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ba;case this.InterpolantFactoryMethodLinear:return Fa;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var i=this.times,n=0,r=i.length;n!==r;++n)i[n]+=t;return this},scale:function(t){if(1!==t)for(var i=this.times,n=0,r=i.length;n!==r;++n)i[n]*=t;return this},trim:function(t,i){for(var n=this.times,r=n.length,o=0,l=r-1;o!==r&&n[o]<t;)++o;for(;-1!==l&&n[l]>i;)--l;if(++l,0!==o||l!==r){o>=l&&(o=(l=Math.max(l,1))-1);var b=this.getValueSize();this.times=Oi.arraySlice(n,o,l),this.values=Oi.arraySlice(this.values,o*b,l*b)}return this},validate:function(){var t=!0,i=this.getValueSize();i-Math.floor(i)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,r=this.values,o=n.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var l=null,b=0;b!==o;b++){var S=n[b];if("number"==typeof S&&isNaN(S)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,b,S),t=!1;break}if(null!==l&&l>S){console.error("THREE.KeyframeTrack: Out of order keys.",this,b,S,l),t=!1;break}l=S}if(void 0!==r&&Oi.isTypedArray(r))for(var L=0,G=r.length;L!==G;++L){var U=r[L];if(isNaN(U)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,L,U),t=!1;break}}return t},optimize:function(){for(var t=Oi.arraySlice(this.times),i=Oi.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),o=t.length-1,l=1,b=1;b<o;++b){var S=!1,L=t[b];if(L!==t[b+1]&&(1!==b||L!==L[0]))if(r)S=!0;else for(var U=b*n,F=U-n,K=U+n,Q=0;Q!==n;++Q){var re=i[U+Q];if(re!==i[F+Q]||re!==i[K+Q]){S=!0;break}}if(S){if(b!==l){t[l]=t[b];for(var ve=b*n,oe=l*n,Z=0;Z!==n;++Z)i[oe+Z]=i[ve+Z]}++l}}if(o>0){t[l]=t[o];for(var Te=o*n,Be=l*n,we=0;we!==n;++we)i[Be+we]=i[Te+we];++l}return l!==t.length?(this.times=Oi.arraySlice(t,0,l),this.values=Oi.arraySlice(i,0,l*n)):(this.times=t,this.values=i),this},clone:function(){var t=Oi.arraySlice(this.times,0),i=Oi.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,i);return r.createInterpolant=this.createInterpolant,r}}),Du.prototype=Object.assign(Object.create(va.prototype),{constructor:Du,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Ba,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Iu.prototype=Object.assign(Object.create(va.prototype),{constructor:Iu,ValueTypeName:"color"}),Dl.prototype=Object.assign(Object.create(va.prototype),{constructor:Dl,ValueTypeName:"number"}),Ou.prototype=Object.assign(Object.create(Wa.prototype),{constructor:Ou,interpolate_:function(t,i,n,r){for(var o=this.resultBuffer,l=this.sampleValues,b=this.valueSize,S=(n-i)/(r-i),L=t*b,G=L+b;L!==G;L+=4)Zi.slerpFlat(o,0,l,L-b,l,L,S);return o}}),Lc.prototype=Object.assign(Object.create(va.prototype),{constructor:Lc,ValueTypeName:"quaternion",DefaultInterpolation:Fa,InterpolantFactoryMethodLinear:function(t){return new Ou(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Bu.prototype=Object.assign(Object.create(va.prototype),{constructor:Bu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Ba,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Il.prototype=Object.assign(Object.create(va.prototype),{constructor:Il,ValueTypeName:"vector"}),Object.assign(ja,{parse:function(t){for(var i=[],n=t.tracks,r=1/(t.fps||1),o=0,l=n.length;o!==l;++o)i.push(Y0(n[o]).scale(r));var b=new ja(t.name,t.duration,i,t.blendMode);return b.uuid=t.uuid,b},toJSON:function(t){for(var i=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode},o=0,l=n.length;o!==l;++o)i.push(va.toJSON(n[o]));return r},CreateFromMorphTargetSequence:function(t,i,n,r){for(var o=i.length,l=[],b=0;b<o;b++){var S=[],L=[];S.push((b+o-1)%o,b,(b+1)%o),L.push(0,1,0);var G=Oi.getKeyframeOrder(S);S=Oi.sortedArray(S,1,G),L=Oi.sortedArray(L,1,G),!r&&0===S[0]&&(S.push(o),L.push(L[0])),l.push(new Dl(".morphTargetInfluences["+i[b].name+"]",S,L).scale(1/n))}return new ja(t,-1,l)},findByName:function(t,i){var n=t;Array.isArray(t)||(n=t.geometry&&t.geometry.animations||t.animations);for(var o=0;o<n.length;o++)if(n[o].name===i)return n[o];return null},CreateClipsFromMorphTargetSequences:function(t,i,n){for(var r={},o=/^([\w-]*?)([\d]+)$/,l=0,b=t.length;l<b;l++){var S=t[l],L=S.name.match(o);if(L&&L.length>1){var G=L[1],U=r[G];U||(r[G]=U=[]),U.push(S)}}var F=[];for(var K in r)F.push(ja.CreateFromMorphTargetSequence(K,r[K],i,n));return F},parseAnimation:function(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(Le,tt,Ze,wt,st){if(0!==Ze.length){var Ge=[],vt=[];Oi.flattenJSON(Ze,Ge,vt,wt),0!==Ge.length&&st.push(new Le(tt,Ge,vt))}},r=[],o=t.name||"default",l=t.fps||30,b=t.blendMode,S=t.length||-1,L=t.hierarchy||[],G=0;G<L.length;G++){var U=L[G].keys;if(U&&0!==U.length)if(U[0].morphTargets){var F={},K=void 0;for(K=0;K<U.length;K++)if(U[K].morphTargets)for(var Q=0;Q<U[K].morphTargets.length;Q++)F[U[K].morphTargets[Q]]=-1;for(var re in F){for(var ve=[],oe=[],Z=0;Z!==U[K].morphTargets.length;++Z){var Te=U[K];ve.push(Te.time),oe.push(Te.morphTarget===re?1:0)}r.push(new Dl(".morphTargetInfluence["+re+"]",ve,oe))}S=F.length*(l||1)}else{var Be=".bones["+i[G].name+"]";n(Il,Be+".position",U,"pos",r),n(Lc,Be+".quaternion",U,"rot",r),n(Il,Be+".scale",U,"scl",r)}}return 0===r.length?null:new ja(o,S,r,b)}}),Object.assign(ja.prototype,{resetDuration:function(){for(var i=0,n=0,r=this.tracks.length;n!==r;++n){var o=this.tracks[n];i=Math.max(i,o.times[o.times.length-1])}return this.duration=i,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new ja(this.name,this.duration,t,this.blendMode)},toJSON:function(){return ja.toJSON(this)}});var Ks={enabled:!1,files:{},add:function(t,i){!1!==this.enabled&&(this.files[t]=i)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function pd(a,t,i){var n=this,r=!1,o=0,l=0,b=void 0,S=[];this.onStart=void 0,this.onLoad=a,this.onProgress=t,this.onError=i,this.itemStart=function(L){l++,!1===r&&void 0!==n.onStart&&n.onStart(L,o,l),r=!0},this.itemEnd=function(L){o++,void 0!==n.onProgress&&n.onProgress(L,o,l),o===l&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(L){void 0!==n.onError&&n.onError(L)},this.resolveURL=function(L){return b?b(L):L},this.setURLModifier=function(L){return b=L,this},this.addHandler=function(L,G){return S.push(L,G),this},this.removeHandler=function(L){var G=S.indexOf(L);return-1!==G&&S.splice(G,2),this},this.getHandler=function(L){for(var G=0,U=S.length;G<U;G+=2){var F=S[G],K=S[G+1];if(F.global&&(F.lastIndex=0),F.test(L))return K}return null}}var op=new pd;function Ei(a){this.manager=void 0!==a?a:op,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Ei.prototype,{load:function(){},loadAsync:function(t,i){var n=this;return new Promise(function(r,o){n.load(t,r,i,o)})},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});var vo={};function to(a){Ei.call(this,a)}function vd(a){Ei.call(this,a)}function md(a){Ei.call(this,a)}function Ol(a){Ei.call(this,a)}function Fu(a){Ei.call(this,a)}function Nu(a){Ei.call(this,a)}function ku(a){Ei.call(this,a)}function sr(){this.type="Curve",this.arcLengthDivisions=200}function Xa(a,t,i,n,r,o,l,b){sr.call(this),this.type="EllipseCurve",this.aX=a||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=l||!1,this.aRotation=b||0}function Bl(a,t,i,n,r,o){Xa.call(this,a,t,i,i,n,r,o),this.type="ArcCurve"}function gd(){var a=0,t=0,i=0,n=0;function r(o,l,b,S){a=o,t=b,i=-3*o+3*l-2*b-S,n=2*o-2*l+b+S}return{initCatmullRom:function(l,b,S,L,G){r(b,S,G*(S-l),G*(L-b))},initNonuniformCatmullRom:function(l,b,S,L,G,U,F){var K=(b-l)/G-(S-l)/(G+U)+(S-b)/U,Q=(S-b)/U-(L-b)/(U+F)+(L-S)/F;r(b,S,K*=U,Q*=U)},calc:function(l){var b=l*l;return a+t*l+i*b+n*(b*l)}}}to.prototype=Object.assign(Object.create(Ei.prototype),{constructor:to,load:function(t,i,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var o=this,l=Ks.get(t);if(void 0!==l)return o.manager.itemStart(t),setTimeout(function(){i&&i(l),o.manager.itemEnd(t)},0),l;if(void 0===vo[t]){var L,S=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(S){var G=S[1],U=!!S[2],F=S[3];F=decodeURIComponent(F),U&&(F=atob(F));try{var K,Q=(this.responseType||"").toLowerCase();switch(Q){case"arraybuffer":case"blob":for(var re=new Uint8Array(F.length),ve=0;ve<F.length;ve++)re[ve]=F.charCodeAt(ve);K="blob"===Q?new Blob([re.buffer],{type:G}):re.buffer;break;case"document":var oe=new DOMParser;K=oe.parseFromString(F,G);break;case"json":K=JSON.parse(F);break;default:K=F}setTimeout(function(){i&&i(K),o.manager.itemEnd(t)},0)}catch(Te){setTimeout(function(){r&&r(Te),o.manager.itemError(t),o.manager.itemEnd(t)},0)}}else{for(var Z in vo[t]=[],vo[t].push({onLoad:i,onProgress:n,onError:r}),(L=new XMLHttpRequest).open("GET",t,!0),L.addEventListener("load",function(Te){var Be=this.response,we=vo[t];if(delete vo[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Ks.add(t,Be);for(var Ae=0,Le=we.length;Ae<Le;Ae++){var tt=we[Ae];tt.onLoad&&tt.onLoad(Be)}o.manager.itemEnd(t)}else{for(var Ze=0,wt=we.length;Ze<wt;Ze++){var st=we[Ze];st.onError&&st.onError(Te)}o.manager.itemError(t),o.manager.itemEnd(t)}},!1),L.addEventListener("progress",function(Te){for(var Be=vo[t],we=0,Ae=Be.length;we<Ae;we++){var Le=Be[we];Le.onProgress&&Le.onProgress(Te)}},!1),L.addEventListener("error",function(Te){var Be=vo[t];delete vo[t];for(var we=0,Ae=Be.length;we<Ae;we++){var Le=Be[we];Le.onError&&Le.onError(Te)}o.manager.itemError(t),o.manager.itemEnd(t)},!1),L.addEventListener("abort",function(Te){var Be=vo[t];delete vo[t];for(var we=0,Ae=Be.length;we<Ae;we++){var Le=Be[we];Le.onError&&Le.onError(Te)}o.manager.itemError(t),o.manager.itemEnd(t)},!1),void 0!==this.responseType&&(L.responseType=this.responseType),void 0!==this.withCredentials&&(L.withCredentials=this.withCredentials),L.overrideMimeType&&L.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)L.setRequestHeader(Z,this.requestHeader[Z]);L.send(null)}return o.manager.itemStart(t),L}vo[t].push({onLoad:i,onProgress:n,onError:r})},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),vd.prototype=Object.assign(Object.create(Ei.prototype),{constructor:vd,load:function(t,i,n,r){var o=this,l=new to(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(t,function(b){try{i(o.parse(JSON.parse(b)))}catch(S){r?r(S):console.error(S),o.manager.itemError(t)}},n,r)},parse:function(t){for(var i=[],n=0;n<t.length;n++){var r=ja.parse(t[n]);i.push(r)}return i}}),md.prototype=Object.assign(Object.create(Ei.prototype),{constructor:md,load:function(t,i,n,r){var o=this,l=[],b=new _l;b.image=l;var S=new to(this.manager);S.setPath(this.path),S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setWithCredentials(o.withCredentials);var L=0;function G(K){S.load(t[K],function(Q){var re=o.parse(Q,!0);l[K]={width:re.width,height:re.height,format:re.format,mipmaps:re.mipmaps},6===(L+=1)&&(1===re.mipmapCount&&(b.minFilter=We),b.format=re.format,b.needsUpdate=!0,i&&i(b))},n,r)}if(Array.isArray(t))for(var U=0,F=t.length;U<F;++U)G(U);else S.load(t,function(K){var Q=o.parse(K,!0);if(Q.isCubemap)for(var re=Q.mipmaps.length/Q.mipmapCount,ve=0;ve<re;ve++){l[ve]={mipmaps:[]};for(var oe=0;oe<Q.mipmapCount;oe++)l[ve].mipmaps.push(Q.mipmaps[ve*Q.mipmapCount+oe]),l[ve].format=Q.format,l[ve].width=Q.width,l[ve].height=Q.height}else b.image.width=Q.width,b.image.height=Q.height,b.mipmaps=Q.mipmaps;1===Q.mipmapCount&&(b.minFilter=We),b.format=Q.format,b.needsUpdate=!0,i&&i(b)},n,r);return b}}),Ol.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Ol,load:function(t,i,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var o=this,l=Ks.get(t);if(void 0!==l)return o.manager.itemStart(t),setTimeout(function(){i&&i(l),o.manager.itemEnd(t)},0),l;var b=document.createElementNS("http://www.w3.org/1999/xhtml","img");function S(){b.removeEventListener("load",S,!1),b.removeEventListener("error",L,!1),Ks.add(t,this),i&&i(this),o.manager.itemEnd(t)}function L(G){b.removeEventListener("load",S,!1),b.removeEventListener("error",L,!1),r&&r(G),o.manager.itemError(t),o.manager.itemEnd(t)}return b.addEventListener("load",S,!1),b.addEventListener("error",L,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(b.crossOrigin=this.crossOrigin),o.manager.itemStart(t),b.src=t,b}}),Fu.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Fu,load:function(t,i,n,r){var o=new ai,l=new Ol(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);var b=0;function S(G){l.load(t[G],function(U){o.images[G]=U,6==++b&&(o.needsUpdate=!0,i&&i(o))},void 0,r)}for(var L=0;L<t.length;++L)S(L);return o}}),Nu.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Nu,load:function(t,i,n,r){var o=this,l=new Gi,b=new to(this.manager);return b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(o.withCredentials),b.load(t,function(S){var L=o.parse(S);L&&(void 0!==L.image?l.image=L.image:void 0!==L.data&&(l.image.width=L.width,l.image.height=L.height,l.image.data=L.data),l.wrapS=void 0!==L.wrapS?L.wrapS:ot,l.wrapT=void 0!==L.wrapT?L.wrapT:ot,l.magFilter=void 0!==L.magFilter?L.magFilter:We,l.minFilter=void 0!==L.minFilter?L.minFilter:We,l.anisotropy=void 0!==L.anisotropy?L.anisotropy:1,void 0!==L.format&&(l.format=L.format),void 0!==L.type&&(l.type=L.type),void 0!==L.mipmaps&&(l.mipmaps=L.mipmaps,l.minFilter=Ht),1===L.mipmapCount&&(l.minFilter=We),l.needsUpdate=!0,i&&i(l,L))},n,r),l}}),ku.prototype=Object.assign(Object.create(Ei.prototype),{constructor:ku,load:function(t,i,n,r){var o=new vi,l=new Ol(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(t,function(b){o.image=b;var S=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);o.format=S?ti:Pr,o.needsUpdate=!0,void 0!==i&&i(o)},n,r),o}}),Object.assign(sr.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,i){var n=this.getUtoTmapping(t);return this.getPoint(n,i)},getPoints:function(t){void 0===t&&(t=5);for(var i=[],n=0;n<=t;n++)i.push(this.getPoint(n/t));return i},getSpacedPoints:function(t){void 0===t&&(t=5);for(var i=[],n=0;n<=t;n++)i.push(this.getPointAt(n/t));return i},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var n,i=[],r=this.getPoint(0),o=0;i.push(0);for(var l=1;l<=t;l++)o+=(n=this.getPoint(l/t)).distanceTo(r),i.push(o),r=n;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,i){var l,n=this.getLengths(),r=0,o=n.length;l=i||t*n[o-1];for(var L,b=0,S=o-1;b<=S;)if((L=n[r=Math.floor(b+(S-b)/2)]-l)<0)b=r+1;else{if(!(L>0)){S=r;break}S=r-1}if(n[r=S]===l)return r/(o-1);var G=n[r];return(r+(l-G)/(n[r+1]-G))/(o-1)},getTangent:function(t,i){var n=1e-4,r=t-n,o=t+n;r<0&&(r=0),o>1&&(o=1);var l=this.getPoint(r),b=this.getPoint(o),S=i||(l.isVector2?new cn:new ke);return S.copy(b).sub(l).normalize(),S},getTangentAt:function(t,i){var n=this.getUtoTmapping(t);return this.getTangent(n,i)},computeFrenetFrames:function(t,i){for(var n=new ke,r=[],o=[],l=[],b=new ke,S=new br,L=0;L<=t;L++)r[L]=this.getTangentAt(L/t,new ke),r[L].normalize();o[0]=new ke,l[0]=new ke;var U=Number.MAX_VALUE,F=Math.abs(r[0].x),K=Math.abs(r[0].y),Q=Math.abs(r[0].z);F<=U&&(U=F,n.set(1,0,0)),K<=U&&(U=K,n.set(0,1,0)),Q<=U&&n.set(0,0,1),b.crossVectors(r[0],n).normalize(),o[0].crossVectors(r[0],b),l[0].crossVectors(r[0],o[0]);for(var re=1;re<=t;re++){if(o[re]=o[re-1].clone(),l[re]=l[re-1].clone(),b.crossVectors(r[re-1],r[re]),b.length()>Number.EPSILON){b.normalize();var ve=Math.acos(pr.clamp(r[re-1].dot(r[re]),-1,1));o[re].applyMatrix4(S.makeRotationAxis(b,ve))}l[re].crossVectors(r[re],o[re])}if(!0===i){var oe=Math.acos(pr.clamp(o[0].dot(o[t]),-1,1));oe/=t,r[0].dot(b.crossVectors(o[0],o[t]))>0&&(oe=-oe);for(var Z=1;Z<=t;Z++)o[Z].applyMatrix4(S.makeRotationAxis(r[Z],oe*Z)),l[Z].crossVectors(r[Z],o[Z])}return{tangents:r,normals:o,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),(Xa.prototype=Object.create(sr.prototype)).constructor=Xa,Xa.prototype.isEllipseCurve=!0,Xa.prototype.getPoint=function(a,t){for(var i=t||new cn,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=o?0:n),!0===this.aClockwise&&!o&&(r===n?r=-n:r-=n);var l=this.aStartAngle+a*r,b=this.aX+this.xRadius*Math.cos(l),S=this.aY+this.yRadius*Math.sin(l);if(0!==this.aRotation){var L=Math.cos(this.aRotation),G=Math.sin(this.aRotation),U=b-this.aX,F=S-this.aY;b=U*L-F*G+this.aX,S=U*G+F*L+this.aY}return i.set(b,S)},Xa.prototype.copy=function(a){return sr.prototype.copy.call(this,a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this},Xa.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a},Xa.prototype.fromJSON=function(a){return sr.prototype.fromJSON.call(this,a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this},(Bl.prototype=Object.create(Xa.prototype)).constructor=Bl,Bl.prototype.isArcCurve=!0;var Hu=new ke,yd=new gd,Ad=new gd,bd=new gd;function Aa(a,t,i,n){void 0===a&&(a=[]),void 0===t&&(t=!1),void 0===i&&(i="centripetal"),void 0===n&&(n=.5),sr.call(this),this.type="CatmullRomCurve3",this.points=a,this.closed=t,this.curveType=i,this.tension=n}function sp(a,t,i,n,r){var o=.5*(n-t),l=.5*(r-i),b=a*a;return(2*i-2*n+o+l)*(a*b)+(-3*i+3*n-2*o-l)*b+o*a+i}function Pc(a,t,i,n){return function K0(a,t){var i=1-a;return i*i*t}(a,t)+function Q0(a,t){return 2*(1-a)*a*t}(a,i)+function Z0(a,t){return a*a*t}(a,n)}function Dc(a,t,i,n,r){return function J0(a,t){var i=1-a;return i*i*i*t}(a,t)+function $0(a,t){var i=1-a;return 3*i*i*a*t}(a,i)+function ey(a,t){return 3*(1-a)*a*a*t}(a,n)+function ty(a,t){return a*a*a*t}(a,r)}function mo(a,t,i,n){void 0===a&&(a=new cn),void 0===t&&(t=new cn),void 0===i&&(i=new cn),void 0===n&&(n=new cn),sr.call(this),this.type="CubicBezierCurve",this.v0=a,this.v1=t,this.v2=i,this.v3=n}function Oo(a,t,i,n){void 0===a&&(a=new ke),void 0===t&&(t=new ke),void 0===i&&(i=new ke),void 0===n&&(n=new ke),sr.call(this),this.type="CubicBezierCurve3",this.v0=a,this.v1=t,this.v2=i,this.v3=n}function Ia(a,t){void 0===a&&(a=new cn),void 0===t&&(t=new cn),sr.call(this),this.type="LineCurve",this.v1=a,this.v2=t}function go(a,t){void 0===a&&(a=new ke),void 0===t&&(t=new ke),sr.call(this),this.type="LineCurve3",this.v1=a,this.v2=t}function yo(a,t,i){void 0===a&&(a=new cn),void 0===t&&(t=new cn),void 0===i&&(i=new cn),sr.call(this),this.type="QuadraticBezierCurve",this.v0=a,this.v1=t,this.v2=i}function Bo(a,t,i){void 0===a&&(a=new ke),void 0===t&&(t=new ke),void 0===i&&(i=new ke),sr.call(this),this.type="QuadraticBezierCurve3",this.v0=a,this.v1=t,this.v2=i}function Ao(a){void 0===a&&(a=[]),sr.call(this),this.type="SplineCurve",this.points=a}(Aa.prototype=Object.create(sr.prototype)).constructor=Aa,Aa.prototype.isCatmullRomCurve3=!0,Aa.prototype.getPoint=function(a,t){void 0===t&&(t=new ke);var S,L,i=t,n=this.points,r=n.length,o=(r-(this.closed?0:1))*a,l=Math.floor(o),b=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===b&&l===r-1&&(l=r-2,b=1),this.closed||l>0?S=n[(l-1)%r]:(Hu.subVectors(n[0],n[1]).add(n[0]),S=Hu);var G=n[l%r],U=n[(l+1)%r];if(this.closed||l+2<r?L=n[(l+2)%r]:(Hu.subVectors(n[r-1],n[r-2]).add(n[r-1]),L=Hu),"centripetal"===this.curveType||"chordal"===this.curveType){var F="chordal"===this.curveType?.5:.25,K=Math.pow(S.distanceToSquared(G),F),Q=Math.pow(G.distanceToSquared(U),F),re=Math.pow(U.distanceToSquared(L),F);Q<1e-4&&(Q=1),K<1e-4&&(K=Q),re<1e-4&&(re=Q),yd.initNonuniformCatmullRom(S.x,G.x,U.x,L.x,K,Q,re),Ad.initNonuniformCatmullRom(S.y,G.y,U.y,L.y,K,Q,re),bd.initNonuniformCatmullRom(S.z,G.z,U.z,L.z,K,Q,re)}else"catmullrom"===this.curveType&&(yd.initCatmullRom(S.x,G.x,U.x,L.x,this.tension),Ad.initCatmullRom(S.y,G.y,U.y,L.y,this.tension),bd.initCatmullRom(S.z,G.z,U.z,L.z,this.tension));return i.set(yd.calc(b),Ad.calc(b),bd.calc(b)),i},Aa.prototype.copy=function(a){sr.prototype.copy.call(this,a),this.points=[];for(var t=0,i=a.points.length;t<i;t++)this.points.push(a.points[t].clone());return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this},Aa.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);a.points=[];for(var t=0,i=this.points.length;t<i;t++)a.points.push(this.points[t].toArray());return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a},Aa.prototype.fromJSON=function(a){sr.prototype.fromJSON.call(this,a),this.points=[];for(var t=0,i=a.points.length;t<i;t++){var n=a.points[t];this.points.push((new ke).fromArray(n))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this},(mo.prototype=Object.create(sr.prototype)).constructor=mo,mo.prototype.isCubicBezierCurve=!0,mo.prototype.getPoint=function(a,t){void 0===t&&(t=new cn);var i=t,n=this.v0,r=this.v1,o=this.v2,l=this.v3;return i.set(Dc(a,n.x,r.x,o.x,l.x),Dc(a,n.y,r.y,o.y,l.y)),i},mo.prototype.copy=function(a){return sr.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this},mo.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a},mo.prototype.fromJSON=function(a){return sr.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this},(Oo.prototype=Object.create(sr.prototype)).constructor=Oo,Oo.prototype.isCubicBezierCurve3=!0,Oo.prototype.getPoint=function(a,t){void 0===t&&(t=new ke);var i=t,n=this.v0,r=this.v1,o=this.v2,l=this.v3;return i.set(Dc(a,n.x,r.x,o.x,l.x),Dc(a,n.y,r.y,o.y,l.y),Dc(a,n.z,r.z,o.z,l.z)),i},Oo.prototype.copy=function(a){return sr.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this},Oo.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a},Oo.prototype.fromJSON=function(a){return sr.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this},(Ia.prototype=Object.create(sr.prototype)).constructor=Ia,Ia.prototype.isLineCurve=!0,Ia.prototype.getPoint=function(a,t){void 0===t&&(t=new cn);var i=t;return 1===a?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(a).add(this.v1)),i},Ia.prototype.getPointAt=function(a,t){return this.getPoint(a,t)},Ia.prototype.getTangent=function(a,t){var i=t||new cn;return i.copy(this.v2).sub(this.v1).normalize(),i},Ia.prototype.copy=function(a){return sr.prototype.copy.call(this,a),this.v1.copy(a.v1),this.v2.copy(a.v2),this},Ia.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},Ia.prototype.fromJSON=function(a){return sr.prototype.fromJSON.call(this,a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},(go.prototype=Object.create(sr.prototype)).constructor=go,go.prototype.isLineCurve3=!0,go.prototype.getPoint=function(a,t){void 0===t&&(t=new ke);var i=t;return 1===a?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(a).add(this.v1)),i},go.prototype.getPointAt=function(a,t){return this.getPoint(a,t)},go.prototype.copy=function(a){return sr.prototype.copy.call(this,a),this.v1.copy(a.v1),this.v2.copy(a.v2),this},go.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},go.prototype.fromJSON=function(a){return sr.prototype.fromJSON.call(this,a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},(yo.prototype=Object.create(sr.prototype)).constructor=yo,yo.prototype.isQuadraticBezierCurve=!0,yo.prototype.getPoint=function(a,t){void 0===t&&(t=new cn);var i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(Pc(a,n.x,r.x,o.x),Pc(a,n.y,r.y,o.y)),i},yo.prototype.copy=function(a){return sr.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this},yo.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},yo.prototype.fromJSON=function(a){return sr.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},(Bo.prototype=Object.create(sr.prototype)).constructor=Bo,Bo.prototype.isQuadraticBezierCurve3=!0,Bo.prototype.getPoint=function(a,t){void 0===t&&(t=new ke);var i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(Pc(a,n.x,r.x,o.x),Pc(a,n.y,r.y,o.y),Pc(a,n.z,r.z,o.z)),i},Bo.prototype.copy=function(a){return sr.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this},Bo.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},Bo.prototype.fromJSON=function(a){return sr.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},(Ao.prototype=Object.create(sr.prototype)).constructor=Ao,Ao.prototype.isSplineCurve=!0,Ao.prototype.getPoint=function(a,t){void 0===t&&(t=new cn);var i=t,n=this.points,r=(n.length-1)*a,o=Math.floor(r),l=r-o,b=n[0===o?o:o-1],S=n[o],L=n[o>n.length-2?n.length-1:o+1],G=n[o>n.length-3?n.length-1:o+2];return i.set(sp(l,b.x,S.x,L.x,G.x),sp(l,b.y,S.y,L.y,G.y)),i},Ao.prototype.copy=function(a){sr.prototype.copy.call(this,a),this.points=[];for(var t=0,i=a.points.length;t<i;t++)this.points.push(a.points[t].clone());return this},Ao.prototype.toJSON=function(){var a=sr.prototype.toJSON.call(this);a.points=[];for(var t=0,i=this.points.length;t<i;t++)a.points.push(this.points[t].toArray());return a},Ao.prototype.fromJSON=function(a){sr.prototype.fromJSON.call(this,a),this.points=[];for(var t=0,i=a.points.length;t<i;t++){var n=a.points[t];this.points.push((new cn).fromArray(n))}return this};var wd=Object.freeze({__proto__:null,ArcCurve:Bl,CatmullRomCurve3:Aa,CubicBezierCurve:mo,CubicBezierCurve3:Oo,EllipseCurve:Xa,LineCurve:Ia,LineCurve3:go,QuadraticBezierCurve:yo,QuadraticBezierCurve3:Bo,SplineCurve:Ao});function Zo(){sr.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function bo(a){Zo.call(this),this.type="Path",this.currentPoint=new cn,a&&this.setFromPoints(a)}function Ss(a){bo.call(this,a),this.uuid=pr.generateUUID(),this.type="Shape",this.holes=[]}function Li(a,t){void 0===t&&(t=1),Kn.call(this),this.type="Light",this.color=new Fn(a),this.intensity=t}function Uu(a,t,i){Li.call(this,a,i),this.type="HemisphereLight",this.position.copy(Kn.DefaultUp),this.updateMatrix(),this.groundColor=new Fn(t)}function Jo(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new cn(512,512),this.map=null,this.mapPass=null,this.matrix=new br,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new wi,this._frameExtents=new cn(1,1),this._viewportCount=1,this._viewports=[new ui(0,0,1,1)]}function Ed(){Jo.call(this,new dr(50,1,.5,500)),this.focus=1}function Gu(a,t,i,n,r,o){Li.call(this,a,t),this.type="SpotLight",this.position.copy(Kn.DefaultUp),this.updateMatrix(),this.target=new Kn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(b){this.intensity=b/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new Ed}function xd(){Jo.call(this,new dr(90,1,.5,500)),this._frameExtents=new cn(4,2),this._viewportCount=6,this._viewports=[new ui(2,1,1,1),new ui(0,1,1,1),new ui(3,1,1,1),new ui(1,1,1,1),new ui(3,0,1,1),new ui(1,0,1,1)],this._cubeDirections=[new ke(1,0,0),new ke(-1,0,0),new ke(0,0,1),new ke(0,0,-1),new ke(0,1,0),new ke(0,-1,0)],this._cubeUps=[new ke(0,1,0),new ke(0,1,0),new ke(0,1,0),new ke(0,1,0),new ke(0,0,1),new ke(0,0,-1)]}function zu(a,t,i,n){Li.call(this,a,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(o){this.intensity=o/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new xd}function Fl(a,t,i,n,r,o){xi.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==a?a:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Md(){Jo.call(this,new Fl(-5,5,5,-5,.5,500))}function Vu(a,t){Li.call(this,a,t),this.type="DirectionalLight",this.position.copy(Kn.DefaultUp),this.updateMatrix(),this.target=new Kn,this.shadow=new Md}function Wu(a,t){Li.call(this,a,t),this.type="AmbientLight"}function ju(a,t,i,n){Li.call(this,a,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}Zo.prototype=Object.assign(Object.create(sr.prototype),{constructor:Zo,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);t.equals(i)||this.curves.push(new Ia(i,t))},getPoint:function(t){for(var i=t*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=i){var o=n[r]-i,l=this.curves[r],b=l.getLength();return l.getPointAt(0===b?0:1-o/b)}r++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],i=0,n=0,r=this.curves.length;n<r;n++)i+=this.curves[n].getLength(),t.push(i);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var i=[],n=0;n<=t;n++)i.push(this.getPoint(n/t));return this.autoClose&&i.push(i[0]),i},getPoints:function(t){void 0===t&&(t=12);for(var n,i=[],r=0,o=this.curves;r<o.length;r++)for(var l=o[r],S=l.getPoints(l&&l.isEllipseCurve?2*t:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?t*l.points.length:t),L=0;L<S.length;L++){var G=S[L];n&&n.equals(G)||(i.push(G),n=G)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(t){sr.prototype.copy.call(this,t),this.curves=[];for(var i=0,n=t.curves.length;i<n;i++)this.curves.push(t.curves[i].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=sr.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var i=0,n=this.curves.length;i<n;i++)t.curves.push(this.curves[i].toJSON());return t},fromJSON:function(t){sr.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var i=0,n=t.curves.length;i<n;i++){var r=t.curves[i];this.curves.push((new wd[r.type]).fromJSON(r))}return this}}),bo.prototype=Object.assign(Object.create(Zo.prototype),{constructor:bo,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var i=1,n=t.length;i<n;i++)this.lineTo(t[i].x,t[i].y);return this},moveTo:function(t,i){return this.currentPoint.set(t,i),this},lineTo:function(t,i){var n=new Ia(this.currentPoint.clone(),new cn(t,i));return this.curves.push(n),this.currentPoint.set(t,i),this},quadraticCurveTo:function(t,i,n,r){var o=new yo(this.currentPoint.clone(),new cn(t,i),new cn(n,r));return this.curves.push(o),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,i,n,r,o,l){var b=new mo(this.currentPoint.clone(),new cn(t,i),new cn(n,r),new cn(o,l));return this.curves.push(b),this.currentPoint.set(o,l),this},splineThru:function(t){var n=new Ao([this.currentPoint.clone()].concat(t));return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,i,n,r,o,l){return this.absarc(t+this.currentPoint.x,i+this.currentPoint.y,n,r,o,l),this},absarc:function(t,i,n,r,o,l){return this.absellipse(t,i,n,n,r,o,l),this},ellipse:function(t,i,n,r,o,l,b,S){return this.absellipse(t+this.currentPoint.x,i+this.currentPoint.y,n,r,o,l,b,S),this},absellipse:function(t,i,n,r,o,l,b,S){var L=new Xa(t,i,n,r,o,l,b,S);if(this.curves.length>0){var G=L.getPoint(0);G.equals(this.currentPoint)||this.lineTo(G.x,G.y)}this.curves.push(L);var U=L.getPoint(1);return this.currentPoint.copy(U),this},copy:function(t){return Zo.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=Zo.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Zo.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Ss.prototype=Object.assign(Object.create(bo.prototype),{constructor:Ss,getPointsHoles:function(t){for(var i=[],n=0,r=this.holes.length;n<r;n++)i[n]=this.holes[n].getPoints(t);return i},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){bo.prototype.copy.call(this,t),this.holes=[];for(var i=0,n=t.holes.length;i<n;i++)this.holes.push(t.holes[i].clone());return this},toJSON:function(){var t=bo.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var i=0,n=this.holes.length;i<n;i++)t.holes.push(this.holes[i].toJSON());return t},fromJSON:function(t){bo.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var i=0,n=t.holes.length;i<n;i++){var r=t.holes[i];this.holes.push((new bo).fromJSON(r))}return this}}),Li.prototype=Object.assign(Object.create(Kn.prototype),{constructor:Li,isLight:!0,copy:function(t){return Kn.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var i=Kn.prototype.toJSON.call(this,t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,void 0!==this.groundColor&&(i.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(i.object.distance=this.distance),void 0!==this.angle&&(i.object.angle=this.angle),void 0!==this.decay&&(i.object.decay=this.decay),void 0!==this.penumbra&&(i.object.penumbra=this.penumbra),void 0!==this.shadow&&(i.object.shadow=this.shadow.toJSON()),i}}),Uu.prototype=Object.assign(Object.create(Li.prototype),{constructor:Uu,isHemisphereLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Jo.prototype,{_projScreenMatrix:new br,_lightPositionWorld:new ke,_lookTarget:new ke,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var i=this.camera,n=this.matrix,r=this._projScreenMatrix,o=this._lookTarget,l=this._lightPositionWorld;l.setFromMatrixPosition(t.matrixWorld),i.position.copy(l),o.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(o),i.updateMatrixWorld(),r.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(i.projectionMatrix),n.multiply(i.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Ed.prototype=Object.assign(Object.create(Jo.prototype),{constructor:Ed,isSpotLightShadow:!0,updateMatrices:function(t){var i=this.camera,n=2*pr.RAD2DEG*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=t.distance||i.far;(n!==i.fov||r!==i.aspect||o!==i.far)&&(i.fov=n,i.aspect=r,i.far=o,i.updateProjectionMatrix()),Jo.prototype.updateMatrices.call(this,t)}}),Gu.prototype=Object.assign(Object.create(Li.prototype),{constructor:Gu,isSpotLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),xd.prototype=Object.assign(Object.create(Jo.prototype),{constructor:xd,isPointLightShadow:!0,updateMatrices:function(t,i){void 0===i&&(i=0);var n=this.camera,r=this.matrix,o=this._lightPositionWorld,l=this._lookTarget,b=this._projScreenMatrix;o.setFromMatrixPosition(t.matrixWorld),n.position.copy(o),l.copy(n.position),l.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(l),n.updateMatrixWorld(),r.makeTranslation(-o.x,-o.y,-o.z),b.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(b)}}),zu.prototype=Object.assign(Object.create(Li.prototype),{constructor:zu,isPointLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Fl.prototype=Object.assign(Object.create(xi.prototype),{constructor:Fl,isOrthographicCamera:!0,copy:function(t,i){return xi.prototype.copy.call(this,t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,i,n,r,o,l){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,o=n-t,l=n+t,b=r+i,S=r-i;if(null!==this.view&&this.view.enabled){var L=(this.right-this.left)/this.view.fullWidth/this.zoom,G=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l=(o+=L*this.view.offsetX)+L*this.view.width,S=(b-=G*this.view.offsetY)-G*this.view.height}this.projectionMatrix.makeOrthographic(o,l,b,S,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){var i=Kn.prototype.toJSON.call(this,t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,null!==this.view&&(i.object.view=Object.assign({},this.view)),i}}),Md.prototype=Object.assign(Object.create(Jo.prototype),{constructor:Md,isDirectionalLightShadow:!0,updateMatrices:function(t){Jo.prototype.updateMatrices.call(this,t)}}),Vu.prototype=Object.assign(Object.create(Li.prototype),{constructor:Vu,isDirectionalLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Wu.prototype=Object.assign(Object.create(Li.prototype),{constructor:Wu,isAmbientLight:!0}),ju.prototype=Object.assign(Object.create(Li.prototype),{constructor:ju,isRectAreaLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var i=Li.prototype.toJSON.call(this,t);return i.object.width=this.width,i.object.height=this.height,i}});var lp=function(){function a(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var i=0;i<9;i++)this.coefficients.push(new ke)}var t=a.prototype;return t.set=function(n){for(var r=0;r<9;r++)this.coefficients[r].copy(n[r]);return this},t.zero=function(){for(var n=0;n<9;n++)this.coefficients[n].set(0,0,0);return this},t.getAt=function(n,r){var o=n.x,l=n.y,b=n.z,S=this.coefficients;return r.copy(S[0]).multiplyScalar(.282095),r.addScaledVector(S[1],.488603*l),r.addScaledVector(S[2],.488603*b),r.addScaledVector(S[3],.488603*o),r.addScaledVector(S[4],o*l*1.092548),r.addScaledVector(S[5],l*b*1.092548),r.addScaledVector(S[6],.315392*(3*b*b-1)),r.addScaledVector(S[7],o*b*1.092548),r.addScaledVector(S[8],.546274*(o*o-l*l)),r},t.getIrradianceAt=function(n,r){var o=n.x,l=n.y,b=n.z,S=this.coefficients;return r.copy(S[0]).multiplyScalar(.886227),r.addScaledVector(S[1],1.023328*l),r.addScaledVector(S[2],1.023328*b),r.addScaledVector(S[3],1.023328*o),r.addScaledVector(S[4],.858086*o*l),r.addScaledVector(S[5],.858086*l*b),r.addScaledVector(S[6],.743125*b*b-.247708),r.addScaledVector(S[7],.858086*o*b),r.addScaledVector(S[8],.429043*(o*o-l*l)),r},t.add=function(n){for(var r=0;r<9;r++)this.coefficients[r].add(n.coefficients[r]);return this},t.addScaledSH=function(n,r){for(var o=0;o<9;o++)this.coefficients[o].addScaledVector(n.coefficients[o],r);return this},t.scale=function(n){for(var r=0;r<9;r++)this.coefficients[r].multiplyScalar(n);return this},t.lerp=function(n,r){for(var o=0;o<9;o++)this.coefficients[o].lerp(n.coefficients[o],r);return this},t.equals=function(n){for(var r=0;r<9;r++)if(!this.coefficients[r].equals(n.coefficients[r]))return!1;return!0},t.copy=function(n){return this.set(n.coefficients)},t.clone=function(){return(new this.constructor).copy(this)},t.fromArray=function(n,r){void 0===r&&(r=0);for(var o=this.coefficients,l=0;l<9;l++)o[l].fromArray(n,r+3*l);return this},t.toArray=function(n,r){void 0===n&&(n=[]),void 0===r&&(r=0);for(var o=this.coefficients,l=0;l<9;l++)o[l].toArray(n,r+3*l);return n},a.getBasisAt=function(n,r){var o=n.x,l=n.y,b=n.z;r[0]=.282095,r[1]=.488603*l,r[2]=.488603*b,r[3]=.488603*o,r[4]=1.092548*o*l,r[5]=1.092548*l*b,r[6]=.315392*(3*b*b-1),r[7]=1.092548*o*b,r[8]=.546274*(o*o-l*l)},a}();function no(a,t){Li.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==a?a:new lp}function Xu(a){Ei.call(this,a),this.textures={}}no.prototype=Object.assign(Object.create(Li.prototype),{constructor:no,isLightProbe:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){var i=Li.prototype.toJSON.call(this,t);return i.object.sh=this.sh.toArray(),i}}),Xu.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Xu,load:function(t,i,n,r){var o=this,l=new to(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(t,function(b){try{i(o.parse(JSON.parse(b)))}catch(S){r?r(S):console.error(S),o.manager.itemError(t)}},n,r)},parse:function(t){var i=this.textures;function n(L){return void 0===i[L]&&console.warn("THREE.MaterialLoader: Undefined texture",L),i[L]}var r=new X0[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new Fn).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&(r.vertexColors="number"==typeof t.vertexColors?t.vertexColors>0:t.vertexColors),void 0!==t.uniforms)for(var o in t.uniforms){var l=t.uniforms[o];switch(r.uniforms[o]={},l.type){case"t":r.uniforms[o].value=n(l.value);break;case"c":r.uniforms[o].value=(new Fn).setHex(l.value);break;case"v2":r.uniforms[o].value=(new cn).fromArray(l.value);break;case"v3":r.uniforms[o].value=(new ke).fromArray(l.value);break;case"v4":r.uniforms[o].value=(new ui).fromArray(l.value);break;case"m3":r.uniforms[o].value=(new da).fromArray(l.value);break;case"m4":r.uniforms[o].value=(new br).fromArray(l.value);break;default:r.uniforms[o].value=l.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var b in t.extensions)r.extensions[b]=t.extensions[b];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){var S=t.normalScale;!1===Array.isArray(S)&&(S=[S,S]),r.normalScale=(new cn).fromArray(S)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new cn).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r},setTextures:function(t){return this.textures=t,this}});var Td={decodeText:function(t){if(typeof TextDecoder<"u")return(new TextDecoder).decode(t);for(var i="",n=0,r=t.length;n<r;n++)i+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(i))}catch{return i}},extractUrlBase:function(t){var i=t.lastIndexOf("/");return-1===i?"./":t.substr(0,i+1)}};function Ic(){De.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function qu(a,t,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Zn.call(this,a,t,i),this.meshPerAttribute=n||1}function Yu(a){Ei.call(this,a)}Ic.prototype=Object.assign(Object.create(De.prototype),{constructor:Ic,isInstancedBufferGeometry:!0,copy:function(t){return De.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=De.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),qu.prototype=Object.assign(Object.create(Zn.prototype),{constructor:qu,isInstancedBufferAttribute:!0,copy:function(t){return Zn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=Zn.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Yu.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Yu,load:function(t,i,n,r){var o=this,l=new to(o.manager);l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(t,function(b){try{i(o.parse(JSON.parse(b)))}catch(S){r?r(S):console.error(S),o.manager.itemError(t)}},n,r)},parse:function(t){var i={},n={};function r(Rt,tn){if(void 0!==i[tn])return i[tn];var Yt=Rt.interleavedBuffers[tn],Gt=function o(Rt,tn){if(void 0!==n[tn])return n[tn];var Gt=new Uint32Array(Rt.arrayBuffers[tn]).buffer;return n[tn]=Gt,Gt}(Rt,Yt.buffer),Sn=new Va(x(Yt.type,Gt),Yt.stride);return Sn.uuid=Yt.uuid,i[tn]=Sn,Sn}var l=t.isInstancedBufferGeometry?new Ic:new De,b=t.data.index;if(void 0!==b){var S=x(b.type,b.array);l.setIndex(new Zn(S,1))}var L=t.data.attributes;for(var G in L){var U=L[G],F=void 0;if(U.isInterleavedBufferAttribute)F=new ws(r(t.data,U.data),U.itemSize,U.offset,U.normalized);else{var Q=x(U.type,U.array);F=new(U.isInstancedBufferAttribute?qu:Zn)(Q,U.itemSize,U.normalized)}void 0!==U.name&&(F.name=U.name),l.setAttribute(G,F)}var ve=t.data.morphAttributes;if(ve)for(var oe in ve){for(var Z=ve[oe],Te=[],Be=0,we=Z.length;Be<we;Be++){var Ae=Z[Be],Le=void 0;Le=Ae.isInterleavedBufferAttribute?new ws(r(t.data,Ae.data),Ae.itemSize,Ae.offset,Ae.normalized):new Zn(x(Ae.type,Ae.array),Ae.itemSize,Ae.normalized),void 0!==Ae.name&&(Le.name=Ae.name),Te.push(Le)}l.morphAttributes[oe]=Te}t.data.morphTargetsRelative&&(l.morphTargetsRelative=!0);var st=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==st)for(var Ge=0,vt=st.length;Ge!==vt;++Ge){var Je=st[Ge];l.addGroup(Je.start,Je.count,Je.materialIndex)}var je=t.data.boundingSphere;if(void 0!==je){var At=new ke;void 0!==je.center&&At.fromArray(je.center),l.boundingSphere=new ao(At,je.radius)}return t.name&&(l.name=t.name),t.userData&&(l.userData=t.userData),l}});var ny=function(a){function t(n){return a.call(this,n)||this}Qn(t,a);var i=t.prototype;return i.load=function(r,o,l,b){var S=this,L=""===this.path?Td.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||L;var G=new to(this.manager);G.setPath(this.path),G.setRequestHeader(this.requestHeader),G.setWithCredentials(this.withCredentials),G.load(r,function(U){var F=null;try{F=JSON.parse(U)}catch(Q){return void 0!==b&&b(Q),void console.error("THREE:ObjectLoader: Can't parse "+r+".",Q.message)}var K=F.metadata;void 0!==K&&void 0!==K.type&&"geometry"!==K.type.toLowerCase()?S.parse(F,o):console.error("THREE.ObjectLoader: Can't load "+r)},l,b)},i.parse=function(r,o){var l=this.parseAnimations(r.animations),b=this.parseShapes(r.shapes),S=this.parseGeometries(r.geometries,b),L=this.parseImages(r.images,function(){void 0!==o&&o(F)}),G=this.parseTextures(r.textures,L),U=this.parseMaterials(r.materials,G),F=this.parseObject(r.object,S,U,l),K=this.parseSkeletons(r.skeletons,F);if(this.bindSkeletons(F,K),void 0!==o){var Q=!1;for(var re in L)if(L[re]instanceof HTMLImageElement){Q=!0;break}!1===Q&&o(F)}return F},i.parseShapes=function(r){var o={};if(void 0!==r)for(var l=0,b=r.length;l<b;l++){var S=(new Ss).fromJSON(r[l]);o[S.uuid]=S}return o},i.parseSkeletons=function(r,o){var l={},b={};if(o.traverse(function(U){U.isBone&&(b[U.uuid]=U)}),void 0!==r)for(var S=0,L=r.length;S<L;S++){var G=(new Ac).fromJSON(r[S],b);l[G.uuid]=G}return l},i.parseGeometries=function(r,o){var b,l={};if(void 0!==r)for(var S=new Yu,L=0,G=r.length;L<G;L++){var U=void 0,F=r[L];switch(F.type){case"PlaneGeometry":case"PlaneBufferGeometry":U=new Ra[F.type](F.width,F.height,F.widthSegments,F.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":U=new Ra[F.type](F.width,F.height,F.depth,F.widthSegments,F.heightSegments,F.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":U=new Ra[F.type](F.radius,F.segments,F.thetaStart,F.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":U=new Ra[F.type](F.radiusTop,F.radiusBottom,F.height,F.radialSegments,F.heightSegments,F.openEnded,F.thetaStart,F.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":U=new Ra[F.type](F.radius,F.height,F.radialSegments,F.heightSegments,F.openEnded,F.thetaStart,F.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":U=new Ra[F.type](F.radius,F.widthSegments,F.heightSegments,F.phiStart,F.phiLength,F.thetaStart,F.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":U=new Ra[F.type](F.radius,F.detail);break;case"RingGeometry":case"RingBufferGeometry":U=new Ra[F.type](F.innerRadius,F.outerRadius,F.thetaSegments,F.phiSegments,F.thetaStart,F.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":U=new Ra[F.type](F.radius,F.tube,F.radialSegments,F.tubularSegments,F.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":U=new Ra[F.type](F.radius,F.tube,F.tubularSegments,F.radialSegments,F.p,F.q);break;case"TubeGeometry":case"TubeBufferGeometry":U=new Ra[F.type]((new wd[F.path.type]).fromJSON(F.path),F.tubularSegments,F.radius,F.radialSegments,F.closed);break;case"LatheGeometry":case"LatheBufferGeometry":U=new Ra[F.type](F.points,F.segments,F.phiStart,F.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":U=new Ra[F.type](F.vertices,F.indices,F.radius,F.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":b=[];for(var K=0,Q=F.shapes.length;K<Q;K++)b.push(o[F.shapes[K]]);U=new Ra[F.type](b,F.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":b=[];for(var ve=0,oe=F.shapes.length;ve<oe;ve++)b.push(o[F.shapes[ve]]);var Te=F.options.extrudePath;void 0!==Te&&(F.options.extrudePath=(new wd[Te.type]).fromJSON(Te)),U=new Ra[F.type](b,F.options);break;case"BufferGeometry":case"InstancedBufferGeometry":U=S.parse(F);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?U=(new THREE.LegacyJSONLoader).parse(F,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+F.type+'"');continue}U.uuid=F.uuid,void 0!==F.name&&(U.name=F.name),!0===U.isBufferGeometry&&void 0!==F.userData&&(U.userData=F.userData),l[F.uuid]=U}return l},i.parseMaterials=function(r,o){var l={},b={};if(void 0!==r){var S=new Xu;S.setTextures(o);for(var L=0,G=r.length;L<G;L++){var U=r[L];if("MultiMaterial"===U.type){for(var F=[],K=0;K<U.materials.length;K++){var Q=U.materials[K];void 0===l[Q.uuid]&&(l[Q.uuid]=S.parse(Q)),F.push(l[Q.uuid])}b[U.uuid]=F}else void 0===l[U.uuid]&&(l[U.uuid]=S.parse(U)),b[U.uuid]=l[U.uuid]}}return b},i.parseAnimations=function(r){var o={};if(void 0!==r)for(var l=0;l<r.length;l++){var S=ja.parse(r[l]);o[S.uuid]=S}return o},i.parseImages=function(r,o){var S,l=this,b={};function G(we){if("string"==typeof we){var Ae=we;return function L(we){return l.manager.itemStart(we),S.load(we,function(){l.manager.itemEnd(we)},void 0,function(){l.manager.itemError(we),l.manager.itemEnd(we)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Ae)?Ae:l.resourcePath+Ae)}return we.data?{data:x(we.type,we.data),width:we.width,height:we.height}:null}if(void 0!==r&&r.length>0){var U=new pd(o);(S=new Ol(U)).setCrossOrigin(this.crossOrigin);for(var F=0,K=r.length;F<K;F++){var Q=r[F],re=Q.url;if(Array.isArray(re)){b[Q.uuid]=[];for(var ve=0,oe=re.length;ve<oe;ve++){var Te=G(re[ve]);null!==Te&&(Te instanceof HTMLImageElement?b[Q.uuid].push(Te):b[Q.uuid].push(new Gi(Te.data,Te.width,Te.height)))}}else{var Be=G(Q.url);null!==Be&&(b[Q.uuid]=Be)}}}return b},i.parseTextures=function(r,o){function l(K,Q){return"number"==typeof K?K:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",K),Q[K])}var b={};if(void 0!==r)for(var S=0,L=r.length;S<L;S++){var G=r[S];void 0===G.image&&console.warn('THREE.ObjectLoader: No "image" specified for',G.uuid),void 0===o[G.image]&&console.warn("THREE.ObjectLoader: Undefined image",G.image);var U=void 0,F=o[G.image];Array.isArray(F)?(U=new ai(F),6===F.length&&(U.needsUpdate=!0)):(U=F&&F.data?new Gi(F.data,F.width,F.height):new vi(F),F&&(U.needsUpdate=!0)),U.uuid=G.uuid,void 0!==G.name&&(U.name=G.name),void 0!==G.mapping&&(U.mapping=l(G.mapping,ry)),void 0!==G.offset&&U.offset.fromArray(G.offset),void 0!==G.repeat&&U.repeat.fromArray(G.repeat),void 0!==G.center&&U.center.fromArray(G.center),void 0!==G.rotation&&(U.rotation=G.rotation),void 0!==G.wrap&&(U.wrapS=l(G.wrap[0],cp),U.wrapT=l(G.wrap[1],cp)),void 0!==G.format&&(U.format=G.format),void 0!==G.type&&(U.type=G.type),void 0!==G.encoding&&(U.encoding=G.encoding),void 0!==G.minFilter&&(U.minFilter=l(G.minFilter,up)),void 0!==G.magFilter&&(U.magFilter=l(G.magFilter,up)),void 0!==G.anisotropy&&(U.anisotropy=G.anisotropy),void 0!==G.flipY&&(U.flipY=G.flipY),void 0!==G.premultiplyAlpha&&(U.premultiplyAlpha=G.premultiplyAlpha),void 0!==G.unpackAlignment&&(U.unpackAlignment=G.unpackAlignment),b[G.uuid]=U}return b},i.parseObject=function(r,o,l,b){var S,U,F;function L(tt){return void 0===o[tt]&&console.warn("THREE.ObjectLoader: Undefined geometry",tt),o[tt]}function G(tt){if(void 0!==tt){if(Array.isArray(tt)){for(var Ze=[],wt=0,st=tt.length;wt<st;wt++){var Ge=tt[wt];void 0===l[Ge]&&console.warn("THREE.ObjectLoader: Undefined material",Ge),Ze.push(l[Ge])}return Ze}return void 0===l[tt]&&console.warn("THREE.ObjectLoader: Undefined material",tt),l[tt]}}switch(r.type){case"Scene":S=new zh,void 0!==r.background&&Number.isInteger(r.background)&&(S.background=new Fn(r.background)),void 0!==r.fog&&("Fog"===r.fog.type?S.fog=new Sf(r.fog.color,r.fog.near,r.fog.far):"FogExp2"===r.fog.type&&(S.fog=new Tf(r.fog.color,r.fog.density)));break;case"PerspectiveCamera":S=new dr(r.fov,r.aspect,r.near,r.far),void 0!==r.focus&&(S.focus=r.focus),void 0!==r.zoom&&(S.zoom=r.zoom),void 0!==r.filmGauge&&(S.filmGauge=r.filmGauge),void 0!==r.filmOffset&&(S.filmOffset=r.filmOffset),void 0!==r.view&&(S.view=Object.assign({},r.view));break;case"OrthographicCamera":S=new Fl(r.left,r.right,r.top,r.bottom,r.near,r.far),void 0!==r.zoom&&(S.zoom=r.zoom),void 0!==r.view&&(S.view=Object.assign({},r.view));break;case"AmbientLight":S=new Wu(r.color,r.intensity);break;case"DirectionalLight":S=new Vu(r.color,r.intensity);break;case"PointLight":S=new zu(r.color,r.intensity,r.distance,r.decay);break;case"RectAreaLight":S=new ju(r.color,r.intensity,r.width,r.height);break;case"SpotLight":S=new Gu(r.color,r.intensity,r.distance,r.angle,r.penumbra,r.decay);break;case"HemisphereLight":S=new Uu(r.color,r.groundColor,r.intensity);break;case"LightProbe":S=(new no).fromJSON(r);break;case"SkinnedMesh":S=new gc(U=L(r.geometry),F=G(r.material)),void 0!==r.bindMode&&(S.bindMode=r.bindMode),void 0!==r.bindMatrix&&S.bindMatrix.fromArray(r.bindMatrix),void 0!==r.skeleton&&(S.skeleton=r.skeleton);break;case"Mesh":S=new kn(U=L(r.geometry),F=G(r.material));break;case"InstancedMesh":U=L(r.geometry),F=G(r.material);var Q=r.instanceMatrix;(S=new pu(U,F,r.count)).instanceMatrix=new Zn(new Float32Array(Q.array),16);break;case"LOD":S=new mc;break;case"Line":S=new eo(L(r.geometry),G(r.material),r.mode);break;case"LineLoop":S=new Au(L(r.geometry),G(r.material));break;case"LineSegments":S=new _a(L(r.geometry),G(r.material));break;case"PointCloud":case"Points":S=new Cl(L(r.geometry),G(r.material));break;case"Sprite":S=new vc(G(r.material));break;case"Group":S=new Yo;break;case"Bone":S=new yc;break;default:S=new Kn}if(S.uuid=r.uuid,void 0!==r.name&&(S.name=r.name),void 0!==r.matrix?(S.matrix.fromArray(r.matrix),void 0!==r.matrixAutoUpdate&&(S.matrixAutoUpdate=r.matrixAutoUpdate),S.matrixAutoUpdate&&S.matrix.decompose(S.position,S.quaternion,S.scale)):(void 0!==r.position&&S.position.fromArray(r.position),void 0!==r.rotation&&S.rotation.fromArray(r.rotation),void 0!==r.quaternion&&S.quaternion.fromArray(r.quaternion),void 0!==r.scale&&S.scale.fromArray(r.scale)),void 0!==r.castShadow&&(S.castShadow=r.castShadow),void 0!==r.receiveShadow&&(S.receiveShadow=r.receiveShadow),r.shadow&&(void 0!==r.shadow.bias&&(S.shadow.bias=r.shadow.bias),void 0!==r.shadow.normalBias&&(S.shadow.normalBias=r.shadow.normalBias),void 0!==r.shadow.radius&&(S.shadow.radius=r.shadow.radius),void 0!==r.shadow.mapSize&&S.shadow.mapSize.fromArray(r.shadow.mapSize),void 0!==r.shadow.camera&&(S.shadow.camera=this.parseObject(r.shadow.camera))),void 0!==r.visible&&(S.visible=r.visible),void 0!==r.frustumCulled&&(S.frustumCulled=r.frustumCulled),void 0!==r.renderOrder&&(S.renderOrder=r.renderOrder),void 0!==r.userData&&(S.userData=r.userData),void 0!==r.layers&&(S.layers.mask=r.layers),void 0!==r.children)for(var re=r.children,ve=0;ve<re.length;ve++)S.add(this.parseObject(re[ve],o,l,b));if(void 0!==r.animations)for(var oe=r.animations,Z=0;Z<oe.length;Z++)S.animations.push(b[oe[Z]]);if("LOD"===r.type){void 0!==r.autoUpdate&&(S.autoUpdate=r.autoUpdate);for(var Be=r.levels,we=0;we<Be.length;we++){var Ae=Be[we],Le=S.getObjectByProperty("uuid",Ae.object);void 0!==Le&&S.addLevel(Le,Ae.distance)}}return S},i.bindSkeletons=function(r,o){0!==Object.keys(o).length&&r.traverse(function(l){if(!0===l.isSkinnedMesh&&void 0!==l.skeleton){var b=o[l.skeleton];void 0===b?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",l.skeleton):l.bind(b,l.bindMatrix)}})},i.setTexturePath=function(r){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(r)},t}(Ei),ry={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},cp={RepeatWrapping:at,ClampToEdgeWrapping:ot,MirroredRepeatWrapping:dt},up={NearestFilter:St,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:We,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:Ht};function Sd(a){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Ei.call(this,a),this.options={premultiplyAlpha:"none"}}function Cd(){this.type="ShapePath",this.color=new Fn,this.subPaths=[],this.currentPath=null}function _d(a){this.type="Font",this.data=a}function ay(a,t,i,n,r){var o=r.glyphs[a]||r.glyphs["?"];if(o){var b,S,L,G,U,F,K,Q,l=new Cd;if(o.o)for(var re=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),ve=0,oe=re.length;ve<oe;)switch(re[ve++]){case"m":b=re[ve++]*t+i,S=re[ve++]*t+n,l.moveTo(b,S);break;case"l":b=re[ve++]*t+i,S=re[ve++]*t+n,l.lineTo(b,S);break;case"q":L=re[ve++]*t+i,G=re[ve++]*t+n,U=re[ve++]*t+i,F=re[ve++]*t+n,l.quadraticCurveTo(U,F,L,G);break;case"b":L=re[ve++]*t+i,G=re[ve++]*t+n,U=re[ve++]*t+i,F=re[ve++]*t+n,K=re[ve++]*t+i,Q=re[ve++]*t+n,l.bezierCurveTo(U,F,K,Q,L,G)}return{offsetX:o.ha*t,path:l}}console.error('THREE.Font: character "'+a+'" does not exists in font family '+r.familyName+".")}function Rd(a){Ei.call(this,a)}Sd.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Sd,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,i,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var o=this,l=Ks.get(t);if(void 0!==l)return o.manager.itemStart(t),setTimeout(function(){i&&i(l),o.manager.itemEnd(t)},0),l;var b={};b.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,b).then(function(S){return S.blob()}).then(function(S){return createImageBitmap(S,o.options)}).then(function(S){Ks.add(t,S),i&&i(S),o.manager.itemEnd(t)}).catch(function(S){r&&r(S),o.manager.itemError(t),o.manager.itemEnd(t)}),o.manager.itemStart(t)}}),Object.assign(Cd.prototype,{moveTo:function(t,i){return this.currentPath=new bo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this},lineTo:function(t,i){return this.currentPath.lineTo(t,i),this},quadraticCurveTo:function(t,i,n,r){return this.currentPath.quadraticCurveTo(t,i,n,r),this},bezierCurveTo:function(t,i,n,r,o,l){return this.currentPath.bezierCurveTo(t,i,n,r,o,l),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,i){function n(en){for(var Yt=[],Gt=0,yn=en.length;Gt<yn;Gt++){var Sn=en[Gt],er=new Ss;er.curves=Sn.curves,Yt.push(er)}return Yt}function r(en,Yt){for(var Gt=Yt.length,yn=!1,Sn=Gt-1,er=0;er<Gt;Sn=er++){var Jt=Yt[Sn],Nr=Yt[er],wr=Nr.x-Jt.x,Er=Nr.y-Jt.y;if(Math.abs(Er)>Number.EPSILON){if(Er<0&&(Jt=Yt[er],wr=-wr,Nr=Yt[Sn],Er=-Er),en.y<Jt.y||en.y>Nr.y)continue;if(en.y===Jt.y){if(en.x===Jt.x)return!0}else{var Ln=Er*(en.x-Jt.x)-wr*(en.y-Jt.y);if(0===Ln)return!0;if(Ln<0)continue;yn=!yn}}else{if(en.y!==Jt.y)continue;if(Nr.x<=en.x&&en.x<=Jt.x||Jt.x<=en.x&&en.x<=Nr.x)return!0}}return yn}var o=Ko.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===i)return n(l);var b,S,L,G=[];if(1===l.length)return S=l[0],(L=new Ss).curves=S.curves,G.push(L),G;var U=!o(l[0].getPoints());U=t?!U:U;var ve,F=[],K=[],Q=[],re=0;K[re]=void 0,Q[re]=[];for(var oe=0,Z=l.length;oe<Z;oe++)b=o(ve=(S=l[oe]).getPoints()),(b=t?!b:b)?(!U&&K[re]&&re++,K[re]={s:new Ss,p:ve},K[re].s.curves=S.curves,U&&re++,Q[re]=[]):Q[re].push({h:S,p:ve[0]});if(!K[0])return n(l);if(K.length>1){for(var Te=!1,Be=[],we=0,Ae=K.length;we<Ae;we++)F[we]=[];for(var Le=0,tt=K.length;Le<tt;Le++)for(var Ze=Q[Le],wt=0;wt<Ze.length;wt++){for(var st=Ze[wt],Ge=!0,vt=0;vt<K.length;vt++)r(st.p,K[vt].p)&&(Le!==vt&&Be.push({froms:Le,tos:vt,hole:wt}),Ge?(Ge=!1,F[vt].push(st)):Te=!0);Ge&&F[Le].push(st)}Be.length>0&&(Te||(Q=F))}for(var Je,je=0,At=K.length;je<At;je++){G.push(L=K[je].s);for(var Rt=0,tn=(Je=Q[je]).length;Rt<tn;Rt++)L.holes.push(Je[Rt].h)}return G}}),Object.assign(_d.prototype,{isFont:!0,generateShapes:function(t,i){void 0===i&&(i=100);for(var n=[],r=function iy(a,t,i){for(var n=Array.from?Array.from(a):String(a).split(""),r=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,l=[],b=0,S=0,L=0;L<n.length;L++){var G=n[L];if("\n"===G)b=0,S-=o;else{var U=ay(G,r,b,S,i);b+=U.offsetX,l.push(U.path)}}return l}(t,i,this.data),o=0,l=r.length;o<l;o++)Array.prototype.push.apply(n,r[o].toShapes());return n}}),Rd.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Rd,load:function(t,i,n,r){var o=this,l=new to(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(o.withCredentials),l.load(t,function(b){var S;try{S=JSON.parse(b)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),S=JSON.parse(b.substring(65,b.length-2))}var L=o.parse(S);i&&i(L)},n,r)},parse:function(t){return new _d(t)}});var Ku,Ld={getContext:function(){return void 0===Ku&&(Ku=new(window.AudioContext||window.webkitAudioContext)),Ku},setContext:function(t){Ku=t}};function Qu(a){Ei.call(this,a)}function Pd(a,t,i){no.call(this,void 0,i);var n=(new Fn).set(a),r=(new Fn).set(t),o=new ke(n.r,n.g,n.b),l=new ke(r.r,r.g,r.b),b=Math.sqrt(Math.PI),S=b*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(l).multiplyScalar(b),this.sh.coefficients[1].copy(o).sub(l).multiplyScalar(S)}function Dd(a,t){no.call(this,void 0,t);var i=(new Fn).set(a);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}Qu.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Qu,load:function(t,i,n,r){var o=this,l=new to(o.manager);l.setResponseType("arraybuffer"),l.setPath(o.path),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(t,function(b){try{var S=b.slice(0);Ld.getContext().decodeAudioData(S,function(G){i(G)})}catch(G){r?r(G):console.error(G),o.manager.itemError(t)}},n,r)}}),Pd.prototype=Object.assign(Object.create(no.prototype),{constructor:Pd,isHemisphereLightProbe:!0,copy:function(t){return no.prototype.copy.call(this,t),this},toJSON:function(t){return no.prototype.toJSON.call(this,t)}}),Dd.prototype=Object.assign(Object.create(no.prototype),{constructor:Dd,isAmbientLightProbe:!0,copy:function(t){return no.prototype.copy.call(this,t),this},toJSON:function(t){return no.prototype.toJSON.call(this,t)}});var hp=new br,dp=new br;function fp(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new dr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new dr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(fp.prototype,{update:function(t){var i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep;var S,L,r=t.projectionMatrix.clone(),o=i.eyeSep/2,l=o*i.near/i.focus,b=i.near*Math.tan(pr.DEG2RAD*i.fov*.5)/i.zoom;dp.elements[12]=-o,hp.elements[12]=o,r.elements[0]=2*i.near/((L=b*i.aspect+l)-(S=-b*i.aspect+l)),r.elements[8]=(L+S)/(L-S),this.cameraL.projectionMatrix.copy(r),r.elements[0]=2*i.near/((L=b*i.aspect-l)-(S=-b*i.aspect-l)),r.elements[8]=(L+S)/(L-S),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(dp),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(hp)}});var pp=function(){function a(i){this.autoStart=void 0===i||i,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}var t=a.prototype;return t.start=function(){this.startTime=vp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},t.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},t.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},t.getDelta=function(){var n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var r=vp();n=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=n}return n},a}();function vp(){return(typeof performance>"u"?Date:performance).now()}var Qs=new ke,mp=new Zi,oy=new ke,Zs=new ke,sy=function(a){function t(){var n;return(n=a.call(this)||this).type="AudioListener",n.context=Ld.getContext(),n.gain=n.context.createGain(),n.gain.connect(n.context.destination),n.filter=null,n.timeDelta=0,n._clock=new pp,n}Qn(t,a);var i=t.prototype;return i.getInput=function(){return this.gain},i.removeFilter=function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},i.getFilter=function(){return this.filter},i.setFilter=function(r){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=r,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},i.getMasterVolume=function(){return this.gain.gain.value},i.setMasterVolume=function(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this},i.updateMatrixWorld=function(r){a.prototype.updateMatrixWorld.call(this,r);var o=this.context.listener,l=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Qs,mp,oy),Zs.set(0,0,-1).applyQuaternion(mp),o.positionX){var b=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(Qs.x,b),o.positionY.linearRampToValueAtTime(Qs.y,b),o.positionZ.linearRampToValueAtTime(Qs.z,b),o.forwardX.linearRampToValueAtTime(Zs.x,b),o.forwardY.linearRampToValueAtTime(Zs.y,b),o.forwardZ.linearRampToValueAtTime(Zs.z,b),o.upX.linearRampToValueAtTime(l.x,b),o.upY.linearRampToValueAtTime(l.y,b),o.upZ.linearRampToValueAtTime(l.z,b)}else o.setPosition(Qs.x,Qs.y,Qs.z),o.setOrientation(Zs.x,Zs.y,Zs.z,l.x,l.y,l.z)},t}(Kn),Id=function(a){function t(n){var r;return(r=a.call(this)||this).type="Audio",r.listener=n,r.context=n.context,r.gain=r.context.createGain(),r.gain.connect(n.getInput()),r.autoplay=!1,r.buffer=null,r.detune=0,r.loop=!1,r.loopStart=0,r.loopEnd=0,r.offset=0,r.duration=void 0,r.playbackRate=1,r.isPlaying=!1,r.hasPlaybackControl=!0,r.source=null,r.sourceType="empty",r._startedAt=0,r._progress=0,r._connected=!1,r.filters=[],r}Qn(t,a);var i=t.prototype;return i.getOutput=function(){return this.gain},i.setNodeSource=function(r){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=r,this.connect(),this},i.setMediaElementSource=function(r){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(r),this.connect(),this},i.setMediaStreamSource=function(r){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(r),this.connect(),this},i.setBuffer=function(r){return this.buffer=r,this.sourceType="buffer",this.autoplay&&this.play(),this},i.play=function(r){if(void 0===r&&(r=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+r;var o=this.context.createBufferSource();return o.buffer=this.buffer,o.loop=this.loop,o.loopStart=this.loopStart,o.loopEnd=this.loopEnd,o.onended=this.onEnded.bind(this),o.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=o,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},i.pause=function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},i.stop=function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},i.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var r=1,o=this.filters.length;r<o;r++)this.filters[r-1].connect(this.filters[r]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this},i.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var r=1,o=this.filters.length;r<o;r++)this.filters[r-1].disconnect(this.filters[r]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this},i.getFilters=function(){return this.filters},i.setFilters=function(r){return r||(r=[]),!0===this._connected?(this.disconnect(),this.filters=r.slice(),this.connect()):this.filters=r.slice(),this},i.setDetune=function(r){if(this.detune=r,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},i.getDetune=function(){return this.detune},i.getFilter=function(){return this.getFilters()[0]},i.setFilter=function(r){return this.setFilters(r?[r]:[])},i.setPlaybackRate=function(r){if(!1!==this.hasPlaybackControl)return this.playbackRate=r,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},i.getPlaybackRate=function(){return this.playbackRate},i.onEnded=function(){this.isPlaying=!1},i.getLoop=function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},i.setLoop=function(r){if(!1!==this.hasPlaybackControl)return this.loop=r,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},i.setLoopStart=function(r){return this.loopStart=r,this},i.setLoopEnd=function(r){return this.loopEnd=r,this},i.getVolume=function(){return this.gain.gain.value},i.setVolume=function(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this},t}(Kn),Js=new ke,gp=new Zi,ly=new ke,$s=new ke,cy=function(a){function t(n){var r;return(r=a.call(this,n)||this).panner=r.context.createPanner(),r.panner.panningModel="HRTF",r.panner.connect(r.gain),r}Qn(t,a);var i=t.prototype;return i.getOutput=function(){return this.panner},i.getRefDistance=function(){return this.panner.refDistance},i.setRefDistance=function(r){return this.panner.refDistance=r,this},i.getRolloffFactor=function(){return this.panner.rolloffFactor},i.setRolloffFactor=function(r){return this.panner.rolloffFactor=r,this},i.getDistanceModel=function(){return this.panner.distanceModel},i.setDistanceModel=function(r){return this.panner.distanceModel=r,this},i.getMaxDistance=function(){return this.panner.maxDistance},i.setMaxDistance=function(r){return this.panner.maxDistance=r,this},i.setDirectionalCone=function(r,o,l){return this.panner.coneInnerAngle=r,this.panner.coneOuterAngle=o,this.panner.coneOuterGain=l,this},i.updateMatrixWorld=function(r){if(a.prototype.updateMatrixWorld.call(this,r),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Js,gp,ly),$s.set(0,0,1).applyQuaternion(gp);var o=this.panner;if(o.positionX){var l=this.context.currentTime+this.listener.timeDelta;o.positionX.linearRampToValueAtTime(Js.x,l),o.positionY.linearRampToValueAtTime(Js.y,l),o.positionZ.linearRampToValueAtTime(Js.z,l),o.orientationX.linearRampToValueAtTime($s.x,l),o.orientationY.linearRampToValueAtTime($s.y,l),o.orientationZ.linearRampToValueAtTime($s.z,l)}else o.setPosition(Js.x,Js.y,Js.z),o.setOrientation($s.x,$s.y,$s.z)}},t}(Id),yp=function(){function a(i,n){void 0===n&&(n=2048),this.analyser=i.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),i.getOutput().connect(this.analyser)}var t=a.prototype;return t.getFrequencyData=function(){return this.analyser.getByteFrequencyData(this.data),this.data},t.getAverageFrequency=function(){for(var n=0,r=this.getFrequencyData(),o=0;o<r.length;o++)n+=r[o];return n/r.length},a}();function Od(a,t,i){var n,r,o;switch(this.binding=a,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(Od.prototype,{accumulate:function(t,i){var n=this.buffer,r=this.valueSize,o=t*r+r,l=this.cumulativeWeight;if(0===l){for(var b=0;b!==r;++b)n[o+b]=n[b];l=i}else this._mixBufferRegion(n,o,0,i/(l+=i),r);this.cumulativeWeight=l},accumulateAdditive:function(t){var i=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(i,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){var i=this.valueSize,n=this.buffer,r=t*i+i,o=this.cumulativeWeight,l=this.cumulativeWeightAdditive,b=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1&&this._mixBufferRegion(n,r,i*this._origIndex,1-o,i),l>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*i,1,i);for(var L=i,G=i+i;L!==G;++L)if(n[L]!==n[L+i]){b.setValue(n,r);break}},saveOriginalState:function(){var i=this.buffer,n=this.valueSize,r=n*this._origIndex;this.binding.getValue(i,r);for(var o=n,l=r;o!==l;++o)i[o]=i[r+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){for(var t=this._addIndex*this.valueSize,i=t+this.valueSize,n=t;n<i;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[i+n]=this.buffer[t+n]},_select:function(t,i,n,r,o){if(r>=.5)for(var l=0;l!==o;++l)t[i+l]=t[n+l]},_slerp:function(t,i,n,r){Zi.slerpFlat(t,i,t,i,t,n,r)},_slerpAdditive:function(t,i,n,r,o){var l=this._workIndex*o;Zi.multiplyQuaternionsFlat(t,l,t,i,t,n),Zi.slerpFlat(t,i,t,i,t,l,r)},_lerp:function(t,i,n,r,o){for(var l=1-r,b=0;b!==o;++b){var S=i+b;t[S]=t[S]*l+t[n+b]*r}},_lerpAdditive:function(t,i,n,r,o){for(var l=0;l!==o;++l){var b=i+l;t[b]=t[b]+t[n+l]*r}}});var Bd="\\[\\]\\.:\\/",uy=new RegExp("["+Bd+"]","g"),Fd="[^"+Bd+"]",hy="[^"+Bd.replace("\\.","")+"]",dy=/((?:WC+[\/:])*)/.source.replace("WC",Fd),fy=/(WCOD+)?/.source.replace("WCOD",hy),py=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Fd),vy=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Fd),my=new RegExp("^"+dy+fy+py+vy+"$"),gy=["material","materials","bones"];function Ap(a,t,i){var n=i||ba.parseTrackName(t);this._targetGroup=a,this._bindings=a.subscribe_(t,n)}function ba(a,t,i){this.path=t,this.parsedPath=i||ba.parseTrackName(t),this.node=ba.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a}function bp(){this.uuid=pr.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var t=0,i=arguments.length;t!==i;++t)a[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}Object.assign(Ap.prototype,{getValue:function(t,i){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(t,i)},setValue:function(t,i){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,o=n.length;r!==o;++r)n[r].setValue(t,i)},bind:function(){for(var t=this._bindings,i=this._targetGroup.nCachedObjects_,n=t.length;i!==n;++i)t[i].bind()},unbind:function(){for(var t=this._bindings,i=this._targetGroup.nCachedObjects_,n=t.length;i!==n;++i)t[i].unbind()}}),Object.assign(ba,{Composite:Ap,create:function(t,i,n){return t&&t.isAnimationObjectGroup?new ba.Composite(t,i,n):new ba(t,i,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(uy,"")},parseTrackName:function(t){var i=my.exec(t);if(!i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var o=n.nodeName.substring(r+1);-1!==gy.indexOf(o)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=o)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,i){if(!i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(i);if(void 0!==n)return n}if(t.children){var o=function l(b){for(var S=0;S<b.length;S++){var L=b[S];if(L.name===i||L.uuid===i)return L;var G=l(L.children);if(G)return G}return null}(t.children);if(o)return o}return null}}),Object.assign(ba.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,i){t[i]=this.node[this.propertyName]},function(t,i){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)t[i++]=n[r]},function(t,i){t[i]=this.resolvedProperty[this.propertyIndex]},function(t,i){this.resolvedProperty.toArray(t,i)}],SetterByBindingTypeAndVersioning:[[function(t,i){this.targetObject[this.propertyName]=t[i]},function(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0},function(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)n[r]=t[i++]},function(t,i){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)n[r]=t[i++];this.targetObject.needsUpdate=!0},function(t,i){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)n[r]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){this.resolvedProperty[this.propertyIndex]=t[i]},function(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0},function(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){this.resolvedProperty.fromArray(t,i)},function(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0},function(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,i){this.bind(),this.getValue(t,i)},setValue:function(t,i){this.bind(),this.setValue(t,i)},bind:function(){var t=this.node,i=this.parsedPath,n=i.objectName,r=i.propertyName,o=i.propertyIndex;if(t||(t=ba.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var l=i.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var b=0;b<t.length;b++)if(t[b].name===l){l=b;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==l){if(void 0===t[l])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[l]}}var S=t[r];if(void 0!==S){var G=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?G=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(G=this.Versioning.MatrixWorldNeedsUpdate);var U=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}U=this.BindingType.ArrayElement,this.resolvedProperty=S,this.propertyIndex=o}else void 0!==S.fromArray&&void 0!==S.toArray?(U=this.BindingType.HasFromToArray,this.resolvedProperty=S):Array.isArray(S)?(U=this.BindingType.EntireArray,this.resolvedProperty=S):this.propertyName=r;this.getValue=this.GetterByBindingType[U],this.setValue=this.SetterByBindingTypeAndVersioning[U][G]}else console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+r+" but it wasn't found.",t)}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(ba.prototype,{_getValue_unbound:ba.prototype.getValue,_setValue_unbound:ba.prototype.setValue}),Object.assign(bp.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,i=this._indicesByUUID,n=this._paths,r=this._parsedPaths,o=this._bindings,l=o.length,b=void 0,S=t.length,L=this.nCachedObjects_,G=0,U=arguments.length;G!==U;++G){var F=arguments[G],K=F.uuid,Q=i[K];if(void 0===Q){Q=S++,i[K]=Q,t.push(F);for(var re=0,ve=l;re!==ve;++re)o[re].push(new ba(F,n[re],r[re]))}else if(Q<L){b=t[Q];var oe=--L,Z=t[oe];i[Z.uuid]=Q,t[Q]=Z,i[K]=oe,t[oe]=F;for(var Te=0,Be=l;Te!==Be;++Te){var we=o[Te],Ae=we[oe],Le=we[Q];we[Q]=Ae,void 0===Le&&(Le=new ba(F,n[Te],r[Te])),we[oe]=Le}}else t[Q]!==b&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=L},remove:function(){for(var t=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length,o=this.nCachedObjects_,l=0,b=arguments.length;l!==b;++l){var S=arguments[l],L=S.uuid,G=i[L];if(void 0!==G&&G>=o){var U=o++,F=t[U];i[F.uuid]=G,t[G]=F,i[L]=U,t[U]=S;for(var K=0,Q=r;K!==Q;++K){var re=n[K],ve=re[U],oe=re[G];re[G]=ve,re[U]=oe}}}this.nCachedObjects_=o},uncache:function(){for(var t=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length,o=this.nCachedObjects_,l=t.length,b=0,S=arguments.length;b!==S;++b){var L=arguments[b],G=L.uuid,U=i[G];if(void 0!==U)if(delete i[G],U<o){var F=--o,K=t[F],Q=--l,re=t[Q];i[K.uuid]=U,t[U]=K,i[re.uuid]=F,t[F]=re,t.pop();for(var ve=0,oe=r;ve!==oe;++ve){var Z=n[ve],Te=Z[F],Be=Z[Q];Z[U]=Te,Z[F]=Be,Z.pop()}}else{var we=--l,Ae=t[we];we>0&&(i[Ae.uuid]=U),t[U]=Ae,t.pop();for(var Le=0,tt=r;Le!==tt;++Le){var Ze=n[Le];Ze[U]=Ze[we],Ze.pop()}}}this.nCachedObjects_=o},subscribe_:function(t,i){var n=this._bindingsIndicesByPath,r=n[t],o=this._bindings;if(void 0!==r)return o[r];var l=this._paths,b=this._parsedPaths,S=this._objects,G=this.nCachedObjects_,U=new Array(S.length);n[t]=r=o.length,l.push(t),b.push(i),o.push(U);for(var F=G,K=S.length;F!==K;++F)U[F]=new ba(S[F],t,i);return U},unsubscribe_:function(t){var i=this._bindingsIndicesByPath,n=i[t];if(void 0!==n){var r=this._paths,o=this._parsedPaths,l=this._bindings,b=l.length-1,S=l[b];i[t[b]]=n,l[n]=S,l.pop(),o[n]=o[b],o.pop(),r[n]=r[b],r.pop()}}});var yy=function(){function a(i,n,r,o){void 0===r&&(r=null),void 0===o&&(o=n.blendMode),this._mixer=i,this._clip=n,this._localRoot=r,this.blendMode=o;for(var l=n.tracks,b=l.length,S=new Array(b),L={endingStart:Ma,endingEnd:Ma},G=0;G!==b;++G){var U=l[G].createInterpolant(null);S[G]=U,U.settings=L}this._interpolantSettings=L,this._interpolants=S,this._propertyBindings=new Array(b),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}var t=a.prototype;return t.play=function(){return this._mixer._activateAction(this),this},t.stop=function(){return this._mixer._deactivateAction(this),this.reset()},t.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},t.isRunning=function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},t.isScheduled=function(){return this._mixer._isActiveAction(this)},t.startAt=function(n){return this._startTime=n,this},t.setLoop=function(n,r){return this.loop=n,this.repetitions=r,this},t.setEffectiveWeight=function(n){return this.weight=n,this._effectiveWeight=this.enabled?n:0,this.stopFading()},t.getEffectiveWeight=function(){return this._effectiveWeight},t.fadeIn=function(n){return this._scheduleFading(n,0,1)},t.fadeOut=function(n){return this._scheduleFading(n,1,0)},t.crossFadeFrom=function(n,r,o){if(n.fadeOut(r),this.fadeIn(r),o){var l=this._clip.duration,b=n._clip.duration,L=l/b;n.warp(1,b/l,r),this.warp(L,1,r)}return this},t.crossFadeTo=function(n,r,o){return n.crossFadeFrom(this,r,o)},t.stopFading=function(){var n=this._weightInterpolant;return null!==n&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this},t.setEffectiveTimeScale=function(n){return this.timeScale=n,this._effectiveTimeScale=this.paused?0:n,this.stopWarping()},t.getEffectiveTimeScale=function(){return this._effectiveTimeScale},t.setDuration=function(n){return this.timeScale=this._clip.duration/n,this.stopWarping()},t.syncWith=function(n){return this.time=n.time,this.timeScale=n.timeScale,this.stopWarping()},t.halt=function(n){return this.warp(this._effectiveTimeScale,0,n)},t.warp=function(n,r,o){var l=this._mixer,b=l.time,S=this.timeScale,L=this._timeScaleInterpolant;null===L&&(L=l._lendControlInterpolant(),this._timeScaleInterpolant=L);var G=L.parameterPositions,U=L.sampleValues;return G[0]=b,G[1]=b+o,U[0]=n/S,U[1]=r/S,this},t.stopWarping=function(){var n=this._timeScaleInterpolant;return null!==n&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this},t.getMixer=function(){return this._mixer},t.getClip=function(){return this._clip},t.getRoot=function(){return this._localRoot||this._mixer._root},t._update=function(n,r,o,l){if(this.enabled){var b=this._startTime;if(null!==b){var S=(n-b)*o;if(S<0||0===o)return;this._startTime=null,r=o*S}r*=this._updateTimeScale(n);var L=this._updateTime(r),G=this._updateWeight(n);if(G>0){var U=this._interpolants,F=this._propertyBindings;if(2501===this.blendMode)for(var K=0,Q=U.length;K!==Q;++K)U[K].evaluate(L),F[K].accumulateAdditive(G);else for(var re=0,ve=U.length;re!==ve;++re)U[re].evaluate(L),F[re].accumulate(l,G)}}else this._updateWeight(n)},t._updateWeight=function(n){var r=0;if(this.enabled){r=this.weight;var o=this._weightInterpolant;if(null!==o){var l=o.evaluate(n)[0];r*=l,n>o.parameterPositions[1]&&(this.stopFading(),0===l&&(this.enabled=!1))}}return this._effectiveWeight=r,r},t._updateTimeScale=function(n){var r=0;if(!this.paused){r=this.timeScale;var o=this._timeScaleInterpolant;null!==o&&(r*=o.evaluate(n)[0],n>o.parameterPositions[1]&&(this.stopWarping(),0===r?this.paused=!0:this.timeScale=r))}return this._effectiveTimeScale=r,r},t._updateTime=function(n){var r=this._clip.duration,o=this.loop,l=this.time+n,b=this._loopCount,S=2202===o;if(0===n)return-1===b?l:S&&1==(1&b)?r-l:l;if(2200===o){-1===b&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(l>=r)l=r;else{if(!(l<0)){this.time=l;break e}l=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=l,this._mixer.dispatchEvent({type:"finished",action:this,direction:n<0?-1:1})}}else{if(-1===b&&(n>=0?(b=0,this._setEndings(!0,0===this.repetitions,S)):this._setEndings(0===this.repetitions,!0,S)),l>=r||l<0){var L=Math.floor(l/r);l-=r*L,b+=Math.abs(L);var G=this.repetitions-b;if(G<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=l=n>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:n>0?1:-1});else{if(1===G){var U=n<0;this._setEndings(U,!U,S)}else this._setEndings(!1,!1,S);this._loopCount=b,this.time=l,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:L})}}else this.time=l;if(S&&1==(1&b))return r-l}return l},t._setEndings=function(n,r,o){var l=this._interpolantSettings;o?(l.endingStart=Ta,l.endingEnd=Ta):(l.endingStart=n?this.zeroSlopeAtStart?Ta:Ma:Pa,l.endingEnd=r?this.zeroSlopeAtEnd?Ta:Ma:Pa)},t._scheduleFading=function(n,r,o){var l=this._mixer,b=l.time,S=this._weightInterpolant;null===S&&(S=l._lendControlInterpolant(),this._weightInterpolant=S);var L=S.parameterPositions,G=S.sampleValues;return L[0]=b,G[0]=r,L[1]=b+n,G[1]=o,this},a}();function Nd(a){this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Nd.prototype=Object.assign(Object.create(na.prototype),{constructor:Nd,_bindAction:function(t,i){var n=t._localRoot||this._root,r=t._clip.tracks,o=r.length,l=t._propertyBindings,b=t._interpolants,S=n.uuid,L=this._bindingsByRootAndName,G=L[S];void 0===G&&(L[S]=G={});for(var U=0;U!==o;++U){var F=r[U],K=F.name,Q=G[K];if(void 0!==Q)l[U]=Q;else{if(void 0!==(Q=l[U])){null===Q._cacheIndex&&(++Q.referenceCount,this._addInactiveBinding(Q,S,K));continue}++(Q=new Od(ba.create(n,K,i&&i._propertyBindings[U].binding.parsedPath),F.ValueTypeName,F.getValueSize())).referenceCount,this._addInactiveBinding(Q,S,K),l[U]=Q}b[U].resultBuffer=Q.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var i=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,i)}for(var o=t._propertyBindings,l=0,b=o.length;l!==b;++l){var S=o[l];0==S.useCount++&&(this._lendBinding(S),S.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var i=t._propertyBindings,n=0,r=i.length;n!==r;++n){var o=i[n];0==--o.useCount&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var i=t._cacheIndex;return null!==i&&i<this._nActiveActions},_addInactiveAction:function(t,i,n){var r=this._actions,o=this._actionsByClip,l=o[i];if(void 0===l)l={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,o[i]=l;else{var b=l.knownActions;t._byClipCacheIndex=b.length,b.push(t)}t._cacheIndex=r.length,r.push(t),l.actionByRoot[n]=t},_removeInactiveAction:function(t){var i=this._actions,n=i[i.length-1],r=t._cacheIndex;n._cacheIndex=r,i[r]=n,i.pop(),t._cacheIndex=null;var o=t._clip.uuid,l=this._actionsByClip,b=l[o],S=b.knownActions,L=S[S.length-1],G=t._byClipCacheIndex;L._byClipCacheIndex=G,S[G]=L,S.pop(),t._byClipCacheIndex=null,delete b.actionByRoot[(t._localRoot||this._root).uuid],0===S.length&&delete l[o],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var i=t._propertyBindings,n=0,r=i.length;n!==r;++n){var o=i[n];0==--o.referenceCount&&this._removeInactiveBinding(o)}},_lendAction:function(t){var i=this._actions,n=t._cacheIndex,r=this._nActiveActions++,o=i[r];t._cacheIndex=r,i[r]=t,o._cacheIndex=n,i[n]=o},_takeBackAction:function(t){var i=this._actions,n=t._cacheIndex,r=--this._nActiveActions,o=i[r];t._cacheIndex=r,i[r]=t,o._cacheIndex=n,i[n]=o},_addInactiveBinding:function(t,i,n){var r=this._bindingsByRootAndName,o=this._bindings,l=r[i];void 0===l&&(r[i]=l={}),l[n]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var i=this._bindings,n=t.binding,r=n.rootNode.uuid,o=n.path,l=this._bindingsByRootAndName,b=l[r],S=i[i.length-1],L=t._cacheIndex;S._cacheIndex=L,i[L]=S,i.pop(),delete b[o],0===Object.keys(b).length&&delete l[r]},_lendBinding:function(t){var i=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,o=i[r];t._cacheIndex=r,i[r]=t,o._cacheIndex=n,i[n]=o},_takeBackBinding:function(t){var i=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,o=i[r];t._cacheIndex=r,i[r]=t,o._cacheIndex=n,i[n]=o},_lendControlInterpolant:function(){var t=this._controlInterpolants,i=this._nActiveControlInterpolants++,n=t[i];return void 0===n&&((n=new Rc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=i,t[i]=n),n},_takeBackControlInterpolant:function(t){var i=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,o=i[r];t.__cacheIndex=r,i[r]=t,o.__cacheIndex=n,i[n]=o},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,i,n){var r=i||this._root,o=r.uuid,l="string"==typeof t?ja.findByName(r,t):t,b=null!==l?l.uuid:t,S=this._actionsByClip[b],L=null;if(void 0===n&&(n=null!==l?l.blendMode:2500),void 0!==S){var G=S.actionByRoot[o];if(void 0!==G&&G.blendMode===n)return G;L=S.knownActions[0],null===l&&(l=L._clip)}if(null===l)return null;var U=new yy(this,l,i,n);return this._bindAction(U,L),this._addInactiveAction(U,b,o),U},existingAction:function(t,i){var n=i||this._root,r=n.uuid,o="string"==typeof t?ja.findByName(n,t):t,b=this._actionsByClip[o?o.uuid:t];return void 0!==b&&b.actionByRoot[r]||null},stopAllAction:function(){for(var t=this._actions,n=this._nActiveActions-1;n>=0;--n)t[n].stop();return this},update:function(t){for(var i=this._actions,n=this._nActiveActions,r=this.time+=t*=this.timeScale,o=Math.sign(t),l=this._accuIndex^=1,b=0;b!==n;++b)i[b]._update(r,t,o,l);for(var L=this._bindings,G=this._nActiveBindings,U=0;U!==G;++U)L[U].apply(l);return this},setTime:function(t){this.time=0;for(var i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var i=this._actions,n=t.uuid,r=this._actionsByClip,o=r[n];if(void 0!==o){for(var l=o.knownActions,b=0,S=l.length;b!==S;++b){var L=l[b];this._deactivateAction(L);var G=L._cacheIndex,U=i[i.length-1];L._cacheIndex=null,L._byClipCacheIndex=null,U._cacheIndex=G,i[G]=U,i.pop(),this._removeInactiveBindingsForAction(L)}delete r[n]}},uncacheRoot:function(t){var i=t.uuid,n=this._actionsByClip;for(var r in n){var l=n[r].actionByRoot[i];void 0!==l&&(this._deactivateAction(l),this._removeInactiveAction(l))}var S=this._bindingsByRootAndName[i];if(void 0!==S)for(var L in S){var G=S[L];G.restoreOriginalState(),this._removeInactiveBinding(G)}},uncacheAction:function(t,i){var n=this.existingAction(t,i);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});var wp=function(){function a(i){"string"==typeof i&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),i=arguments[1]),this.value=i}return a.prototype.clone=function(){return new a(void 0===this.value.clone?this.value:this.value.clone())},a}();function kd(a,t,i){Va.call(this,a,t),this.meshPerAttribute=i||1}function Hd(a,t,i,n,r){this.buffer=a,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}function Ud(a,t,i,n){this.ray=new cs(a,t),this.near=i||0,this.far=n||1/0,this.camera=null,this.layers=new Ql,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Ep(a,t){return a.distance-t.distance}function Gd(a,t,i,n){if(a.layers.test(t.layers)&&a.raycast(t,i),!0===n)for(var r=a.children,o=0,l=r.length;o<l;o++)Gd(r[o],t,i,!0)}kd.prototype=Object.assign(Object.create(Va.prototype),{constructor:kd,isInstancedInterleavedBuffer:!0,copy:function(t){return Va.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){var i=Va.prototype.clone.call(this,t);return i.meshPerAttribute=this.meshPerAttribute,i},toJSON:function(t){var i=Va.prototype.toJSON.call(this,t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}),Object.defineProperty(Hd.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Hd.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,i){return this.type=t,this.elementSize=i,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(Ud.prototype,{set:function(t,i){this.ray.set(t,i)},setFromCamera:function(t,i){i&&i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i&&i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,i,n){var r=n||[];return Gd(t,this,r,i),r.sort(Ep),r},intersectObjects:function(t,i,n){var r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var o=0,l=t.length;o<l;o++)Gd(t[o],this,r,i);return r.sort(Ep),r}});var Ay=function(){function a(i,n,r){return void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=0),this.radius=i,this.phi=n,this.theta=r,this}var t=a.prototype;return t.set=function(n,r,o){return this.radius=n,this.phi=r,this.theta=o,this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.radius=n.radius,this.phi=n.phi,this.theta=n.theta,this},t.makeSafe=function(){var n=1e-6;return this.phi=Math.max(n,Math.min(Math.PI-n,this.phi)),this},t.setFromVector3=function(n){return this.setFromCartesianCoords(n.x,n.y,n.z)},t.setFromCartesianCoords=function(n,r,o){return this.radius=Math.sqrt(n*n+r*r+o*o),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(n,o),this.phi=Math.acos(pr.clamp(r/this.radius,-1,1))),this},a}(),by=function(){function a(i,n,r){return this.radius=void 0!==i?i:1,this.theta=void 0!==n?n:0,this.y=void 0!==r?r:0,this}var t=a.prototype;return t.set=function(n,r,o){return this.radius=n,this.theta=r,this.y=o,this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.radius=n.radius,this.theta=n.theta,this.y=n.y,this},t.setFromVector3=function(n){return this.setFromCartesianCoords(n.x,n.y,n.z)},t.setFromCartesianCoords=function(n,r,o){return this.radius=Math.sqrt(n*n+o*o),this.theta=Math.atan2(n,o),this.y=r,this},a}(),xp=new cn,Mp=function(){function a(i,n){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==i?i:new cn(1/0,1/0),this.max=void 0!==n?n:new cn(-1/0,-1/0)}var t=a.prototype;return t.set=function(n,r){return this.min.copy(n),this.max.copy(r),this},t.setFromPoints=function(n){this.makeEmpty();for(var r=0,o=n.length;r<o;r++)this.expandByPoint(n[r]);return this},t.setFromCenterAndSize=function(n,r){var o=xp.copy(r).multiplyScalar(.5);return this.min.copy(n).sub(o),this.max.copy(n).add(o),this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.min.copy(n.min),this.max.copy(n.max),this},t.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},t.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},t.getCenter=function(n){return void 0===n&&(console.warn("THREE.Box2: .getCenter() target is now required"),n=new cn),this.isEmpty()?n.set(0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)},t.getSize=function(n){return void 0===n&&(console.warn("THREE.Box2: .getSize() target is now required"),n=new cn),this.isEmpty()?n.set(0,0):n.subVectors(this.max,this.min)},t.expandByPoint=function(n){return this.min.min(n),this.max.max(n),this},t.expandByVector=function(n){return this.min.sub(n),this.max.add(n),this},t.expandByScalar=function(n){return this.min.addScalar(-n),this.max.addScalar(n),this},t.containsPoint=function(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y)},t.containsBox=function(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y},t.getParameter=function(n,r){return void 0===r&&(console.warn("THREE.Box2: .getParameter() target is now required"),r=new cn),r.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y))},t.intersectsBox=function(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y)},t.clampPoint=function(n,r){return void 0===r&&(console.warn("THREE.Box2: .clampPoint() target is now required"),r=new cn),r.copy(n).clamp(this.min,this.max)},t.distanceToPoint=function(n){return xp.copy(n).clamp(this.min,this.max).sub(n).length()},t.intersect=function(n){return this.min.max(n.min),this.max.min(n.max),this},t.union=function(n){return this.min.min(n.min),this.max.max(n.max),this},t.translate=function(n){return this.min.add(n),this.max.add(n),this},t.equals=function(n){return n.min.equals(this.min)&&n.max.equals(this.max)},a}(),Tp=new ke,Zu=new ke,Sp=function(){function a(i,n){this.start=void 0!==i?i:new ke,this.end=void 0!==n?n:new ke}var t=a.prototype;return t.set=function(n,r){return this.start.copy(n),this.end.copy(r),this},t.clone=function(){return(new this.constructor).copy(this)},t.copy=function(n){return this.start.copy(n.start),this.end.copy(n.end),this},t.getCenter=function(n){return void 0===n&&(console.warn("THREE.Line3: .getCenter() target is now required"),n=new ke),n.addVectors(this.start,this.end).multiplyScalar(.5)},t.delta=function(n){return void 0===n&&(console.warn("THREE.Line3: .delta() target is now required"),n=new ke),n.subVectors(this.end,this.start)},t.distanceSq=function(){return this.start.distanceToSquared(this.end)},t.distance=function(){return this.start.distanceTo(this.end)},t.at=function(n,r){return void 0===r&&(console.warn("THREE.Line3: .at() target is now required"),r=new ke),this.delta(r).multiplyScalar(n).add(this.start)},t.closestPointToPointParameter=function(n,r){Tp.subVectors(n,this.start),Zu.subVectors(this.end,this.start);var o=Zu.dot(Zu),b=Zu.dot(Tp)/o;return r&&(b=pr.clamp(b,0,1)),b},t.closestPointToPoint=function(n,r,o){var l=this.closestPointToPointParameter(n,r);return void 0===o&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),o=new ke),this.delta(o).multiplyScalar(l).add(this.start)},t.applyMatrix4=function(n){return this.start.applyMatrix4(n),this.end.applyMatrix4(n),this},t.equals=function(n){return n.start.equals(this.start)&&n.end.equals(this.end)},a}();function Oc(a){Kn.call(this),this.material=a,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}(Oc.prototype=Object.create(Kn.prototype)).constructor=Oc,Oc.prototype.isImmediateRenderObject=!0;var Cp=new ke,wy=function(a){function t(n,r){var o;(o=a.call(this)||this).light=n,o.light.updateMatrixWorld(),o.matrix=n.matrixWorld,o.matrixAutoUpdate=!1,o.color=r;for(var l=new De,b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],S=0,L=1;S<32;S++,L++){var U=S/32*Math.PI*2,F=L/32*Math.PI*2;b.push(Math.cos(U),Math.sin(U),1,Math.cos(F),Math.sin(F),1)}l.setAttribute("position",new _n(b,3));var K=new Fi({fog:!1,toneMapped:!1});return o.cone=new _a(l,K),o.add(o.cone),o.update(),o}Qn(t,a);var i=t.prototype;return i.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},i.update=function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,o=r*Math.tan(this.light.angle);this.cone.scale.set(o,o,r),Cp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Cp),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},t}(Kn),Cs=new ke,Ju=new br,zd=new br,_p=function(a){function t(n){for(var r,o=Rp(n),l=new De,b=[],S=[],L=new Fn(0,0,1),G=new Fn(0,1,0),U=0;U<o.length;U++){var F=o[U];F.parent&&F.parent.isBone&&(b.push(0,0,0),b.push(0,0,0),S.push(L.r,L.g,L.b),S.push(G.r,G.g,G.b))}l.setAttribute("position",new _n(b,3)),l.setAttribute("color",new _n(S,3));var K=new Fi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(r=a.call(this,l,K)||this).type="SkeletonHelper",r.isSkeletonHelper=!0,r.root=n,r.bones=o,r.matrix=n.matrixWorld,r.matrixAutoUpdate=!1,r}return Qn(t,a),t.prototype.updateMatrixWorld=function(r){var o=this.bones,l=this.geometry,b=l.getAttribute("position");zd.copy(this.root.matrixWorld).invert();for(var S=0,L=0;S<o.length;S++){var G=o[S];G.parent&&G.parent.isBone&&(Ju.multiplyMatrices(zd,G.matrixWorld),Cs.setFromMatrixPosition(Ju),b.setXYZ(L,Cs.x,Cs.y,Cs.z),Ju.multiplyMatrices(zd,G.parent.matrixWorld),Cs.setFromMatrixPosition(Ju),b.setXYZ(L+1,Cs.x,Cs.y,Cs.z),L+=2)}l.getAttribute("position").needsUpdate=!0,a.prototype.updateMatrixWorld.call(this,r)},t}(_a);function Rp(a){var t=[];a&&a.isBone&&t.push(a);for(var i=0;i<a.children.length;i++)t.push.apply(t,Rp(a.children[i]));return t}var Ey=function(a){function t(n,r,o){var l,b=new Ru(r,4,2),S=new Ui({wireframe:!0,fog:!1,toneMapped:!1});return(l=a.call(this,b,S)||this).light=n,l.light.updateMatrixWorld(),l.color=o,l.type="PointLightHelper",l.matrix=l.light.matrixWorld,l.matrixAutoUpdate=!1,l.update(),l}Qn(t,a);var i=t.prototype;return i.dispose=function(){this.geometry.dispose(),this.material.dispose()},i.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},t}(kn),xy=new ke,Lp=new Fn,Pp=new Fn,My=function(a){function t(n,r,o){var l;(l=a.call(this)||this).light=n,l.light.updateMatrixWorld(),l.matrix=n.matrixWorld,l.matrixAutoUpdate=!1,l.color=o;var b=new _u(r);b.rotateY(.5*Math.PI),l.material=new Ui({wireframe:!0,fog:!1,toneMapped:!1}),void 0===l.color&&(l.material.vertexColors=!0);var S=b.getAttribute("position"),L=new Float32Array(3*S.count);return b.setAttribute("color",new Zn(L,3)),l.add(new kn(b,l.material)),l.update(),l}Qn(t,a);var i=t.prototype;return i.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},i.update=function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var o=r.geometry.getAttribute("color");Lp.copy(this.light.color),Pp.copy(this.light.groundColor);for(var l=0,b=o.count;l<b;l++){var S=l<b/2?Lp:Pp;o.setXYZ(l,S.r,S.g,S.b)}o.needsUpdate=!0}r.lookAt(xy.setFromMatrixPosition(this.light.matrixWorld).negate())},t}(Kn),Dp=function(a){function t(i,n,r,o){var l;void 0===i&&(i=10),void 0===n&&(n=10),void 0===r&&(r=4473924),void 0===o&&(o=8947848),r=new Fn(r),o=new Fn(o);for(var b=n/2,S=i/n,L=i/2,G=[],U=[],F=0,K=0,Q=-L;F<=n;F++,Q+=S){G.push(-L,0,Q,L,0,Q),G.push(Q,0,-L,Q,0,L);var re=F===b?r:o;re.toArray(U,K),re.toArray(U,K+=3),re.toArray(U,K+=3),re.toArray(U,K+=3),K+=3}var ve=new De;ve.setAttribute("position",new _n(G,3)),ve.setAttribute("color",new _n(U,3));var oe=new Fi({vertexColors:!0,toneMapped:!1});return(l=a.call(this,ve,oe)||this).type="GridHelper",l}return Qn(t,a),t}(_a),Ty=function(a){function t(i,n,r,o,l,b){var S;void 0===i&&(i=10),void 0===n&&(n=16),void 0===r&&(r=8),void 0===o&&(o=64),void 0===l&&(l=4473924),void 0===b&&(b=8947848),l=new Fn(l),b=new Fn(b);for(var L=[],G=[],U=0;U<=n;U++){var F=U/n*(2*Math.PI),K=Math.sin(F)*i,Q=Math.cos(F)*i;L.push(0,0,0),L.push(K,0,Q);var re=1&U?l:b;G.push(re.r,re.g,re.b),G.push(re.r,re.g,re.b)}for(var ve=0;ve<=r;ve++)for(var oe=1&ve?l:b,Z=i-i/r*ve,Te=0;Te<o;Te++){var Be=Te/o*(2*Math.PI),we=Math.sin(Be)*Z,Ae=Math.cos(Be)*Z;L.push(we,0,Ae),G.push(oe.r,oe.g,oe.b),Be=(Te+1)/o*(2*Math.PI),we=Math.sin(Be)*Z,Ae=Math.cos(Be)*Z,L.push(we,0,Ae),G.push(oe.r,oe.g,oe.b)}var Le=new De;Le.setAttribute("position",new _n(L,3)),Le.setAttribute("color",new _n(G,3));var tt=new Fi({vertexColors:!0,toneMapped:!1});return(S=a.call(this,Le,tt)||this).type="PolarGridHelper",S}return Qn(t,a),t}(_a),Ip=new ke,$u=new ke,Op=new ke,Sy=function(a){function t(n,r,o){var l;(l=a.call(this)||this).light=n,l.light.updateMatrixWorld(),l.matrix=n.matrixWorld,l.matrixAutoUpdate=!1,l.color=o,void 0===r&&(r=1);var b=new De;b.setAttribute("position",new _n([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));var S=new Fi({fog:!1,toneMapped:!1});return l.lightPlane=new eo(b,S),l.add(l.lightPlane),(b=new De).setAttribute("position",new _n([0,0,0,0,0,1],3)),l.targetLine=new eo(b,S),l.add(l.targetLine),l.update(),l}Qn(t,a);var i=t.prototype;return i.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},i.update=function(){Ip.setFromMatrixPosition(this.light.matrixWorld),$u.setFromMatrixPosition(this.light.target.matrixWorld),Op.subVectors($u,Ip),this.lightPlane.lookAt($u),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($u),this.targetLine.scale.z=Op.length()},t}(Kn),eh=new ke,Wi=new xi,Cy=function(a){function t(n){var r,o=new De,l=new Fi({color:16777215,vertexColors:!0,toneMapped:!1}),b=[],S=[],L={},G=new Fn(16755200),U=new Fn(16711680),F=new Fn(43775),K=new Fn(16777215),Q=new Fn(3355443);function re(oe,Z,Te){ve(oe,Te),ve(Z,Te)}function ve(oe,Z){b.push(0,0,0),S.push(Z.r,Z.g,Z.b),void 0===L[oe]&&(L[oe]=[]),L[oe].push(b.length/3-1)}return re("n1","n2",G),re("n2","n4",G),re("n4","n3",G),re("n3","n1",G),re("f1","f2",G),re("f2","f4",G),re("f4","f3",G),re("f3","f1",G),re("n1","f1",G),re("n2","f2",G),re("n3","f3",G),re("n4","f4",G),re("p","n1",U),re("p","n2",U),re("p","n3",U),re("p","n4",U),re("u1","u2",F),re("u2","u3",F),re("u3","u1",F),re("c","t",K),re("p","c",Q),re("cn1","cn2",Q),re("cn3","cn4",Q),re("cf1","cf2",Q),re("cf3","cf4",Q),o.setAttribute("position",new _n(b,3)),o.setAttribute("color",new _n(S,3)),(r=a.call(this,o,l)||this).type="CameraHelper",r.camera=n,r.camera.updateProjectionMatrix&&r.camera.updateProjectionMatrix(),r.matrix=n.matrixWorld,r.matrixAutoUpdate=!1,r.pointMap=L,r.update(),r}return Qn(t,a),t.prototype.update=function(){var r=this.geometry,o=this.pointMap;Wi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Xi("c",o,r,Wi,0,0,-1),Xi("t",o,r,Wi,0,0,1),Xi("n1",o,r,Wi,-1,-1,-1),Xi("n2",o,r,Wi,1,-1,-1),Xi("n3",o,r,Wi,-1,1,-1),Xi("n4",o,r,Wi,1,1,-1),Xi("f1",o,r,Wi,-1,-1,1),Xi("f2",o,r,Wi,1,-1,1),Xi("f3",o,r,Wi,-1,1,1),Xi("f4",o,r,Wi,1,1,1),Xi("u1",o,r,Wi,.7,1.1,-1),Xi("u2",o,r,Wi,-.7,1.1,-1),Xi("u3",o,r,Wi,0,2,-1),Xi("cf1",o,r,Wi,-1,0,1),Xi("cf2",o,r,Wi,1,0,1),Xi("cf3",o,r,Wi,0,-1,1),Xi("cf4",o,r,Wi,0,1,1),Xi("cn1",o,r,Wi,-1,0,-1),Xi("cn2",o,r,Wi,1,0,-1),Xi("cn3",o,r,Wi,0,-1,-1),Xi("cn4",o,r,Wi,0,1,-1),r.getAttribute("position").needsUpdate=!0},t}(_a);function Xi(a,t,i,n,r,o,l){eh.set(r,o,l).unproject(n);var b=t[a];if(void 0!==b)for(var S=i.getAttribute("position"),L=0,G=b.length;L<G;L++)S.setXYZ(b[L],eh.x,eh.y,eh.z)}var nh,Vd,$o,th=new ca,Bp=function(a){function t(n,r){var o;void 0===r&&(r=16776960);var l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),b=new Float32Array(24),S=new De;return S.setIndex(new Zn(l,1)),S.setAttribute("position",new Zn(b,3)),(o=a.call(this,S,new Fi({color:r,toneMapped:!1}))||this).object=n,o.type="BoxHelper",o.matrixAutoUpdate=!1,o.update(),o}Qn(t,a);var i=t.prototype;return i.update=function(r){if(void 0!==r&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&th.setFromObject(this.object),!th.isEmpty()){var o=th.min,l=th.max,b=this.geometry.attributes.position,S=b.array;S[0]=l.x,S[1]=l.y,S[2]=l.z,S[3]=o.x,S[4]=l.y,S[5]=l.z,S[6]=o.x,S[7]=o.y,S[8]=l.z,S[9]=l.x,S[10]=o.y,S[11]=l.z,S[12]=l.x,S[13]=l.y,S[14]=o.z,S[15]=o.x,S[16]=l.y,S[17]=o.z,S[18]=o.x,S[19]=o.y,S[20]=o.z,S[21]=l.x,S[22]=o.y,S[23]=o.z,b.needsUpdate=!0,this.geometry.computeBoundingSphere()}},i.setFromObject=function(r){return this.object=r,this.update(),this},i.copy=function(r){return _a.prototype.copy.call(this,r),this.object=r.object,this},t}(_a),_y=function(a){function t(n,r){var o;void 0===r&&(r=16776960);var l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),S=new De;return S.setIndex(new Zn(l,1)),S.setAttribute("position",new _n([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(o=a.call(this,S,new Fi({color:r,toneMapped:!1}))||this).box=n,o.type="Box3Helper",o.geometry.computeBoundingSphere(),o}return Qn(t,a),t.prototype.updateMatrixWorld=function(r){var o=this.box;o.isEmpty()||(o.getCenter(this.position),o.getSize(this.scale),this.scale.multiplyScalar(.5),a.prototype.updateMatrixWorld.call(this,r))},t}(_a),Ry=function(a){function t(n,r,o){var l;void 0===r&&(r=1),void 0===o&&(o=16776960);var b=o,L=new De;L.setAttribute("position",new _n([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),L.computeBoundingSphere(),(l=a.call(this,L,new Fi({color:b,toneMapped:!1}))||this).type="PlaneHelper",l.plane=n,l.size=r;var U=new De;return U.setAttribute("position",new _n([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),U.computeBoundingSphere(),l.add(new kn(U,new Ui({color:b,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),l}return Qn(t,a),t.prototype.updateMatrixWorld=function(r){var o=-this.plane.constant;Math.abs(o)<1e-8&&(o=1e-8),this.scale.set(.5*this.size,.5*this.size,o),this.children[0].material.side=o<0?1:0,this.lookAt(this.plane.normal),a.prototype.updateMatrixWorld.call(this,r)},t}(eo),Fp=new ke,Ly=function(a){function t(n,r,o,l,b,S){var L;return(L=a.call(this)||this).type="ArrowHelper",void 0===n&&(n=new ke(0,0,1)),void 0===r&&(r=new ke(0,0,0)),void 0===o&&(o=1),void 0===l&&(l=16776960),void 0===b&&(b=.2*o),void 0===S&&(S=.2*b),void 0===nh&&((nh=new De).setAttribute("position",new _n([0,0,0,0,1,0],3)),(Vd=new xc(0,.5,1,5,1)).translate(0,-.5,0)),L.position.copy(r),L.line=new eo(nh,new Fi({color:l,toneMapped:!1})),L.line.matrixAutoUpdate=!1,L.add(L.line),L.cone=new kn(Vd,new Ui({color:l,toneMapped:!1})),L.cone.matrixAutoUpdate=!1,L.add(L.cone),L.setDirection(n),L.setLength(o,b,S),L}Qn(t,a);var i=t.prototype;return i.setDirection=function(r){if(r.y>.99999)this.quaternion.set(0,0,0,1);else if(r.y<-.99999)this.quaternion.set(1,0,0,0);else{Fp.set(r.z,0,-r.x).normalize();var o=Math.acos(r.y);this.quaternion.setFromAxisAngle(Fp,o)}},i.setLength=function(r,o,l){void 0===o&&(o=.2*r),void 0===l&&(l=.2*o),this.line.scale.set(1,Math.max(1e-4,r-o),1),this.line.updateMatrix(),this.cone.scale.set(l,o,l),this.cone.position.y=r,this.cone.updateMatrix()},i.setColor=function(r){this.line.material.color.set(r),this.cone.material.color.set(r)},i.copy=function(r){return a.prototype.copy.call(this,r,!1),this.line.copy(r.line),this.cone.copy(r.cone),this},t}(Kn),Np=function(a){function t(i){var n;void 0===i&&(i=1);var r=[0,0,0,i,0,0,0,0,0,0,i,0,0,0,0,0,0,i],l=new De;l.setAttribute("position",new _n(r,3)),l.setAttribute("color",new _n([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var b=new Fi({vertexColors:!0,toneMapped:!1});return(n=a.call(this,l,b)||this).type="AxesHelper",n}return Qn(t,a),t}(_a),kp=new Float32Array(1),Py=new Int32Array(kp.buffer),Dy={toHalfFloat:function(t){kp[0]=t;var i=Py[0],n=i>>16&32768,r=i>>12&2047,o=i>>23&255;return o<103?n:o>142?(n|=31744,n|=(255==o?0:1)&&8388607&i):o<113?n|=((r|=2048)>>114-o)+(r>>113-o&1):(n|=o-112<<10|r>>1,n+=1&r)}},Fo=Math.pow(2,8),Hp=[.125,.215,.35,.446,.526,.582],Up=5+Hp.length,No=(($o={})[qr]=0,$o[Mo]=1,$o[3002]=2,$o[3004]=3,$o[3005]=4,$o[3006]=5,$o[3007]=6,$o),Wd=new Fl,jd=By(),Bc=jd._lodPlanes,Gp=jd._sizeLods,rh=jd._sigmas,Xd=null,el=(1+Math.sqrt(5))/2,Hl=1/el,zp=[new ke(1,1,1),new ke(-1,1,1),new ke(1,1,-1),new ke(-1,1,-1),new ke(0,el,Hl),new ke(0,el,-Hl),new ke(Hl,0,el),new ke(-Hl,0,el),new ke(el,Hl,0),new ke(-el,Hl,0)],Iy=function(){function a(i){this._renderer=i,this._pingPongRenderTarget=null,this._blurMaterial=function Fy(a){return new Qo({name:"SphericalGaussianBlur",defines:{n:a},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(a)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new ke(0,1,0)},inputEncoding:{value:No[qr]},outputEncoding:{value:No[qr]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}var t=a.prototype;return t.fromScene=function(n,r,o,l){void 0===r&&(r=0),void 0===o&&(o=.1),void 0===l&&(l=100),Xd=this._renderer.getRenderTarget();var b=this._allocateTargets();return this._sceneToCubeUV(n,o,l,b),r>0&&this._blur(b,0,0,r),this._applyPMREM(b),this._cleanup(b),b},t.fromEquirectangular=function(n){return this._fromTexture(n)},t.fromCubemap=function(n){return this._fromTexture(n)},t.compileCubemapShader=function(){null===this._cubemapShader&&(this._cubemapShader=jp(),this._compileMaterial(this._cubemapShader))},t.compileEquirectangularShader=function(){null===this._equirectShader&&(this._equirectShader=Wp(),this._compileMaterial(this._equirectShader))},t.dispose=function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var n=0;n<Bc.length;n++)Bc[n].dispose()},t._cleanup=function(n){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Xd),n.scissorTest=!1,ih(n,0,0,n.width,n.height)},t._fromTexture=function(n){Xd=this._renderer.getRenderTarget();var r=this._allocateTargets(n);return this._textureToCubeUV(n,r),this._applyPMREM(r),this._cleanup(r),r},t._allocateTargets=function(n){var r={magFilter:St,minFilter:St,generateMipmaps:!1,type:Ft,format:1023,encoding:Oy(n)?n.encoding:3002,depthBuffer:!1},o=Vp(r);return o.depthBuffer=!n,this._pingPongRenderTarget=Vp(r),o},t._compileMaterial=function(n){var r=new kn(Bc[0],n);this._renderer.compile(r,Wd)},t._sceneToCubeUV=function(n,r,o,l){var L=new dr(90,1,r,o),G=[1,-1,1,1,1,1],U=[1,1,1,-1,-1,-1],F=this._renderer,K=F.outputEncoding,Q=F.toneMapping,re=F.getClearColor(),ve=F.getClearAlpha();F.toneMapping=0,F.outputEncoding=qr;var oe=n.background;if(oe&&oe.isColor){oe.convertSRGBToLinear();var Z=Math.max(oe.r,oe.g,oe.b),Te=Math.min(Math.max(Math.ceil(Math.log2(Z)),-128),127);oe=oe.multiplyScalar(Math.pow(2,-Te)),F.setClearColor(oe,(Te+128)/255),n.background=null}for(var we=0;we<6;we++){var Ae=we%3;0==Ae?(L.up.set(0,G[we],0),L.lookAt(U[we],0,0)):1==Ae?(L.up.set(0,0,G[we]),L.lookAt(0,U[we],0)):(L.up.set(0,G[we],0),L.lookAt(0,0,U[we])),ih(l,Ae*Fo,we>2?Fo:0,Fo,Fo),F.setRenderTarget(l),F.render(n,L)}F.toneMapping=Q,F.outputEncoding=K,F.setClearColor(re,ve)},t._textureToCubeUV=function(n,r){var o=this._renderer;n.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=jp()):null==this._equirectShader&&(this._equirectShader=Wp());var l=n.isCubeTexture?this._cubemapShader:this._equirectShader,b=new kn(Bc[0],l),S=l.uniforms;S.envMap.value=n,n.isCubeTexture||S.texelSize.value.set(1/n.image.width,1/n.image.height),S.inputEncoding.value=No[n.encoding],S.outputEncoding.value=No[r.texture.encoding],ih(r,0,0,3*Fo,2*Fo),o.setRenderTarget(r),o.render(b,Wd)},t._applyPMREM=function(n){var r=this._renderer,o=r.autoClear;r.autoClear=!1;for(var l=1;l<Up;l++){var b=Math.sqrt(rh[l]*rh[l]-rh[l-1]*rh[l-1]);this._blur(n,l-1,l,b,zp[(l-1)%zp.length])}r.autoClear=o},t._blur=function(n,r,o,l,b){var S=this._pingPongRenderTarget;this._halfBlur(n,S,r,o,l,"latitudinal",b),this._halfBlur(S,n,o,o,l,"longitudinal",b)},t._halfBlur=function(n,r,o,l,b,S,L){var G=this._renderer,U=this._blurMaterial;"latitudinal"!==S&&"longitudinal"!==S&&console.error("blur direction must be either latitudinal or longitudinal!");var K=new kn(Bc[l],U),Q=U.uniforms,re=Gp[o]-1,ve=isFinite(b)?Math.PI/(2*re):2*Math.PI/39,oe=b/ve,Z=isFinite(b)?1+Math.floor(3*oe):20;Z>20&&console.warn("sigmaRadians, "+b+", is too large and will clip, as it requested "+Z+" samples when the maximum is set to 20");for(var Te=[],Be=0,we=0;we<20;++we){var Ae=we/oe,Le=Math.exp(-Ae*Ae/2);Te.push(Le),0==we?Be+=Le:we<Z&&(Be+=2*Le)}for(var tt=0;tt<Te.length;tt++)Te[tt]=Te[tt]/Be;Q.envMap.value=n.texture,Q.samples.value=Z,Q.weights.value=Te,Q.latitudinal.value="latitudinal"===S,L&&(Q.poleAxis.value=L),Q.dTheta.value=ve,Q.mipInt.value=8-o,Q.inputEncoding.value=No[n.texture.encoding],Q.outputEncoding.value=No[n.texture.encoding];var Ze=Gp[l];ih(r,3*Math.max(0,Fo-2*Ze),(0===l?0:2*Fo)+2*Ze*(l>4?l-8+4:0),3*Ze,2*Ze),G.setRenderTarget(r),G.render(K,Wd)},a}();function Oy(a){return void 0!==a&&a.type===Ft&&(a.encoding===qr||a.encoding===Mo||3007===a.encoding)}function By(){for(var a=[],t=[],i=[],n=8,r=0;r<Up;r++){var o=Math.pow(2,n);t.push(o);var l=1/o;r>4?l=Hp[r-8+4-1]:0==r&&(l=0),i.push(l);for(var b=1/(o-1),S=-b/2,L=1+b/2,G=[S,S,L,S,L,L,S,S,L,L,S,L],ve=new Float32Array(108),oe=new Float32Array(72),Z=new Float32Array(36),Te=0;Te<6;Te++){var Be=Te%3*2/3-1,we=Te>2?0:-1;ve.set([Be,we,0,Be+2/3,we,0,Be+2/3,we+1,0,Be,we,0,Be+2/3,we+1,0,Be,we+1,0],18*Te),oe.set(G,12*Te),Z.set([Te,Te,Te,Te,Te,Te],6*Te)}var tt=new De;tt.setAttribute("position",new Zn(ve,3)),tt.setAttribute("uv",new Zn(oe,2)),tt.setAttribute("faceIndex",new Zn(Z,1)),a.push(tt),n>4&&n--}return{_lodPlanes:a,_sizeLods:t,_sigmas:i}}function Vp(a){var t=new Sa(3*Fo,3*Fo,a);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function ih(a,t,i,n,r){a.viewport.set(t,i,n,r),a.scissor.set(t,i,n,r)}function Wp(){return new Qo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new cn(1,1)},inputEncoding:{value:No[qr]},outputEncoding:{value:No[qr]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function jp(){return new Qo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:No[qr]},outputEncoding:{value:No[qr]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Xp(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Aa.call(this,a),this.type="catmullrom",this.closed=!0}function qp(a){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Aa.call(this,a),this.type="catmullrom"}function Kd(a){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Aa.call(this,a),this.type="catmullrom"}sr.create=function(a,t){return console.log("THREE.Curve.create() has been deprecated"),a.prototype=Object.create(sr.prototype),a.prototype.constructor=a,a.prototype.getPoint=t,a},Object.assign(Zo.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var i=this.getPoints(t);return this.createGeometry(i)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var i=this.getSpacedPoints(t);return this.createGeometry(i)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var i=new Mi,n=0,r=t.length;n<r;n++){var o=t[n];i.vertices.push(new ke(o.x,o.y,o.z||0))}return i}}),Object.assign(bo.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Xp.prototype=Object.create(Aa.prototype),qp.prototype=Object.create(Aa.prototype),Kd.prototype=Object.create(Aa.prototype),Object.assign(Kd.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Dp.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},_p.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ei.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Td.extractUrlBase(t)}}),Ei.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Mp.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(ca.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(ao.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),wi.prototype.setFromMatrix=function(a){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(a)},Sp.prototype.center=function(a){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(a)},Object.assign(pr,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),pr.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),pr.ceilPowerOfTwo(t)}}),Object.assign(da.prototype,{flattenToArrayOffset:function(t,i){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,i)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(br.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,i){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,i)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new ke).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,i,n,r,o,l){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,i,r,n,o,l)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Ja.prototype.isIntersectionLine=function(a){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(a)},Object.assign(Zi.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(cs.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Ha.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,i)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Ha,{barycoordFromPoint:function(t,i,n,r,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ha.getBarycoord(t,i,n,r,o)},normal:function(t,i,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ha.getNormal(t,i,n,r)}}),Object.assign(Ss.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new nd(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new sd(this,t)}}),Object.assign(cn.prototype,{fromAttribute:function(t,i,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,i,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ke.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,i){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(i,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,i,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,i,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ui.prototype,{fromAttribute:function(t,i,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,i,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Mi.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(Kn.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,i){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(i,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Kn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(kn.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(kn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(mc.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ac.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),gc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(sr.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),dr.prototype.setLens=function(a,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(a)},Object.defineProperties(Li.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Zn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Za},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Za)}}}),Object.assign(Zn.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Za:So),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(De.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,i){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),i&&i.isBufferAttribute||i&&i.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(i),this):this.setAttribute(t,i):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Zn(arguments[1],arguments[2])))},addDrawCall:function(t,i,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,i)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(De.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ic.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Ud.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Va.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Za},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Va.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Za:So),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Cc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(zh.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(wp.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(fr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Fn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Ts.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ms.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(Kr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(hc.prototype,{clearTarget:function(t,i,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(i,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(hc.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Mo:qr}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Af.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Sa.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Id.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var i=this;return(new Qu).load(t,function(r){i.setBuffer(r)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),yp.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},hi.prototype.updateCubeMap=function(a,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(a,t)},hi.prototype.clear=function(a,t,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(a,t,i,n)};var vA={merge:function(t,i,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),i.isMesh&&(i.matrixAutoUpdate&&i.updateMatrix(),r=i.matrix,i=i.geometry),t.merge(i,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};Go.crossOrigin=void 0,Go.loadTexture=function(a,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new ku;r.setCrossOrigin(this.crossOrigin);var o=r.load(a,i,void 0,n);return t&&(o.mapping=t),o},Go.loadTextureCube=function(a,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Fu;r.setCrossOrigin(this.crossOrigin);var o=r.load(a,i,void 0,n);return t&&(o.mapping=t),o},Go.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Go.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var yA={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"123"}})),s.ACESFilmicToneMapping=4,s.AddEquation=100,s.AddOperation=2,s.AdditiveAnimationBlendMode=2501,s.AdditiveBlending=2,s.AlphaFormat=1021,s.AlwaysDepth=1,s.AlwaysStencilFunc=519,s.AmbientLight=Wu,s.AmbientLightProbe=Dd,s.AnimationClip=ja,s.AnimationLoader=vd,s.AnimationMixer=Nd,s.AnimationObjectGroup=bp,s.AnimationUtils=Oi,s.ArcCurve=Bl,s.ArrayCamera=cc,s.ArrowHelper=Ly,s.Audio=Id,s.AudioAnalyser=yp,s.AudioContext=Ld,s.AudioListener=sy,s.AudioLoader=Qu,s.AxesHelper=Np,s.AxisHelper=function lA(a){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Np(a)},s.BackSide=1,s.BasicDepthPacking=3200,s.BasicShadowMap=0,s.BinaryTextureLoader=function fA(a){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Nu(a)},s.Bone=yc,s.BooleanKeyframeTrack=Du,s.BoundingBoxHelper=function cA(a,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Bp(a,t)},s.Box2=Mp,s.Box3=ca,s.Box3Helper=_y,s.BoxBufferGeometry=gr,s.BoxGeometry=Yh,s.BoxHelper=Bp,s.BufferAttribute=Zn,s.BufferGeometry=De,s.BufferGeometryLoader=Yu,s.ByteType=1010,s.Cache=Ks,s.Camera=xi,s.CameraHelper=Cy,s.CanvasRenderer=function mA(){console.error("THREE.CanvasRenderer has been removed")},s.CanvasTexture=wc,s.CatmullRomCurve3=Aa,s.CineonToneMapping=3,s.CircleBufferGeometry=Kh,s.CircleGeometry=kf,s.ClampToEdgeWrapping=ot,s.Clock=pp,s.ClosedSplineCurve3=Xp,s.Color=Fn,s.ColorKeyframeTrack=Iu,s.CompressedTexture=_l,s.CompressedTextureLoader=md,s.ConeBufferGeometry=Uf,s.ConeGeometry=Hf,s.CubeCamera=hi,s.CubeGeometry=Yh,s.CubeReflectionMapping=301,s.CubeRefractionMapping=302,s.CubeTexture=ai,s.CubeTextureLoader=Fu,s.CubeUVReflectionMapping=306,s.CubeUVRefractionMapping=307,s.CubicBezierCurve=mo,s.CubicBezierCurve3=Oo,s.CubicInterpolant=Lu,s.CullFaceBack=1,s.CullFaceFront=2,s.CullFaceFrontBack=3,s.CullFaceNone=0,s.Curve=sr,s.CurvePath=Zo,s.CustomBlending=5,s.CustomToneMapping=5,s.CylinderBufferGeometry=xc,s.CylinderGeometry=Qh,s.Cylindrical=by,s.DataTexture=Gi,s.DataTexture2DArray=bl,s.DataTexture3D=wl,s.DataTextureLoader=Nu,s.DataUtils=Dy,s.DecrementStencilOp=7683,s.DecrementWrapStencilOp=34056,s.DefaultLoadingManager=op,s.DepthFormat=yt,s.DepthStencilFormat=Nt,s.DepthTexture=Ec,s.DirectionalLight=Vu,s.DirectionalLightHelper=Sy,s.DiscreteInterpolant=Pu,s.DodecahedronBufferGeometry=Zh,s.DodecahedronGeometry=Gf,s.DoubleSide=2,s.DstAlphaFactor=206,s.DstColorFactor=208,s.DynamicBufferAttribute=function Jy(a,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Zn(a,t).setUsage(Za)},s.DynamicCopyUsage=35050,s.DynamicDrawUsage=Za,s.DynamicReadUsage=35049,s.EdgesGeometry=$h,s.EdgesHelper=function uA(a,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new _a(new $h(a.geometry),new Fi({color:void 0!==t?t:16777215}))},s.EllipseCurve=Xa,s.EqualDepth=4,s.EqualStencilFunc=514,s.EquirectangularReflectionMapping=303,s.EquirectangularRefractionMapping=304,s.Euler=dl,s.EventDispatcher=na,s.ExtrudeBufferGeometry=Cc,s.ExtrudeGeometry=nd,s.Face3=ds,s.Face4=function Ny(a,t,i,n,r,o,l){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new ds(a,t,i,r,o,l)},s.FaceColors=1,s.FileLoader=to,s.FlatShading=1,s.Float16BufferAttribute=Hs,s.Float32Attribute=function oA(a,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new _n(a,t)},s.Float32BufferAttribute=_n,s.Float64Attribute=function sA(a,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ne(a,t)},s.Float64BufferAttribute=Ne,s.FloatType=xn,s.Fog=Sf,s.FogExp2=Tf,s.Font=_d,s.FontLoader=Rd,s.FrontSide=0,s.Frustum=wi,s.GLBufferAttribute=Hd,s.GLSL1="100",s.GLSL3=al,s.GammaEncoding=3007,s.Geometry=Mi,s.GeometryUtils=vA,s.GreaterDepth=6,s.GreaterEqualDepth=5,s.GreaterEqualStencilFunc=518,s.GreaterStencilFunc=516,s.GridHelper=Dp,s.Group=Yo,s.HalfFloatType=nr,s.HemisphereLight=Uu,s.HemisphereLightHelper=My,s.HemisphereLightProbe=Pd,s.IcosahedronBufferGeometry=rd,s.IcosahedronGeometry=Yf,s.ImageBitmapLoader=Sd,s.ImageLoader=Ol,s.ImageUtils=Go,s.ImmediateRenderObject=Oc,s.IncrementStencilOp=7682,s.IncrementWrapStencilOp=34055,s.InstancedBufferAttribute=qu,s.InstancedBufferGeometry=Ic,s.InstancedInterleavedBuffer=kd,s.InstancedMesh=pu,s.Int16Attribute=function nA(a,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ns(a,t)},s.Int16BufferAttribute=Ns,s.Int32Attribute=function iA(a,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new ks(a,t)},s.Int32BufferAttribute=ks,s.Int8Attribute=function $y(a,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ga(a,t)},s.Int8BufferAttribute=ga,s.IntType=1013,s.InterleavedBuffer=Va,s.InterleavedBufferAttribute=ws,s.Interpolant=Wa,s.InterpolateDiscrete=Ba,s.InterpolateLinear=Fa,s.InterpolateSmooth=2302,s.InvertStencilOp=5386,s.JSONLoader=function gA(){console.error("THREE.JSONLoader has been removed.")},s.KeepStencilOp=7680,s.KeyframeTrack=va,s.LOD=mc,s.LatheBufferGeometry=id,s.LatheGeometry=Kf,s.Layers=Ql,s.LensFlare=function AA(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},s.LessDepth=2,s.LessEqualDepth=3,s.LessEqualStencilFunc=515,s.LessStencilFunc=513,s.Light=Li,s.LightProbe=no,s.Line=eo,s.Line3=Sp,s.LineBasicMaterial=Fi,s.LineCurve=Ia,s.LineCurve3=go,s.LineDashedMaterial=Ys,s.LineLoop=Au,s.LinePieces=1,s.LineSegments=_a,s.LineStrip=0,s.LinearEncoding=qr,s.LinearFilter=We,s.LinearInterpolant=Rc,s.LinearMipMapLinearFilter=1008,s.LinearMipMapNearestFilter=1007,s.LinearMipmapLinearFilter=Ht,s.LinearMipmapNearestFilter=1007,s.LinearToneMapping=1,s.Loader=Ei,s.LoaderUtils=Td,s.LoadingManager=pd,s.LogLuvEncoding=3003,s.LoopOnce=2200,s.LoopPingPong=2202,s.LoopRepeat=2201,s.LuminanceAlphaFormat=1025,s.LuminanceFormat=1024,s.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s.Material=fr,s.MaterialLoader=Xu,s.Math=pr,s.MathUtils=pr,s.Matrix3=da,s.Matrix4=br,s.MaxEquation=104,s.Mesh=kn,s.MeshBasicMaterial=Ui,s.MeshDepthMaterial=As,s.MeshDistanceMaterial=bs,s.MeshFaceMaterial=function Vy(a){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),a},s.MeshLambertMaterial=Xs,s.MeshMatcapMaterial=qs,s.MeshNormalMaterial=js,s.MeshPhongMaterial=Ts,s.MeshPhysicalMaterial=Ms,s.MeshStandardMaterial=Io,s.MeshToonMaterial=Ws,s.MinEquation=103,s.MirroredRepeatWrapping=dt,s.MixOperation=1,s.MultiMaterial=function Wy(a){return void 0===a&&(a=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),a.isMultiMaterial=!0,a.materials=a,a.clone=function(){return a.slice()},a},s.MultiplyBlending=4,s.MultiplyOperation=0,s.NearestFilter=St,s.NearestMipMapLinearFilter=1005,s.NearestMipMapNearestFilter=1004,s.NearestMipmapLinearFilter=1005,s.NearestMipmapNearestFilter=1004,s.NeverDepth=0,s.NeverStencilFunc=512,s.NoBlending=0,s.NoColors=0,s.NoToneMapping=0,s.NormalAnimationBlendMode=2500,s.NormalBlending=1,s.NotEqualDepth=7,s.NotEqualStencilFunc=517,s.NumberKeyframeTrack=Dl,s.Object3D=Kn,s.ObjectLoader=ny,s.ObjectSpaceNormalMap=1,s.OctahedronBufferGeometry=_u,s.OctahedronGeometry=Qf,s.OneFactor=201,s.OneMinusDstAlphaFactor=207,s.OneMinusDstColorFactor=209,s.OneMinusSrcAlphaFactor=205,s.OneMinusSrcColorFactor=203,s.OrthographicCamera=Fl,s.PCFShadowMap=1,s.PCFSoftShadowMap=2,s.PMREMGenerator=Iy,s.ParametricBufferGeometry=Pl,s.ParametricGeometry=_c,s.Particle=function Xy(a){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new vc(a)},s.ParticleBasicMaterial=function Ky(a){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new po(a)},s.ParticleSystem=function qy(a,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Cl(a,t)},s.ParticleSystemMaterial=function Qy(a){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new po(a)},s.Path=bo,s.PerspectiveCamera=dr,s.Plane=Ja,s.PlaneBufferGeometry=ia,s.PlaneGeometry=Zf,s.PlaneHelper=Ry,s.PointCloud=function jy(a,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Cl(a,t)},s.PointCloudMaterial=function Yy(a){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new po(a)},s.PointLight=zu,s.PointLightHelper=Ey,s.Points=Cl,s.PointsMaterial=po,s.PolarGridHelper=Ty,s.PolyhedronBufferGeometry=zs,s.PolyhedronGeometry=Jf,s.PositionalAudio=cy,s.PropertyBinding=ba,s.PropertyMixer=Od,s.QuadraticBezierCurve=yo,s.QuadraticBezierCurve3=Bo,s.Quaternion=Zi,s.QuaternionKeyframeTrack=Lc,s.QuaternionLinearInterpolant=Ou,s.REVISION="123",s.RGBADepthPacking=3201,s.RGBAFormat=Pr,s.RGBAIntegerFormat=1033,s.RGBA_ASTC_10x10_Format=37819,s.RGBA_ASTC_10x5_Format=37816,s.RGBA_ASTC_10x6_Format=37817,s.RGBA_ASTC_10x8_Format=37818,s.RGBA_ASTC_12x10_Format=37820,s.RGBA_ASTC_12x12_Format=37821,s.RGBA_ASTC_4x4_Format=37808,s.RGBA_ASTC_5x4_Format=37809,s.RGBA_ASTC_5x5_Format=37810,s.RGBA_ASTC_6x5_Format=37811,s.RGBA_ASTC_6x6_Format=37812,s.RGBA_ASTC_8x5_Format=37813,s.RGBA_ASTC_8x6_Format=37814,s.RGBA_ASTC_8x8_Format=37815,s.RGBA_BPTC_Format=36492,s.RGBA_ETC2_EAC_Format=37496,s.RGBA_PVRTC_2BPPV1_Format=35843,s.RGBA_PVRTC_4BPPV1_Format=35842,s.RGBA_S3TC_DXT1_Format=33777,s.RGBA_S3TC_DXT3_Format=33778,s.RGBA_S3TC_DXT5_Format=33779,s.RGBDEncoding=3006,s.RGBEEncoding=3002,s.RGBEFormat=1023,s.RGBFormat=ti,s.RGBIntegerFormat=1032,s.RGBM16Encoding=3005,s.RGBM7Encoding=3004,s.RGB_ETC1_Format=36196,s.RGB_ETC2_Format=37492,s.RGB_PVRTC_2BPPV1_Format=35841,s.RGB_PVRTC_4BPPV1_Format=35840,s.RGB_S3TC_DXT1_Format=33776,s.RGFormat=1030,s.RGIntegerFormat=1031,s.RawShaderMaterial=Qo,s.Ray=cs,s.Raycaster=Ud,s.RectAreaLight=ju,s.RedFormat=1028,s.RedIntegerFormat=1029,s.ReinhardToneMapping=2,s.RepeatWrapping=at,s.ReplaceStencilOp=7681,s.ReverseSubtractEquation=102,s.RingBufferGeometry=ad,s.RingGeometry=$f,s.SRGB8_ALPHA8_ASTC_10x10_Format=37851,s.SRGB8_ALPHA8_ASTC_10x5_Format=37848,s.SRGB8_ALPHA8_ASTC_10x6_Format=37849,s.SRGB8_ALPHA8_ASTC_10x8_Format=37850,s.SRGB8_ALPHA8_ASTC_12x10_Format=37852,s.SRGB8_ALPHA8_ASTC_12x12_Format=37853,s.SRGB8_ALPHA8_ASTC_4x4_Format=37840,s.SRGB8_ALPHA8_ASTC_5x4_Format=37841,s.SRGB8_ALPHA8_ASTC_5x5_Format=37842,s.SRGB8_ALPHA8_ASTC_6x5_Format=37843,s.SRGB8_ALPHA8_ASTC_6x6_Format=37844,s.SRGB8_ALPHA8_ASTC_8x5_Format=37845,s.SRGB8_ALPHA8_ASTC_8x6_Format=37846,s.SRGB8_ALPHA8_ASTC_8x8_Format=37847,s.Scene=zh,s.SceneUtils=yA,s.ShaderChunk=Vr,s.ShaderLib=fo,s.ShaderMaterial=Kr,s.ShadowMaterial=Vs,s.Shape=Ss,s.ShapeBufferGeometry=od,s.ShapeGeometry=sd,s.ShapePath=Cd,s.ShapeUtils=Ko,s.ShortType=1011,s.Skeleton=Ac,s.SkeletonHelper=_p,s.SkinnedMesh=gc,s.SmoothShading=2,s.Sphere=ao,s.SphereBufferGeometry=Ru,s.SphereGeometry=ep,s.Spherical=Ay,s.SphericalHarmonics3=lp,s.Spline=Kd,s.SplineCurve=Ao,s.SplineCurve3=qp,s.SpotLight=Gu,s.SpotLightHelper=wy,s.Sprite=vc,s.SpriteMaterial=Es,s.SrcAlphaFactor=204,s.SrcAlphaSaturateFactor=210,s.SrcColorFactor=202,s.StaticCopyUsage=35046,s.StaticDrawUsage=So,s.StaticReadUsage=35045,s.StereoCamera=fp,s.StreamCopyUsage=35042,s.StreamDrawUsage=35040,s.StreamReadUsage=35041,s.StringKeyframeTrack=Bu,s.SubtractEquation=101,s.SubtractiveBlending=3,s.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s.TangentSpaceNormalMap=0,s.TetrahedronBufferGeometry=ld,s.TetrahedronGeometry=tp,s.TextBufferGeometry=cd,s.TextGeometry=np,s.Texture=vi,s.TextureLoader=ku,s.TorusBufferGeometry=ud,s.TorusGeometry=rp,s.TorusKnotBufferGeometry=hd,s.TorusKnotGeometry=ip,s.Triangle=Ha,s.TriangleFanDrawMode=2,s.TriangleStripDrawMode=1,s.TrianglesDrawMode=0,s.TubeBufferGeometry=dd,s.TubeGeometry=ap,s.UVMapping=300,s.Uint16Attribute=function rA(a,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Ga(a,t)},s.Uint16BufferAttribute=Ga,s.Uint32Attribute=function aA(a,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new qo(a,t)},s.Uint32BufferAttribute=qo,s.Uint8Attribute=function eA(a,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ya(a,t)},s.Uint8BufferAttribute=ya,s.Uint8ClampedAttribute=function tA(a,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Fs(a,t)},s.Uint8ClampedBufferAttribute=Fs,s.Uniform=wp,s.UniformsLib=Cn,s.UniformsUtils=Or,s.UnsignedByteType=Ft,s.UnsignedInt248Type=ur,s.UnsignedIntType=zn,s.UnsignedShort4444Type=1017,s.UnsignedShort5551Type=1018,s.UnsignedShort565Type=1019,s.UnsignedShortType=vn,s.VSMShadowMap=3,s.Vector2=cn,s.Vector3=ke,s.Vector4=ui,s.VectorKeyframeTrack=Il,s.Vertex=function Zy(a,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new ke(a,t,i)},s.VertexColors=2,s.VideoTexture=Xh,s.WebGL1Renderer=Gh,s.WebGLCubeRenderTarget=Di,s.WebGLMultisampleRenderTarget=jl,s.WebGLRenderTarget=Sa,s.WebGLRenderTargetCube=function pA(a,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Di(a,i)},s.WebGLRenderer=hc,s.WebGLUtils=bf,s.WireframeGeometry=fd,s.WireframeHelper=function hA(a,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new _a(new fd(a.geometry),new Fi({color:void 0!==t?t:16777215}))},s.WrapAroundEnding=Pa,s.XHRLoader=function dA(a){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new to(a)},s.ZeroCurvatureEnding=Ma,s.ZeroFactor=200,s.ZeroSlopeEnding=Ta,s.ZeroStencilOp=0,s.sRGBEncoding=Mo,Object.defineProperty(s,"__esModule",{value:!0})},c("object"==typeof m&&typeof C<"u"?m:(s=typeof globalThis<"u"?globalThis:s||self).THREE={})},{}],58:[function(h,C,m){THREE.DRACOLoader=function(s){THREE.Loader.call(this,s),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}},THREE.DRACOLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.DRACOLoader,setDecoderPath:function(s){return this.decoderPath=s,this},setDecoderConfig:function(s){return this.decoderConfig=s,this},setWorkerLimit:function(s){return this.workerLimit=s,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(s,c,u,p){var d=new THREE.FileLoader(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(s,A=>{this.decodeGeometry(A,{attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1}).then(c).catch(p)},u,p)},decodeDracoFile:function(s,c,u,p){this.decodeGeometry(s,{attributeIDs:u||this.defaultAttributeIDs,attributeTypes:p||this.defaultAttributeTypes,useUniqueIDs:!!u}).then(c)},decodeGeometry:function(s,c){for(var u in c.attributeTypes){var p=c.attributeTypes[u];void 0!==p.BYTES_PER_ELEMENT&&(c.attributeTypes[u]=p.name)}var d=JSON.stringify(c);if(THREE.DRACOLoader.taskCache.has(s)){var A=THREE.DRACOLoader.taskCache.get(s);if(A.key===d)return A.promise;if(0===s.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var E,g=this.workerNextTaskID++,T=this._getWorker(g,s.byteLength).then(y=>(E=y,new Promise((M,_)=>{E._callbacks[g]={resolve:M,reject:_},E.postMessage({type:"decode",id:g,taskConfig:c,buffer:s},[s])}))).then(y=>this._createGeometry(y.geometry));return T.catch(()=>!0).then(()=>{E&&g&&this._releaseTask(E,g)}),THREE.DRACOLoader.taskCache.set(s,{key:d,promise:T}),T},_createGeometry:function(s){var c=new THREE.BufferGeometry;s.index&&c.setIndex(new THREE.BufferAttribute(s.index.array,1));for(var u=0;u<s.attributes.length;u++){var p=s.attributes[u];c.setAttribute(p.name,new THREE.BufferAttribute(p.array,p.itemSize))}return c},_loadLibrary:function(s,c){var u=new THREE.FileLoader(this.manager);return u.setPath(this.decoderPath),u.setResponseType(c),u.setWithCredentials(this.withCredentials),new Promise((p,d)=>{u.load(s,p,void 0,d)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var s="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,c=[];return s?c.push(this._loadLibrary("draco_decoder.js","text")):(c.push(this._loadLibrary("draco_wasm_wrapper.js","text")),c.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(c).then(u=>{var p=u[0];s||(this.decoderConfig.wasmBinary=u[1]);var d=THREE.DRACOLoader.DRACOWorker.toString(),A=["/* draco decoder */",p,"","/* worker */",d.substring(d.indexOf("{")+1,d.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([A]))}),this.decoderPending},_getWorker:function(s,c){return this._initDecoder().then(()=>{var u;return this.workerPool.length<this.workerLimit?((u=new Worker(this.workerSourceURL))._callbacks={},u._taskCosts={},u._taskLoad=0,u.postMessage({type:"init",decoderConfig:this.decoderConfig}),u.onmessage=function(d){var A=d.data;switch(A.type){case"decode":u._callbacks[A.id].resolve(A);break;case"error":u._callbacks[A.id].reject(A);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+A.type+'"')}},this.workerPool.push(u)):this.workerPool.sort(function(p,d){return p._taskLoad>d._taskLoad?-1:1}),(u=this.workerPool[this.workerPool.length-1])._taskCosts[s]=c,u._taskLoad+=c,u})},_releaseTask:function(s,c){s._taskLoad-=s._taskCosts[c],delete s._callbacks[c],delete s._taskCosts[c]},debug:function(){console.log("Task load: ",this.workerPool.map(s=>s._taskLoad))},dispose:function(){for(var s=0;s<this.workerPool.length;++s)this.workerPool[s].terminate();return this.workerPool.length=0,this}}),THREE.DRACOLoader.DRACOWorker=function(){var s,c;function d(E,g,v,T,y,M){var _=M.num_components(),D=v.num_points()*_,B=D*y.BYTES_PER_ELEMENT,H=function A(E,g){switch(g){case Float32Array:return E.DT_FLOAT32;case Int8Array:return E.DT_INT8;case Int16Array:return E.DT_INT16;case Int32Array:return E.DT_INT32;case Uint8Array:return E.DT_UINT8;case Uint16Array:return E.DT_UINT16;case Uint32Array:return E.DT_UINT32}}(E,y),q=E._malloc(B);g.GetAttributeDataArrayForAllPoints(v,M,H,B,q);var V=new y(E.HEAPF32.buffer,q,D).slice();return E._free(q),{name:T,array:V,itemSize:_}}onmessage=function(E){var g=E.data;switch(g.type){case"init":s=g.decoderConfig,c=new Promise(function(y){s.onModuleLoaded=function(M){y({draco:M})},DracoDecoderModule(s)});break;case"decode":var v=g.buffer,T=g.taskConfig;c.then(y=>{var M=y.draco,_=new M.Decoder,O=new M.DecoderBuffer;O.Init(new Int8Array(v),v.byteLength);try{var D=function u(E,g,v,T){var _,O,y=T.attributeIDs,M=T.attributeTypes,D=g.GetEncodedGeometryType(v);if(D===E.TRIANGULAR_MESH)_=new E.Mesh,O=g.DecodeBufferToMesh(v,_);else{if(D!==E.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");_=new E.PointCloud,O=g.DecodeBufferToPointCloud(v,_)}if(!O.ok()||0===_.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+O.error_msg());var B={index:null,attributes:[]};for(var H in y){var V,ne,q=self[M[H]];if(T.useUniqueIDs)V=g.GetAttributeByUniqueId(_,ne=y[H]);else{if(-1===(ne=g.GetAttributeId(_,E[y[H]])))continue;V=g.GetAttribute(_,ne)}B.attributes.push(d(E,g,_,H,q,V))}return D===E.TRIANGULAR_MESH&&(B.index=function p(E,g,v){var y=3*v.num_faces(),M=4*y,_=E._malloc(M);g.GetTrianglesUInt32Array(v,M,_);var O=new Uint32Array(E.HEAPF32.buffer,_,y).slice();return E._free(_),{array:O,itemSize:1}}(E,g,_)),E.destroy(_),B}(M,_,O,T),B=D.attributes.map(H=>H.array.buffer);D.index&&B.push(D.index.array.buffer),self.postMessage({type:"decode",id:g.id,geometry:D},B)}catch(H){console.error(H),self.postMessage({type:"error",id:g.id,error:H.message})}finally{M.destroy(O),M.destroy(_)}})}}},THREE.DRACOLoader.taskCache=new WeakMap,THREE.DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},THREE.DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},THREE.DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},THREE.DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},{}],59:[function(h,C,m){THREE.GLTFLoader=function(){function s(Re){THREE.Loader.call(this,Re),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(Oe){return new E(Oe)}),this.register(function(Oe){return new v(Oe)}),this.register(function(Oe){return new T(Oe)}),this.register(function(Oe){return new g(Oe)}),this.register(function(Oe){return new d(Oe)}),this.register(function(Oe){return new y(Oe)})}function c(){var Re={};return{get:function(Oe){return Re[Oe]},add:function(Oe,$e){Re[Oe]=$e},remove:function(Oe){delete Re[Oe]},removeAll:function(){Re={}}}}s.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:s,load:function(Re,Oe,$e,Ve){var nt,Ke=this;nt=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(Re),this.manager.itemStart(Re);var ut=function(_t){Ve?Ve(_t):console.error(_t),Ke.manager.itemError(Re),Ke.manager.itemEnd(Re)},ht=new THREE.FileLoader(this.manager);ht.setPath(this.path),ht.setResponseType("arraybuffer"),ht.setRequestHeader(this.requestHeader),ht.setWithCredentials(this.withCredentials),ht.load(Re,function(_t){try{Ke.parse(_t,nt,function(Bt){Oe(Bt),Ke.manager.itemEnd(Re)},ut)}catch(Bt){ut(Bt)}},$e,ut)},setDRACOLoader:function(Re){return this.dracoLoader=Re,this},setDDSLoader:function(Re){return this.ddsLoader=Re,this},setKTX2Loader:function(Re){return this.ktx2Loader=Re,this},setMeshoptDecoder:function(Re){return this.meshoptDecoder=Re,this},register:function(Re){return-1===this.pluginCallbacks.indexOf(Re)&&this.pluginCallbacks.push(Re),this},unregister:function(Re){return-1!==this.pluginCallbacks.indexOf(Re)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(Re),1),this},parse:function(Re,Oe,$e,Ve){var Ke,nt={},ut={};if("string"==typeof Re)Ke=Re;else if(THREE.LoaderUtils.decodeText(new Uint8Array(Re,0,4))===M){try{nt[u.KHR_BINARY_GLTF]=new D(Re)}catch(ie){return void(Ve&&Ve(ie))}Ke=nt[u.KHR_BINARY_GLTF].content}else Ke=THREE.LoaderUtils.decodeText(new Uint8Array(Re));var _t=JSON.parse(Ke);if(void 0===_t.asset||_t.asset.version[0]<2)Ve&&Ve(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var Bt=new sn(_t,{path:Oe||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});Bt.fileLoader.setRequestHeader(this.requestHeader);for(var Kt=0;Kt<this.pluginCallbacks.length;Kt++){var rn=this.pluginCallbacks[Kt](Bt);ut[rn.name]=rn,nt[rn.name]=!0}if(_t.extensionsUsed)for(Kt=0;Kt<_t.extensionsUsed.length;++Kt){var mn=_t.extensionsUsed[Kt],Ce=_t.extensionsRequired||[];switch(mn){case u.KHR_MATERIALS_UNLIT:nt[mn]=new A;break;case u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:nt[mn]=new V;break;case u.KHR_DRACO_MESH_COMPRESSION:nt[mn]=new B(_t,this.dracoLoader);break;case u.MSFT_TEXTURE_DDS:nt[mn]=new p(this.ddsLoader);break;case u.KHR_TEXTURE_TRANSFORM:nt[mn]=new H;break;case u.KHR_MESH_QUANTIZATION:nt[mn]=new ne;break;default:Ce.indexOf(mn)>=0&&void 0===ut[mn]&&console.warn('THREE.GLTFLoader: Unknown extension "'+mn+'".')}}Bt.setExtensions(nt),Bt.setPlugins(ut),Bt.parse($e,Ve)}}});var u={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function p(Re){if(!Re)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=u.MSFT_TEXTURE_DDS,this.ddsLoader=Re}function d(Re){this.parser=Re,this.name=u.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function A(){this.name=u.KHR_MATERIALS_UNLIT}function E(Re){this.parser=Re,this.name=u.KHR_MATERIALS_CLEARCOAT}function g(Re){this.parser=Re,this.name=u.KHR_MATERIALS_TRANSMISSION}function v(Re){this.parser=Re,this.name=u.KHR_TEXTURE_BASISU}function T(Re){this.parser=Re,this.name=u.EXT_TEXTURE_WEBP,this.isSupported=null}function y(Re){this.name=u.EXT_MESHOPT_COMPRESSION,this.parser=Re}d.prototype._markDefs=function(){for(var Re=this.parser,Oe=this.parser.json.nodes||[],$e=0,Ve=Oe.length;$e<Ve;$e++){var Ke=Oe[$e];Ke.extensions&&Ke.extensions[this.name]&&void 0!==Ke.extensions[this.name].light&&Re._addNodeRef(this.cache,Ke.extensions[this.name].light)}},d.prototype._loadLight=function(Re){var Oe=this.parser,$e="light:"+Re,Ve=Oe.cache.get($e);if(Ve)return Ve;var _t,Ke=Oe.json,ht=((Ke.extensions&&Ke.extensions[this.name]||{}).lights||[])[Re],Bt=new THREE.Color(16777215);void 0!==ht.color&&Bt.fromArray(ht.color);var Kt=void 0!==ht.range?ht.range:0;switch(ht.type){case"directional":(_t=new THREE.DirectionalLight(Bt)).target.position.set(0,0,-1),_t.add(_t.target);break;case"point":(_t=new THREE.PointLight(Bt)).distance=Kt;break;case"spot":(_t=new THREE.SpotLight(Bt)).distance=Kt,ht.spot=ht.spot||{},ht.spot.innerConeAngle=void 0!==ht.spot.innerConeAngle?ht.spot.innerConeAngle:0,ht.spot.outerConeAngle=void 0!==ht.spot.outerConeAngle?ht.spot.outerConeAngle:Math.PI/4,_t.angle=ht.spot.outerConeAngle,_t.penumbra=1-ht.spot.innerConeAngle/ht.spot.outerConeAngle,_t.target.position.set(0,0,-1),_t.add(_t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+ht.type+'".')}return _t.position.set(0,0,0),_t.decay=2,void 0!==ht.intensity&&(_t.intensity=ht.intensity),_t.name=Oe.createUniqueName(ht.name||"light_"+Re),Ve=Promise.resolve(_t),Oe.cache.add($e,Ve),Ve},d.prototype.createNodeAttachment=function(Re){var Oe=this,$e=this.parser,Ke=$e.json.nodes[Re],ut=(Ke.extensions&&Ke.extensions[this.name]||{}).light;return void 0===ut?null:this._loadLight(ut).then(function(ht){return $e._getNodeRef(Oe.cache,ut,ht)})},A.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},A.prototype.extendParams=function(Re,Oe,$e){var Ve=[];Re.color=new THREE.Color(1,1,1),Re.opacity=1;var Ke=Oe.pbrMetallicRoughness;if(Ke){if(Array.isArray(Ke.baseColorFactor)){var nt=Ke.baseColorFactor;Re.color.fromArray(nt),Re.opacity=nt[3]}void 0!==Ke.baseColorTexture&&Ve.push($e.assignTexture(Re,"map",Ke.baseColorTexture))}return Promise.all(Ve)},E.prototype.getMaterialType=function(Re){var $e=this.parser.json.materials[Re];return $e.extensions&&$e.extensions[this.name]?THREE.MeshPhysicalMaterial:null},E.prototype.extendMaterialParams=function(Re,Oe){var $e=this.parser,Ve=$e.json.materials[Re];if(!Ve.extensions||!Ve.extensions[this.name])return Promise.resolve();var Ke=[],nt=Ve.extensions[this.name];if(void 0!==nt.clearcoatFactor&&(Oe.clearcoat=nt.clearcoatFactor),void 0!==nt.clearcoatTexture&&Ke.push($e.assignTexture(Oe,"clearcoatMap",nt.clearcoatTexture)),void 0!==nt.clearcoatRoughnessFactor&&(Oe.clearcoatRoughness=nt.clearcoatRoughnessFactor),void 0!==nt.clearcoatRoughnessTexture&&Ke.push($e.assignTexture(Oe,"clearcoatRoughnessMap",nt.clearcoatRoughnessTexture)),void 0!==nt.clearcoatNormalTexture&&(Ke.push($e.assignTexture(Oe,"clearcoatNormalMap",nt.clearcoatNormalTexture)),void 0!==nt.clearcoatNormalTexture.scale)){var ut=nt.clearcoatNormalTexture.scale;Oe.clearcoatNormalScale=new THREE.Vector2(ut,ut)}return Promise.all(Ke)},g.prototype.getMaterialType=function(Re){var $e=this.parser.json.materials[Re];return $e.extensions&&$e.extensions[this.name]?THREE.MeshPhysicalMaterial:null},g.prototype.extendMaterialParams=function(Re,Oe){var $e=this.parser,Ve=$e.json.materials[Re];if(!Ve.extensions||!Ve.extensions[this.name])return Promise.resolve();var Ke=[],nt=Ve.extensions[this.name];return void 0!==nt.transmissionFactor&&(Oe.transmission=nt.transmissionFactor),void 0!==nt.transmissionTexture&&Ke.push($e.assignTexture(Oe,"transmissionMap",nt.transmissionTexture)),Promise.all(Ke)},v.prototype.loadTexture=function(Re){var Oe=this.parser,$e=Oe.json,Ve=$e.textures[Re];if(!Ve.extensions||!Ve.extensions[this.name])return null;var nt=$e.images[Ve.extensions[this.name].source],ut=Oe.options.ktx2Loader;if(!ut){if($e.extensionsRequired&&$e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return Oe.loadTextureImage(Re,nt,ut)},T.prototype.loadTexture=function(Re){var Oe=this.name,$e=this.parser,Ve=$e.json,Ke=Ve.textures[Re];if(!Ke.extensions||!Ke.extensions[Oe])return null;var ut=Ve.images[Ke.extensions[Oe].source],ht=ut.uri?$e.options.manager.getHandler(ut.uri):$e.textureLoader;return this.detectSupport().then(function(_t){if(_t)return $e.loadTextureImage(Re,ut,ht);if(Ve.extensionsRequired&&Ve.extensionsRequired.indexOf(Oe)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return $e.loadTexture(Re)})},T.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(Re){var Oe=new Image;Oe.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",Oe.onload=Oe.onerror=function(){Re(1===Oe.height)}})),this.isSupported},y.prototype.loadBufferView=function(Re){var Oe=this.parser.json,$e=Oe.bufferViews[Re];if($e.extensions&&$e.extensions[this.name]){var Ve=$e.extensions[this.name],Ke=this.parser.getDependency("buffer",Ve.buffer),nt=this.parser.options.meshoptDecoder;if(!nt||!nt.supported){if(Oe.extensionsRequired&&Oe.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([Ke,nt.ready]).then(function(ut){var ht=Ve.byteOffset||0,_t=Ve.byteLength||0,Bt=Ve.count,Kt=Ve.byteStride,rn=new ArrayBuffer(Bt*Kt),mn=new Uint8Array(ut[0],ht,_t);return nt.decodeGltfBuffer(new Uint8Array(rn),Bt,Kt,mn,Ve.mode,Ve.filter),rn})}return null};var M="glTF";function D(Re){this.name=u.KHR_BINARY_GLTF,this.content=null,this.body=null;var Oe=new DataView(Re,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(Re.slice(0,4))),version:Oe.getUint32(4,!0),length:Oe.getUint32(8,!0)},this.header.magic!==M)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var $e=new DataView(Re,12),Ve=0;Ve<$e.byteLength;){var Ke=$e.getUint32(Ve,!0),nt=$e.getUint32(Ve+=4,!0);if(Ve+=4,1313821514===nt){var ut=new Uint8Array(Re,12+Ve,Ke);this.content=THREE.LoaderUtils.decodeText(ut)}else if(5130562===nt){var ht=12+Ve;this.body=Re.slice(ht,ht+Ke)}Ve+=Ke}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function B(Re,Oe){if(!Oe)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=u.KHR_DRACO_MESH_COMPRESSION,this.json=Re,this.dracoLoader=Oe,this.dracoLoader.preload()}function H(){this.name=u.KHR_TEXTURE_TRANSFORM}function q(Re){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var Oe=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),$e=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),Ve=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),Ke=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),nt=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),ut={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=ut,this.onBeforeCompile=function(ht){for(var _t in ut)ht.uniforms[_t]=ut[_t];ht.fragmentShader=ht.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",Oe).replace("#include <metalnessmap_pars_fragment>",$e).replace("#include <roughnessmap_fragment>",Ve).replace("#include <metalnessmap_fragment>",Ke).replace("#include <lights_physical_fragment>",nt)},Object.defineProperties(this,{specular:{get:function(){return ut.specular.value},set:function(ht){ut.specular.value=ht}},specularMap:{get:function(){return ut.specularMap.value},set:function(ht){ut.specularMap.value=ht,ht?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return ut.glossiness.value},set:function(ht){ut.glossiness.value=ht}},glossinessMap:{get:function(){return ut.glossinessMap.value},set:function(ht){ut.glossinessMap.value=ht,ht?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(Re)}function V(){return{name:u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return q},extendParams:function(Re,Oe,$e){var Ve=Oe.extensions[this.name];Re.color=new THREE.Color(1,1,1),Re.opacity=1;var Ke=[];if(Array.isArray(Ve.diffuseFactor)){var nt=Ve.diffuseFactor;Re.color.fromArray(nt),Re.opacity=nt[3]}if(void 0!==Ve.diffuseTexture&&Ke.push($e.assignTexture(Re,"map",Ve.diffuseTexture)),Re.emissive=new THREE.Color(0,0,0),Re.glossiness=void 0!==Ve.glossinessFactor?Ve.glossinessFactor:1,Re.specular=new THREE.Color(1,1,1),Array.isArray(Ve.specularFactor)&&Re.specular.fromArray(Ve.specularFactor),void 0!==Ve.specularGlossinessTexture){var ut=Ve.specularGlossinessTexture;Ke.push($e.assignTexture(Re,"glossinessMap",ut)),Ke.push($e.assignTexture(Re,"specularMap",ut))}return Promise.all(Ke)},createMaterial:function(Re){var Oe=new q(Re);return Oe.fog=!0,Oe.color=Re.color,Oe.map=void 0===Re.map?null:Re.map,Oe.lightMap=null,Oe.lightMapIntensity=1,Oe.aoMap=void 0===Re.aoMap?null:Re.aoMap,Oe.aoMapIntensity=1,Oe.emissive=Re.emissive,Oe.emissiveIntensity=1,Oe.emissiveMap=void 0===Re.emissiveMap?null:Re.emissiveMap,Oe.bumpMap=void 0===Re.bumpMap?null:Re.bumpMap,Oe.bumpScale=1,Oe.normalMap=void 0===Re.normalMap?null:Re.normalMap,Oe.normalMapType=THREE.TangentSpaceNormalMap,Re.normalScale&&(Oe.normalScale=Re.normalScale),Oe.displacementMap=null,Oe.displacementScale=1,Oe.displacementBias=0,Oe.specularMap=void 0===Re.specularMap?null:Re.specularMap,Oe.specular=Re.specular,Oe.glossinessMap=void 0===Re.glossinessMap?null:Re.glossinessMap,Oe.glossiness=Re.glossiness,Oe.alphaMap=null,Oe.envMap=void 0===Re.envMap?null:Re.envMap,Oe.envMapIntensity=1,Oe.refractionRatio=.98,Oe}}}function ne(){this.name=u.KHR_MESH_QUANTIZATION}function ae(Re,Oe,$e,Ve){THREE.Interpolant.call(this,Re,Oe,$e,Ve)}B.prototype.decodePrimitive=function(Re,Oe){var $e=this.json,Ve=this.dracoLoader,Ke=Re.extensions[this.name].bufferView,nt=Re.extensions[this.name].attributes,ut={},ht={},_t={};for(var Bt in nt){var Kt=W[Bt]||Bt.toLowerCase();ut[Kt]=nt[Bt]}for(Bt in Re.attributes)if(Kt=W[Bt]||Bt.toLowerCase(),void 0!==nt[Bt]){var rn=$e.accessors[Re.attributes[Bt]];_t[Kt]=he[rn.componentType],ht[Kt]=!0===rn.normalized}return Oe.getDependency("bufferView",Ke).then(function(Ce){return new Promise(function(ie){Ve.decodeDracoFile(Ce,function(le){for(var Fe in le.attributes){var Pt=ht[Fe];void 0!==Pt&&(le.attributes[Fe].normalized=Pt)}ie(le)},ut,_t)})})},H.prototype.extendTexture=function(Re,Oe){return Re=Re.clone(),void 0!==Oe.offset&&Re.offset.fromArray(Oe.offset),void 0!==Oe.rotation&&(Re.rotation=Oe.rotation),void 0!==Oe.scale&&Re.repeat.fromArray(Oe.scale),void 0!==Oe.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Re.needsUpdate=!0,Re},(q.prototype=Object.create(THREE.MeshStandardMaterial.prototype)).constructor=q,q.prototype.copy=function(Re){return THREE.MeshStandardMaterial.prototype.copy.call(this,Re),this.specularMap=Re.specularMap,this.specular.copy(Re.specular),this.glossinessMap=Re.glossinessMap,this.glossiness=Re.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},(ae.prototype=Object.create(THREE.Interpolant.prototype)).constructor=ae,ae.prototype.beforeStart_=ae.prototype.copySampleValue_=function(Re){for(var Oe=this.resultBuffer,$e=this.sampleValues,Ve=this.valueSize,Ke=Re*Ve*3+Ve,nt=0;nt!==Ve;nt++)Oe[nt]=$e[Ke+nt];return Oe},ae.prototype.afterEnd_=ae.prototype.copySampleValue_,ae.prototype.interpolate_=function(Re,Oe,$e,Ve){for(var Ke=this.resultBuffer,nt=this.sampleValues,ut=this.valueSize,ht=2*ut,_t=3*ut,Bt=Ve-Oe,Kt=($e-Oe)/Bt,rn=Kt*Kt,mn=rn*Kt,Ce=Re*_t,ie=Ce-_t,le=-2*mn+3*rn,Fe=mn-rn,Ye=1-le,Pt=Fe-rn+Kt,Me=0;Me!==ut;Me++)Ke[Me]=Ye*nt[ie+Me+ut]+Pt*(nt[ie+Me+ht]*Bt)+le*nt[Ce+Me+ut]+Fe*(nt[Ce+Me]*Bt);return Ke};var he={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},me={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},P={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},X={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},W={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},te={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ce={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};function _e(Re,Oe){return"string"!=typeof Re||""===Re?"":(/^https?:\/\//i.test(Oe)&&/^\//.test(Re)&&(Oe=Oe.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(Re)||/^data:.*,.*$/i.test(Re)||/^blob:.*$/i.test(Re)?Re:Oe+Re)}function ze(Re){return void 0===Re.DefaultMaterial&&(Re.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),Re.DefaultMaterial}function rt(Re,Oe,$e){for(var Ve in $e.extensions)void 0===Re[Ve]&&(Oe.userData.gltfExtensions=Oe.userData.gltfExtensions||{},Oe.userData.gltfExtensions[Ve]=$e.extensions[Ve])}function gt(Re,Oe){void 0!==Oe.extras&&("object"==typeof Oe.extras?Object.assign(Re.userData,Oe.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+Oe.extras))}function $t(Re,Oe){if(Re.updateMorphTargets(),void 0!==Oe.weights)for(var $e=0,Ve=Oe.weights.length;$e<Ve;$e++)Re.morphTargetInfluences[$e]=Oe.weights[$e];if(Oe.extras&&Array.isArray(Oe.extras.targetNames)){var Ke=Oe.extras.targetNames;if(Re.morphTargetInfluences.length===Ke.length)for(Re.morphTargetDictionary={},$e=0,Ve=Ke.length;$e<Ve;$e++)Re.morphTargetDictionary[Ke[$e]]=$e;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function un(Re){var Oe=Re.extensions&&Re.extensions[u.KHR_DRACO_MESH_COMPRESSION];return Oe?"draco:"+Oe.bufferView+":"+Oe.indices+":"+In(Oe.attributes):Re.indices+":"+In(Re.attributes)+":"+Re.mode}function In(Re){for(var Oe="",$e=Object.keys(Re).sort(),Ve=0,Ke=$e.length;Ve<Ke;Ve++)Oe+=$e[Ve]+":"+Re[$e[Ve]]+";";return Oe}function sn(Re,Oe){this.json=Re||{},this.extensions={},this.plugins={},this.options=Oe||{},this.cache=new c,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},this.textureLoader=typeof createImageBitmap<"u"&&!1===/Firefox/.test(navigator.userAgent)?new THREE.ImageBitmapLoader(this.options.manager):new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function Cr(Re,Oe,$e){var Ve=Oe.attributes,Ke=[];function nt(Bt,Kt){return $e.getDependency("accessor",Bt).then(function(rn){Re.setAttribute(Kt,rn)})}for(var ut in Ve){var ht=W[ut]||ut.toLowerCase();ht in Re.attributes||Ke.push(nt(Ve[ut],ht))}if(void 0!==Oe.indices&&!Re.index){var _t=$e.getDependency("accessor",Oe.indices).then(function(Bt){Re.setIndex(Bt)});Ke.push(_t)}return gt(Re,Oe),function tr(Re,Oe,$e){var Ve=Oe.attributes,Ke=new THREE.Box3;if(void 0!==Ve.POSITION){var ht=(nt=$e.json.accessors[Ve.POSITION]).max;if(void 0!==(ut=nt.min)&&void 0!==ht){Ke.set(new THREE.Vector3(ut[0],ut[1],ut[2]),new THREE.Vector3(ht[0],ht[1],ht[2]));var _t=Oe.targets;if(void 0!==_t){for(var Bt=new THREE.Vector3,Kt=new THREE.Vector3,rn=0,mn=_t.length;rn<mn;rn++){var nt,ut,Ce=_t[rn];void 0!==Ce.POSITION&&(ht=(nt=$e.json.accessors[Ce.POSITION]).max,void 0!==(ut=nt.min)&&void 0!==ht?(Kt.setX(Math.max(Math.abs(ut[0]),Math.abs(ht[0]))),Kt.setY(Math.max(Math.abs(ut[1]),Math.abs(ht[1]))),Kt.setZ(Math.max(Math.abs(ut[2]),Math.abs(ht[2]))),Bt.max(Kt)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}Ke.expandByVector(Bt)}Re.boundingBox=Ke;var ie=new THREE.Sphere;Ke.getCenter(ie.center),ie.radius=Ke.min.distanceTo(Ke.max)/2,Re.boundingSphere=ie}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(Re,Oe,$e),Promise.all(Ke).then(function(){return void 0!==Oe.targets?function Tt(Re,Oe,$e){for(var Ve=!1,Ke=!1,nt=0,ut=Oe.length;nt<ut&&(void 0!==(ht=Oe[nt]).POSITION&&(Ve=!0),void 0!==ht.NORMAL&&(Ke=!0),!Ve||!Ke);nt++);if(!Ve&&!Ke)return Promise.resolve(Re);var _t=[],Bt=[];for(nt=0,ut=Oe.length;nt<ut;nt++){var ht=Oe[nt];if(Ve){var Kt=void 0!==ht.POSITION?$e.getDependency("accessor",ht.POSITION):Re.attributes.position;_t.push(Kt)}Ke&&(Kt=void 0!==ht.NORMAL?$e.getDependency("accessor",ht.NORMAL):Re.attributes.normal,Bt.push(Kt))}return Promise.all([Promise.all(_t),Promise.all(Bt)]).then(function(rn){var Ce=rn[1];return Ve&&(Re.morphAttributes.position=rn[0]),Ke&&(Re.morphAttributes.normal=Ce),Re.morphTargetsRelative=!0,Re})}(Re,Oe.targets,$e):Re})}function Un(Re,Oe){var $e=Re.getIndex();if(null===$e){var Ve=[],Ke=Re.getAttribute("position");if(void 0===Ke)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Re;for(var nt=0;nt<Ke.count;nt++)Ve.push(nt);Re.setIndex(Ve),$e=Re.getIndex()}var ut=$e.count-2,ht=[];if(Oe===THREE.TriangleFanDrawMode)for(nt=1;nt<=ut;nt++)ht.push($e.getX(0)),ht.push($e.getX(nt)),ht.push($e.getX(nt+1));else for(nt=0;nt<ut;nt++)nt%2==0?(ht.push($e.getX(nt)),ht.push($e.getX(nt+1)),ht.push($e.getX(nt+2))):(ht.push($e.getX(nt+2)),ht.push($e.getX(nt+1)),ht.push($e.getX(nt)));ht.length/3!==ut&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var _t=Re.clone();return _t.setIndex(ht),_t}return sn.prototype.setExtensions=function(Re){this.extensions=Re},sn.prototype.setPlugins=function(Re){this.plugins=Re},sn.prototype.parse=function(Re,Oe){var $e=this,Ve=this.json,Ke=this.extensions;this.cache.removeAll(),this._invokeAll(function(nt){return nt._markDefs&&nt._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(nt){var ut={scene:nt[0][Ve.scene||0],scenes:nt[0],animations:nt[1],cameras:nt[2],asset:Ve.asset,parser:$e,userData:{}};rt(Ke,ut,Ve),gt(ut,Ve),Re(ut)}).catch(Oe)},sn.prototype._markDefs=function(){for(var Re=this.json.nodes||[],Oe=this.json.skins||[],$e=this.json.meshes||[],Ve=0,Ke=Oe.length;Ve<Ke;Ve++)for(var nt=Oe[Ve].joints,ut=0,ht=nt.length;ut<ht;ut++)Re[nt[ut]].isBone=!0;for(var _t=0,Bt=Re.length;_t<Bt;_t++){var Kt=Re[_t];void 0!==Kt.mesh&&(this._addNodeRef(this.meshCache,Kt.mesh),void 0!==Kt.skin&&($e[Kt.mesh].isSkinnedMesh=!0)),void 0!==Kt.camera&&this._addNodeRef(this.cameraCache,Kt.camera)}},sn.prototype._addNodeRef=function(Re,Oe){void 0!==Oe&&(void 0===Re.refs[Oe]&&(Re.refs[Oe]=Re.uses[Oe]=0),Re.refs[Oe]++)},sn.prototype._getNodeRef=function(Re,Oe,$e){if(Re.refs[Oe]<=1)return $e;var Ve=$e.clone();return Ve.name+="_instance_"+Re.uses[Oe]++,Ve},sn.prototype._invokeOne=function(Re){var Oe=Object.values(this.plugins);Oe.push(this);for(var $e=0;$e<Oe.length;$e++){var Ve=Re(Oe[$e]);if(Ve)return Ve}},sn.prototype._invokeAll=function(Re){var Oe=Object.values(this.plugins);Oe.unshift(this);for(var $e=[],Ve=0;Ve<Oe.length;Ve++){var Ke=Re(Oe[Ve]);Ke&&$e.push(Ke)}return $e},sn.prototype.getDependency=function(Re,Oe){var $e=Re+":"+Oe,Ve=this.cache.get($e);if(!Ve){switch(Re){case"scene":Ve=this.loadScene(Oe);break;case"node":Ve=this.loadNode(Oe);break;case"mesh":Ve=this._invokeOne(function(Ke){return Ke.loadMesh&&Ke.loadMesh(Oe)});break;case"accessor":Ve=this.loadAccessor(Oe);break;case"bufferView":Ve=this._invokeOne(function(Ke){return Ke.loadBufferView&&Ke.loadBufferView(Oe)});break;case"buffer":Ve=this.loadBuffer(Oe);break;case"material":Ve=this._invokeOne(function(Ke){return Ke.loadMaterial&&Ke.loadMaterial(Oe)});break;case"texture":Ve=this._invokeOne(function(Ke){return Ke.loadTexture&&Ke.loadTexture(Oe)});break;case"skin":Ve=this.loadSkin(Oe);break;case"animation":Ve=this.loadAnimation(Oe);break;case"camera":Ve=this.loadCamera(Oe);break;default:throw new Error("Unknown type: "+Re)}this.cache.add($e,Ve)}return Ve},sn.prototype.getDependencies=function(Re){var Oe=this.cache.get(Re);if(!Oe){var $e=this;Oe=Promise.all((this.json[Re+("mesh"===Re?"es":"s")]||[]).map(function(Ke,nt){return $e.getDependency(Re,nt)})),this.cache.add(Re,Oe)}return Oe},sn.prototype.loadBuffer=function(Re){var Oe=this.json.buffers[Re],$e=this.fileLoader;if(Oe.type&&"arraybuffer"!==Oe.type)throw new Error("THREE.GLTFLoader: "+Oe.type+" buffer type is not supported.");if(void 0===Oe.uri&&0===Re)return Promise.resolve(this.extensions[u.KHR_BINARY_GLTF].body);var Ve=this.options;return new Promise(function(Ke,nt){$e.load(_e(Oe.uri,Ve.path),Ke,void 0,function(){nt(new Error('THREE.GLTFLoader: Failed to load buffer "'+Oe.uri+'".'))})})},sn.prototype.loadBufferView=function(Re){var Oe=this.json.bufferViews[Re];return this.getDependency("buffer",Oe.buffer).then(function($e){var Ke=Oe.byteOffset||0;return $e.slice(Ke,Ke+(Oe.byteLength||0))})},sn.prototype.loadAccessor=function(Re){var Oe=this,$e=this.json,Ve=this.json.accessors[Re];if(void 0===Ve.bufferView&&void 0===Ve.sparse)return Promise.resolve(null);var Ke=[];return Ke.push(void 0!==Ve.bufferView?this.getDependency("bufferView",Ve.bufferView):null),void 0!==Ve.sparse&&(Ke.push(this.getDependency("bufferView",Ve.sparse.indices.bufferView)),Ke.push(this.getDependency("bufferView",Ve.sparse.values.bufferView))),Promise.all(Ke).then(function(nt){var ie,le,ut=nt[0],ht=X[Ve.type],_t=he[Ve.componentType],Bt=_t.BYTES_PER_ELEMENT,rn=Ve.byteOffset||0,mn=void 0!==Ve.bufferView?$e.bufferViews[Ve.bufferView].byteStride:void 0,Ce=!0===Ve.normalized;if(mn&&mn!==Bt*ht){var Fe=Math.floor(rn/mn),Ye="InterleavedBuffer:"+Ve.bufferView+":"+Ve.componentType+":"+Fe+":"+Ve.count,Pt=Oe.cache.get(Ye);Pt||(ie=new _t(ut,Fe*mn,Ve.count*mn/Bt),Pt=new THREE.InterleavedBuffer(ie,mn/Bt),Oe.cache.add(Ye,Pt)),le=new THREE.InterleavedBufferAttribute(Pt,ht,rn%mn/Bt,Ce)}else ie=null===ut?new _t(Ve.count*ht):new _t(ut,rn,Ve.count*ht),le=new THREE.BufferAttribute(ie,ht,Ce);if(void 0!==Ve.sparse){var ot=Ve.sparse.values.byteOffset||0,dt=new(0,he[Ve.sparse.indices.componentType])(nt[1],Ve.sparse.indices.byteOffset||0,Ve.sparse.count*X.SCALAR),St=new _t(nt[2],ot,Ve.sparse.count*ht);null!==ut&&(le=new THREE.BufferAttribute(le.array.slice(),le.itemSize,le.normalized));for(var It=0,Zt=dt.length;It<Zt;It++){var Xt=dt[It];if(le.setX(Xt,St[It*ht]),ht>=2&&le.setY(Xt,St[It*ht+1]),ht>=3&&le.setZ(Xt,St[It*ht+2]),ht>=4&&le.setW(Xt,St[It*ht+3]),ht>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return le})},sn.prototype.loadTexture=function(Re){var ut,ht,$e=this.json,Ke=$e.textures[Re],nt=Ke.extensions||{};return(ut=nt[u.MSFT_TEXTURE_DDS]?$e.images[nt[u.MSFT_TEXTURE_DDS].source]:$e.images[Ke.source]).uri&&(ht=this.options.manager.getHandler(ut.uri)),ht||(ht=nt[u.MSFT_TEXTURE_DDS]?this.extensions[u.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(Re,ut,ht)},sn.prototype.loadTextureImage=function(Re,Oe,$e){var Ve=this,Ke=this.json,nt=this.options,ut=Ke.textures[Re],ht=self.URL||self.webkitURL,_t=Oe.uri,Bt=!1,Kt=!0;return"image/jpeg"===Oe.mimeType&&(Kt=!1),void 0!==Oe.bufferView&&(_t=Ve.getDependency("bufferView",Oe.bufferView).then(function(rn){if("image/png"===Oe.mimeType){var mn=new DataView(rn,25,1).getUint8(0,!1);Kt=6===mn||4===mn||3===mn}Bt=!0;var Ce=new Blob([rn],{type:Oe.mimeType});return _t=ht.createObjectURL(Ce)})),Promise.resolve(_t).then(function(rn){return new Promise(function(mn,Ce){var ie=mn;!0===$e.isImageBitmapLoader&&(ie=function(le){mn(new THREE.CanvasTexture(le))}),$e.load(_e(rn,nt.path),ie,void 0,Ce)})}).then(function(rn){!0===Bt&&ht.revokeObjectURL(_t),rn.flipY=!1,ut.name&&(rn.name=ut.name),Kt||(rn.format=THREE.RGBFormat);var Ce=(Ke.samplers||{})[ut.sampler]||{};return rn.magFilter=me[Ce.magFilter]||THREE.LinearFilter,rn.minFilter=me[Ce.minFilter]||THREE.LinearMipmapLinearFilter,rn.wrapS=P[Ce.wrapS]||THREE.RepeatWrapping,rn.wrapT=P[Ce.wrapT]||THREE.RepeatWrapping,Ve.associations.set(rn,{type:"textures",index:Re}),rn})},sn.prototype.assignTexture=function(Re,Oe,$e){var Ve=this;return this.getDependency("texture",$e.index).then(function(Ke){if(void 0!==$e.texCoord&&0!=$e.texCoord&&!("aoMap"===Oe&&1==$e.texCoord)&&console.warn("THREE.GLTFLoader: Custom UV set "+$e.texCoord+" for texture "+Oe+" not yet supported."),Ve.extensions[u.KHR_TEXTURE_TRANSFORM]){var nt=void 0!==$e.extensions?$e.extensions[u.KHR_TEXTURE_TRANSFORM]:void 0;if(nt){var ut=Ve.associations.get(Ke);Ke=Ve.extensions[u.KHR_TEXTURE_TRANSFORM].extendTexture(Ke,nt),Ve.associations.set(Ke,ut)}}Re[Oe]=Ke})},sn.prototype.assignFinalMaterial=function(Re){var Oe=Re.geometry,$e=Re.material,Ve=void 0!==Oe.attributes.tangent,Ke=void 0!==Oe.attributes.color,nt=void 0===Oe.attributes.normal,ut=!0===Re.isSkinnedMesh,ht=Object.keys(Oe.morphAttributes).length>0,_t=ht&&void 0!==Oe.morphAttributes.normal;if(Re.isPoints){var Kt=this.cache.get(Bt="PointsMaterial:"+$e.uuid);Kt||(Kt=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(Kt,$e),Kt.color.copy($e.color),Kt.map=$e.map,Kt.sizeAttenuation=!1,this.cache.add(Bt,Kt)),$e=Kt}else if(Re.isLine){var rn=this.cache.get(Bt="LineBasicMaterial:"+$e.uuid);rn||(rn=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(rn,$e),rn.color.copy($e.color),this.cache.add(Bt,rn)),$e=rn}if(Ve||Ke||nt||ut||ht){var Bt="ClonedMaterial:"+$e.uuid+":";$e.isGLTFSpecularGlossinessMaterial&&(Bt+="specular-glossiness:"),ut&&(Bt+="skinning:"),Ve&&(Bt+="vertex-tangents:"),Ke&&(Bt+="vertex-colors:"),nt&&(Bt+="flat-shading:"),ht&&(Bt+="morph-targets:"),_t&&(Bt+="morph-normals:");var mn=this.cache.get(Bt);mn||(mn=$e.clone(),ut&&(mn.skinning=!0),Ve&&(mn.vertexTangents=!0),Ke&&(mn.vertexColors=!0),nt&&(mn.flatShading=!0),ht&&(mn.morphTargets=!0),_t&&(mn.morphNormals=!0),this.cache.add(Bt,mn),this.associations.set(mn,this.associations.get($e))),$e=mn}$e.aoMap&&void 0===Oe.attributes.uv2&&void 0!==Oe.attributes.uv&&Oe.setAttribute("uv2",Oe.attributes.uv),$e.normalScale&&!Ve&&($e.normalScale.y=-$e.normalScale.y),$e.clearcoatNormalScale&&!Ve&&($e.clearcoatNormalScale.y=-$e.clearcoatNormalScale.y),Re.material=$e},sn.prototype.getMaterialType=function(){return THREE.MeshStandardMaterial},sn.prototype.loadMaterial=function(Re){var nt,Oe=this,Ve=this.extensions,Ke=this.json.materials[Re],ut={},ht=Ke.extensions||{},_t=[];if(ht[u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var Bt=Ve[u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];nt=Bt.getMaterialType(),_t.push(Bt.extendParams(ut,Ke,Oe))}else if(ht[u.KHR_MATERIALS_UNLIT]){var Kt=Ve[u.KHR_MATERIALS_UNLIT];nt=Kt.getMaterialType(),_t.push(Kt.extendParams(ut,Ke,Oe))}else{var rn=Ke.pbrMetallicRoughness||{};if(ut.color=new THREE.Color(1,1,1),ut.opacity=1,Array.isArray(rn.baseColorFactor)){var mn=rn.baseColorFactor;ut.color.fromArray(mn),ut.opacity=mn[3]}void 0!==rn.baseColorTexture&&_t.push(Oe.assignTexture(ut,"map",rn.baseColorTexture)),ut.metalness=void 0!==rn.metallicFactor?rn.metallicFactor:1,ut.roughness=void 0!==rn.roughnessFactor?rn.roughnessFactor:1,void 0!==rn.metallicRoughnessTexture&&(_t.push(Oe.assignTexture(ut,"metalnessMap",rn.metallicRoughnessTexture)),_t.push(Oe.assignTexture(ut,"roughnessMap",rn.metallicRoughnessTexture))),nt=this._invokeOne(function(ie){return ie.getMaterialType&&ie.getMaterialType(Re)}),_t.push(Promise.all(this._invokeAll(function(ie){return ie.extendMaterialParams&&ie.extendMaterialParams(Re,ut)})))}!0===Ke.doubleSided&&(ut.side=THREE.DoubleSide);var Ce=Ke.alphaMode||"OPAQUE";return"BLEND"===Ce?(ut.transparent=!0,ut.depthWrite=!1):(ut.transparent=!1,"MASK"===Ce&&(ut.alphaTest=void 0!==Ke.alphaCutoff?Ke.alphaCutoff:.5)),void 0!==Ke.normalTexture&&nt!==THREE.MeshBasicMaterial&&(_t.push(Oe.assignTexture(ut,"normalMap",Ke.normalTexture)),ut.normalScale=new THREE.Vector2(1,1),void 0!==Ke.normalTexture.scale&&ut.normalScale.set(Ke.normalTexture.scale,Ke.normalTexture.scale)),void 0!==Ke.occlusionTexture&&nt!==THREE.MeshBasicMaterial&&(_t.push(Oe.assignTexture(ut,"aoMap",Ke.occlusionTexture)),void 0!==Ke.occlusionTexture.strength&&(ut.aoMapIntensity=Ke.occlusionTexture.strength)),void 0!==Ke.emissiveFactor&&nt!==THREE.MeshBasicMaterial&&(ut.emissive=(new THREE.Color).fromArray(Ke.emissiveFactor)),void 0!==Ke.emissiveTexture&&nt!==THREE.MeshBasicMaterial&&_t.push(Oe.assignTexture(ut,"emissiveMap",Ke.emissiveTexture)),Promise.all(_t).then(function(){var ie;return ie=nt===q?Ve[u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(ut):new nt(ut),Ke.name&&(ie.name=Ke.name),ie.map&&(ie.map.encoding=THREE.sRGBEncoding),ie.emissiveMap&&(ie.emissiveMap.encoding=THREE.sRGBEncoding),gt(ie,Ke),Oe.associations.set(ie,{type:"materials",index:Re}),Ke.extensions&&rt(Ve,ie,Ke),ie})},sn.prototype.createUniqueName=function(Re){for(var Oe=THREE.PropertyBinding.sanitizeNodeName(Re||""),$e=1;this.nodeNamesUsed[Oe];++$e)Oe=Re+"_"+$e;return this.nodeNamesUsed[Oe]=!0,Oe},sn.prototype.loadGeometries=function(Re){var Oe=this,$e=this.extensions,Ve=this.primitiveCache;function Ke(mn){return $e[u.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(mn,Oe).then(function(Ce){return Cr(Ce,mn,Oe)})}for(var nt=[],ut=0,ht=Re.length;ut<ht;ut++){var rn,_t=Re[ut],Bt=un(_t),Kt=Ve[Bt];Kt?nt.push(Kt.promise):(rn=_t.extensions&&_t.extensions[u.KHR_DRACO_MESH_COMPRESSION]?Ke(_t):Cr(new THREE.BufferGeometry,_t,Oe),Ve[Bt]={primitive:_t,promise:rn},nt.push(rn))}return Promise.all(nt)},sn.prototype.loadMesh=function(Re){for(var Oe=this,Ve=this.extensions,Ke=this.json.meshes[Re],nt=Ke.primitives,ut=[],ht=0,_t=nt.length;ht<_t;ht++){var Bt=void 0===nt[ht].material?ze(this.cache):this.getDependency("material",nt[ht].material);ut.push(Bt)}return ut.push(Oe.loadGeometries(nt)),Promise.all(ut).then(function(Kt){for(var rn=Kt.slice(0,Kt.length-1),mn=Kt[Kt.length-1],Ce=[],ie=0,le=mn.length;ie<le;ie++){var Pt,Fe=mn[ie],Ye=nt[ie],Me=rn[ie];if(4===Ye.mode||5===Ye.mode||6===Ye.mode||void 0===Ye.mode)!0===(Pt=!0===Ke.isSkinnedMesh?new THREE.SkinnedMesh(Fe,Me):new THREE.Mesh(Fe,Me)).isSkinnedMesh&&!Pt.geometry.attributes.skinWeight.normalized&&Pt.normalizeSkinWeights(),5===Ye.mode?Pt.geometry=Un(Pt.geometry,THREE.TriangleStripDrawMode):6===Ye.mode&&(Pt.geometry=Un(Pt.geometry,THREE.TriangleFanDrawMode));else if(1===Ye.mode)Pt=new THREE.LineSegments(Fe,Me);else if(3===Ye.mode)Pt=new THREE.Line(Fe,Me);else if(2===Ye.mode)Pt=new THREE.LineLoop(Fe,Me);else{if(0!==Ye.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Ye.mode);Pt=new THREE.Points(Fe,Me)}Object.keys(Pt.geometry.morphAttributes).length>0&&$t(Pt,Ke),Pt.name=Oe.createUniqueName(Ke.name||"mesh_"+Re),gt(Pt,Ke),Ye.extensions&&rt(Ve,Pt,Ye),Oe.assignFinalMaterial(Pt),Ce.push(Pt)}if(1===Ce.length)return Ce[0];var qe=new THREE.Group;for(ie=0,le=Ce.length;ie<le;ie++)qe.add(Ce[ie]);return qe})},sn.prototype.loadCamera=function(Re){var Oe,$e=this.json.cameras[Re],Ve=$e[$e.type];if(Ve)return"perspective"===$e.type?Oe=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(Ve.yfov),Ve.aspectRatio||1,Ve.znear||1,Ve.zfar||2e6):"orthographic"===$e.type&&(Oe=new THREE.OrthographicCamera(-Ve.xmag,Ve.xmag,Ve.ymag,-Ve.ymag,Ve.znear,Ve.zfar)),$e.name&&(Oe.name=this.createUniqueName($e.name)),gt(Oe,$e),Promise.resolve(Oe);console.warn("THREE.GLTFLoader: Missing camera parameters.")},sn.prototype.loadSkin=function(Re){var Oe=this.json.skins[Re],$e={joints:Oe.joints};return void 0===Oe.inverseBindMatrices?Promise.resolve($e):this.getDependency("accessor",Oe.inverseBindMatrices).then(function(Ve){return $e.inverseBindMatrices=Ve,$e})},sn.prototype.loadAnimation=function(Re){for(var $e=this.json.animations[Re],Ve=[],Ke=[],nt=[],ut=[],ht=[],_t=0,Bt=$e.channels.length;_t<Bt;_t++){var Kt=$e.channels[_t],rn=$e.samplers[Kt.sampler],mn=Kt.target,ie=void 0!==$e.parameters?$e.parameters[rn.input]:rn.input,le=void 0!==$e.parameters?$e.parameters[rn.output]:rn.output;Ve.push(this.getDependency("node",void 0!==mn.node?mn.node:mn.id)),Ke.push(this.getDependency("accessor",ie)),nt.push(this.getDependency("accessor",le)),ut.push(rn),ht.push(mn)}return Promise.all([Promise.all(Ve),Promise.all(Ke),Promise.all(nt),Promise.all(ut),Promise.all(ht)]).then(function(Fe){for(var Ye=Fe[0],Pt=Fe[1],Me=Fe[2],qe=Fe[3],at=Fe[4],ot=[],dt=0,St=Ye.length;dt<St;dt++){var It=Ye[dt],Zt=Pt[dt],Xt=Me[dt],Vt=qe[dt],We=at[dt];if(void 0!==It){var ft;switch(It.updateMatrix(),It.matrixAutoUpdate=!0,te[We.path]){case te.weights:ft=THREE.NumberKeyframeTrack;break;case te.rotation:ft=THREE.QuaternionKeyframeTrack;break;default:ft=THREE.VectorKeyframeTrack}var Mt=It.name?It.name:It.uuid,Ht=void 0!==Vt.interpolation?ce[Vt.interpolation]:THREE.InterpolateLinear,kt=[];te[We.path]===te.weights?It.traverse(function(nr){!0===nr.isMesh&&nr.morphTargetInfluences&&kt.push(nr.name?nr.name:nr.uuid)}):kt.push(Mt);var Ft=Xt.array;if(Xt.normalized){var jt;if(Ft.constructor===Int8Array)jt=1/127;else if(Ft.constructor===Uint8Array)jt=1/255;else if(Ft.constructor==Int16Array)jt=1/32767;else{if(Ft.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");jt=1/65535}for(var ln=new Float32Array(Ft.length),vn=0,hn=Ft.length;vn<hn;vn++)ln[vn]=Ft[vn]*jt;Ft=ln}for(vn=0,hn=kt.length;vn<hn;vn++){var zn=new ft(kt[vn]+"."+te[We.path],Zt.array,Ft,Ht);"CUBICSPLINE"===Vt.interpolation&&(zn.createInterpolant=function(Xr){return new ae(this.times,this.values,this.getValueSize()/3,Xr)},zn.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),ot.push(zn)}}}return new THREE.AnimationClip($e.name?$e.name:"animation_"+Re,void 0,ot)})},sn.prototype.loadNode=function(Re){var ut,$e=this.extensions,Ve=this,Ke=this.json.nodes[Re],nt=Ke.name?Ve.createUniqueName(Ke.name):"";return(ut=[],void 0!==Ke.mesh&&ut.push(Ve.getDependency("mesh",Ke.mesh).then(function(ht){var _t=Ve._getNodeRef(Ve.meshCache,Ke.mesh,ht);return void 0!==Ke.weights&&_t.traverse(function(Bt){if(Bt.isMesh)for(var Kt=0,rn=Ke.weights.length;Kt<rn;Kt++)Bt.morphTargetInfluences[Kt]=Ke.weights[Kt]}),_t})),void 0!==Ke.camera&&ut.push(Ve.getDependency("camera",Ke.camera).then(function(ht){return Ve._getNodeRef(Ve.cameraCache,Ke.camera,ht)})),Ve._invokeAll(function(ht){return ht.createNodeAttachment&&ht.createNodeAttachment(Re)}).forEach(function(ht){ut.push(ht)}),Promise.all(ut)).then(function(ut){var ht;if((ht=!0===Ke.isBone?new THREE.Bone:ut.length>1?new THREE.Group:1===ut.length?ut[0]:new THREE.Object3D)!==ut[0])for(var _t=0,Bt=ut.length;_t<Bt;_t++)ht.add(ut[_t]);if(Ke.name&&(ht.userData.name=Ke.name,ht.name=nt),gt(ht,Ke),Ke.extensions&&rt($e,ht,Ke),void 0!==Ke.matrix){var Kt=new THREE.Matrix4;Kt.fromArray(Ke.matrix),ht.applyMatrix4(Kt)}else void 0!==Ke.translation&&ht.position.fromArray(Ke.translation),void 0!==Ke.rotation&&ht.quaternion.fromArray(Ke.rotation),void 0!==Ke.scale&&ht.scale.fromArray(Ke.scale);return Ve.associations.set(ht,{type:"nodes",index:Re}),ht})},sn.prototype.loadScene=function(){function Re(Oe,$e,Ve,Ke){var nt=Ve.nodes[Oe];return Ke.getDependency("node",Oe).then(function(ut){return void 0===nt.skin?ut:Ke.getDependency("skin",nt.skin).then(function(_t){for(var Bt=[],Kt=0,rn=(ht=_t).joints.length;Kt<rn;Kt++)Bt.push(Ke.getDependency("node",ht.joints[Kt]));return Promise.all(Bt)}).then(function(_t){return ut.traverse(function(Bt){if(Bt.isMesh){for(var Kt=[],rn=[],mn=0,Ce=_t.length;mn<Ce;mn++){var ie=_t[mn];if(ie){Kt.push(ie);var le=new THREE.Matrix4;void 0!==ht.inverseBindMatrices&&le.fromArray(ht.inverseBindMatrices.array,16*mn),rn.push(le)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',ht.joints[mn])}Bt.bind(new THREE.Skeleton(Kt,rn),Bt.matrixWorld)}}),ut});var ht}).then(function(ut){$e.add(ut);var ht=[];if(nt.children)for(var _t=nt.children,Bt=0,Kt=_t.length;Bt<Kt;Bt++)ht.push(Re(_t[Bt],ut,Ve,Ke));return Promise.all(ht)})}return function($e){var Ve=this.json,Ke=this.extensions,nt=this.json.scenes[$e],ht=new THREE.Group;nt.name&&(ht.name=this.createUniqueName(nt.name)),gt(ht,nt),nt.extensions&&rt(Ke,ht,nt);for(var _t=nt.nodes||[],Bt=[],Kt=0,rn=_t.length;Kt<rn;Kt++)Bt.push(Re(_t[Kt],ht,Ve,this));return Promise.all(Bt).then(function(){return ht})}}(),s}()},{}],60:[function(h,C,m){THREE.MTLLoader=function(s){THREE.Loader.call(this,s)},THREE.MTLLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.MTLLoader,load:function(s,c,u,p){var d=this,A=""===this.path?THREE.LoaderUtils.extractUrlBase(s):this.path,E=new THREE.FileLoader(this.manager);E.setPath(this.path),E.setRequestHeader(this.requestHeader),E.setWithCredentials(this.withCredentials),E.load(s,function(g){try{c(d.parse(g,A))}catch(v){p?p(v):console.error(v),d.manager.itemError(s)}},u,p)},setMaterialOptions:function(s){return this.materialOptions=s,this},parse:function(s,c){for(var u=s.split("\n"),p={},d=/\s+/,A={},E=0;E<u.length;E++){var g=u[E];if(0!==(g=g.trim()).length&&"#"!==g.charAt(0)){var v=g.indexOf(" "),T=v>=0?g.substring(0,v):g;T=T.toLowerCase();var y=v>=0?g.substring(v+1):"";if(y=y.trim(),"newmtl"===T)A[y]=p={name:y};else if("ka"===T||"kd"===T||"ks"===T||"ke"===T){var M=y.split(d,3);p[T]=[parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])]}else p[T]=y}}var _=new THREE.MTLLoader.MaterialCreator(this.resourcePath||c,this.materialOptions);return _.setCrossOrigin(this.crossOrigin),_.setManager(this.manager),_.setMaterials(A),_}}),THREE.MTLLoader.MaterialCreator=function(s,c){this.baseUrl=s||"",this.options=c,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(s){return this.crossOrigin=s,this},setManager:function(s){this.manager=s},setMaterials:function(s){this.materialsInfo=this.convert(s),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(s){if(!this.options)return s;var c={};for(var u in s){var p=s[u],d={};for(var A in c[u]=d,p){var E=!0,g=p[A],v=A.toLowerCase();switch(v){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(g=[g[0]/255,g[1]/255,g[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===g[0]&&0===g[1]&&0===g[2]&&(E=!1)}E&&(d[v]=g)}}return c},preload:function(){for(var s in this.materialsInfo)this.create(s)},getIndex:function(s){return this.nameLookup[s]},getAsArray:function(){var s=0;for(var c in this.materialsInfo)this.materialsArray[s]=this.create(c),this.nameLookup[c]=s,s++;return this.materialsArray},create:function(s){return void 0===this.materials[s]&&this.createMaterial_(s),this.materials[s]},createMaterial_:function(s){var c=this,u=this.materialsInfo[s],p={name:s,side:this.side};function A(T,y){if(!p[T]){var M=c.getTextureParams(y,p),_=c.loadTexture(function d(T,y){return"string"!=typeof y||""===y?"":/^https?:\/\//i.test(y)?y:T+y}(c.baseUrl,M.url));_.repeat.copy(M.scale),_.offset.copy(M.offset),_.wrapS=c.wrap,_.wrapT=c.wrap,p[T]=_}}for(var E in u){var v,g=u[E];if(""!==g)switch(E.toLowerCase()){case"kd":p.color=(new THREE.Color).fromArray(g);break;case"ks":p.specular=(new THREE.Color).fromArray(g);break;case"ke":p.emissive=(new THREE.Color).fromArray(g);break;case"map_kd":A("map",g);break;case"map_ks":A("specularMap",g);break;case"map_ke":A("emissiveMap",g);break;case"norm":A("normalMap",g);break;case"map_bump":case"bump":A("bumpMap",g);break;case"map_d":A("alphaMap",g),p.transparent=!0;break;case"ns":p.shininess=parseFloat(g);break;case"d":(v=parseFloat(g))<1&&(p.opacity=v,p.transparent=!0);break;case"tr":v=parseFloat(g),this.options&&this.options.invertTrProperty&&(v=1-v),v>0&&(p.opacity=1-v,p.transparent=!0)}}return this.materials[s]=new THREE.MeshPhongMaterial(p),this.materials[s]},getTextureParams:function(s,c){var d,u={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},p=s.split(/\s+/);return(d=p.indexOf("-bm"))>=0&&(c.bumpScale=parseFloat(p[d+1]),p.splice(d,2)),(d=p.indexOf("-s"))>=0&&(u.scale.set(parseFloat(p[d+1]),parseFloat(p[d+2])),p.splice(d,4)),(d=p.indexOf("-o"))>=0&&(u.offset.set(parseFloat(p[d+1]),parseFloat(p[d+2])),p.splice(d,4)),u.url=p.join(" ").trim(),u},loadTexture:function(s,c,u,p,d){var A,E=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager,g=E.getHandler(s);return null===g&&(g=new THREE.TextureLoader(E)),g.setCrossOrigin&&g.setCrossOrigin(this.crossOrigin),A=g.load(s,u,p,d),void 0!==c&&(A.mapping=c),A}}},{}],61:[function(h,C,m){THREE.OBJLoader=function(){var s=/^[og]\s*(.+)?/,c=/^mtllib /,u=/^usemtl /,p=/^usemap /,d=new THREE.Vector3,A=new THREE.Vector3,E=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3;function T(){var M={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(_,O){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=_,void(this.object.fromDeclaration=!1!==O);var D=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:_||"",fromDeclaration:!1!==O,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(H,q){var V=this._finalize(!1);V&&(V.inherited||V.groupCount<=0)&&this.materials.splice(V.index,1);var ne={index:this.materials.length,name:H||"",mtllib:Array.isArray(q)&&q.length>0?q[q.length-1]:"",smooth:void 0!==V?V.smooth:this.smooth,groupStart:void 0!==V?V.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(ae){var fe={index:"number"==typeof ae?ae:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return fe.clone=this.clone.bind(fe),fe}};return this.materials.push(ne),ne},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(H){var q=this.currentMaterial();if(q&&-1===q.groupEnd&&(q.groupEnd=this.geometry.vertices.length/3,q.groupCount=q.groupEnd-q.groupStart,q.inherited=!1),H&&this.materials.length>1)for(var V=this.materials.length-1;V>=0;V--)this.materials[V].groupCount<=0&&this.materials.splice(V,1);return H&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),q}},D&&D.name&&"function"==typeof D.clone){var B=D.clone(0);B.inherited=!0,this.object.materials.push(B)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(_,O){var D=parseInt(_,10);return 3*(D>=0?D-1:D+O/3)},parseNormalIndex:function(_,O){var D=parseInt(_,10);return 3*(D>=0?D-1:D+O/3)},parseUVIndex:function(_,O){var D=parseInt(_,10);return 2*(D>=0?D-1:D+O/2)},addVertex:function(_,O,D){var B=this.vertices,H=this.object.geometry.vertices;H.push(B[_+0],B[_+1],B[_+2]),H.push(B[O+0],B[O+1],B[O+2]),H.push(B[D+0],B[D+1],B[D+2])},addVertexPoint:function(_){var O=this.vertices;this.object.geometry.vertices.push(O[_+0],O[_+1],O[_+2])},addVertexLine:function(_){var O=this.vertices;this.object.geometry.vertices.push(O[_+0],O[_+1],O[_+2])},addNormal:function(_,O,D){var B=this.normals,H=this.object.geometry.normals;H.push(B[_+0],B[_+1],B[_+2]),H.push(B[O+0],B[O+1],B[O+2]),H.push(B[D+0],B[D+1],B[D+2])},addFaceNormal:function(_,O,D){var B=this.vertices,H=this.object.geometry.normals;d.fromArray(B,_),A.fromArray(B,O),E.fromArray(B,D),v.subVectors(E,A),g.subVectors(d,A),v.cross(g),v.normalize(),H.push(v.x,v.y,v.z),H.push(v.x,v.y,v.z),H.push(v.x,v.y,v.z)},addColor:function(_,O,D){var B=this.colors,H=this.object.geometry.colors;void 0!==B[_]&&H.push(B[_+0],B[_+1],B[_+2]),void 0!==B[O]&&H.push(B[O+0],B[O+1],B[O+2]),void 0!==B[D]&&H.push(B[D+0],B[D+1],B[D+2])},addUV:function(_,O,D){var B=this.uvs,H=this.object.geometry.uvs;H.push(B[_+0],B[_+1]),H.push(B[O+0],B[O+1]),H.push(B[D+0],B[D+1])},addDefaultUV:function(){var _=this.object.geometry.uvs;_.push(0,0),_.push(0,0),_.push(0,0)},addUVLine:function(_){var O=this.uvs;this.object.geometry.uvs.push(O[_+0],O[_+1])},addFace:function(_,O,D,B,H,q,V,ne,ae){var fe=this.vertices.length,he=this.parseVertexIndex(_,fe),me=this.parseVertexIndex(O,fe),P=this.parseVertexIndex(D,fe);if(this.addVertex(he,me,P),this.addColor(he,me,P),void 0!==V&&""!==V){var X=this.normals.length;he=this.parseNormalIndex(V,X),me=this.parseNormalIndex(ne,X),P=this.parseNormalIndex(ae,X),this.addNormal(he,me,P)}else this.addFaceNormal(he,me,P);if(void 0!==B&&""!==B){var W=this.uvs.length;he=this.parseUVIndex(B,W),me=this.parseUVIndex(H,W),P=this.parseUVIndex(q,W),this.addUV(he,me,P),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(_){this.object.geometry.type="Points";for(var O=this.vertices.length,D=0,B=_.length;D<B;D++){var H=this.parseVertexIndex(_[D],O);this.addVertexPoint(H),this.addColor(H)}},addLineGeometry:function(_,O){this.object.geometry.type="Line";for(var D=this.vertices.length,B=this.uvs.length,H=0,q=_.length;H<q;H++)this.addVertexLine(this.parseVertexIndex(_[H],D));var V=0;for(q=O.length;V<q;V++)this.addUVLine(this.parseUVIndex(O[V],B))}};return M.startObject("",!1),M}function y(M){THREE.Loader.call(this,M),this.materials=null}return y.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:y,load:function(M,_,O,D){var B=this,H=new THREE.FileLoader(this.manager);H.setPath(this.path),H.setRequestHeader(this.requestHeader),H.setWithCredentials(this.withCredentials),H.load(M,function(q){try{_(B.parse(q))}catch(V){D?D(V):console.error(V),B.manager.itemError(M)}},O,D)},setMaterials:function(M){return this.materials=M,this},parse:function(M){var _=new T;-1!==M.indexOf("\r\n")&&(M=M.replace(/\r\n/g,"\n")),-1!==M.indexOf("\\\n")&&(M=M.replace(/\\\n/g,""));for(var O=M.split("\n"),D="",B="",q=[],V="function"==typeof"".trimLeft,ne=0,ae=O.length;ne<ae;ne++)if(D=O[ne],0!==(D=V?D.trimLeft():D.trim()).length&&"#"!==(B=D.charAt(0)))if("v"===B){var fe=D.split(/\s+/);switch(fe[0]){case"v":_.vertices.push(parseFloat(fe[1]),parseFloat(fe[2]),parseFloat(fe[3])),fe.length>=7?_.colors.push(parseFloat(fe[4]),parseFloat(fe[5]),parseFloat(fe[6])):_.colors.push(void 0,void 0,void 0);break;case"vn":_.normals.push(parseFloat(fe[1]),parseFloat(fe[2]),parseFloat(fe[3]));break;case"vt":_.uvs.push(parseFloat(fe[1]),parseFloat(fe[2]))}}else if("f"===B){for(var me=D.substr(1).trim().split(/\s+/),P=[],X=0,W=me.length;X<W;X++){var te=me[X];if(te.length>0){var ce=te.split("/");P.push(ce)}}var Se=P[0];for(X=1,W=P.length-1;X<W;X++){var _e=P[X],ze=P[X+1];_.addFace(Se[0],_e[0],ze[0],Se[1],_e[1],ze[1],Se[2],_e[2],ze[2])}}else if("l"===B){var rt=D.substring(1).trim().split(" "),gt=[],Tt=[];if(-1===D.indexOf("/"))gt=rt;else for(var $t=0,un=rt.length;$t<un;$t++){var In=rt[$t].split("/");""!==In[0]&&gt.push(In[0]),""!==In[1]&&Tt.push(In[1])}_.addLineGeometry(gt,Tt)}else if("p"===B){var sn=D.substr(1).trim().split(" ");_.addPointGeometry(sn)}else if(null!==(q=s.exec(D))){var tr=(" "+q[0].substr(1).trim()).substr(1);_.startObject(tr)}else if(u.test(D))_.object.startMaterial(D.substring(7).trim(),_.materialLibraries);else if(c.test(D))_.materialLibraries.push(D.substring(7).trim());else if(p.test(D))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===B){if((q=D.split(" ")).length>1){var Cr=q[1].trim().toLowerCase();_.object.smooth="0"!==Cr&&"off"!==Cr}else _.object.smooth=!0;(Un=_.object.currentMaterial())&&(Un.smooth=_.object.smooth)}else{if("\0"===D)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+D+'"')}_.finalize();var Re=new THREE.Group;if(Re.materialLibraries=[].concat(_.materialLibraries),!0==!(1===_.objects.length&&0===_.objects[0].geometry.vertices.length))for(ne=0,ae=_.objects.length;ne<ae;ne++){var $e=_.objects[ne],Ve=$e.geometry,Ke=$e.materials,nt="Line"===Ve.type,ut="Points"===Ve.type,ht=!1;if(0!==Ve.vertices.length){var Fe;(_t=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute(Ve.vertices,3)),Ve.normals.length>0&&_t.setAttribute("normal",new THREE.Float32BufferAttribute(Ve.normals,3)),Ve.colors.length>0&&(ht=!0,_t.setAttribute("color",new THREE.Float32BufferAttribute(Ve.colors,3))),!0===Ve.hasUVIndices&&_t.setAttribute("uv",new THREE.Float32BufferAttribute(Ve.uvs,2));for(var Bt=[],Kt=0,rn=Ke.length;Kt<rn;Kt++){var Ce=(mn=Ke[Kt]).name+"_"+mn.smooth+"_"+ht,Un=_.materials[Ce];if(null!==this.materials)if(Un=this.materials.create(mn.name),!nt||!Un||Un instanceof THREE.LineBasicMaterial){if(ut&&Un&&!(Un instanceof THREE.PointsMaterial)){var le=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(le,Un),le.color.copy(Un.color),le.map=Un.map,Un=le}}else{var ie=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(ie,Un),ie.color.copy(Un.color),Un=ie}void 0===Un&&((Un=nt?new THREE.LineBasicMaterial:ut?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=mn.name,Un.flatShading=!mn.smooth,Un.vertexColors=ht,_.materials[Ce]=Un),Bt.push(Un)}if(Bt.length>1){for(Kt=0,rn=Ke.length;Kt<rn;Kt++){var mn;_t.addGroup((mn=Ke[Kt]).groupStart,mn.groupCount,Kt)}Fe=nt?new THREE.LineSegments(_t,Bt):ut?new THREE.Points(_t,Bt):new THREE.Mesh(_t,Bt)}else Fe=nt?new THREE.LineSegments(_t,Bt[0]):ut?new THREE.Points(_t,Bt[0]):new THREE.Mesh(_t,Bt[0]);Fe.name=$e.name,Re.add(Fe)}}else if(_.vertices.length>0){var _t;Un=new THREE.PointsMaterial({size:1,sizeAttenuation:!1}),(_t=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute(_.vertices,3)),_.colors.length>0&&(_t.setAttribute("color",new THREE.Float32BufferAttribute(_.colors,3)),Un.vertexColors=!0);var Ye=new THREE.Points(_t,Un);Re.add(Ye)}return Re}}),y}()},{}],62:[function(h,C,m){var s=h("layout-bmfont-text"),c=h("inherits"),u=h("quad-indices"),p=h("three-buffer-vertex-data"),d=h("object-assign"),A=h("./lib/vertices"),E=h("./lib/utils"),g=THREE.BufferGeometry;function v(T){g.call(this),"string"==typeof T&&(T={text:T}),this._opt=d({},T),T&&this.update(T)}C.exports=function(y){return new v(y)},c(v,g),v.prototype.update=function(T){if("string"==typeof T&&(T={text:T}),!(T=d({},this._opt,T)).font)throw new TypeError("must specify a { font } in options");this.layout=s(T);var y=!1!==T.flipY,M=T.font,_=M.common.scaleW,O=M.common.scaleH,D=this.layout.glyphs.filter(function(ne){var ae=ne.data;return ae.width*ae.height>0});this.visibleGlyphs=D;var B=A.positions(D),H=A.uvs(D,_,O,y),q=u({clockwise:!0,type:"uint16",count:D.length});if(p.index(this,q,1,"uint16"),p.attr(this,"position",B,2),p.attr(this,"uv",H,2),!T.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(T.multipage){var V=A.pages(D);p.attr(this,"page",V,1)}},v.prototype.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var T=this.attributes.position.array;if(!T||!this.attributes.position.itemSize||T.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);E.computeSphere(T,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')},v.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var T=this.boundingBox,y=this.attributes.position.array;!y||!this.attributes.position.itemSize||y.length<2?T.makeEmpty():E.computeBox(y,T)}},{"./lib/utils":63,"./lib/vertices":64,inherits:30,"layout-bmfont-text":36,"object-assign":39,"quad-indices":51,"three-buffer-vertex-data":65}],63:[function(h,C,m){var c={min:[0,0],max:[0,0]};function u(p){var d=p.length/2;c.min[0]=p[0],c.min[1]=p[1],c.max[0]=p[0],c.max[1]=p[1];for(var A=0;A<d;A++){var E=p[2*A+0],g=p[2*A+1];c.min[0]=Math.min(E,c.min[0]),c.min[1]=Math.min(g,c.min[1]),c.max[0]=Math.max(E,c.max[0]),c.max[1]=Math.max(g,c.max[1])}}C.exports.computeBox=function(p,d){u(p),d.min.set(c.min[0],c.min[1],0),d.max.set(c.max[0],c.max[1],0)},C.exports.computeSphere=function(p,d){u(p);var A=c.min[0],E=c.min[1],T=c.max[0]-A,y=c.max[1]-E,M=Math.sqrt(T*T+y*y);d.center.set(A+T/2,E+y/2,0),d.radius=M/2}},{}],64:[function(h,C,m){C.exports.pages=function(c){var u=new Float32Array(4*c.length*1),p=0;return c.forEach(function(d){var A=d.data.page||0;u[p++]=A,u[p++]=A,u[p++]=A,u[p++]=A}),u},C.exports.uvs=function(c,u,p,d){var A=new Float32Array(4*c.length*2),E=0;return c.forEach(function(g){var v=g.data,y=v.y+v.height,M=v.x/u,_=v.y/p,O=(v.x+v.width)/u,D=y/p;d&&(_=(p-v.y)/p,D=(p-y)/p),A[E++]=M,A[E++]=_,A[E++]=M,A[E++]=D,A[E++]=O,A[E++]=D,A[E++]=O,A[E++]=_}),A},C.exports.positions=function(c){var u=new Float32Array(4*c.length*2),p=0;return c.forEach(function(d){var A=d.data,E=d.position[0]+A.xoffset,g=d.position[1]+A.yoffset,v=A.width,T=A.height;u[p++]=E,u[p++]=g,u[p++]=E,u[p++]=g+T,u[p++]=E+v,u[p++]=g+T,u[p++]=E+v,u[p++]=g}),u}},{}],65:[function(h,C,m){var s=h("flatten-vertex-data");function d(E,g,v,T){return g=s(g=g||[],T),(E=new THREE.BufferAttribute(g,v)).itemSize=v,E.needsUpdate=!0,E}C.exports.attr=function p(E,g,v,T,y){if("number"!=typeof T&&(T=3),"string"!=typeof y&&(y="float32"),Array.isArray(v)&&Array.isArray(v[0])&&v[0].length!==T)throw new Error("Nested vertex array has unexpected size; expected "+T+" but found "+v[0].length);var _=d(E.getAttribute(g),v,T,y);E.setAttribute(g,_)},C.exports.index=function u(E,g,v,T){"number"!=typeof v&&(v=1),"string"!=typeof T&&(T="uint16");var y=!E.index&&"function"!=typeof E.setIndex,_=d(y?E.getAttribute("index"):E.index,g,v,T);_&&(y?E.addAttribute("index",_):E.index=_)}},{"flatten-vertex-data":23}],66:[function(h,C,m){(function(s,c){var u=h("process/browser.js").nextTick,p=Function.prototype.apply,d=Array.prototype.slice,A={},E=0;function g(v,T){this._id=v,this._clearFn=T}m.setTimeout=function(){return new g(p.call(setTimeout,window,arguments),clearTimeout)},m.setInterval=function(){return new g(p.call(setInterval,window,arguments),clearInterval)},m.clearTimeout=m.clearInterval=function(v){v.close()},g.prototype.unref=g.prototype.ref=function(){},g.prototype.close=function(){this._clearFn.call(window,this._id)},m.enroll=function(v,T){clearTimeout(v._idleTimeoutId),v._idleTimeout=T},m.unenroll=function(v){clearTimeout(v._idleTimeoutId),v._idleTimeout=-1},m._unrefActive=m.active=function(v){clearTimeout(v._idleTimeoutId);var T=v._idleTimeout;T>=0&&(v._idleTimeoutId=setTimeout(function(){v._onTimeout&&v._onTimeout()},T))},m.setImmediate="function"==typeof s?s:function(v){var T=E++,y=!(arguments.length<2)&&d.call(arguments,1);return A[T]=!0,u(function(){A[T]&&(y?v.apply(null,y):v.call(null),m.clearImmediate(T))}),T},m.clearImmediate="function"==typeof c?c:function(v){delete A[v]}}).call(this,h("timers").setImmediate,h("timers").clearImmediate)},{"process/browser.js":49,timers:66}],67:[function(h,C,m){(function(s){var u;u=function(){"use strict";var c=typeof window<"u"?window:typeof s<"u"?s:typeof self<"u"?self:{},d=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},A=function(H,q){for(var V=0,ne=H.length;V<ne;V++)q[V]=H[V]},E=function(H,q){for(var V in q)q.hasOwnProperty(V)&&(H[V]=q[V]);return H},v=function u(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}(function p(B,H){return B(H={exports:{}},H.exports),H.exports}(function(B,H){B.exports=function(){var J,V=function(){function J($,ye){for(var xe=0;xe<ye.length;xe++){var Ue=ye[xe];Ue.enumerable=Ue.enumerable||!1,Ue.configurable=!0,"value"in Ue&&(Ue.writable=!0),Object.defineProperty($,Ue.key,Ue)}}return function($,ye,xe){return ye&&J($.prototype,ye),xe&&J($,xe),$}}(),ne=function($,ye){if(Array.isArray($))return $;if(Symbol.iterator in Object($))return function J($,ye){var xe=[],Ue=!0,ct=!1,Et=void 0;try{for(var on,an=$[Symbol.iterator]();!(Ue=(on=an.next()).done)&&(xe.push(on.value),!ye||xe.length!==ye);Ue=!0);}catch(Ct){ct=!0,Et=Ct}finally{try{!Ue&&an.return&&an.return()}finally{if(ct)throw Et}}return xe}($,ye);throw new TypeError("Invalid attempt to destructure non-iterable instance")},me=function($,ye,xe){return $+(ye-$)*xe},P=(J=/iPad|iPhone|iPod/.test(navigator.platform),function(){return J}),X=function(){var J=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return J}}(),W=function(){var J=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return J}}(),te=function(){var J=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return J}}(),ce=function(){var J=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),$=J?parseInt(J[1],10):null;return function(){return $}}(),Se=function(){var J;return J=P()&&W()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return J}}(),_e=function(){var J=!1;if(65===ce()){var $=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if($){var ye=$[1].split("."),xe=ne(ye,4),an=xe[3];J=3325===parseInt(xe[2],10)&&parseInt(an,10)<148}}return function(){return J}}(),ze=function(){var J=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return J}}(),rt=function(){var $=90==window.orientation||-90==window.orientation;return ze()?!$:$},Tt=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},$t=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},In=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},tr=function($,ye,xe,Ue){var ct=$.createShader($.VERTEX_SHADER);$.shaderSource(ct,ye),$.compileShader(ct);var Et=$.createShader($.FRAGMENT_SHADER);$.shaderSource(Et,xe),$.compileShader(Et);var an=$.createProgram();for(var on in $.attachShader(an,ct),$.attachShader(an,Et),Ue)$.bindAttribLocation(an,Ue[on],on);return $.linkProgram(an),$.deleteShader(ct),$.deleteShader(Et),an},Cr=function($,ye){for(var xe={},Ue=$.getProgramParameter(ye,$.ACTIVE_UNIFORMS),ct="",Et=0;Et<Ue;Et++)xe[ct=$.getActiveUniform(ye,Et).name.replace("[0]","")]=$.getUniformLocation(ye,ct);return xe},Re=function(){var ye,$=!1;return ye=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ye)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ye.substr(0,4)))&&($=!0),$},Oe=function($,ye){for(var xe in ye)ye.hasOwnProperty(xe)&&($[xe]=ye[xe]);return $},$e=function($){if(P()){var ye=$.style.width,xe=$.style.height;$.style.width=parseInt(ye)+1+"px",$.style.height=parseInt(xe)+"px",setTimeout(function(){$.style.width=ye,$.style.height=xe},100)}window.canvas=$},Ve=function(){var J=Math.PI/180,$=.25*Math.PI;var Et=new Float32Array([0,0,0,1]),an=new Float32Array([0,0,0]);function on(Ct,Ut,pn,Bn,Yn,or){(function ye(Ct,Ut,pn,Bn){var Yn=Math.tan(Ut?Ut.upDegrees*J:$),or=Math.tan(Ut?Ut.downDegrees*J:$),Mr=Math.tan(Ut?Ut.leftDegrees*J:$),Ar=Math.tan(Ut?Ut.rightDegrees*J:$),vr=2/(Mr+Ar),ni=2/(Yn+or);return Ct[0]=vr,Ct[1]=0,Ct[2]=0,Ct[3]=0,Ct[4]=0,Ct[5]=ni,Ct[6]=0,Ct[7]=0,Ct[8]=-(Mr-Ar)*vr*.5,Ct[9]=(Yn-or)*ni*.5,Ct[10]=Bn/(pn-Bn),Ct[11]=-1,Ct[12]=0,Ct[13]=0,Ct[14]=Bn*pn/(pn-Bn),Ct[15]=0,Ct})(Ct,Bn||null,or.depthNear,or.depthFar),function xe(Ct,Ut,pn){var Bn=Ut[0],Yn=Ut[1],or=Ut[2],Mr=Ut[3],Ar=Bn+Bn,vr=Yn+Yn,ni=or+or,Ci=Bn*Ar,ki=Bn*vr,_i=Bn*ni,ji=Yn*vr,aa=Yn*ni,oa=or*ni,sa=Mr*Ar,la=Mr*vr,Oa=Mr*ni;return Ct[0]=1-(ji+oa),Ct[1]=ki+Oa,Ct[2]=_i-la,Ct[3]=0,Ct[4]=ki-Oa,Ct[5]=1-(Ci+oa),Ct[6]=aa+sa,Ct[7]=0,Ct[8]=_i+la,Ct[9]=aa-sa,Ct[10]=1-(Ci+ji),Ct[11]=0,Ct[12]=pn[0],Ct[13]=pn[1],Ct[14]=pn[2],Ct[15]=1,Ct}(Ut,pn.orientation||Et,pn.position||an),Yn&&function Ue(Ct,Ut,pn){var Mr,Ar,vr,ni,Ci,ki,_i,ji,aa,oa,sa,la,Bn=pn[0],Yn=pn[1],or=pn[2];return Ut===Ct?(Ct[12]=Ut[0]*Bn+Ut[4]*Yn+Ut[8]*or+Ut[12],Ct[13]=Ut[1]*Bn+Ut[5]*Yn+Ut[9]*or+Ut[13],Ct[14]=Ut[2]*Bn+Ut[6]*Yn+Ut[10]*or+Ut[14],Ct[15]=Ut[3]*Bn+Ut[7]*Yn+Ut[11]*or+Ut[15]):(Ar=Ut[1],vr=Ut[2],ni=Ut[3],Ci=Ut[4],ki=Ut[5],_i=Ut[6],ji=Ut[7],aa=Ut[8],oa=Ut[9],sa=Ut[10],la=Ut[11],Ct[0]=Mr=Ut[0],Ct[1]=Ar,Ct[2]=vr,Ct[3]=ni,Ct[4]=Ci,Ct[5]=ki,Ct[6]=_i,Ct[7]=ji,Ct[8]=aa,Ct[9]=oa,Ct[10]=sa,Ct[11]=la,Ct[12]=Mr*Bn+Ci*Yn+aa*or+Ut[12],Ct[13]=Ar*Bn+ki*Yn+oa*or+Ut[13],Ct[14]=vr*Bn+_i*Yn+sa*or+Ut[14],Ct[15]=ni*Bn+ji*Yn+la*or+Ut[15]),Ct}(Ut,Ut,Yn),function ct(Ct,Ut){var pn=Ut[0],Bn=Ut[1],Yn=Ut[2],or=Ut[3],Mr=Ut[4],Ar=Ut[5],vr=Ut[6],ni=Ut[7],Ci=Ut[8],ki=Ut[9],_i=Ut[10],ji=Ut[11],aa=Ut[12],oa=Ut[13],sa=Ut[14],la=Ut[15],Oa=pn*Ar-Bn*Mr,Ba=pn*vr-Yn*Mr,Fa=pn*ni-or*Mr,Ka=Bn*vr-Yn*Ar,Ma=Bn*ni-or*Ar,Ta=Yn*ni-or*vr,Pa=Ci*oa-ki*aa,Qa=Ci*sa-_i*aa,ro=Ci*la-ji*aa,Eo=ki*sa-_i*oa,Ho=ki*la-ji*oa,xo=_i*la-ji*sa,qr=Oa*xo-Ba*Ho+Fa*Eo+Ka*ro-Ma*Qa+Ta*Pa;return qr?(Ct[0]=(Ar*xo-vr*Ho+ni*Eo)*(qr=1/qr),Ct[1]=(Yn*Ho-Bn*xo-or*Eo)*qr,Ct[2]=(oa*Ta-sa*Ma+la*Ka)*qr,Ct[3]=(_i*Ma-ki*Ta-ji*Ka)*qr,Ct[4]=(vr*ro-Mr*xo-ni*Qa)*qr,Ct[5]=(pn*xo-Yn*ro+or*Qa)*qr,Ct[6]=(sa*Fa-aa*Ta-la*Ba)*qr,Ct[7]=(Ci*Ta-_i*Fa+ji*Ba)*qr,Ct[8]=(Mr*Ho-Ar*ro+ni*Pa)*qr,Ct[9]=(Bn*ro-pn*Ho-or*Pa)*qr,Ct[10]=(aa*Ma-oa*Fa+la*Oa)*qr,Ct[11]=(ki*Fa-Ci*Ma-ji*Oa)*qr,Ct[12]=(Ar*Qa-Mr*Eo-vr*Pa)*qr,Ct[13]=(pn*Eo-Bn*Qa+Yn*Pa)*qr,Ct[14]=(oa*Ba-aa*Ka-sa*Oa)*qr,Ct[15]=(Ci*Ka-ki*Ba+_i*Oa)*qr,Ct):null}(Ut,Ut)}return function(Ct,Ut,pn){return!(!Ct||!Ut||(Ct.pose=Ut,Ct.timestamp=Ut.timestamp,on(Ct.leftProjectionMatrix,Ct.leftViewMatrix,Ut,pn._getFieldOfView("left"),pn._getEyeOffset("left"),pn),on(Ct.rightProjectionMatrix,Ct.rightViewMatrix,Ut,pn._getFieldOfView("right"),pn._getEyeOffset("right"),pn),0))}}(),nt=function($){var xe=$.indexOf("://"),Ue=$.indexOf("/",-1!==xe?xe+3:0);return-1===Ue&&(Ue=$.length),$.substring(0,Ue)},ht=function(){var J={};return function($,ye){void 0===J[$]&&(console.warn("webvr-polyfill: "+ye),J[$]=!0)}}(),_t=function($,ye){ht($,$+" has been deprecated. This may not work on native WebVR displays. "+(ye?"Please use "+ye+" instead.":""))};var Kt=function Bt(J,$,ye){if($){for(var xe=[],Ue=null,ct=0;ct<$.length;++ct)switch(Et=$[ct]){case J.TEXTURE_BINDING_2D:case J.TEXTURE_BINDING_CUBE_MAP:if((an=$[++ct])<J.TEXTURE0||an>J.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),xe.push(null,null);break}Ue||(Ue=J.getParameter(J.ACTIVE_TEXTURE)),J.activeTexture(an),xe.push(J.getParameter(Et),null);break;case J.ACTIVE_TEXTURE:Ue=J.getParameter(J.ACTIVE_TEXTURE),xe.push(null);break;default:xe.push(J.getParameter(Et))}for(ye(J),ct=0;ct<$.length;++ct){var Et,on=xe[ct];switch(Et=$[ct]){case J.ACTIVE_TEXTURE:break;case J.ARRAY_BUFFER_BINDING:J.bindBuffer(J.ARRAY_BUFFER,on);break;case J.COLOR_CLEAR_VALUE:J.clearColor(on[0],on[1],on[2],on[3]);break;case J.COLOR_WRITEMASK:J.colorMask(on[0],on[1],on[2],on[3]);break;case J.CURRENT_PROGRAM:J.useProgram(on);break;case J.ELEMENT_ARRAY_BUFFER_BINDING:J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,on);break;case J.FRAMEBUFFER_BINDING:J.bindFramebuffer(J.FRAMEBUFFER,on);break;case J.RENDERBUFFER_BINDING:J.bindRenderbuffer(J.RENDERBUFFER,on);break;case J.TEXTURE_BINDING_2D:if((an=$[++ct])<J.TEXTURE0||an>J.TEXTURE31)break;J.activeTexture(an),J.bindTexture(J.TEXTURE_2D,on);break;case J.TEXTURE_BINDING_CUBE_MAP:var an;if((an=$[++ct])<J.TEXTURE0||an>J.TEXTURE31)break;J.activeTexture(an),J.bindTexture(J.TEXTURE_CUBE_MAP,on);break;case J.VIEWPORT:J.viewport(on[0],on[1],on[2],on[3]);break;case J.BLEND:case J.CULL_FACE:case J.DEPTH_TEST:case J.SCISSOR_TEST:case J.STENCIL_TEST:on?J.enable(Et):J.disable(Et);break;default:console.log("No GL restore behavior for 0x"+Et.toString(16))}Ue&&J.activeTexture(Ue)}}else ye(J)},rn=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),mn=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function Ce(J,$,ye,xe){this.gl=J,this.cardboardUI=$,this.bufferScale=ye,this.dirtySubmitFrameBindings=xe,this.ctxAttribs=J.getContextAttributes(),this.instanceExt=J.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=J.drawingBufferWidth,this.bufferHeight=J.drawingBufferHeight,this.realBindFramebuffer=J.bindFramebuffer,this.realEnable=J.enable,this.realDisable=J.disable,this.realColorMask=J.colorMask,this.realClearColor=J.clearColor,this.realViewport=J.viewport,P()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(J.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(J.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=tr(J,rn,mn,this.attribs),this.uniforms=Cr(J,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=J.createBuffer(),this.indexBuffer=J.createBuffer(),this.indexCount=0,this.renderTarget=J.createTexture(),this.framebuffer=J.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=J.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=J.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=J.createRenderbuffer()),this.patch(),this.onResize()}Ce.prototype.destroy=function(){var J=this.gl;this.unpatch(),J.deleteProgram(this.program),J.deleteBuffer(this.vertexBuffer),J.deleteBuffer(this.indexBuffer),J.deleteTexture(this.renderTarget),J.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&J.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&J.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&J.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},Ce.prototype.onResize=function(){var J=this.gl,$=this;Kt(J,[J.RENDERBUFFER_BINDING,J.TEXTURE_BINDING_2D,J.TEXTURE0],function(xe){$.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,null),$.scissorTest&&$.realDisable.call(xe,xe.SCISSOR_TEST),$.realColorMask.call(xe,!0,!0,!0,!0),$.realViewport.call(xe,0,0,xe.drawingBufferWidth,xe.drawingBufferHeight),$.realClearColor.call(xe,0,0,0,1),xe.clear(xe.COLOR_BUFFER_BIT),$.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,$.framebuffer),xe.bindTexture(xe.TEXTURE_2D,$.renderTarget),xe.texImage2D(xe.TEXTURE_2D,0,$.ctxAttribs.alpha?xe.RGBA:xe.RGB,$.bufferWidth,$.bufferHeight,0,$.ctxAttribs.alpha?xe.RGBA:xe.RGB,xe.UNSIGNED_BYTE,null),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.framebufferTexture2D(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_2D,$.renderTarget,0),$.ctxAttribs.depth&&$.ctxAttribs.stencil?(xe.bindRenderbuffer(xe.RENDERBUFFER,$.depthStencilBuffer),xe.renderbufferStorage(xe.RENDERBUFFER,xe.DEPTH_STENCIL,$.bufferWidth,$.bufferHeight),xe.framebufferRenderbuffer(xe.FRAMEBUFFER,xe.DEPTH_STENCIL_ATTACHMENT,xe.RENDERBUFFER,$.depthStencilBuffer)):$.ctxAttribs.depth?(xe.bindRenderbuffer(xe.RENDERBUFFER,$.depthBuffer),xe.renderbufferStorage(xe.RENDERBUFFER,xe.DEPTH_COMPONENT16,$.bufferWidth,$.bufferHeight),xe.framebufferRenderbuffer(xe.FRAMEBUFFER,xe.DEPTH_ATTACHMENT,xe.RENDERBUFFER,$.depthBuffer)):$.ctxAttribs.stencil&&(xe.bindRenderbuffer(xe.RENDERBUFFER,$.stencilBuffer),xe.renderbufferStorage(xe.RENDERBUFFER,xe.STENCIL_INDEX8,$.bufferWidth,$.bufferHeight),xe.framebufferRenderbuffer(xe.FRAMEBUFFER,xe.STENCIL_ATTACHMENT,xe.RENDERBUFFER,$.stencilBuffer)),!xe.checkFramebufferStatus(xe.FRAMEBUFFER)===xe.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),$.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,$.lastBoundFramebuffer),$.scissorTest&&$.realEnable.call(xe,xe.SCISSOR_TEST),$.realColorMask.apply(xe,$.colorMask),$.realViewport.apply(xe,$.viewport),$.realClearColor.apply(xe,$.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},Ce.prototype.patch=function(){if(!this.isPatched){var J=this,$=this.gl.canvas,ye=this.gl;P()||($.width=Tt()*this.bufferScale,$.height=$t()*this.bufferScale,Object.defineProperty($,"width",{configurable:!0,enumerable:!0,get:function(){return J.bufferWidth},set:function(Ue){J.bufferWidth=Ue,J.realCanvasWidth.set.call($,Ue),J.onResize()}}),Object.defineProperty($,"height",{configurable:!0,enumerable:!0,get:function(){return J.bufferHeight},set:function(Ue){J.bufferHeight=Ue,J.realCanvasHeight.set.call($,Ue),J.onResize()}})),this.lastBoundFramebuffer=ye.getParameter(ye.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(ye.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(xe,Ue){J.lastBoundFramebuffer=Ue||J.framebuffer,J.realBindFramebuffer.call(ye,xe,J.lastBoundFramebuffer)},this.cullFace=ye.getParameter(ye.CULL_FACE),this.depthTest=ye.getParameter(ye.DEPTH_TEST),this.blend=ye.getParameter(ye.BLEND),this.scissorTest=ye.getParameter(ye.SCISSOR_TEST),this.stencilTest=ye.getParameter(ye.STENCIL_TEST),ye.enable=function(xe){switch(xe){case ye.CULL_FACE:J.cullFace=!0;break;case ye.DEPTH_TEST:J.depthTest=!0;break;case ye.BLEND:J.blend=!0;break;case ye.SCISSOR_TEST:J.scissorTest=!0;break;case ye.STENCIL_TEST:J.stencilTest=!0}J.realEnable.call(ye,xe)},ye.disable=function(xe){switch(xe){case ye.CULL_FACE:J.cullFace=!1;break;case ye.DEPTH_TEST:J.depthTest=!1;break;case ye.BLEND:J.blend=!1;break;case ye.SCISSOR_TEST:J.scissorTest=!1;break;case ye.STENCIL_TEST:J.stencilTest=!1}J.realDisable.call(ye,xe)},this.colorMask=ye.getParameter(ye.COLOR_WRITEMASK),ye.colorMask=function(xe,Ue,ct,Et){J.colorMask[0]=xe,J.colorMask[1]=Ue,J.colorMask[2]=ct,J.colorMask[3]=Et,J.realColorMask.call(ye,xe,Ue,ct,Et)},this.clearColor=ye.getParameter(ye.COLOR_CLEAR_VALUE),ye.clearColor=function(xe,Ue,ct,Et){J.clearColor[0]=xe,J.clearColor[1]=Ue,J.clearColor[2]=ct,J.clearColor[3]=Et,J.realClearColor.call(ye,xe,Ue,ct,Et)},this.viewport=ye.getParameter(ye.VIEWPORT),ye.viewport=function(xe,Ue,ct,Et){J.viewport[0]=xe,J.viewport[1]=Ue,J.viewport[2]=ct,J.viewport[3]=Et,J.realViewport.call(ye,xe,Ue,ct,Et)},this.isPatched=!0,$e($)}},Ce.prototype.unpatch=function(){if(this.isPatched){var J=this.gl,$=this.gl.canvas;P()||(Object.defineProperty($,"width",this.realCanvasWidth),Object.defineProperty($,"height",this.realCanvasHeight)),$.width=this.bufferWidth,$.height=this.bufferHeight,J.bindFramebuffer=this.realBindFramebuffer,J.enable=this.realEnable,J.disable=this.realDisable,J.colorMask=this.realColorMask,J.clearColor=this.realClearColor,J.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&J.bindFramebuffer(J.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){$e($)},1)}},Ce.prototype.setTextureBounds=function(J,$){J||(J=[0,0,.5,1]),$||($=[.5,0,.5,1]),this.viewportOffsetScale[0]=J[0],this.viewportOffsetScale[1]=J[1],this.viewportOffsetScale[2]=J[2],this.viewportOffsetScale[3]=J[3],this.viewportOffsetScale[4]=$[0],this.viewportOffsetScale[5]=$[1],this.viewportOffsetScale[6]=$[2],this.viewportOffsetScale[7]=$[3]},Ce.prototype.submitFrame=function(){var J=this.gl,$=this,ye=[];if(this.dirtySubmitFrameBindings||ye.push(J.CURRENT_PROGRAM,J.ARRAY_BUFFER_BINDING,J.ELEMENT_ARRAY_BUFFER_BINDING,J.TEXTURE_BINDING_2D,J.TEXTURE0),Kt(J,ye,function(Ue){$.realBindFramebuffer.call(Ue,Ue.FRAMEBUFFER,null);var ct=0,Et=0;$.instanceExt&&(ct=Ue.getVertexAttrib($.attribs.position,$.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),Et=Ue.getVertexAttrib($.attribs.texCoord,$.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),$.cullFace&&$.realDisable.call(Ue,Ue.CULL_FACE),$.depthTest&&$.realDisable.call(Ue,Ue.DEPTH_TEST),$.blend&&$.realDisable.call(Ue,Ue.BLEND),$.scissorTest&&$.realDisable.call(Ue,Ue.SCISSOR_TEST),$.stencilTest&&$.realDisable.call(Ue,Ue.STENCIL_TEST),$.realColorMask.call(Ue,!0,!0,!0,!0),$.realViewport.call(Ue,0,0,Ue.drawingBufferWidth,Ue.drawingBufferHeight),($.ctxAttribs.alpha||P())&&($.realClearColor.call(Ue,0,0,0,1),Ue.clear(Ue.COLOR_BUFFER_BIT)),Ue.useProgram($.program),Ue.bindBuffer(Ue.ELEMENT_ARRAY_BUFFER,$.indexBuffer),Ue.bindBuffer(Ue.ARRAY_BUFFER,$.vertexBuffer),Ue.enableVertexAttribArray($.attribs.position),Ue.enableVertexAttribArray($.attribs.texCoord),Ue.vertexAttribPointer($.attribs.position,2,Ue.FLOAT,!1,20,0),Ue.vertexAttribPointer($.attribs.texCoord,3,Ue.FLOAT,!1,20,8),$.instanceExt&&(0!=ct&&$.instanceExt.vertexAttribDivisorANGLE($.attribs.position,0),0!=Et&&$.instanceExt.vertexAttribDivisorANGLE($.attribs.texCoord,0)),Ue.activeTexture(Ue.TEXTURE0),Ue.uniform1i($.uniforms.diffuse,0),Ue.bindTexture(Ue.TEXTURE_2D,$.renderTarget),Ue.uniform4fv($.uniforms.viewportOffsetScale,$.viewportOffsetScale),Ue.drawElements(Ue.TRIANGLES,$.indexCount,Ue.UNSIGNED_SHORT,0),$.cardboardUI&&$.cardboardUI.renderNoState(),$.realBindFramebuffer.call($.gl,Ue.FRAMEBUFFER,$.framebuffer),$.ctxAttribs.preserveDrawingBuffer||($.realClearColor.call(Ue,0,0,0,0),Ue.clear(Ue.COLOR_BUFFER_BIT)),$.dirtySubmitFrameBindings||$.realBindFramebuffer.call(Ue,Ue.FRAMEBUFFER,$.lastBoundFramebuffer),$.cullFace&&$.realEnable.call(Ue,Ue.CULL_FACE),$.depthTest&&$.realEnable.call(Ue,Ue.DEPTH_TEST),$.blend&&$.realEnable.call(Ue,Ue.BLEND),$.scissorTest&&$.realEnable.call(Ue,Ue.SCISSOR_TEST),$.stencilTest&&$.realEnable.call(Ue,Ue.STENCIL_TEST),$.realColorMask.apply(Ue,$.colorMask),$.realViewport.apply(Ue,$.viewport),($.ctxAttribs.alpha||!$.ctxAttribs.preserveDrawingBuffer)&&$.realClearColor.apply(Ue,$.clearColor),$.instanceExt&&(0!=ct&&$.instanceExt.vertexAttribDivisorANGLE($.attribs.position,ct),0!=Et&&$.instanceExt.vertexAttribDivisorANGLE($.attribs.texCoord,Et))}),P()){var xe=J.canvas;(xe.width!=$.bufferWidth||xe.height!=$.bufferHeight)&&($.bufferWidth=xe.width,$.bufferHeight=xe.height,$.onResize())}},Ce.prototype.updateDeviceInfo=function(J){var $=this.gl,ye=this;Kt($,[$.ARRAY_BUFFER_BINDING,$.ELEMENT_ARRAY_BUFFER_BINDING],function(Ue){var ct=ye.computeMeshVertices_(ye.meshWidth,ye.meshHeight,J);if(Ue.bindBuffer(Ue.ARRAY_BUFFER,ye.vertexBuffer),Ue.bufferData(Ue.ARRAY_BUFFER,ct,Ue.STATIC_DRAW),!ye.indexCount){var Et=ye.computeMeshIndices_(ye.meshWidth,ye.meshHeight);Ue.bindBuffer(Ue.ELEMENT_ARRAY_BUFFER,ye.indexBuffer),Ue.bufferData(Ue.ELEMENT_ARRAY_BUFFER,Et,Ue.STATIC_DRAW),ye.indexCount=Et.length}})},Ce.prototype.computeMeshVertices_=function(J,$,ye){for(var xe=new Float32Array(2*J*$*5),Ue=ye.getLeftEyeVisibleTanAngles(),ct=ye.getLeftEyeNoLensTanAngles(),Et=ye.getLeftEyeVisibleScreenRect(ct),an=0,on=0;on<2;on++){for(var Ct=0;Ct<$;Ct++)for(var Ut=0;Ut<J;Ut++,an++){var pn=Ut/(J-1),Bn=Ct/($-1),Yn=pn,or=Bn,Mr=me(Ue[0],Ue[2],pn),Ar=me(Ue[3],Ue[1],Bn),vr=Math.sqrt(Mr*Mr+Ar*Ar),ni=ye.distortion.distortInverse(vr);Bn=2*(Et.y+(Bn=(Ar*ni/vr-ct[3])/(ct[1]-ct[3]))*Et.height-.5),xe[5*an+0]=pn=2*(Et.x+(pn=(Mr*ni/vr-ct[0])/(ct[2]-ct[0]))*Et.width-.5),xe[5*an+1]=Bn,xe[5*an+2]=Yn,xe[5*an+3]=or,xe[5*an+4]=on}var _i=Ue[2]-Ue[0];Ue[0]=-(_i+Ue[0]),Ue[2]=_i-Ue[2],ct[0]=-((_i=ct[2]-ct[0])+ct[0]),ct[2]=_i-ct[2],Et.x=1-(Et.x+Et.width)}return xe},Ce.prototype.computeMeshIndices_=function(J,$){for(var ye=new Uint16Array(2*(J-1)*($-1)*6),xe=J/2,Ue=$/2,ct=0,Et=0,an=0;an<2;an++)for(var on=0;on<$;on++)for(var Ct=0;Ct<J;Ct++,ct++)0==Ct||0==on||(Ct<=xe==on<=Ue?(ye[Et++]=ct,ye[Et++]=ct-J-1,ye[Et++]=ct-J,ye[Et++]=ct-J-1,ye[Et++]=ct,ye[Et++]=ct-1):(ye[Et++]=ct-1,ye[Et++]=ct-J,ye[Et++]=ct,ye[Et++]=ct-J,ye[Et++]=ct-1,ye[Et++]=ct-J-1));return ye},Ce.prototype.getOwnPropertyDescriptor_=function(J,$){var ye=Object.getOwnPropertyDescriptor(J,$);return(void 0===ye.get||void 0===ye.set)&&(ye.configurable=!0,ye.enumerable=!0,ye.get=function(){return this.getAttribute($)},ye.set=function(xe){this.setAttribute($,xe)}),ye};var ie=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),le=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),Fe=Math.PI/180;function Zt(J){this.gl=J,this.attribs={position:0},this.program=tr(J,ie,le,this.attribs),this.uniforms=Cr(J,this.program),this.vertexBuffer=J.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function Xt(J){this.coefficients=J}Zt.prototype.destroy=function(){var J=this.gl;this.listener&&J.canvas.removeEventListener("click",this.listener,!1),J.deleteProgram(this.program),J.deleteBuffer(this.vertexBuffer)},Zt.prototype.listen=function(J,$){var ye=this.gl.canvas;this.listener=function(xe){var Ue=ye.clientWidth/2;xe.clientX>Ue-42&&xe.clientX<Ue+42&&xe.clientY>ye.clientHeight-42?J(xe):xe.clientX<42&&xe.clientY<42&&$(xe)},ye.addEventListener("click",this.listener,!1)},Zt.prototype.onResize=function(){var J=this.gl,$=this;Kt(J,[J.ARRAY_BUFFER_BINDING],function(xe){var Ue=[],ct=xe.drawingBufferWidth/2,Et=Math.max(screen.width,screen.height)*window.devicePixelRatio,on=xe.drawingBufferWidth/Et*window.devicePixelRatio,Ct=4*on/2,Ut=42*on,pn=28*on/2,Bn=14*on;function Yn(ni,Ci){var ki=(90-ni)*Fe,_i=Math.cos(ki),ji=Math.sin(ki);Ue.push(.3125*_i*pn+ct,.3125*ji*pn+pn),Ue.push(Ci*_i*pn+ct,Ci*ji*pn+pn)}Ue.push(ct-Ct,Ut),Ue.push(ct-Ct,xe.drawingBufferHeight),Ue.push(ct+Ct,Ut),Ue.push(ct+Ct,xe.drawingBufferHeight),$.gearOffset=Ue.length/2;for(var or=0;or<=6;or++){var Mr=60*or;Yn(Mr,1),Yn(Mr+12,1),Yn(Mr+20,.75),Yn(Mr+40,.75),Yn(Mr+48,1)}function Ar(ni,Ci){Ue.push(Bn+ni,xe.drawingBufferHeight-Bn-Ci)}$.gearVertexCount=Ue.length/2-$.gearOffset,$.arrowOffset=Ue.length/2;var vr=Ct/Math.sin(45*Fe);Ar(0,pn),Ar(pn,0),Ar(pn+vr,vr),Ar(vr,pn+vr),Ar(vr,pn-vr),Ar(0,pn),Ar(pn,2*pn),Ar(pn+vr,2*pn-vr),Ar(vr,pn-vr),Ar(0,pn),Ar(vr,pn-Ct),Ar(28*on,pn-Ct),Ar(vr,pn+Ct),Ar(28*on,pn+Ct),$.arrowVertexCount=Ue.length/2-$.arrowOffset,xe.bindBuffer(xe.ARRAY_BUFFER,$.vertexBuffer),xe.bufferData(xe.ARRAY_BUFFER,new Float32Array(Ue),xe.STATIC_DRAW)})},Zt.prototype.render=function(){var J=this.gl,$=this;Kt(J,[J.CULL_FACE,J.DEPTH_TEST,J.BLEND,J.SCISSOR_TEST,J.STENCIL_TEST,J.COLOR_WRITEMASK,J.VIEWPORT,J.CURRENT_PROGRAM,J.ARRAY_BUFFER_BINDING],function(xe){xe.disable(xe.CULL_FACE),xe.disable(xe.DEPTH_TEST),xe.disable(xe.BLEND),xe.disable(xe.SCISSOR_TEST),xe.disable(xe.STENCIL_TEST),xe.colorMask(!0,!0,!0,!0),xe.viewport(0,0,xe.drawingBufferWidth,xe.drawingBufferHeight),$.renderNoState()})},Zt.prototype.renderNoState=function(){var $,ye,xe,Ue,ct,Et,an,on,Ct,Ut,J=this.gl;J.useProgram(this.program),J.bindBuffer(J.ARRAY_BUFFER,this.vertexBuffer),J.enableVertexAttribArray(this.attribs.position),J.vertexAttribPointer(this.attribs.position,2,J.FLOAT,!1,8,0),J.uniform4f(this.uniforms.color,1,1,1,1),Ct=1/((Ue=0)-(ct=J.drawingBufferHeight)),Ut=1/((Et=.1)-(an=1024)),($=this.projMat)[0]=-2*(on=1/((ye=0)-(xe=J.drawingBufferWidth))),$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=-2*Ct,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=2*Ut,$[11]=0,$[12]=(ye+xe)*on,$[13]=(ct+Ue)*Ct,$[14]=(an+Et)*Ut,$[15]=1,J.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),J.drawArrays(J.TRIANGLE_STRIP,0,4),J.drawArrays(J.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),J.drawArrays(J.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},Xt.prototype.distortInverse=function(J){for(var $=0,ye=1,xe=J-this.distort($);Math.abs(ye-$)>1e-4;){var Ue=J-this.distort(ye),ct=ye-Ue*((ye-$)/(Ue-xe));$=ye,ye=ct,xe=Ue}return ye},Xt.prototype.distort=function(J){for(var $=J*J,ye=0,xe=0;xe<this.coefficients.length;xe++)ye=$*(ye+this.coefficients[xe]);return(ye+1)*J};var Vt=Math.PI/180,We=180/Math.PI,ft=function($,ye,xe){this.x=$||0,this.y=ye||0,this.z=xe||0};ft.prototype={constructor:ft,set:function($,ye,xe){return this.x=$,this.y=ye,this.z=xe,this},copy:function($){return this.x=$.x,this.y=$.y,this.z=$.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var $=this.length();return 0!==$?this.multiplyScalar(1/$):(this.x=0,this.y=0,this.z=0),this},multiplyScalar:function($){this.x*=$,this.y*=$,this.z*=$},applyQuaternion:function($){var ye=this.x,xe=this.y,Ue=this.z,ct=$.x,Et=$.y,an=$.z,on=$.w,Ct=on*ye+Et*Ue-an*xe,Ut=on*xe+an*ye-ct*Ue,pn=on*Ue+ct*xe-Et*ye,Bn=-ct*ye-Et*xe-an*Ue;return this.x=Ct*on+Bn*-ct+Ut*-an-pn*-Et,this.y=Ut*on+Bn*-Et+pn*-ct-Ct*-an,this.z=pn*on+Bn*-an+Ct*-Et-Ut*-ct,this},dot:function($){return this.x*$.x+this.y*$.y+this.z*$.z},crossVectors:function($,ye){var xe=$.x,Ue=$.y,ct=$.z,Et=ye.x,an=ye.y,on=ye.z;return this.x=Ue*on-ct*an,this.y=ct*Et-xe*on,this.z=xe*an-Ue*Et,this}};var Mt=function($,ye,xe,Ue){this.x=$||0,this.y=ye||0,this.z=xe||0,this.w=void 0!==Ue?Ue:1};function Ht(J){this.width=J.width||Tt(),this.height=J.height||$t(),this.widthMeters=J.widthMeters,this.heightMeters=J.heightMeters,this.bevelMeters=J.bevelMeters}Mt.prototype={constructor:Mt,set:function($,ye,xe,Ue){return this.x=$,this.y=ye,this.z=xe,this.w=Ue,this},copy:function($){return this.x=$.x,this.y=$.y,this.z=$.z,this.w=$.w,this},setFromEulerXYZ:function($,ye,xe){var Ue=Math.cos($/2),ct=Math.cos(ye/2),Et=Math.cos(xe/2),an=Math.sin($/2),on=Math.sin(ye/2),Ct=Math.sin(xe/2);return this.x=an*ct*Et+Ue*on*Ct,this.y=Ue*on*Et-an*ct*Ct,this.z=Ue*ct*Ct+an*on*Et,this.w=Ue*ct*Et-an*on*Ct,this},setFromEulerYXZ:function($,ye,xe){var Ue=Math.cos($/2),ct=Math.cos(ye/2),Et=Math.cos(xe/2),an=Math.sin($/2),on=Math.sin(ye/2),Ct=Math.sin(xe/2);return this.x=an*ct*Et+Ue*on*Ct,this.y=Ue*on*Et-an*ct*Ct,this.z=Ue*ct*Ct-an*on*Et,this.w=Ue*ct*Et+an*on*Ct,this},setFromAxisAngle:function($,ye){var xe=ye/2,Ue=Math.sin(xe);return this.x=$.x*Ue,this.y=$.y*Ue,this.z=$.z*Ue,this.w=Math.cos(xe),this},multiply:function($){return this.multiplyQuaternions(this,$)},multiplyQuaternions:function($,ye){var xe=$.x,Ue=$.y,ct=$.z,Et=$.w,an=ye.x,on=ye.y,Ct=ye.z,Ut=ye.w;return this.x=xe*Ut+Et*an+Ue*Ct-ct*on,this.y=Ue*Ut+Et*on+ct*an-xe*Ct,this.z=ct*Ut+Et*Ct+xe*on-Ue*an,this.w=Et*Ut-xe*an-Ue*on-ct*Ct,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var $=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===$?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x=this.x*($=1/$),this.y=this.y*$,this.z=this.z*$,this.w=this.w*$),this},slerp:function($,ye){if(0===ye)return this;if(1===ye)return this.copy($);var xe=this.x,Ue=this.y,ct=this.z,Et=this.w,an=Et*$.w+xe*$.x+Ue*$.y+ct*$.z;if(an<0?(this.w=-$.w,this.x=-$.x,this.y=-$.y,this.z=-$.z,an=-an):this.copy($),an>=1)return this.w=Et,this.x=xe,this.y=Ue,this.z=ct,this;var on=Math.acos(an),Ct=Math.sqrt(1-an*an);if(Math.abs(Ct)<.001)return this.w=.5*(Et+this.w),this.x=.5*(xe+this.x),this.y=.5*(Ue+this.y),this.z=.5*(ct+this.z),this;var Ut=Math.sin((1-ye)*on)/Ct,pn=Math.sin(ye*on)/Ct;return this.w=Et*Ut+this.w*pn,this.x=xe*Ut+this.x*pn,this.y=Ue*Ut+this.y*pn,this.z=ct*Ut+this.z*pn,this},setFromUnitVectors:function(){var J,$;return function(xe,Ue){return void 0===J&&(J=new ft),($=xe.dot(Ue)+1)<1e-6?($=0,Math.abs(xe.x)>Math.abs(xe.z)?J.set(-xe.y,xe.x,0):J.set(0,-xe.z,xe.y)):J.crossVectors(xe,Ue),this.x=J.x,this.y=J.y,this.z=J.z,this.w=$,this.normalize(),this}}()};var kt=new Ht({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Ft=new Ht({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),jt={CardboardV1:new vn({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new vn({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function ln(J,$){this.viewer=jt.CardboardV2,this.updateDeviceParams(J),this.distortion=new Xt(this.viewer.distortionCoefficients);for(var ye=0;ye<$.length;ye++){var xe=$[ye];jt[xe.id]=new vn(xe)}}function vn(J){this.id=J.id,this.label=J.label,this.fov=J.fov,this.interLensDistance=J.interLensDistance,this.baselineLensDistance=J.baselineLensDistance,this.screenLensDistance=J.screenLensDistance,this.distortionCoefficients=J.distortionCoefficients,this.inverseCoefficients=J.inverseCoefficients}ln.prototype.updateDeviceParams=function(J){this.device=this.determineDevice_(J)||this.device},ln.prototype.getDevice=function(){return this.device},ln.prototype.setViewer=function(J){this.viewer=J,this.distortion=new Xt(this.viewer.distortionCoefficients)},ln.prototype.determineDevice_=function(J){if(!J)return P()?(console.warn("Using fallback iOS device measurements."),Ft):(console.warn("Using fallback Android device measurements."),kt);var $=.0254,xe=$/J.ydpi;return new Ht({widthMeters:$/J.xdpi*Tt(),heightMeters:xe*$t(),bevelMeters:.001*J.bevelMm})},ln.prototype.getDistortedFieldOfViewLeftEye=function(){var J=this.viewer,$=this.device,ye=this.distortion,xe=J.screenLensDistance,ct=J.interLensDistance/2,Et=J.baselineLensDistance-$.bevelMeters,an=$.heightMeters-Et,on=We*Math.atan(ye.distort(($.widthMeters-J.interLensDistance)/2/xe)),Ct=We*Math.atan(ye.distort(ct/xe)),Ut=We*Math.atan(ye.distort(Et/xe)),pn=We*Math.atan(ye.distort(an/xe));return{leftDegrees:Math.min(on,J.fov),rightDegrees:Math.min(Ct,J.fov),downDegrees:Math.min(Ut,J.fov),upDegrees:Math.min(pn,J.fov)}},ln.prototype.getLeftEyeVisibleTanAngles=function(){var J=this.viewer,$=this.device,ye=this.distortion,xe=Math.tan(-Vt*J.fov),Ue=Math.tan(Vt*J.fov),ct=Math.tan(Vt*J.fov),Et=Math.tan(-Vt*J.fov),an=$.widthMeters/4,on=$.heightMeters/2,Ut=J.interLensDistance/2-an,pn=-(J.baselineLensDistance-$.bevelMeters-on),Bn=J.screenLensDistance,Yn=ye.distort((Ut-an)/Bn),or=ye.distort((pn+on)/Bn),Mr=ye.distort((Ut+an)/Bn),Ar=ye.distort((pn-on)/Bn),vr=new Float32Array(4);return vr[0]=Math.max(xe,Yn),vr[1]=Math.min(Ue,or),vr[2]=Math.min(ct,Mr),vr[3]=Math.max(Et,Ar),vr},ln.prototype.getLeftEyeNoLensTanAngles=function(){var J=this.viewer,$=this.device,ye=this.distortion,xe=new Float32Array(4),Ue=ye.distortInverse(Math.tan(-Vt*J.fov)),ct=ye.distortInverse(Math.tan(Vt*J.fov)),Et=ye.distortInverse(Math.tan(Vt*J.fov)),an=ye.distortInverse(Math.tan(-Vt*J.fov)),on=$.widthMeters/4,Ct=$.heightMeters/2,pn=J.interLensDistance/2-on,Bn=-(J.baselineLensDistance-$.bevelMeters-Ct),Yn=J.screenLensDistance,Mr=(Bn+Ct)/Yn,Ar=(pn+on)/Yn,vr=(Bn-Ct)/Yn;return xe[0]=Math.max(Ue,(pn-on)/Yn),xe[1]=Math.min(ct,Mr),xe[2]=Math.min(Et,Ar),xe[3]=Math.max(an,vr),xe},ln.prototype.getLeftEyeVisibleScreenRect=function(J){var $=this.viewer,ye=this.device,xe=$.screenLensDistance,Ue=(ye.widthMeters-$.interLensDistance)/2,ct=$.baselineLensDistance-ye.bevelMeters,Et=(J[0]*xe+Ue)/ye.widthMeters,Ct=(J[3]*xe+ct)/ye.heightMeters;return{x:Et,y:Ct,width:(J[2]*xe+Ue)/ye.widthMeters-Et,height:(J[1]*xe+ct)/ye.heightMeters-Ct}},ln.prototype.getFieldOfViewLeftEye=function(J){return J?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},ln.prototype.getFieldOfViewRightEye=function(J){var $=this.getFieldOfViewLeftEye(J);return{leftDegrees:$.rightDegrees,rightDegrees:$.leftDegrees,upDegrees:$.upDegrees,downDegrees:$.downDegrees}},ln.prototype.getUndistortedFieldOfViewLeftEye=function(){var J=this.getUndistortedParams_();return{leftDegrees:We*Math.atan(J.outerDist),rightDegrees:We*Math.atan(J.innerDist),downDegrees:We*Math.atan(J.bottomDist),upDegrees:We*Math.atan(J.topDist)}},ln.prototype.getUndistortedViewportLeftEye=function(){var J=this.getUndistortedParams_(),ye=this.device,xe=this.viewer.screenLensDistance,Et=ye.width/(ye.widthMeters/xe),an=ye.height/(ye.heightMeters/xe),on=Math.round((J.eyePosX-J.outerDist)*Et),Ct=Math.round((J.eyePosY-J.bottomDist)*an);return{x:on,y:Ct,width:Math.round((J.eyePosX+J.innerDist)*Et)-on,height:Math.round((J.eyePosY+J.topDist)*an)-Ct}},ln.prototype.getUndistortedParams_=function(){var J=this.viewer,$=this.device,xe=J.screenLensDistance,Ue=J.interLensDistance/2/xe,Et=$.heightMeters/xe,an=$.widthMeters/xe/2-Ue,on=(J.baselineLensDistance-$.bevelMeters)/xe,Ut=this.distortion.distortInverse(Math.tan(Vt*J.fov)),pn=Math.min(an,Ut),Bn=Math.min(Ue,Ut),Yn=Math.min(on,Ut);return{outerDist:pn,innerDist:Bn,topDist:Math.min(Et-on,Ut),bottomDist:Yn,eyePosX:an,eyePosY:on}},ln.Viewers=jt;var nr={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function Pn(J,$){if(this.dpdb=nr,this.recalculateDeviceParams_(),J){this.onDeviceParamsUpdated=$;var ye=new XMLHttpRequest,xe=this;ye.open("GET",J,!0),ye.addEventListener("load",function(){xe.loading=!1,ye.status>=200&&ye.status<=299?(xe.dpdb=JSON.parse(ye.response),xe.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),ye.send()}}function jr(J){this.xdpi=J.xdpi,this.ydpi=J.ydpi,this.bevelMm=J.bevelMm}function Xr(J,$){this.set(J,$)}function ur(J,$){this.kFilter=J,this.isDebug=$,this.currentAccelMeasurement=new Xr,this.currentGyroMeasurement=new Xr,this.previousGyroMeasurement=new Xr,this.filterQ=P()?new Mt(-1,0,0,1):new Mt(1,0,0,1),this.previousFilterQ=new Mt,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Mt,this.isOrientationInitialized=!1,this.estimatedGravity=new ft,this.measuredGravity=new ft,this.gyroIntegralQ=new Mt}function Si(J,$){this.predictionTimeS=J,this.isDebug=$,this.previousQ=new Mt,this.previousTimestampS=null,this.deltaQ=new Mt,this.outQ=new Mt}function ti(J,$,ye,xe){this.yawOnly=ye,this.accelerometer=new ft,this.gyroscope=new ft,this.filter=new ur(J,xe),this.posePredictor=new Si($,xe),this.isFirefoxAndroid=te(),this.isIOS=P();var Ue=ce();this.isDeviceMotionInRadians=!this.isIOS&&Ue&&Ue<66,this.isWithoutDeviceMotion=_e()||Se(),this.filterToWorldQ=new Mt,P()?this.filterToWorldQ.setFromAxisAngle(new ft(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new ft(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Mt,this.worldToScreenQ=new Mt,this.originalPoseAdjustQ=new Mt,this.originalPoseAdjustQ.setFromAxisAngle(new ft(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),rt()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Mt,this.orientationOut_=new Float32Array(4),this.start()}Pn.prototype.getDeviceParams=function(){return this.deviceParams},Pn.prototype.recalculateDeviceParams_=function(){var J=this.calcDeviceParams_();J?(this.deviceParams=J,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Pn.prototype.calcDeviceParams_=function(){var J=this.dpdb;if(!J)return console.error("DPDB not available."),null;if(1!=J.format)return console.error("DPDB has unexpected format version."),null;if(!J.devices||!J.devices.length)return console.error("DPDB does not have a devices section."),null;var $=navigator.userAgent||navigator.vendor||window.opera,ye=Tt(),xe=$t();if(!J.devices)return console.error("DPDB has no devices section."),null;for(var Ue=0;Ue<J.devices.length;Ue++){var ct=J.devices[Ue];if(ct.rules)if("ios"==ct.type||"android"==ct.type){if(P()==("ios"==ct.type)){for(var Et=!1,an=0;an<ct.rules.length;an++)if(this.ruleMatches_(ct.rules[an],$,ye,xe)){Et=!0;break}if(Et)return new jr({xdpi:ct.dpi[0]||ct.dpi,ydpi:ct.dpi[1]||ct.dpi,bevelMm:ct.bw})}}else console.warn("Device["+Ue+"] has invalid type.");else console.warn("Device["+Ue+"] has no rules section.")}return console.warn("No DPDB device match."),null},Pn.prototype.ruleMatches_=function(J,$,ye,xe){if(!J.ua&&!J.res||(J.ua&&"SM"===J.ua.substring(0,2)&&(J.ua=J.ua.substring(0,7)),J.ua&&$.indexOf(J.ua)<0))return!1;if(J.res){if(!J.res[0]||!J.res[1])return!1;var Ue=J.res[0],ct=J.res[1];if(Math.min(ye,xe)!=Math.min(Ue,ct)||Math.max(ye,xe)!=Math.max(Ue,ct))return!1}return!0},Xr.prototype.set=function(J,$){this.sample=J,this.timestampS=$},Xr.prototype.copy=function(J){this.set(J.sample,J.timestampS)},ur.prototype.addAccelMeasurement=function(J,$){this.currentAccelMeasurement.set(J,$)},ur.prototype.addGyroMeasurement=function(J,$){this.currentGyroMeasurement.set(J,$),function($){return!(isNaN($)||$<=.001||$>1)}($-this.previousGyroMeasurement.timestampS)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},ur.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var $=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);this.gyroIntegralQ.multiply($),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply($);var ye=new Mt;ye.copy(this.filterQ),ye.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(ye),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var xe=new Mt;xe.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),xe.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",We*function($){return $.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos($.w)}(xe),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var Ue=new Mt;Ue.copy(this.filterQ),Ue.multiply(xe),this.filterQ.slerp(Ue,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},ur.prototype.getOrientation=function(){return this.filterQ},ur.prototype.accelToQuaternion_=function(J){var $=new ft;$.copy(J),$.normalize();var ye=new Mt;return ye.setFromUnitVectors(new ft(0,0,-1),$),ye.inverse(),ye},ur.prototype.gyroToQuaternionDelta_=function(J,$){var ye=new Mt,xe=new ft;return xe.copy(J),xe.normalize(),ye.setFromAxisAngle(xe,J.length()*$),ye},Si.prototype.getPrediction=function(J,$,ye){if(!this.previousTimestampS)return this.previousQ.copy(J),this.previousTimestampS=ye,J;var xe=new ft;xe.copy($),xe.normalize();var Ue=$.length();return Ue<20*Vt?(this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(We*Ue).toFixed(1)),this.outQ.copy(J),this.previousQ.copy(J),this.outQ):(this.deltaQ.setFromAxisAngle(xe,Ue*this.predictionTimeS),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(J),this.previousTimestampS=ye,this.outQ)},ti.prototype.getPosition=function(){return null},ti.prototype.getOrientation=function(){var J=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ)return this.deviceOrientationFixQ=this.deviceOrientationFixQ||(Ue=(new Mt).setFromAxisAngle(new ft(0,0,-1),0),ct=new Mt,-90===window.orientation?ct.setFromAxisAngle(new ft(0,1,0),Math.PI/-2):ct.setFromAxisAngle(new ft(0,1,0),Math.PI/2),Ue.multiply(ct)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var Ue=new Mt;return Ue.setFromAxisAngle(new ft(1,0,0),-Math.PI/2),Ue}(),J=this._deviceOrientationQ,(ye=new Mt).copy(J),ye.multiply(this.deviceOrientationFilterToWorldQ),ye.multiply(this.resetQ),ye.multiply(this.worldToScreenQ),ye.multiplyQuaternions(this.deviceOrientationFixQ,ye),this.yawOnly&&(ye.x=0,ye.z=0,ye.normalize()),this.orientationOut_[0]=ye.x,this.orientationOut_[1]=ye.y,this.orientationOut_[2]=ye.z,this.orientationOut_[3]=ye.w,this.orientationOut_;var Ue,ct,ye,$=this.filter.getOrientation();return J=this.posePredictor.getPrediction($,this.gyroscope,this.previousTimestampS),(ye=new Mt).copy(this.filterToWorldQ),ye.multiply(this.resetQ),ye.multiply(J),ye.multiply(this.worldToScreenQ),this.yawOnly&&(ye.x=0,ye.z=0,ye.normalize()),this.orientationOut_[0]=ye.x,this.orientationOut_[1]=ye.y,this.orientationOut_[2]=ye.z,this.orientationOut_[3]=ye.w,this.orientationOut_},ti.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),rt()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},ti.prototype.onDeviceOrientation_=function(J){this._deviceOrientationQ=this._deviceOrientationQ||new Mt;var $=J.alpha,ye=J.beta,xe=J.gamma;$=($||0)*Math.PI/180,ye=(ye||0)*Math.PI/180,xe=(xe||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(ye,$,-xe)},ti.prototype.onDeviceMotion_=function(J){this.updateDeviceMotion_(J)},ti.prototype.updateDeviceMotion_=function(J){var $=J.accelerationIncludingGravity,ye=J.rotationRate,xe=J.timeStamp/1e3,Ue=xe-this.previousTimestampS;return Ue<0?(ht("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=xe)):Ue<=.001||Ue>1?(ht("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=xe)):(this.accelerometer.set(-$.x,-$.y,-$.z),ye&&(ze()?this.gyroscope.set(-ye.beta,ye.alpha,ye.gamma):this.gyroscope.set(ye.alpha,ye.beta,ye.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,xe)),this.filter.addAccelMeasurement(this.accelerometer,xe),void(this.previousTimestampS=xe))},ti.prototype.onOrientationChange_=function(J){this.setScreenTransform_()},ti.prototype.onMessage_=function(J){var $=J.data;$&&$.type&&"devicemotion"===$.type.toLowerCase()&&this.updateDeviceMotion_($.deviceMotionEvent)},ti.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new ft(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new ft(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},ti.prototype.start=function(){var $,ye,xe;this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),P()&&($=window.self!==window.top,ye=nt(document.referrer),xe=nt(window.location.href),$&&ye!==xe)&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},ti.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var xa=new ft(1,0,0),Pe=new ft(0,0,1),Qe=new Mt;Qe.setFromAxisAngle(xa,-Math.PI/2),Qe.multiply((new Mt).setFromAxisAngle(Pe,Math.PI/2));var yt=function(){function J($){(function(J,$){if(!(J instanceof $))throw new TypeError("Cannot call a class as a function")})(this,J),this.config=$,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Mt,this._outQ=new Mt,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return V(J,[{key:"init",value:function(){var ye=null;try{(ye=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(xe){this.errors.push(xe),"SecurityError"===xe.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===xe.name?this.useDeviceMotion():console.error(xe)}ye&&(this.api="sensor",this.sensor=ye,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new ti(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var ye=this.sensor.quaternion;this._sensorQ.set(ye[0],ye[1],ye[2],ye[3]);var xe=this._outQ;return xe.copy(Qe),xe.multiply(this._sensorQ),this.config.YAW_ONLY&&(xe.x=xe.z=0,xe.normalize()),this._out[0]=xe.x,this._out[1]=xe.y,this._out[2]=xe.z,this._out[3]=xe.w,this._out}},{key:"_onSensorError",value:function(ye){this.errors.push(ye.error),"NotAllowedError"===ye.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===ye.error.name?console.error("Sensor could not be read"):console.error(ye.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),J}();function Dt(){this.loadIcon_();var J=document.createElement("div");(Et=J.style).position="fixed",Et.top=0,Et.right=0,Et.bottom=0,Et.left=0,Et.backgroundColor="gray",Et.fontFamily="sans-serif",Et.zIndex=1e6;var $=document.createElement("img");$.src=this.icon,(Et=$.style).marginLeft="25%",Et.marginTop="25%",Et.width="50%",J.appendChild($);var ye=document.createElement("div");(Et=ye.style).textAlign="center",Et.fontSize="16px",Et.lineHeight="24px",Et.margin="24px 25%",Et.width="50%",ye.innerHTML="Place your phone into your Cardboard viewer.",J.appendChild(ye);var xe=document.createElement("div");(Et=xe.style).backgroundColor="#CFD8DC",Et.position="fixed",Et.bottom=0,Et.width="100%",Et.height="48px",Et.padding="14px 24px",Et.boxSizing="border-box",Et.color="#656A6B",J.appendChild(xe);var Ue=document.createElement("div");Ue.style.float="left",Ue.innerHTML="No Cardboard viewer?";var Et,ct=document.createElement("a");ct.href="https://www.google.com/get/cardboard/get-cardboard/",ct.innerHTML="get one",ct.target="_blank",(Et=ct.style).float="right",Et.fontWeight=600,Et.textTransform="uppercase",Et.borderLeft="1px solid gray",Et.paddingLeft="24px",Et.textDecoration="none",Et.color="#656A6B",xe.appendChild(Ue),xe.appendChild(ct),this.overlay=J,this.text=ye,this.hide()}Dt.prototype.show=function(J){J||this.overlay.parentElement?J&&(this.overlay.parentElement&&this.overlay.parentElement!=J&&this.overlay.parentElement.removeChild(this.overlay),J.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var ye=this.overlay.querySelector("img").style;rt()?(ye.width="20%",ye.marginLeft="40%",ye.marginTop="3%"):(ye.width="50%",ye.marginLeft="25%",ye.marginTop="25%")},Dt.prototype.hide=function(){this.overlay.style.display="none"},Dt.prototype.showTemporarily=function(J,$){this.show($),this.timer=setTimeout(this.hide.bind(this),J)},Dt.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Dt.prototype.update=function(){this.disableShowTemporarily(),!rt()&&Re()?this.show():this.hide()},Dt.prototype.loadIcon_=function(){this.icon="data:"+"image/svg+xml"+","+encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var gn="WEBVR_CARDBOARD_VIEWER";function bn(J){try{this.selectedKey=localStorage.getItem(gn)}catch($){console.error("Failed to load viewer profile: %s",$)}this.selectedKey||(this.selectedKey=J||"CardboardV1"),this.dialog=this.createDialog_(ln.Viewers),this.root=null,this.onChangeCallbacks_=[]}bn.prototype.show=function(J){this.root=J,J.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},bn.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},bn.prototype.getCurrentViewer=function(){return ln.Viewers[this.selectedKey]},bn.prototype.getSelectedKey_=function(){var J=this.dialog.querySelector("input[name=field]:checked");return J?J.id:null},bn.prototype.onChange=function(J){this.onChangeCallbacks_.push(J)},bn.prototype.fireOnChange_=function(J){for(var $=0;$<this.onChangeCallbacks_.length;$++)this.onChangeCallbacks_[$](J)},bn.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&ln.Viewers[this.selectedKey]){this.fireOnChange_(ln.Viewers[this.selectedKey]);try{localStorage.setItem(gn,this.selectedKey)}catch(J){console.error("Failed to save viewer profile: %s",J)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},bn.prototype.createDialog_=function(J){var $=document.createElement("div");$.classList.add("webvr-polyfill-viewer-selector"),$.style.display="none";var ye=document.createElement("div");(ct=ye.style).position="fixed",ct.left=0,ct.top=0,ct.width="100%",ct.height="100%",ct.background="rgba(0, 0, 0, 0.3)",ye.addEventListener("click",this.hide.bind(this));var Ue=document.createElement("div"),ct=Ue.style;for(var Et in ct.boxSizing="border-box",ct.position="fixed",ct.top="24px",ct.left="50%",ct.marginLeft="-140px",ct.width="280px",ct.padding="24px",ct.overflow="hidden",ct.background="#fafafa",ct.fontFamily="'Roboto', sans-serif",ct.boxShadow="0px 5px 20px #666",Ue.appendChild(this.createH1_("Select your viewer")),J)Ue.appendChild(this.createChoice_(Et,J[Et].label));return Ue.appendChild(this.createButton_("Save",this.onSave_.bind(this))),$.appendChild(ye),$.appendChild(Ue),$},bn.prototype.createH1_=function(J){var $=document.createElement("h1"),ye=$.style;return ye.color="black",ye.fontSize="20px",ye.fontWeight="bold",ye.marginTop=0,ye.marginBottom="24px",$.innerHTML=J,$},bn.prototype.createChoice_=function(J,$){var ye=document.createElement("div");ye.style.marginTop="8px",ye.style.color="black";var xe=document.createElement("input");xe.style.fontSize="30px",xe.setAttribute("id",J),xe.setAttribute("type","radio"),xe.setAttribute("value",J),xe.setAttribute("name","field");var Ue=document.createElement("label");return Ue.style.marginLeft="4px",Ue.setAttribute("for",J),Ue.innerHTML=$,ye.appendChild(xe),ye.appendChild(Ue),ye},bn.prototype.createButton_=function(J,$){var ye=document.createElement("button");ye.innerHTML=J;var xe=ye.style;return xe.float="right",xe.textTransform="uppercase",xe.color="#1094f7",xe.fontSize="14px",xe.letterSpacing=0,xe.border=0,xe.background="none",xe.marginTop="16px",ye.addEventListener("click",$),ye},typeof window<"u"?window:typeof c<"u"||typeof self<"u"&&self;var pi=function Wn(J){return J&&J.__esModule&&Object.prototype.hasOwnProperty.call(J,"default")?J.default:J}(function qn(J,$){return J($={exports:{}},$.exports),$.exports}(function(J,$){J.exports=function(ye){var xe={};function Ue(ct){if(xe[ct])return xe[ct].exports;var Et=xe[ct]={i:ct,l:!1,exports:{}};return ye[ct].call(Et.exports,Et,Et.exports,Ue),Et.l=!0,Et.exports}return Ue.m=ye,Ue.c=xe,Ue.d=function(ct,Et,an){Ue.o(ct,Et)||Object.defineProperty(ct,Et,{configurable:!1,enumerable:!0,get:an})},Ue.n=function(ct){var Et=ct&&ct.__esModule?function(){return ct.default}:function(){return ct};return Ue.d(Et,"a",Et),Et},Ue.o=function(ct,Et){return Object.prototype.hasOwnProperty.call(ct,Et)},Ue.p="",Ue(Ue.s=0)}([function(ye,xe,Ue){var ct=function(){function Ut(pn,Bn){for(var Yn=0;Yn<Bn.length;Yn++){var or=Bn[Yn];or.enumerable=or.enumerable||!1,or.configurable=!0,"value"in or&&(or.writable=!0),Object.defineProperty(pn,or.key,or)}}return function(pn,Bn,Yn){return Bn&&Ut(pn.prototype,Bn),Yn&&Ut(pn,Yn),pn}}();var an=Ue(1),on=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,Ct=function(){function Ut(){(function Et(Ut,pn){if(!(Ut instanceof pn))throw new TypeError("Cannot call a class as a function")})(this,Ut),on?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",an),this.noSleepVideo.addEventListener("timeupdate",function(pn){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return ct(Ut,[{key:"enable",value:function(){on?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){on?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),Ut}();ye.exports=Ct},function(ye,xe,Ue){ye.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})),xr=1e3,ir=[0,0,.5,1],cr=[.5,0,.5,1],Jr=window.requestAnimationFrame,li=window.cancelAnimationFrame;function Ir(J){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:J.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:J.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:J.canPresent},maxLayers:{writable:!1,enumerable:!0,value:J.maxLayers},hasOrientation:{enumerable:!0,get:function(){return _t("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),J.hasOrientation}}})}function Br(J){var $=!("wakelock"in(J=J||{}))||J.wakelock;this.isPolyfilled=!0,this.displayId=xr++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return _t("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Ir({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,$&&Re()&&(this.wakelock_=new pi)}Br.prototype.getFrameData=function(J){return Ve(J,this._getPose(),this)},Br.prototype.getPose=function(){return _t("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Br.prototype.resetPose=function(){return _t("VRDisplay.prototype.resetPose"),this._resetPose()},Br.prototype.getImmediatePose=function(){return _t("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Br.prototype.requestAnimationFrame=function(J){return Jr(J)},Br.prototype.cancelAnimationFrame=function(J){return li(J)},Br.prototype.wrapForFullscreen=function(J){if(P())return J;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var $=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",$.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==J)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=J,this.originalParent_=J.parentElement,this.originalParent_||document.body.appendChild(J),!this.fullscreenWrapper_.parentElement){var ye=this.fullscreenElement_.parentElement;ye.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),ye.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var xe=this;return function Ue(){if(xe.fullscreenElement_){var ct=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];xe.fullscreenElement_.setAttribute("style",ct.join("; ")+";")}}(),this.fullscreenWrapper_},Br.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var J=this.fullscreenElement_;this.fullscreenElementCachedStyle_?J.setAttribute("style",this.fullscreenElementCachedStyle_):J.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var $=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(J),this.originalParent_===$?$.insertBefore(J,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(J),$.removeChild(this.fullscreenWrapper_),J}},Br.prototype.requestPresent=function(J){var $=this.isPresenting,ye=this;return J instanceof Array||(_t("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),J=[J]),new Promise(function(xe,Ue){if(ye.capabilities.canPresent)if(0==J.length||J.length>ye.capabilities.maxLayers)Ue(new Error("Invalid number of layers."));else{var ct=J[0];if(ct.source){var Et=ct.leftBounds||ir,an=ct.rightBounds||cr;if($){var on=ye.layer_;on.source!==ct.source&&(on.source=ct.source);for(var Ct=0;Ct<4;Ct++)on.leftBounds[Ct]=Et[Ct],on.rightBounds[Ct]=an[Ct];return ye.wrapForFullscreen(ye.layer_.source),ye.updatePresent_(),void xe()}if(ye.layer_={predistorted:ct.predistorted,source:ct.source,leftBounds:Et.slice(0),rightBounds:an.slice(0)},ye.waitingForPresent_=!1,ye.layer_&&ye.layer_.source){var Ut=ye.wrapForFullscreen(ye.layer_.source);ye.addFullscreenListeners_(Ut,function(){var or=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;ye.isPresenting=Ut===or,ye.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Mr){console.error("screen.orientation.lock() failed due to",Mr.message)}),ye.waitingForPresent_=!1,ye.beginPresent_(),xe()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),ye.removeFullscreenWrapper(),ye.disableWakeLock(),ye.endPresent_(),ye.removeFullscreenListeners_()),ye.fireVRDisplayPresentChange_()},function(){ye.waitingForPresent_&&(ye.removeFullscreenWrapper(),ye.removeFullscreenListeners_(),ye.disableWakeLock(),ye.waitingForPresent_=!1,ye.isPresenting=!1,Ue(new Error("Unable to present.")))}),function($){if(X())return!1;if($.requestFullscreen)$.requestFullscreen();else if($.webkitRequestFullscreen)$.webkitRequestFullscreen();else if($.mozRequestFullScreen)$.mozRequestFullScreen();else{if(!$.msRequestFullscreen)return!1;$.msRequestFullscreen()}return!0}(Ut)?(ye.enableWakeLock(),ye.waitingForPresent_=!0):(P()||X())&&(ye.enableWakeLock(),ye.isPresenting=!0,ye.beginPresent_(),ye.fireVRDisplayPresentChange_(),xe())}!ye.waitingForPresent_&&!P()&&(In(),Ue(new Error("Unable to present.")))}else xe()}else Ue(new Error("VRDisplay is not capable of presenting."))})},Br.prototype.exitPresent=function(){var J=this.isPresenting,$=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(ye,xe){J?(!In()&&P()&&($.endPresent_(),$.fireVRDisplayPresentChange_()),X()&&($.removeFullscreenWrapper(),$.removeFullscreenListeners_(),$.endPresent_(),$.fireVRDisplayPresentChange_()),ye()):xe(new Error("Was not presenting to VRDisplay."))})},Br.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Br.prototype.fireVRDisplayPresentChange_=function(){var J=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(J)},Br.prototype.fireVRDisplayConnect_=function(){var J=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(J)},Br.prototype.addFullscreenListeners_=function(J,$,ye){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=J,this.fullscreenChangeHandler_=$,this.fullscreenErrorHandler_=ye,$&&(document.fullscreenEnabled?J.addEventListener("fullscreenchange",$,!1):document.webkitFullscreenEnabled?J.addEventListener("webkitfullscreenchange",$,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",$,!1):document.msFullscreenEnabled&&J.addEventListener("msfullscreenchange",$,!1)),ye&&(document.fullscreenEnabled?J.addEventListener("fullscreenerror",ye,!1):document.webkitFullscreenEnabled?J.addEventListener("webkitfullscreenerror",ye,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",ye,!1):document.msFullscreenEnabled&&J.addEventListener("msfullscreenerror",ye,!1))},Br.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var J=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var $=this.fullscreenChangeHandler_;J.removeEventListener("fullscreenchange",$,!1),J.removeEventListener("webkitfullscreenchange",$,!1),document.removeEventListener("mozfullscreenchange",$,!1),J.removeEventListener("msfullscreenchange",$,!1)}if(this.fullscreenErrorHandler_){var ye=this.fullscreenErrorHandler_;J.removeEventListener("fullscreenerror",ye,!1),J.removeEventListener("webkitfullscreenerror",ye,!1),document.removeEventListener("mozfullscreenerror",ye,!1),J.removeEventListener("msfullscreenerror",ye,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Br.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Br.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Br.prototype.beginPresent_=function(){},Br.prototype.endPresent_=function(){},Br.prototype.submitFrame=function(J){},Br.prototype.getEyeParameters=function(J){return null};var ta={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},ci_LEFT="left",ci_RIGHT="right";function bi(J){var $=Oe({},ta);J=Oe($,J||{}),Br.call(this,{wakelock:J.MOBILE_WAKE_LOCK}),this.config=J,this.displayName="Cardboard VRDisplay",this.capabilities=new Ir({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new yt(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Pn(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new ln(this.dpdb_.getDeviceParams(),J.ADDITIONAL_VIEWERS),this.viewerSelector_=new bn(J.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Dt),P()&&window.addEventListener("resize",this.onResize_.bind(this))}return(bi.prototype=Object.create(Br.prototype))._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},bi.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},bi.prototype._getFieldOfView=function(J){var $;if(J==ci_LEFT)$=this.deviceInfo_.getFieldOfViewLeftEye();else{if(J!=ci_RIGHT)return console.error("Invalid eye provided: %s",J),null;$=this.deviceInfo_.getFieldOfViewRightEye()}return $},bi.prototype._getEyeOffset=function(J){var $;if(J==ci_LEFT)$=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(J!=ci_RIGHT)return console.error("Invalid eye provided: %s",J),null;$=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return $},bi.prototype.getEyeParameters=function(J){var $=this._getEyeOffset(J),ye=this._getFieldOfView(J),xe={offset:$,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(xe,"fieldOfView",{enumerable:!0,get:function(){return _t("VRFieldOfView","VRFrameData's projection matrices"),ye}}),xe},bi.prototype.onDeviceParamsUpdated_=function(J){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(J),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},bi.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},bi.prototype.beginPresent_=function(){var J=this.layer_.source.getContext("webgl");J||(J=this.layer_.source.getContext("experimental-webgl")),J||(J=this.layer_.source.getContext("webgl2")),J&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(J.canvas.width=Tt()*this.bufferScale_,J.canvas.height=$t()*this.bufferScale_,this.cardboardUI_=new Zt(J)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Zt(J)),this.distorter_=new Ce(J,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function($){this.viewerSelector_.show(this.layer_.source.parentElement),$.stopPropagation(),$.preventDefault()}.bind(this),function($){this.exitPresent(),$.stopPropagation(),$.preventDefault()}.bind(this)),this.rotateInstructions_&&(rt()&&Re()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},bi.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},bi.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},bi.prototype.submitFrame=function(J){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var $=this.layer_.source.getContext("webgl");$||($=this.layer_.source.getContext("experimental-webgl")),$||($=this.layer_.source.getContext("webgl2"));var ye=$.canvas;(ye.width!=this.lastWidth||ye.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=ye.width,this.lastHeight=ye.height,this.cardboardUI_.render()}},bi.prototype.onOrientationChange_=function(J){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},bi.prototype.onResize_=function(J){if(this.layer_){var $=this.layer_.source.getContext("webgl");$||($=this.layer_.source.getContext("experimental-webgl")),$||($=this.layer_.source.getContext("webgl2")),$.canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";"),$e($.canvas)}},bi.prototype.onViewerChanged_=function(J){this.deviceInfo_.setViewer(J),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},bi.prototype.fireVRDisplayDeviceParamsChange_=function(){var J=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(J)},bi.VRFrameData=function hr(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},bi.VRDisplay=Br,bi}()})),y={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function M(B){this.config=E(E({},y),B),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&d())&&(this.enable(),this.getVRDisplays().then(function(H){H&&H[0]&&H[0].fireVRDisplayConnect_&&H[0].fireVRDisplayConnect_()}))}M.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(d()){var B=new v({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(B)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},M.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var B=this.native.VRFrameData,H=new this.native.VRFrameData,q=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(V){V instanceof B?q.call(this,V):(q.call(this,H),V.pose=H.pose,A(H.leftProjectionMatrix,V.leftProjectionMatrix),A(H.rightProjectionMatrix,V.rightProjectionMatrix),A(H.leftViewMatrix,V.leftViewMatrix),A(H.rightViewMatrix,V.rightViewMatrix))}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=v.VRDisplay,window.VRFrameData=v.VRFrameData},M.prototype.getVRDisplays=function(){var B=this;return this.hasNative?this.native.getVRDisplays.call(navigator).then(function(q){return q.length>0?q:B.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},M.version="0.10.12",M.VRFrameData=v.VRFrameData,M.VRDisplay=v.VRDisplay;var _=Object.freeze({default:M}),O=_&&M||_;return typeof c<"u"&&c.window&&(c.document||(c.document=c.window.document),c.navigator||(c.navigator=c.window.navigator)),O},"object"==typeof m&&typeof C<"u"?C.exports=u():this.WebVRPolyfill=u()}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],68:[function(h,C,m){var s=/\n/,c="\n",u=/\s/;function p(v,T,y,M){var _=v.indexOf(T,y);return-1===_||_>M?M:_}function d(v){return u.test(v)}function g(v,T,y,M){return{start:T,end:T+Math.min(M,y-T)}}C.exports=function(v,T){return C.exports.lines(v,T).map(function(M){return v.substring(M.start,M.end)}).join("\n")},C.exports.lines=function(T,y){if(0===(y=y||{}).width&&"nowrap"!==y.mode)return[];T=T||"";var M="number"==typeof y.width?y.width:Number.MAX_VALUE,_=Math.max(0,y.start||0),O="number"==typeof y.end?y.end:T.length,D=y.mode,B=y.measure||g;return"pre"===D?function A(v,T,y,M,_){for(var O=[],D=y,B=y;B<M&&B<T.length;B++){var H=T.charAt(B),q=s.test(H);if(q||B===M-1){var ne=v(T,D,q?B:B+1,_);O.push(ne),D=B+1}}return O}(B,T,_,O,M):function E(v,T,y,M,_,O){var D=[],B=_;for("nowrap"===O&&(B=Number.MAX_VALUE);y<M&&y<T.length;){for(var H=p(T,c,y,M);y<H&&d(T.charAt(y));)y++;var q=v(T,y,H,B),V=y+(q.end-q.start),ne=V+c.length;if(V<H){for(;V>y&&!d(T.charAt(V));)V--;if(V===y)ne>y+c.length&&ne--,V=ne;else for(ne=V;V>y&&d(T.charAt(V-c.length));)V--}if(V>=y){var ae=v(T,y,V,B);D.push(ae)}y=ne}return D}(B,T,_,O,M,D)}},{}],69:[function(h,C,m){"use strict";var s=h("global/window"),c=h("is-function"),u=h("parse-headers"),p=h("xtend");function E(M,_,O){var D=M;return c(_)?(O=_,"string"==typeof M&&(D={uri:M})):D=p(_,{uri:M}),D.callback=O,D}function g(M,_,O){return v(_=E(M,_,O))}function v(M){if(typeof M.callback>"u")throw new Error("callback argument missing");var _=!1,O=function(_e,ze,rt){_||(_=!0,M.callback(_e,ze,rt))};function B(){var Se=void 0;if(Se=V.response?V.response:V.responseText||function T(M){try{if("document"===M.responseType)return M.responseXML;if(""===M.responseType&&(!M.responseXML||"parsererror"!==M.responseXML.documentElement.nodeName))return M.responseXML}catch{}return null}(V),W)try{Se=JSON.parse(Se)}catch{}return Se}function H(Se){return clearTimeout(te),Se instanceof Error||(Se=new Error(""+(Se||"Unknown XMLHttpRequest Error"))),Se.statusCode=0,O(Se,ce)}function q(){if(!ae){var Se;clearTimeout(te);var _e=ce,ze=null;return 0!==(Se=M.useXDR&&void 0===V.status?200:1223===V.status?204:V.status)?(_e={body:B(),statusCode:Se,method:he,headers:{},url:fe,rawRequest:V},V.getAllResponseHeaders&&(_e.headers=u(V.getAllResponseHeaders()))):ze=new Error("Internal XMLHttpRequest Error"),O(ze,_e,_e.body)}}var V=M.xhr||null;V||(V=M.cors||M.useXDR?new g.XDomainRequest:new g.XMLHttpRequest);var ne,ae,te,fe=V.url=M.uri||M.url,he=V.method=M.method||"GET",me=M.body||M.data,P=V.headers=M.headers||{},X=!!M.sync,W=!1,ce={body:void 0,headers:{},statusCode:0,method:he,url:fe,rawRequest:V};if("json"in M&&!1!==M.json&&(W=!0,P.accept||P.Accept||(P.Accept="application/json"),"GET"!==he&&"HEAD"!==he&&(P["content-type"]||P["Content-Type"]||(P["Content-Type"]="application/json"),me=JSON.stringify(!0===M.json?me:M.json))),V.onreadystatechange=function D(){4===V.readyState&&setTimeout(q,0)},V.onload=q,V.onerror=H,V.onprogress=function(){},V.onabort=function(){ae=!0},V.ontimeout=H,V.open(he,fe,!X,M.username,M.password),X||(V.withCredentials=!!M.withCredentials),!X&&M.timeout>0&&(te=setTimeout(function(){if(!ae){ae=!0,V.abort("timeout");var Se=new Error("XMLHttpRequest timeout");Se.code="ETIMEDOUT",H(Se)}},M.timeout)),V.setRequestHeader)for(ne in P)P.hasOwnProperty(ne)&&V.setRequestHeader(ne,P[ne]);else if(M.headers&&!function A(M){for(var _ in M)if(M.hasOwnProperty(_))return!1;return!0}(M.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in M&&(V.responseType=M.responseType),"beforeSend"in M&&"function"==typeof M.beforeSend&&M.beforeSend(V),V.send(me||null),V}C.exports=g,C.exports.default=g,g.XMLHttpRequest=s.XMLHttpRequest||function y(){},g.XDomainRequest="withCredentials"in new g.XMLHttpRequest?g.XMLHttpRequest:s.XDomainRequest,function d(M,_){for(var O=0;O<M.length;O++)_(M[O])}(["get","put","post","patch","head","delete"],function(M){g["delete"===M?"del":M]=function(_,O,D){return(O=E(_,O,D)).method=M.toUpperCase(),v(O)}})},{"global/window":27,"is-function":33,"parse-headers":47,xtend:71}],70:[function(h,C,m){C.exports=typeof self.DOMParser<"u"?function(c){return(new self.DOMParser).parseFromString(c,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(c){var u=new self.ActiveXObject("Microsoft.XMLDOM");return u.async="false",u.loadXML(c),u}:function(c){var u=document.createElement("div");return u.innerHTML=c,u}},{}],71:[function(h,C,m){C.exports=function c(){for(var u={},p=0;p<arguments.length;p++){var d=arguments[p];for(var A in d)s.call(d,A)&&(u[A]=d[A])}return u};var s=Object.prototype.hasOwnProperty},{}],72:[function(h,C,m){C.exports={name:"aframe",version:"1.1.0",description:"A web framework for building virtual reality experiences.",homepage:"https://aframe.io/",main:"dist/aframe-master.js",scripts:{browserify:"browserify src/index.js -s 'AFRAME' -p browserify-derequire",build:"shx mkdir -p build/ && npm run browserify -- --debug -t [ envify --INSPECTOR_VERSION dev ] -o build/aframe.js",codecov:"codecov",dev:"npm run build && cross-env INSPECTOR_VERSION=dev node ./scripts/budo -t envify",dist:"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"npm run browserify -s -- --debug | exorcist dist/aframe-master.js.map > dist/aframe-master.js","dist:min":"npm run browserify -s -- --debug -p [ minifyify --map aframe-master.min.js.map --output dist/aframe-master.min.js.map ] -o dist/aframe-master.min.js",docs:"markserv --dir docs --port 9001",preghpages:"node ./scripts/preghpages.js",ghpages:"ghpages -p gh-pages/",lint:"semistandard -v | snazzy","lint:fix":"semistandard --fix",precommit:"npm run lint",prepush:"node scripts/testOnlyCheck.js",prerelease:"node scripts/release.js 1.0.4 1.1.0",start:"npm run dev","start:https":"cross-env SSL=true npm run dev",test:"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"mocha --ui tdd tests/node"},repository:"aframevr/aframe",license:"MIT",files:["dist/*","docs/**/*","src/**/*","vendor/**/*"],dependencies:{"custom-event-polyfill":"^1.0.6",debug:"ngokevin/debug#noTimestamp","deep-assign":"^2.0.0","document-register-element":"dmarcos/document-register-element#8ccc532b7f3744be954574caf3072a5fd260ca90","load-bmfont":"^1.2.3","object-assign":"^4.0.1",present:"0.0.6","promise-polyfill":"^3.1.0","super-animejs":"^3.1.0","super-three":"^0.123.1","three-bmfont-text":"dmarcos/three-bmfont-text#1babdf8507c731a18f8af3b807292e2b9740955e","webvr-polyfill":"^0.10.12"},devDependencies:{browserify:"^13.1.0","browserify-css":"^0.8.4","browserify-derequire":"^0.9.4","browserify-istanbul":"^2.0.0",budo:"^9.2.0",chai:"^3.5.0","chai-shallow-deep-equal":"^1.4.0",chalk:"^1.1.3",codecov:"^1.0.1","cross-env":"^5.0.1",envify:"^3.4.1",exorcist:"^0.4.0",ghpages:"0.0.8","git-rev":"^0.2.1",glob:"^7.1.1",husky:"^0.11.7",istanbul:"^0.4.5",jsdom:"^9.11.0",karma:"1.4.1","karma-browserify":"^5.1.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^2.0.0","karma-coverage":"^1.1.1","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^1.2.0","karma-mocha":"^1.1.1","karma-mocha-reporter":"^2.1.0","karma-sinon-chai":"1.2.4",lolex:"^1.5.1",markserv:"github:sukima/markserv#feature/fix-broken-websoketio-link",minifyify:"^7.3.3",mocha:"^3.0.2","mozilla-download":"^1.1.1","replace-in-file":"^2.5.3",semistandard:"^9.0.0",shelljs:"^0.7.7",shx:"^0.2.2",sinon:"^1.17.5","sinon-chai":"2.8.0",snazzy:"^5.0.0","too-wordy":"ngokevin/too-wordy",uglifyjs:"^2.4.10","write-good":"^0.9.1"},link:!0,browserify:{transform:["browserify-css","envify"]},semistandard:{ignore:["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},keywords:["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","web-components","webvr"],"browserify-css":{minify:!0},engines:{node:">= 4.6.0",npm:"^2.15.9"}}},{}],73:[function(h,C,m){var s=h("super-animejs"),c=h("../core/component").components,u=h("../core/component").registerComponent,p=h("../lib/three"),d=h("../utils"),A=new p.Color,E=new p.Color,g=d.entity.getComponentProperty,v=d.entity.setComponentProperty,T={},y="color",_="rotation",O="scale",D="components";function q(P){P.x=p.Math.degToRad(P.x),P.y=p.Math.degToRad(P.y),P.z=p.Math.degToRad(P.z)}function V(P,X,W){var te;for(te=0;te<X.length;te++)P.addEventListener(X[te],W)}function ne(P,X,W){var te;for(te=0;te<X.length;te++)P.removeEventListener(X[te],W)}function ae(P,X){var W,te,ce;for(te=he(X),ce=P,W=0;W<te.length;W++)ce=ce[te[W]];if(void 0===ce)throw console.log(P),new Error("[animation] property ("+X+") could not be found");return ce}function fe(P,X,W,te){var ce,Se,_e,ze;for(X.startsWith("object3D.rotation")&&(W=p.Math.degToRad(W)),Se=he(X),ze=P,ce=0;ce<Se.length-1;ce++)ze=ze[Se[ce]];_e=Se[Se.length-1],te!==y?ze[_e]=W:"r"in ze[_e]?(ze[_e].r=W.r,ze[_e].g=W.g,ze[_e].b=W.b):(ze[_e].x=W.r,ze[_e].y=W.g,ze[_e].z=W.b)}function he(P){return P in T||(T[P]=P.split(".")),T[P]}function me(P){return P.isRawProperty||P.property.startsWith(D)||P.property.startsWith("object3D")}C.exports.Component=u("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(P){return!0===P||"true"===P||!1!==P&&"false"!==P&&parseInt(P,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var P=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){P.animationIsPlaying=!1,P.el.emit("animationcomplete",P.eventDetail,!1),P.id&&P.el.emit("animationcomplete__"+P.id,P.eventDetail,!1)}}},update:function(P){var X=this.config,W=this.data;this.animationIsPlaying=!1,this.data.enabled&&W.property&&(X.autoplay=!1,X.direction=W.dir,X.duration=W.dur,X.easing=W.easing,X.elasticity=W.elasticity,X.loop=W.loop,X.round=W.round,this.createAndStartAnimation())},tick:function(P,X){this.animationIsPlaying&&(this.time+=X,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var P=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=s(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!(!P.autoplay||P.startEvents&&P.startEvents.length)){if(P.delay)return void setTimeout(this.beginAnimation,P.delay);this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=s(this.config),this.data.delay)return void setTimeout(this.beginAnimation,this.data.delay);this.beginAnimation()}},updateConfigForRawColor:function(){var te,ce,Se,_e,P=this.config,X=this.data,W=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(ce in te=""===X.from?ae(W,X.property):X.from,this.setColorConfig(te,X.to),te=this.fromColor,Se=this.toColor,this.targetsArray.length=0,this.targetsArray.push(te),P.targets=this.targetsArray,Se)P[ce]=Se[ce];P.update=(_e={},function(ze){var rt;((rt=ze.animatables[0].target).r!==_e.r||rt.g!==_e.g||rt.b!==_e.b)&&fe(W,X.property,rt,X.type)})}},updateConfigForDefault:function(){var te,ce,_e,ze,P=this.config,X=this.data,W=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(te=""===X.from?me(X)?ae(W,X.property):g(W,X.property):X.from,_e=X.to,isNaN(te||_e)?(te=te&&te.toString(),_e=_e&&_e.toString()):(te=parseFloat(te),_e=parseFloat(_e)),(ce="true"===X.to||"false"===X.to||!0===X.to||!1===X.to)&&(te="true"===X.from||!0===X.from?1:0,_e="true"===X.to||!0===X.to?1:0),this.targets.aframeProperty=te,P.targets=this.targets,P.aframeProperty=_e,P.update=function(rt){var gt;(gt=rt.animatables[0].target.aframeProperty)!==ze&&(ze=gt,ce&&(gt=gt>=1),me(X)?fe(W,X.property,gt,X.type):v(W,X.property,gt))})},updateConfigForVector:function(){var te,ce,Se,_e,P=this.config,X=this.data,W=this.el;for(te in ce=""!==X.from?d.coordinates.parse(X.from):g(W,X.property),Se=d.coordinates.parse(X.to),X.property===_&&(q(ce),q(Se)),this.targetsArray.length=0,this.targetsArray.push(ce),P.targets=this.targetsArray,Se)P[te]=Se[te];P.update="position"!==X.property&&X.property!==_&&X.property!==O?function(){var _e={};return function(ze){var rt=ze.animatables[0].target;rt.x===_e.x&&rt.y===_e.y&&rt.z===_e.z||(_e.x=rt.x,_e.y=rt.y,_e.z=rt.z,v(W,X.property,rt))}}():(_e={},function(ze){var rt=ze.animatables[0].target;X.property===O&&(rt.x=Math.max(1e-4,rt.x),rt.y=Math.max(1e-4,rt.y),rt.z=Math.max(1e-4,rt.z)),(rt.x!==_e.x||rt.y!==_e.y||rt.z!==_e.z)&&(_e.x=rt.x,_e.y=rt.y,_e.z=rt.z,W.object3D[X.property].set(rt.x,rt.y,rt.z))})},updateConfig:function(){var P;P=function H(P,X){var W,te,ce,Se;return Se=(ce=X.split("."))[1],!(W=P.components[te=ce[0]]||c[te])||Se&&!W.schema[Se]?null:Se?W.schema[Se].type:W.schema.type}(this.el,this.data.property),me(this.data)&&this.data.type===y?this.updateConfigForRawColor():"vec2"===P||"vec3"===P||"vec4"===P?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(P){var X,W=this.data,te=this.el,ce=this;return!(""!==W.from||!W.property.startsWith(D)||(X=he(W.property)[1],te.components[X])||(te.addEventListener("componentinitialized",function Se(_e){_e.detail.name===X&&(P(),ce.animation=s(ce.config),te.removeEventListener("componentinitialized",Se))}),0))},stopRelatedAnimations:function(){var P,X;for(X in this.el.components)P=this.el.components[X],X!==this.attrName&&"animation"===P.name&&P.animationIsPlaying&&P.data.property===this.data.property&&(P.animationIsPlaying=!1)},addEventListeners:function(){var P=this.data,X=this.el;V(X,P.startEvents,this.onStartEvent),V(X,P.pauseEvents,this.pauseAnimation),V(X,P.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var P=this.data,X=this.el;ne(X,P.startEvents,this.onStartEvent),ne(X,P.pauseEvents,this.pauseAnimation),ne(X,P.resumeEvents,this.resumeAnimation)},setColorConfig:function(P,X){A.set(P),E.set(X),X=this.toColor,(P=this.fromColor).r=A.r,P.g=A.g,P.b=A.b,X.r=E.r,X.g=E.g,X.b=E.b}})},{"../core/component":130,"../lib/three":178,"../utils":204,"super-animejs":56}],74:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../lib/three");C.exports.Component=s("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var u,p=this.el;u=this.camera=new c.PerspectiveCamera,p.setObject3D("camera",u)},update:function(u){var p=this.data,d=this.camera;d.aspect=p.aspect||window.innerWidth/window.innerHeight,d.far=p.far,d.fov=p.fov,d.near=p.near,d.zoom=p.zoom,d.updateProjectionMatrix(),this.updateActiveCamera(u),this.updateSpectatorCamera(u)},updateActiveCamera:function(u){var p=this.data,d=this.el,A=this.system;u&&u.active===p.active||p.spectator||(p.active&&A.activeCameraEl!==d?A.setActiveCamera(d):!p.active&&A.activeCameraEl===d&&A.disableActiveCamera())},updateSpectatorCamera:function(u){var p=this.data,d=this.el,A=this.system;u&&u.spectator===p.spectator||(p.spectator&&A.spectatorCameraEl!==d?A.setSpectatorCamera(d):!p.spectator&&A.spectatorCameraEl===d&&A.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},{"../core/component":130,"../lib/three":178}],75:[function(h,C,m){var v,T,y,M,s=h("../core/component").registerComponent,c=h("../utils/"),u=c.bind,d_FUSING="cursor-fusing",A={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},E={DOWN:["selectstart"],UP:["selectend"]},g="a-mouse-cursor-hover";C.exports.Component=s("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:c.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function(){var v=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.updateCanvasBounds=c.debounce(function(){v.canvasBounds=v.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=u(this.onCursorDown,this),this.onCursorUp=u(this.onCursorUp,this),this.onIntersection=u(this.onIntersection,this),this.onIntersectionCleared=u(this.onIntersectionCleared,this),this.onMouseMove=u(this.onMouseMove,this),this.onEnterVR=u(this.onEnterVR,this)},update:function(v){this.data.rayOrigin!==v.rayOrigin&&this.updateMouseEventListeners()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var v=this.el;v.removeState("cursor-hovering"),v.removeState(d_FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState("cursor-hovered"),this.removeEventListeners()},addEventListeners:function(){var v,T=this.data,y=this.el,M=this;function _(){v=y.sceneEl.canvas,!T.downEvents.length&&!T.upEvents.length&&(A.DOWN.forEach(function(O){v.addEventListener(O,M.onCursorDown)}),A.UP.forEach(function(O){v.addEventListener(O,M.onCursorUp)}))}(v=y.sceneEl.canvas)?_():y.sceneEl.addEventListener("render-target-loaded",_),T.downEvents.forEach(function(O){y.addEventListener(O,M.onCursorDown)}),T.upEvents.forEach(function(O){y.addEventListener(O,M.onCursorUp)}),y.addEventListener("raycaster-intersection",this.onIntersection),y.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),y.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),y.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var v,T=this.data,y=this.el,M=this;(v=y.sceneEl.canvas)&&!T.downEvents.length&&!T.upEvents.length&&(A.DOWN.forEach(function(_){v.removeEventListener(_,M.onCursorDown)}),A.UP.forEach(function(_){v.removeEventListener(_,M.onCursorUp)})),T.downEvents.forEach(function(_){y.removeEventListener(_,M.onCursorDown)}),T.upEvents.forEach(function(_){y.removeEventListener(_,M.onCursorUp)}),y.removeEventListener("raycaster-intersection",this.onIntersection),y.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),v.removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchstart",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),y.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),y.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var v,T=this.el;(v=T.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),v.removeEventListener("touchmove",this.onMouseMove),T.setAttribute("raycaster","useWorldCoordinates",!1),"mouse"===this.data.rayOrigin&&(v.addEventListener("mousemove",this.onMouseMove,!1),v.addEventListener("touchmove",this.onMouseMove,!1),T.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:(v=new THREE.Vector3,T=new THREE.Vector2,y=new THREE.Vector3,M={origin:y,direction:v},function(_){var H,q,O=this.canvasBounds,D=this.el.sceneEl.camera;D.parent.updateMatrixWorld(),q=(H="touchmove"===_.type||"touchstart"===_.type?_.touches.item(0):_).clientY-O.top,T.x=(H.clientX-O.left)/O.width*2-1,T.y=-q/O.height*2+1,y.setFromMatrixPosition(D.matrixWorld),v.set(T.x,T.y,.5).unproject(D).sub(y).normalize(),this.el.setAttribute("raycaster",M),"touchmove"===_.type&&_.preventDefault()}),onCursorDown:function(v){this.isCursorDown=!0,"mouse"===this.data.rayOrigin&&"touchstart"===v.type&&(this.onMouseMove(v),this.el.components.raycaster.checkIntersections(),v.preventDefault()),this.twoWayEmit("mousedown"),this.cursorDownEl=this.intersectedEl},onCursorUp:function(v){if(this.isCursorDown){this.isCursorDown=!1;var T=this.data;this.twoWayEmit("mouseup"),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit("mouseup",this.intersectedEventDetail)),(!T.fuse||"mouse"===T.rayOrigin)&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit("click"),this.cursorDownEl=null,"touchend"===v.type&&v.preventDefault()}},onIntersection:function(v){var T,M,_,O;O=v.detail.intersections[M=v.detail.els[0]===this.el?1:0],(_=v.detail.els[M])&&this.intersectedEl!==_&&(this.intersectedEl&&(T=this.el.components.raycaster.getIntersection(this.intersectedEl))&&T.distance<=O.distance||(this.clearCurrentIntersection(!0),this.setIntersection(_,O)))},onIntersectionCleared:function(v){-1!==v.detail.clearedEls.indexOf(this.intersectedEl)&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var v=this.el.sceneEl.xrSession,T=this;v&&"mouse"!==this.data.rayOrigin&&(E.DOWN.forEach(function(y){v.addEventListener(y,T.onCursorDown)}),E.UP.forEach(function(y){v.addEventListener(y,T.onCursorUp)}))},setIntersection:function(v,T){var y=this.el,M=this.data,_=this;this.intersectedEl!==v&&(this.intersectedEl=v,y.addState("cursor-hovering"),v.addState("cursor-hovered"),this.twoWayEmit("mouseenter"),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.add(g),0!==M.fuseTimeout&&M.fuse&&(y.addState(d_FUSING),this.twoWayEmit("fusing"),this.fuseTimeout=setTimeout(function(){y.removeState(d_FUSING),_.twoWayEmit("click")},M.fuseTimeout)))},clearCurrentIntersection:function(v){var y,M,_=this.el;this.intersectedEl&&(this.intersectedEl.removeState("cursor-hovered"),_.removeState("cursor-hovering"),_.removeState(d_FUSING),this.twoWayEmit("mouseleave"),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.remove(g),this.intersectedEl=null,clearTimeout(this.fuseTimeout),!0!==v&&0!==(M=this.el.components.raycaster.intersections).length&&(y=M[M[0].object.el===_?1:0])&&this.setIntersection(y.object.el,y))},twoWayEmit:function(v){var M,T=this.el,y=this.intersectedEl;M=this.el.components.raycaster.getIntersection(y),this.eventDetail.intersectedEl=y,this.eventDetail.intersection=M,T.emit(v,this.eventDetail),y&&(this.intersectedEventDetail.intersection=M,y.emit(v,this.intersectedEventDetail))}})},{"../core/component":130,"../utils/":204}],76:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,E="https://cdn.aframe.io/controllers/google/",g=E+"vr_controller_daydream.obj",v=E+"vr_controller_daydream.mtl",T=h("../utils/").device.isWebXRAvailable,_=T?"google-daydream":"Daydream Controller";C.exports.Component=s("daydream-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:T?{axes:{touchpad:[0,1]},buttons:["none","none","touchpad","menu","system"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","menu","system"]},bindMethods:function(){this.onModelLoaded=c(this.onModelLoaded,this),this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this),this.onAxisMoved=c(this.onAxisMoved,this)},init:function(){var H=this;this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(q){A(q.detail.id,"down",H)},this.onButtonUp=function(q){A(q.detail.id,"up",H)},this.onButtonTouchStart=function(q){A(q.detail.id,"touchstart",H)},this.onButtonTouchEnd=function(q){A(q.detail.id,"touchend",H)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var H=this.el;H.addEventListener("buttonchanged",this.onButtonChanged),H.addEventListener("buttondown",this.onButtonDown),H.addEventListener("buttonup",this.onButtonUp),H.addEventListener("touchstart",this.onButtonTouchStart),H.addEventListener("touchend",this.onButtonTouchEnd),H.addEventListener("model-loaded",this.onModelLoaded),H.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var H=this.el;H.removeEventListener("buttonchanged",this.onButtonChanged),H.removeEventListener("buttondown",this.onButtonDown),H.removeEventListener("buttonup",this.onButtonUp),H.removeEventListener("touchstart",this.onButtonTouchStart),H.removeEventListener("touchend",this.onButtonTouchEnd),H.removeEventListener("model-loaded",this.onModelLoaded),H.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){p(this,_,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var q=this.data;this.el.setAttribute("tracked-controls",{armModel:q.armModel,hand:q.hand,idPrefix:_,id:_,orientationOffset:q.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:g,mtl:v})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(H){var V,q=H.detail.model;this.data.model&&((V=this.buttonMeshes={}).menu=q.getObjectByName("AppButton_AppButton_Cylinder.004"),V.system=q.getObjectByName("HomeButton_HomeButton_Cylinder.005"),V.trackpad=q.getObjectByName("TouchPad_TouchPad_Cylinder.003"),V.touchpad=q.getObjectByName("TouchPad_TouchPad_Cylinder.003"),q.position.set(0,0,-.04))},onAxisMoved:function(H){d(this,this.mapping.axes,H)},onButtonChanged:function(H){var q=this.mapping.buttons[H.detail.id];q&&this.el.emit(q+"changed",H.detail.state)},updateModel:function(H,q){this.data.model&&this.updateButtonModel(H,q)},updateButtonModel:function(H,q){var V=this.buttonMeshes;if(V&&V[H]){var ne;switch(q){case"down":ne=this.data.buttonHighlightColor;break;case"touchstart":ne=this.data.buttonTouchedColor;break;default:ne=this.data.buttonColor}V[H].material.color.set(ne)}}})},{"../core/component":130,"../utils/":204,"../utils/bind":198,"../utils/tracked-controls":213}],77:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,E=h("../utils/").device.isWebXRAvailable,g="https://cdn.aframe.io/controllers/samsung/",v=g+"gear_vr_controller.obj",T=g+"gear_vr_controller.mtl",_=E?"samsung-gearvr":"Gear VR";C.exports.Component=s("gearvr-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:E?{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=c(this.onModelLoaded,this),this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this),this.onAxisMoved=c(this.onAxisMoved,this)},init:function(){var H=this;this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(q){A(q.detail.id,"down",H)},this.onButtonUp=function(q){A(q.detail.id,"up",H)},this.onButtonTouchStart=function(q){A(q.detail.id,"touchstart",H)},this.onButtonTouchEnd=function(q){A(q.detail.id,"touchend",H)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var H=this.el;H.addEventListener("buttonchanged",this.onButtonChanged),H.addEventListener("buttondown",this.onButtonDown),H.addEventListener("buttonup",this.onButtonUp),H.addEventListener("touchstart",this.onButtonTouchStart),H.addEventListener("touchend",this.onButtonTouchEnd),H.addEventListener("model-loaded",this.onModelLoaded),H.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var H=this.el;H.removeEventListener("buttonchanged",this.onButtonChanged),H.removeEventListener("buttondown",this.onButtonDown),H.removeEventListener("buttonup",this.onButtonUp),H.removeEventListener("touchstart",this.onButtonTouchStart),H.removeEventListener("touchend",this.onButtonTouchEnd),H.removeEventListener("model-loaded",this.onModelLoaded),H.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){p(this,_,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var q=this.data;this.el.setAttribute("tracked-controls",{armModel:q.armModel,hand:q.hand,idPrefix:_,id:_,orientationOffset:q.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:v,mtl:T})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(H){var V,q=H.detail.model;this.data.model&&((V=this.buttonMeshes={}).trigger=q.children[2],V.trackpad=q.children[1],V.touchpad=q.children[1])},onButtonChanged:function(H){var q=this.mapping.buttons[H.detail.id];q&&this.el.emit(q+"changed",H.detail.state)},onAxisMoved:function(H){d(this,this.mapping.axes,H)},updateModel:function(H,q){this.data.model&&this.updateButtonModel(H,q)},updateButtonModel:function(H,q){var V=this.buttonMeshes;if(V&&V[H]){var ne;switch(q){case"down":ne=this.data.buttonHighlightColor;break;case"touchstart":ne=this.data.buttonTouchedColor;break;default:ne=this.data.buttonColor}V[H].material.color.set(ne)}}})},{"../core/component":130,"../utils/":204,"../utils/bind":198,"../utils/tracked-controls":213}],78:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,E="generic";C.exports.Component=s("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"}},mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]},bindMethods:function(){this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this),this.onAxisMoved=c(this.onAxisMoved,this)},init:function(){var v=this;this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(T){A(T.detail.id,"down",v)},this.onButtonUp=function(T){A(T.detail.id,"up",v)},this.onButtonTouchStart=function(T){A(T.detail.id,"touchstart",v)},this.onButtonTouchEnd=function(T){A(T.detail.id,"touchend",v)},this.controllerPresent=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var v=this.el;v.addEventListener("buttonchanged",this.onButtonChanged),v.addEventListener("buttondown",this.onButtonDown),v.addEventListener("buttonup",this.onButtonUp),v.addEventListener("touchstart",this.onButtonTouchStart),v.addEventListener("touchend",this.onButtonTouchEnd),v.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var v=this.el;v.removeEventListener("buttonchanged",this.onButtonChanged),v.removeEventListener("buttondown",this.onButtonDown),v.removeEventListener("buttonup",this.onButtonUp),v.removeEventListener("touchstart",this.onButtonTouchStart),v.removeEventListener("touchend",this.onButtonTouchEnd),v.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var v=this.data;p(this,E,{hand:v.hand?v.hand:void 0,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var v=this.el,T=this.data;this.el.components["tracked-controls"]?this.removeEventListeners():(v.setAttribute("tracked-controls",{hand:T.hand,idPrefix:E,orientationOffset:T.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel())},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(v){var T=this.mapping.buttons[v.detail.id];T&&this.el.emit(T+"changed",v.detail.state)},onAxisMoved:function(v){d(this,this.mapping.axes,v)},initDefaultModel:function(){var v=this.modelEl=document.createElement("a-entity");v.setAttribute("geometry",{primitive:"sphere",radius:.03}),v.setAttribute("material",{color:this.data.color}),this.el.appendChild(v)}})},{"../core/component":130,"../utils/bind":198,"../utils/tracked-controls":213}],79:[function(h,C,m){var s=h("../core/geometry").geometries,c=h("../core/geometry").geometryNames,u=h("../core/component").registerComponent,p=h("../lib/three"),d=new p.Geometry;C.exports.Component=u("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:c,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(A){var v,E=this.data,g=this.el,T=this.system;this.geometry&&(T.unuseGeometry(A),this.geometry=null),this.geometry=T.getOrCreateGeometry(E),(v=g.getObject3D("mesh"))?v.geometry=this.geometry:((v=new p.Mesh).geometry=this.geometry,g.setObject3D("mesh",v))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=d,this.geometry=null},updateSchema:function(A){var E=this.oldData&&this.oldData.primitive,g=A.primitive,v=s[g]&&s[g].schema;if(!v)throw new Error("Unknown geometry schema `"+g+"`");E&&E===g||this.extendSchema(v)}})},{"../core/component":130,"../core/geometry":131,"../lib/three":178}],80:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../lib/three"),p=h("../utils/").debug("components:gltf-model:warn");C.exports.Component=s("gltf-model",{schema:{type:"model"},init:function(){var d=this.system.getDRACOLoader();this.model=null,this.loader=new c.GLTFLoader,d&&this.loader.setDRACOLoader(d)},update:function(){var d=this,A=this.el,E=this.data;E&&(this.remove(),this.loader.load(E,function(v){d.model=v.scene||v.scenes[0],d.model.animations=v.animations,A.setObject3D("mesh",d.model),A.emit("model-loaded",{format:"gltf",model:d.model})},void 0,function(v){p(v&&v.message?v.message:"Failed to load glTF model"),A.emit("model-error",{format:"gltf",src:E})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../core/component":130,"../lib/three":178,"../utils/":204}],81:[function(h,C,m){var s=h("../core/component").registerComponent,c={toonLeft:"https://cdn.aframe.io/controllers/hands/leftHand.glb",toonRight:"https://cdn.aframe.io/controllers/hands/rightHand.glb",lowPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandLow.glb",lowPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandLow.glb",highPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandHigh.glb",highPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandHigh.glb"},p={};function d(E,g){var v;if(E){if("grip"===(v=p[E]))return v+(g?"close":"open");if("point"===v)return v+(g?"up":"down");if("pointing"===v||"pistol"===v)return v+(g?"start":"end")}}p.Fist="grip",p["Thumb Up"]="pistol",p.Point="pointing",C.exports.Component=s("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},init:function(){var E=this,g=this.el;this.gesture="Open",this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){E.handleButton("grip","down")},this.onGripUp=function(){E.handleButton("grip","up")},this.onTrackpadDown=function(){E.handleButton("trackpad","down")},this.onTrackpadUp=function(){E.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){E.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){E.handleButton("trackpad","touchend")},this.onTriggerDown=function(){E.handleButton("trigger","down")},this.onTriggerUp=function(){E.handleButton("trigger","up")},this.onTriggerTouchStart=function(){E.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){E.handleButton("trigger","touchend")},this.onGripTouchStart=function(){E.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){E.handleButton("grip","touchend")},this.onThumbstickDown=function(){E.handleButton("thumbstick","down")},this.onThumbstickUp=function(){E.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){E.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){E.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){E.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){E.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){E.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){E.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),g.addEventListener("controllerconnected",this.onControllerConnected),g.addEventListener("controllerdisconnected",this.onControllerDisconnected),g.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(E,g){var v=this.el.getObject3D("mesh");!v||!v.mixer||v.mixer.update(g/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var E=this.el;E.addEventListener("gripdown",this.onGripDown),E.addEventListener("gripup",this.onGripUp),E.addEventListener("trackpaddown",this.onTrackpadDown),E.addEventListener("trackpadup",this.onTrackpadUp),E.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),E.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),E.addEventListener("triggerdown",this.onTriggerDown),E.addEventListener("triggerup",this.onTriggerUp),E.addEventListener("triggertouchstart",this.onTriggerTouchStart),E.addEventListener("triggertouchend",this.onTriggerTouchEnd),E.addEventListener("griptouchstart",this.onGripTouchStart),E.addEventListener("griptouchend",this.onGripTouchEnd),E.addEventListener("thumbstickdown",this.onThumbstickDown),E.addEventListener("thumbstickup",this.onThumbstickUp),E.addEventListener("abuttontouchstart",this.onAorXTouchStart),E.addEventListener("abuttontouchend",this.onAorXTouchEnd),E.addEventListener("bbuttontouchstart",this.onBorYTouchStart),E.addEventListener("bbuttontouchend",this.onBorYTouchEnd),E.addEventListener("xbuttontouchstart",this.onAorXTouchStart),E.addEventListener("xbuttontouchend",this.onAorXTouchEnd),E.addEventListener("ybuttontouchstart",this.onBorYTouchStart),E.addEventListener("ybuttontouchend",this.onBorYTouchEnd),E.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),E.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var E=this.el;E.removeEventListener("gripdown",this.onGripDown),E.removeEventListener("gripup",this.onGripUp),E.removeEventListener("trackpaddown",this.onTrackpadDown),E.removeEventListener("trackpadup",this.onTrackpadUp),E.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),E.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),E.removeEventListener("triggerdown",this.onTriggerDown),E.removeEventListener("triggerup",this.onTriggerUp),E.removeEventListener("triggertouchstart",this.onTriggerTouchStart),E.removeEventListener("triggertouchend",this.onTriggerTouchEnd),E.removeEventListener("griptouchstart",this.onGripTouchStart),E.removeEventListener("griptouchend",this.onGripTouchEnd),E.removeEventListener("thumbstickdown",this.onThumbstickDown),E.removeEventListener("thumbstickup",this.onThumbstickUp),E.removeEventListener("abuttontouchstart",this.onAorXTouchStart),E.removeEventListener("abuttontouchend",this.onAorXTouchEnd),E.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),E.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),E.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),E.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),E.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),E.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),E.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),E.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(E){var g,v=this.el,T=this.data.hand,M=this.data.color,_=this;if(g={hand:T,model:!1},T!==E){var O=c[this.data.handModelStyle+T.charAt(0).toUpperCase()+T.slice(1)];this.loader.load(O,function(D){var B=D.scene.children[0],H="left"===T?Math.PI/2:-Math.PI/2;B.mixer=new THREE.AnimationMixer(B),_.clips=D.animations,v.setObject3D("mesh",B),B.children[1].material.color=new THREE.Color(M),B.position.set(0,0,0),B.rotation.set(0,0,H),v.setAttribute("magicleap-controls",g),v.setAttribute("vive-controls",g),v.setAttribute("oculus-touch-controls",g),v.setAttribute("windows-motion-controls",g)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(E,g){var v,T="down"===g,y="touchstart"===g;if(0===g.indexOf("touch")){if(y===this.touchedButtons[E])return;this.touchedButtons[E]=y}else{if(T===this.pressedButtons[E])return;this.pressedButtons[E]=T}v=this.gesture,this.gesture=this.determineGesture(),this.gesture!==v&&(this.animateGesture(this.gesture,v),this.emitGestureEvents(this.gesture,v))},determineGesture:function(){var E,g=this.pressedButtons.grip,v=this.pressedButtons.surface||this.touchedButtons.surface,T=this.pressedButtons.trackpad||this.touchedButtons.trackpad,y=this.pressedButtons.trigger||this.touchedButtons.trigger,M=this.touchedButtons.AorX||this.touchedButtons.BorY,_=function A(E){var g=E&&E.controller;return g&&(g.id&&0===g.id.indexOf("OpenVR ")||g.profiles&&g.profiles[0]&&"htc-vive-controller-mv"===g.profiles[0])}(this.el.components["tracked-controls"]);return _?g||y?E="Fist":T&&(E="Point"):g?E=v||M||T?y?"Fist":"Point":y?"Thumb Up":"Point + Thumb":y&&(E="Hold"),E},getClip:function(E){var g,v;for(v=0;v<this.clips.length;v++)if((g=this.clips[v]).name===E)return g},animateGesture:function(E,g){E?this.playAnimation(E||"Open",g,!1):this.playAnimation(g,g,!0)},emitGestureEvents:function(E,g){var T,v=this.el;g!==E&&((T=d(g,!1))&&v.emit(T),(T=d(E,!0))&&v.emit(T))},playAnimation:function(E,g,v){var T,y,_,M=this.el.getObject3D("mesh");if(M){if(M.mixer.stopAllAction(),T=this.getClip(E),(_=M.mixer.clipAction(T)).clampWhenFinished=!0,_.loop=THREE.LoopRepeat,_.repetitions=0,_.timeScale=v?-1:1,_.time=v?T.duration:0,_.weight=1,!g||E===g)return M.mixer.stopAllAction(),void _.play();T=this.getClip(g),(y=M.mixer.clipAction(T)).weight=.15,y.play(),_.play(),y.crossFadeTo(_,.15,!0)}}})},{"../core/component":130}],82:[function(h,C,m){var _,s=h("../core/component").registerComponent,c=h("../utils/bind"),p=h("../utils/tracked-controls").checkControllerPresentAndSetup,g={left:"b_l_",right:"b_r_"},v=["wrist","thumb1","thumb2","thumb3","thumb_null",null,"index1","index2","index3","index_null",null,"middle1","middle2","middle3","middle_null",null,"ring1","ring2","ring3","ring_null","pinky0","pinky1","pinky2","pinky3","pinky_null"];C.exports.Component=s("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"}},bindMethods:function(){this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var _=0;_<this.jointEls.length;++_)this.jointEls[_].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var _=0;_<this.jointEls.length;++_)this.jointEls[_].object3D.visible=!1},init:function(){var _=this.el.sceneEl,O=_.getAttribute("webxr").optionalFeatures;O.push("hand-tracking"),_.setAttribute("webxr",{optionalFeatures:O}),this.onModelLoaded=this.onModelLoaded.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3},this.indexTipPosition=new THREE.Vector3,this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace)},updateReferenceSpace:function(){var _=this,O=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,O){var D=_.el.sceneEl.systems.webxr.sessionReferenceSpaceType;O.requestReferenceSpace(D).then(function(B){_.referenceSpace=B.getOffsetReferenceSpace(new XRRigidTransform({x:0,y:1.5,z:0}))}).catch(function(B){throw _.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(D,"tracked-controls-webxr uses reference space "+D),B})}},checkIfControllerPresent:function(){var _=this.data;p(this,"",{hand:_.hand?_.hand:void 0,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var O=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,D=this.el.sceneEl.frame;!O||!D||!this.el.components["tracked-controls-webxr"]||O.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),D.getJointPose&&this.updateHandModel(),this.detectGesture())},updateHandModel:function(){"dots"===this.data.modelStyle&&this.updateHandDotsModel(),"mesh"===this.data.modelStyle&&this.updateHandMeshModel()},updateHandMeshModel:function(){var _=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,O=this.referenceSpace;if(_&&this.mesh&&O){this.mesh.visible=!1;for(var D=0;D<_.hand.length;D++){var B,H,q;_.hand[D]&&(H=this.el.sceneEl.frame.getJointPose(_.hand[D],O),null!=v[D]&&null!=(B=this.getBone(g[this.data.hand]+v[D]))&&H&&(q=H.transform,this.mesh.visible=!0,B.position.copy(q.position).multiplyScalar(100),B.quaternion.set(q.orientation.x,q.orientation.y,q.orientation.z,q.orientation.w)))}}},getBone:function(_){for(var O=this.bones,D=0;D<O.length;D++)if(O[D].name===_)return O[D];return null},updateHandDotsModel:function(){for(var _=this.el.sceneEl.frame,O=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,B=this.el.components["tracked-controls-webxr"].system.referenceSpace,H=0;H<this.jointEls.length;++H){var q=this.jointEls[H];if(q.object3D.visible=!!O.hand[H],O.hand[H]){var V=q.object3D,ne=_.getJointPose(O.hand[H],B);if(q.object3D.visible=!!ne,!ne)continue;V.matrix.elements=ne.transform.matrix,V.matrix.decompose(V.position,V.rotation,V.scale),q.setAttribute("scale",{x:ne.radius,y:ne.radius,z:ne.radius})}}},detectGesture:function(){this.detectPinch()},detectPinch:(_=new THREE.Vector3,function(){var O=this.el.sceneEl.frame,D=this.indexTipPosition,B=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,q=this.referenceSpace||this.el.components["tracked-controls-webxr"].system.referenceSpace;if(B.hand[XRHand.INDEX_PHALANX_TIP]&&B.hand[XRHand.THUMB_PHALANX_TIP]){var V=O.getJointPose(B.hand[XRHand.INDEX_PHALANX_TIP],q),ne=O.getJointPose(B.hand[XRHand.THUMB_PHALANX_TIP],q);if(V&&ne){_.copy(ne.transform.position),D.copy(V.transform.position);var ae=D.distanceTo(_);ae<.015&&!1===this.isPinched&&(this.isPinched=!0,this.pinchEventDetail.position.copy(D).lerp(_,.5),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchstarted",this.pinchEventDetail)),ae>.03&&!0===this.isPinched&&(this.isPinched=!1,this.pinchEventDetail.position.copy(D).lerp(_,.5),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchended",this.pinchEventDetail)),this.isPinched&&(this.pinchEventDetail.position.copy(D).lerp(_,.5),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchmoved",this.pinchEventDetail)),D.y+=1.5}}}),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){this.el.setAttribute("tracked-controls",{hand:this.data.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var _;this.checkIfControllerPresent(),_=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,this.el.getObject3D("mesh")&&(!_||!_.hand||!_.hand[0])&&this.el.removeObject3D("mesh")},initDefaultModel:function(){"dots"===this.data.modelStyle&&this.initDotsModel(),"mesh"===this.data.modelStyle&&this.initMeshHandModel()},initDotsModel:function(){if(0===this.jointEls.length)for(var _=0;_<25;++_){var O=this.jointEl=document.createElement("a-entity");O.setAttribute("geometry",{primitive:"sphere",radius:1}),O.setAttribute("material",{color:this.data.modelColor}),O.object3D.visible=!1,this.el.appendChild(O),this.jointEls.push(O)}},initMeshHandModel:function(){this.el.setAttribute("gltf-model","left"===this.data.hand?"https://cdn.aframe.io/controllers/oculus-hands/unity/left.glb":"https://cdn.aframe.io/controllers/oculus-hands/unity/right.glb")},onModelLoaded:function(){var _=this.mesh=this.el.getObject3D("mesh").children[0],O=this.skinnedMesh=_.children[24];this.skinnedMesh&&(this.bones=O.skeleton.bones,this.el.removeObject3D("mesh"),_.position.set(0,1.5,0),_.rotation.set(0,0,0),O.frustumCulled=!1,O.material=new THREE.MeshStandardMaterial({skinning:!0,color:this.data.modelColor}),this.el.setObject3D("mesh",_))}})},{"../core/component":130,"../utils/bind":198,"../utils/tracked-controls":213}],83:[function(h,C,m){h("./animation"),h("./camera"),h("./cursor"),h("./daydream-controls"),h("./gearvr-controls"),h("./geometry"),h("./generic-tracked-controller-controls"),h("./gltf-model"),h("./hand-tracking-controls"),h("./hand-controls"),h("./layer"),h("./laser-controls"),h("./light"),h("./line"),h("./link"),h("./look-controls"),h("./magicleap-controls"),h("./material"),h("./obj-model"),h("./oculus-go-controls"),h("./oculus-touch-controls"),h("./position"),h("./raycaster"),h("./rotation"),h("./scale"),h("./shadow"),h("./sound"),h("./text"),h("./tracked-controls"),h("./tracked-controls-webvr"),h("./tracked-controls-webxr"),h("./visible"),h("./valve-index-controls"),h("./vive-controls"),h("./vive-focus-controls"),h("./wasd-controls"),h("./windows-motion-controls"),h("./scene/background"),h("./scene/debug"),h("./scene/device-orientation-permission-ui"),h("./scene/embedded"),h("./scene/inspector"),h("./scene/fog"),h("./scene/keyboard-shortcuts"),h("./scene/pool"),h("./scene/screenshot"),h("./scene/stats"),h("./scene/vr-mode-ui")},{"./animation":73,"./camera":74,"./cursor":75,"./daydream-controls":76,"./gearvr-controls":77,"./generic-tracked-controller-controls":78,"./geometry":79,"./gltf-model":80,"./hand-controls":81,"./hand-tracking-controls":82,"./laser-controls":84,"./layer":85,"./light":86,"./line":87,"./link":88,"./look-controls":89,"./magicleap-controls":90,"./material":91,"./obj-model":92,"./oculus-go-controls":93,"./oculus-touch-controls":94,"./position":95,"./raycaster":96,"./rotation":97,"./scale":98,"./scene/background":99,"./scene/debug":100,"./scene/device-orientation-permission-ui":101,"./scene/embedded":102,"./scene/fog":103,"./scene/inspector":104,"./scene/keyboard-shortcuts":105,"./scene/pool":106,"./scene/screenshot":107,"./scene/stats":108,"./scene/vr-mode-ui":109,"./shadow":110,"./sound":111,"./text":112,"./tracked-controls":115,"./tracked-controls-webvr":113,"./tracked-controls-webxr":114,"./valve-index-controls":116,"./visible":117,"./vive-controls":118,"./vive-focus-controls":119,"./wasd-controls":120,"./windows-motion-controls":121}],84:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/");s("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var u=this.config,p=this.data,d=this.el,A=this,E={hand:p.hand,model:p.model};function g(T){var y=u[T.detail.name];if(y){var M=c.extend({showLine:!0},y.raycaster||{});T.detail.rayOrigin&&(M.origin=T.detail.rayOrigin.origin,M.direction=T.detail.rayOrigin.direction,M.showLine=!0),T.detail.rayOrigin||!A.modelReady?d.setAttribute("raycaster",M):d.setAttribute("raycaster","showLine",!0),d.setAttribute("cursor",c.extend({fuse:!1},y.cursor))}}d.setAttribute("daydream-controls",E),d.setAttribute("gearvr-controls",E),d.setAttribute("magicleap-controls",E),d.setAttribute("oculus-go-controls",E),d.setAttribute("oculus-touch-controls",E),d.setAttribute("valve-index-controls",E),d.setAttribute("vive-controls",E),d.setAttribute("vive-focus-controls",E),d.setAttribute("windows-motion-controls",E),d.setAttribute("generic-tracked-controller-controls",E),d.addEventListener("controllerconnected",g),d.addEventListener("controllerdisconnected",function v(){d.setAttribute("raycaster","showLine",!1)}),d.addEventListener("controllermodelready",function(T){g(T),A.modelReady=!0})},config:{"daydream-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"gearvr-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:.001,z:0}}},"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},{"../core/component":130,"../utils/":204}],85:[function(h,C,m){var s=h("../core/component").registerComponent,u=h("../utils/").debug("components:layer:warn");C.exports.Component=s("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var d=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=d.createFramebuffer();var A=this.el.sceneEl.getAttribute("webxr").requiredFeatures;A.push("layers"),this.el.sceneEl.getAttribute("webxr","requiredFeatures",A),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(d){this.data.src!==d.src&&this.updateSrc()},updateSrc:function(){var d=this.data.type;this.texture=void 0,"quad"!==d?"monocubemap"!==d&&"stereocubemap"!==d||this.loadCubeMapImages():this.loadQuadImage()},loadCubeMapImages:function(){var A,d=this.data.type,E=this.xrGLFactory,g=this.el.sceneEl.frame,v=this.data.src;this.visibilityChanged=!1,this.layer&&(this.pendingCubeMapUpdate=!v.complete,this.loadingScreen=!this.loadingScreen,"monocubemap"===d?(A=E.getSubImage(this.layer,g),this.loadCubeMapImage(A.colorTexture,v,0)):(A=E.getSubImage(this.layer,g,"left"),this.loadCubeMapImage(A.colorTexture,v,0),A=E.getSubImage(this.layer,g,"right"),this.loadCubeMapImage(A.colorTexture,v,6)))},loadQuadImage:function(){var d=this.data.src,A=this;this.el.sceneEl.systems.material.loadTexture(d,{src:d},function(g){A.el.sceneEl.renderer.initTexture(g),A.texture=g,"VIDEO"===d.tagName&&setTimeout(function(){A.textureIsVideo=!0},1e3),A.layer&&(A.layer.height=A.data.height/2||A.texture.image.height/1e3,A.layer.width=A.data.width/2||A.texture.image.width/1e3,A.needsRedraw=!0),A.updateQuadPanel()})},preGenerateCubeMapTextures:function(d,A){"monocubemap"===this.data.type?this.generateCubeMapTextures(d,0,A):(this.generateCubeMapTextures(d,0,A),this.generateCubeMapTextures(d,6,A))},generateCubeMapTextures:function(d,A,E){for(var M,g=this.data,v=this.cubeFaceSize,T=Math.min(d.width,d.height),y=[],O=0;O<6;O++){var D=document.createElement("CANVAS");D.width=D.height=v;var B=D.getContext("2d");g.rotateCubemap&&(2===O||3===O)&&(B.save(),B.translate(v,v),B.rotate(Math.PI)),B.drawImage(d,(O+A)*T,0,T,T,0,0,v,v),B.restore(),E&&E(),y.push(D)}return g.rotateCubemap&&(M=y[0],y[0]=y[1],y[1]=M,M=y[4],y[4]=y[5],y[5]=M),E&&E(),y},loadCubeMapImage:function(d,A,E){var v,g=this.el.sceneEl.renderer.getContext();g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),g.bindTexture(g.TEXTURE_CUBE_MAP,d),v=!A.complete||this.loadingScreen?this.loadingScreenImages:this.generateCubeMapTextures(A,E);var T=0;v.forEach(function(y,M){g.texSubImage2D(g.TEXTURE_CUBE_MAP_POSITIVE_X+M,0,0,0,g.RGBA,g.UNSIGNED_BYTE,y),T=g.getError()}),0!==T&&console.log("renderingError, WebGL Error Code: "+T),g.bindTexture(g.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&(!this.layer&&this.el.sceneEl.is("vr-mode")&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),(this.needsRedraw||this.layer.needsRedraw||this.textureIsVideo)&&("quad"===this.data.type&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var d=this,A=this.data.type;this.el.sceneEl.xrSession.onvisibilitychange=function(E){d.visibilityChanged="hidden"!==E.session.visibilityState},"quad"!==A?"monocubemap"!==A&&"stereocubemap"!==A||this.initCubeMapLayer():this.initQuadLayer()},initQuadLayer:function(){var d=this.el.sceneEl,A=d.renderer.getContext(),E=this.xrGLFactory=new XRWebGLBinding(d.xrSession,A);this.texture&&(this.layer=E.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),d.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var d=this.data.src,A=this.el.sceneEl,E=A.renderer.getContext(),g=E.getParameter(E.MAX_CUBE_MAP_TEXTURE_SIZE),v=this.cubeFaceSize=Math.min(g,Math.min(d.width,d.height)),T=this.xrGLFactory=new XRWebGLBinding(A.xrSession,E);this.layer=T.createCubeLayer({space:this.referenceSpace,viewPixelWidth:v,viewPixelHeight:v,layout:"monocubemap"===this.data.type?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),A.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var d=this.cubeFaceSize,A=this.loadingScreenImages=[],E=0;E<6;E++){var g=document.createElement("CANVAS");g.width=g.height=d;var v=g.getContext("2d");g.width=g.height=d,v.fillStyle="black",v.fillRect(0,0,d,d),2!==E&&3!==E&&(v.translate(d,0),v.scale(-1,1),v.fillStyle="white",v.font="30px Arial",v.fillText("Loading",d/2,d/2)),A.push(g)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(d){this.layerEnabled=d,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var d=this.quadPanelEl;this.quadPanelEl||(d=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(d)),d.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),d.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var d=this.el.sceneEl,A=this.el.sceneEl.renderer.getContext(),E=this.xrGLFactory.getSubImage(this.layer,d.frame),g=d.renderer.properties.get(this.texture).__webglTexture,v=A.getParameter(A.FRAMEBUFFER_BINDING);A.viewport(E.viewport.x,E.viewport.y,E.viewport.width,E.viewport.height),A.bindFramebuffer(A.FRAMEBUFFER,this.frameBuffer),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,E.colorTexture,0),function p(d,A,E,g){var v=d.createFramebuffer();let T=E.viewport.x,y=E.viewport.y,M=E.viewport.x+E.viewport.width,_=E.viewport.y+E.viewport.height;"VIDEO"===g.tagName&&(d.bindTexture(d.TEXTURE_2D,A),d.texSubImage2D(d.TEXTURE_2D,0,0,0,g.width,g.height,d.RGB,d.UNSIGNED_BYTE,g)),d.bindFramebuffer(d.READ_FRAMEBUFFER,v),d.framebufferTexture2D(d.READ_FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,A,0),d.readBuffer(d.COLOR_ATTACHMENT0),d.blitFramebuffer(0,0,g.width,g.height,T,y,M,_,d.COLOR_BUFFER_BIT,d.NEAREST),d.bindFramebuffer(d.READ_FRAMEBUFFER,null),d.deleteFramebuffer(v)}(A,g,E,this.data.src),A.bindFramebuffer(A.FRAMEBUFFER,v)},updateTransform:function(){var d=this.el,A=this.position,E=this.quaternion;d.object3D.updateMatrixWorld(),A.setFromMatrixPosition(d.object3D.matrixWorld),E.setFromRotationMatrix(d.object3D.matrixWorld),this.layerEnabled||A.set(0,0,1e8),this.layer.transform=new XRRigidTransform(A,E)},onEnterVR:function(){var d=this.el.sceneEl,A=d.xrSession;d.hasWebXR&&XRWebGLBinding&&A?(A.requestReferenceSpace("local").then(this.onRequestedReferenceSpace),this.needsRedraw=!0,this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()):u("The layer component requires WebXR and the layers API enabled")},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(d){this.referenceSpace=d}})},{"../core/component":130,"../utils/":204}],86:[function(h,C,m){var s=h("../utils/bind"),c=h("../utils").diff,u=h("../utils/debug"),p=h("../core/component").registerComponent,d=h("../lib/three"),A=d.Math.degToRad,E=u("components:light:warn");C.exports.Component=p("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color"},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var g=this.el;this.light=null,this.defaultTarget=null,this.rendererSystem=this.el.sceneEl.systems.renderer,this.system.registerLight(g)},update:function(g){var v=this.data,T=c(v,g),y=this.light,M=this.rendererSystem,_=this;if(!y||"type"in T)this.setLight(this.data),this.updateShadow();else{var O=!1;Object.keys(T).forEach(function(D){var B=v[D];switch(D){case"color":y.color.set(B),M.applyColorCorrection(y.color);break;case"groundColor":y.groundColor.set(B),M.applyColorCorrection(y.groundColor);break;case"angle":y.angle=A(B);break;case"target":null===B?("spot"===v.type||"directional"===v.type)&&(y.target=_.defaultTarget):B.hasLoaded?_.onSetTarget(B,y):B.addEventListener("loaded",s(_.onSetTarget,_,B,y));break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":O||(_.updateShadow(),O=!0);break;default:y[D]=B}})}},setLight:function(g){var v=this.el,T=this.getLight(g);T&&(this.light&&v.removeObject3D("light"),this.light=T,this.light.el=v,v.setObject3D("light",this.light),("spot"===g.type||"directional"===g.type||"hemisphere"===g.type)&&v.getObject3D("light").translateY(-1),"spot"===g.type&&(v.setObject3D("light-target",this.defaultTarget),v.getObject3D("light-target").position.set(0,0,-1)))},updateShadow:function(){var g=this.el,v=this.data,T=this.light;T.castShadow=v.castShadow;var y=g.getObject3D("cameraHelper");if(v.shadowCameraVisible&&!y?g.setObject3D("cameraHelper",new d.CameraHelper(T.shadow.camera)):!v.shadowCameraVisible&&y&&g.removeObject3D("cameraHelper"),!v.castShadow)return T;T.shadow.bias=v.shadowBias,T.shadow.radius=v.shadowRadius,T.shadow.mapSize.height=v.shadowMapHeight,T.shadow.mapSize.width=v.shadowMapWidth,T.shadow.camera.near=v.shadowCameraNear,T.shadow.camera.far=v.shadowCameraFar,T.shadow.camera instanceof d.OrthographicCamera?(T.shadow.camera.top=v.shadowCameraTop,T.shadow.camera.right=v.shadowCameraRight,T.shadow.camera.bottom=v.shadowCameraBottom,T.shadow.camera.left=v.shadowCameraLeft):T.shadow.camera.fov=v.shadowCameraFov,T.shadow.camera.updateProjectionMatrix(),y&&y.update()},getLight:function(g){var v=g.angle,T=new d.Color(g.color);this.rendererSystem.applyColorCorrection(T),T=T.getHex();var y=g.decay,M=g.distance,_=new d.Color(g.groundColor);this.rendererSystem.applyColorCorrection(_),_=_.getHex();var O=g.intensity,D=g.type,B=g.target,H=null;switch(D.toLowerCase()){case"ambient":return new d.AmbientLight(T,O);case"directional":return H=new d.DirectionalLight(T,O),this.defaultTarget=H.target,B&&(B.hasLoaded?this.onSetTarget(B,H):B.addEventListener("loaded",s(this.onSetTarget,this,B,H))),H;case"hemisphere":return new d.HemisphereLight(T,_,O);case"point":return new d.PointLight(T,O,M,y);case"spot":return H=new d.SpotLight(T,O,M,A(v),g.penumbra,y),this.defaultTarget=H.target,B&&(B.hasLoaded?this.onSetTarget(B,H):B.addEventListener("loaded",s(this.onSetTarget,this,B,H))),H;default:E("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",D)}},onSetTarget:function(g,v){v.target=g.object3D},remove:function(){var g=this.el;g.removeObject3D("light"),g.getObject3D("cameraHelper")&&g.removeObject3D("cameraHelper")}})},{"../core/component":130,"../lib/three":178,"../utils":204,"../utils/bind":198,"../utils/debug":200}],87:[function(h,C,m){var s=h("../core/component").registerComponent;function c(u,p){return!(!u||!p)&&u.x===p.x&&u.y===p.y&&u.z===p.z}C.exports.Component=s("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var p,d,u=this.data;this.rendererSystem=this.el.sceneEl.systems.renderer,d=this.material=new THREE.LineBasicMaterial({color:u.color,opacity:u.opacity,transparent:u.opacity<1,visible:u.visible}),(p=this.geometry=new THREE.BufferGeometry).setAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.rendererSystem.applyColorCorrection(d.color),this.line=new THREE.Line(p,d),this.el.setObject3D(this.attrName,this.line)},update:function(u){var p=this.data,d=this.geometry,A=!1,E=this.material,g=d.attributes.position.array;c(p.start,u.start)||(g[0]=p.start.x,g[1]=p.start.y,g[2]=p.start.z,A=!0),c(p.end,u.end)||(g[3]=p.end.x,g[4]=p.end.y,g[5]=p.end.z,A=!0),A&&(d.attributes.position.needsUpdate=!0,d.computeBoundingSphere()),E.color.setStyle(p.color),this.rendererSystem.applyColorCorrection(E.color),E.opacity=p.opacity,E.transparent=p.opacity<1,E.visible=p.visible},remove:function(){this.el.removeObject3D("line",this.line)}})},{"../core/component":130}],88:[function(h,C,m){var p,d,A,E,s=h("../core/component").registerComponent,c=h("../core/shader").registerShader,u=h("../lib/three");C.exports.Component=s("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new u.Quaternion,this.hiddenEls=[]},update:function(p){var g,d=this.data,A=this.el;d.visualAspectEnabled&&(this.initVisualAspect(),g=d.highlighted?d.highlightedColor:d.borderColor,A.setAttribute("material","backgroundColor",d.highlighted?d.highlightedColor:d.backgroundColor),A.setAttribute("material","strokeColor",g),d.on!==p.on&&this.updateEventListener(),void 0!==p.peekMode&&d.peekMode!==p.peekMode&&this.updatePeekMode(),d.image&&p.image!==d.image&&A.setAttribute("material","pano","string"==typeof d.image?d.image:d.image.src))},updatePeekMode:function(){var p=this.el,d=this.sphereEl;this.data.peekMode?(this.hideAll(),p.getObject3D("mesh").visible=!1,d.setAttribute("visible",!0)):(this.showAll(),p.getObject3D("mesh").visible=!0,d.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var p=this.el;p.isPlaying&&(this.removeEventListener(),p.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var p=this.data.on;p&&this.el.removeEventListener(p,this.navigate)},initVisualAspect:function(){var d,A,E,p=this.el;!this.data.visualAspectEnabled||this.visualAspectInitialized||(E=this.textEl=this.textEl||document.createElement("a-entity"),A=this.sphereEl=this.sphereEl||document.createElement("a-entity"),d=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),p.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),p.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),E.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),E.setAttribute("position","0 1.5 0"),p.appendChild(E),d.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),d.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),d.setAttribute("rotation","0 180 0"),d.setAttribute("position","0 0 0"),d.setAttribute("visible",!1),p.appendChild(d),A.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),A.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),A.setAttribute("visible",!1),p.appendChild(A),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:(p=new u.Vector3,d=new u.Vector3,A=new u.Quaternion,E=new u.Vector3,function(){var y,M,g=this.el,v=g.object3D,T=g.sceneEl.camera,_=this.textEl;if(this.data.visualAspectEnabled)if(v.updateMatrixWorld(),T.parent.updateMatrixWorld(),T.updateMatrixWorld(),v.matrix.decompose(d,A,E),d.setFromMatrixPosition(v.matrixWorld),p.setFromMatrixPosition(T.matrixWorld),(M=d.distanceTo(p))>20)this.previousQuaternion||(this.quaternionClone.copy(A),this.previousQuaternion=this.quaternionClone),v.lookAt(p);else{if(y=this.calculateCameraPortalOrientation(),M<.5){if(!0===this.semiSphereEl.getAttribute("visible"))return;_.setAttribute("text","width",1.5),y<=0?(_.setAttribute("position","0 0 0.75"),_.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(_.setAttribute("position","0 0 -0.75"),_.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),g.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=y}else _.setAttribute("rotation",y<=0?"0 180 0":"0 0 0"),_.setAttribute("text","width",5),_.setAttribute("position","0 1.5 0"),g.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(v.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}),hideAll:function(){var p=this.el,d=this.hiddenEls,A=this;d.length>0||p.sceneEl.object3D.traverse(function(E){E&&E.el&&E.el.hasAttribute("link-controls")||!E.el||E===p.sceneEl.object3D||E.el===p||E.el===A.sphereEl||E.el===p.sceneEl.cameraEl||!1===E.el.getAttribute("visible")||E.el===A.textEl||E.el===A.semiSphereEl||(E.el.setAttribute("visible",!1),d.push(E.el))})},showAll:function(){this.hiddenEls.forEach(function(p){p.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var p=new u.Matrix4,d=new u.Vector3,A=new u.Vector3(0,0,1),E=new u.Vector3(0,0,0);return function(){var g=this.el,v=g.sceneEl.camera;return d.set(0,0,0),A.set(0,0,1),E.set(0,0,0),g.object3D.matrixWorld.extractRotation(p),A.applyMatrix4(p),g.object3D.updateMatrixWorld(),g.object3D.localToWorld(E),v.parent.parent.updateMatrixWorld(),v.parent.updateMatrixWorld(),v.updateMatrixWorld(),v.localToWorld(d),d.sub(E).normalize(),A.normalize(),Math.sign(A.dot(d))}}(),remove:function(){this.removeEventListener()}}),c("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join("\n")})},{"../core/component":130,"../core/shader":140,"../lib/three":178}],89:[function(h,C,m){var A,s=h("../core/component").registerComponent,c=h("../lib/three"),u=h("../utils/"),p=u.bind,d=Math.PI/2;C.exports.Component=s("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new c.Vector3,this.hmdQuaternion=new c.Quaternion,this.magicWindowAbsoluteEuler=new c.Euler,this.magicWindowDeltaEuler=new c.Euler,this.position=new c.Vector3,this.magicWindowObject=new c.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new c.Vector3,rotation:new c.Euler},this.el.sceneEl.is("vr-mode")&&this.onEnterVR()},setupMagicWindowControls:function(){var A,E=this.data;u.device.isMobile()&&(A=this.magicWindowControls=new c.DeviceOrientationControls(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(A.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?A.enabled=E.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){A.enabled=E.magicWindowTrackingEnabled})))},update:function(A){var E=this.data;E.enabled!==A.enabled&&this.updateGrabCursor(E.enabled),A&&!E.magicWindowTrackingEnabled&&A.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=E.magicWindowTrackingEnabled),A&&!E.pointerLockEnabled!==A.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(A){this.data.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=p(this.onMouseDown,this),this.onMouseMove=p(this.onMouseMove,this),this.onMouseUp=p(this.onMouseUp,this),this.onTouchStart=p(this.onTouchStart,this),this.onTouchMove=p(this.onTouchMove,this),this.onTouchEnd=p(this.onTouchEnd,this),this.onEnterVR=p(this.onEnterVR,this),this.onExitVR=p(this.onExitVR,this),this.onPointerLockChange=p(this.onPointerLockChange,this),this.onPointerLockError=p(this.onPointerLockError,this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new c.Object3D,this.yawObject=new c.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var A=this.el.sceneEl,E=A.canvas;E?(E.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),E.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),A.addEventListener("enter-vr",this.onEnterVR),A.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))):A.addEventListener("render-target-loaded",p(this.addEventListeners,this))},removeEventListeners:function(){var A=this.el.sceneEl,E=A&&A.canvas;E&&(E.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),E.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),A.removeEventListener("enter-vr",this.onEnterVR),A.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:(A=new c.Matrix4,function(){var T,E=this.el.object3D,g=this.pitchObject,v=this.yawObject,y=this.el.sceneEl;y.is("vr-mode")&&y.checkHeadsetConnected()?y.hasWebXR&&(T=y.renderer.xr.getCameraPose())&&(A.elements=T.transform.matrix,A.decompose(E.position,E.rotation,E.scale)):(this.updateMagicWindowOrientation(),E.rotation.x=this.magicWindowDeltaEuler.x+g.rotation.x,E.rotation.y=this.magicWindowDeltaEuler.y+v.rotation.y,E.rotation.z=this.magicWindowDeltaEuler.z)}),updateMagicWindowOrientation:function(){var A=this.magicWindowAbsoluteEuler,E=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),A.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),!this.previousMagicWindowYaw&&0!==A.y&&(this.previousMagicWindowYaw=A.y),this.previousMagicWindowYaw&&(E.x=A.x,E.y+=A.y-this.previousMagicWindowYaw,E.z=A.z,this.previousMagicWindowYaw=A.y))},onMouseMove:function(A){var E,g,v,T=this.pitchObject,y=this.previousMouseEvent,M=this.yawObject;!this.data.enabled||!this.mouseDown&&!this.pointerLocked||(this.pointerLocked?(g=A.movementX||A.mozMovementX||0,v=A.movementY||A.mozMovementY||0):(g=A.screenX-y.screenX,v=A.screenY-y.screenY),this.previousMouseEvent.screenX=A.screenX,this.previousMouseEvent.screenY=A.screenY,M.rotation.y+=.002*g*(E=this.data.reverseMouseDrag?1:-1),T.rotation.x+=.002*v*E,T.rotation.x=Math.max(-d,Math.min(d,T.rotation.x)))},onMouseDown:function(A){var E=this.el.sceneEl;if(this.data.enabled&&this.data.mouseEnabled&&(!E.is("vr-mode")||!E.checkHeadsetConnected())&&0===A.button){var g=E&&E.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=A.screenX,this.previousMouseEvent.screenY=A.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(g.requestPointerLock?g.requestPointerLock():g.mozRequestPointerLock&&g.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(A){1!==A.touches.length||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||(this.touchStart={x:A.touches[0].pageX,y:A.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(A){var v;!this.touchStarted||!this.data.touchEnabled||(v=2*Math.PI*(A.touches[0].pageX-this.touchStart.x)/this.el.sceneEl.canvas.clientWidth,this.yawObject.rotation.y-=.5*v*(this.data.reverseTouchDrag?1:-1),this.touchStart={x:A.touches[0].pageX,y:A.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var A=this.el.sceneEl;A.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),A.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(A){var E=this.el.sceneEl;function g(){E.canvas.classList.add("a-grab-cursor")}function v(){E.canvas.classList.remove("a-grab-cursor")}E.canvas?A?g():v():E.addEventListener("render-target-loaded",A?g:v)},saveCameraPose:function(){var A=this.el;this.savedPose.position.copy(A.object3D.position),this.savedPose.rotation.copy(A.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var A=this.el,E=this.savedPose;this.hasSavedPose&&(A.object3D.position.copy(E.position),A.object3D.rotation.copy(E.rotation),this.hasSavedPose=!1)}})},{"../core/component":130,"../lib/three":178,"../utils/":204}],90:[function(h,C,m){var s=h("../utils/bind"),c=h("../core/component").registerComponent,u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,v="magicleap-one";C.exports.Component=c("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]},init:function(){var M=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=s(this.onButtonChanged,this),this.onButtonDown=function(_){A(_.detail.id,"down",M)},this.onButtonUp=function(_){A(_.detail.id,"up",M)},this.onButtonTouchEnd=function(_){A(_.detail.id,"touchend",M)},this.onButtonTouchStart=function(_){A(_.detail.id,"touchstart",M)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var M=this.data;this.controllerIndex="right"===M.hand?0:"left"===M.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=s(this.onModelLoaded,this),this.onControllersUpdate=s(this.onControllersUpdate,this),this.checkIfControllerPresent=s(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=s(this.removeControllersUpdateListener,this),this.onAxisMoved=s(this.onAxisMoved,this)},addEventListeners:function(){var M=this.el;M.addEventListener("buttonchanged",this.onButtonChanged),M.addEventListener("buttondown",this.onButtonDown),M.addEventListener("buttonup",this.onButtonUp),M.addEventListener("touchstart",this.onButtonTouchStart),M.addEventListener("touchend",this.onButtonTouchEnd),M.addEventListener("axismove",this.onAxisMoved),M.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var M=this.el;M.removeEventListener("buttonchanged",this.onButtonChanged),M.removeEventListener("buttondown",this.onButtonDown),M.removeEventListener("buttonup",this.onButtonUp),M.removeEventListener("touchstart",this.onButtonTouchStart),M.removeEventListener("touchend",this.onButtonTouchEnd),M.removeEventListener("axismove",this.onAxisMoved),M.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){p(this,v,{index:this.controllerIndex,hand:this.data.hand})},injectTrackedControls:function(){var _=this.data;this.el.setAttribute("tracked-controls",{idPrefix:v,hand:_.hand,controller:this.controllerIndex,orientationOffset:_.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/magicleap/magicleap-one-controller.glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(M){var _=this.mapping.buttons[M.detail.id];_&&("trigger"===_&&console.log("analog value of trigger press: "+M.detail.state.value),this.el.emit(_+"changed",M.detail.state))},onModelLoaded:function(M){M.detail.model.scale.set(.01,.01,.01)},onAxisMoved:function(M){d(this,this.mapping.axes,M)},updateModel:function(M,_){},setButtonColor:function(M,_){}})},{"../core/component":130,"../utils/bind":198,"../utils/tracked-controls":213}],91:[function(h,C,m){var s=h("../utils/"),c=h("../core/component"),u=h("../lib/three"),p=h("../core/shader"),d=s.debug("components:material:error"),E=p.shaders;function M(_,O){_.dispose(),O.unregisterMaterial(_)}C.exports.Component=(0,c.registerComponent)("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:p.shaderNames,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColors:{type:"string",default:"none",oneOf:["face","vertex"]},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0}},init:function(){this.material=null},update:function(_){var O=this.data;(!this.shader||O.shader!==_.shader)&&this.updateShader(O.shader),this.shader.update(this.data),this.updateMaterial(_)},updateSchema:function(_){var O,D,B,H;O=this.oldData&&this.oldData.shader,(B=E[H=(D=_&&_.shader)||O]&&E[H].schema)||d("Unknown shader schema "+H),(!O||D!==O)&&(this.extendSchema(B),this.updateBehavior())},updateBehavior:function(){var _,H,O=this.el.sceneEl,D=this.schema,B=this;function q(V,ne){var ae;for(ae in H)H[ae]=V;B.shader.update(H)}for(_ in this.tick=void 0,H={},D)"time"===D[_].type&&(this.tick=q,H[_]=!0);O&&(this.tick?O.addBehavior(this):O.removeBehavior(this))},updateShader:function(_){var B,O=this.data,D=E[_]&&E[_].Shader;if(!D)throw new Error("Unknown shader "+_);(B=this.shader=new D).el=this.el,B.init(O),this.setMaterial(B.material),this.updateSchema(O)},updateMaterial:function(_){var B,O=this.data,D=this.material;for(B in D.alphaTest=O.alphaTest,D.depthTest=!1!==O.depthTest,D.depthWrite=!1!==O.depthWrite,D.opacity=O.opacity,D.flatShading=O.flatShading,D.side=function v(_){switch(_){case"back":return u.BackSide;case"double":return u.DoubleSide;default:return u.FrontSide}}(O.side),D.transparent=!1!==O.transparent||O.opacity<1,D.vertexColors=function T(_){switch(_){case"face":return u.FaceColors;case"vertex":return u.VertexColors;default:return u.NoColors}}(O.vertexColors),D.visible=O.visible,D.blending=function y(_){switch(_){case"none":return u.NoBlending;case"additive":return u.AdditiveBlending;case"subtractive":return u.SubtractiveBlending;case"multiply":return u.MultiplyBlending;default:return u.NormalBlending}}(O.blending),D.dithering=O.dithering,_)break;B&&(_.alphaTest!==O.alphaTest||_.side!==O.side||_.vertexColors!==O.vertexColors)&&(D.needsUpdate=!0)},remove:function(){var _=new u.MeshBasicMaterial,O=this.material,D=this.el.getObject3D("mesh");D&&(D.material=_),M(O,this.system)},setMaterial:function(_){var D,O=this.el,B=this.system;this.material&&M(this.material,B),this.material=_,B.registerMaterial(_),(D=O.getObject3D("mesh"))?D.material=_:O.addEventListener("object3dset",function H(q){"mesh"!==q.detail.type||q.target!==O||(O.getObject3D("mesh").material=_,O.removeEventListener("object3dset",H))})}})},{"../core/component":130,"../core/shader":140,"../lib/three":178,"../utils/":204}],92:[function(h,C,m){var s=h("../utils/debug"),c=h("../core/component").registerComponent,u=h("../lib/three"),p=s("components:obj-model:warn");C.exports.Component=c("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var d=this;this.model=null,this.objLoader=new u.OBJLoader,this.mtlLoader=new u.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(A){d.model&&"material"===A.detail.name&&d.applyMaterial()})},update:function(){var d=this.data;d.obj&&(this.resetMesh(),this.loadObj(d.obj,d.mtl))},remove:function(){this.model&&this.resetMesh()},resetMesh:function(){this.el.removeObject3D("mesh")},loadObj:function(d,A){var E=this,g=this.el,v=this.mtlLoader,T=this.objLoader,y=this.el.sceneEl.systems.renderer,M=A.substr(0,A.lastIndexOf("/")+1);if(A)return g.hasAttribute("material")&&p("Material component properties are ignored when a .MTL is provided"),v.setResourcePath(M),void v.load(A,function(_){_.preload(),T.setMaterials(_),T.load(d,function(O){E.model=O,E.model.traverse(function(D){if(D.isMesh){var B=D.material;B.color&&y.applyColorCorrection(B.color),B.map&&y.applyColorCorrection(B.map),B.emissive&&y.applyColorCorrection(B.emissive),B.emissiveMap&&y.applyColorCorrection(B.emissiveMap)}}),g.setObject3D("mesh",O),g.emit("model-loaded",{format:"obj",model:O})})});T.load(d,function(O){E.model=O,E.applyMaterial(),g.setObject3D("mesh",O),g.emit("model-loaded",{format:"obj",model:O})})},applyMaterial:function(){var d=this.el.components.material;d&&this.model.traverse(function(A){A instanceof u.Mesh&&(A.material=d.material)})}})},{"../core/component":130,"../lib/three":178,"../utils/debug":200}],93:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,E=h("../utils/").device.isWebXRAvailable,y=E?"oculus-go":"Oculus Go";C.exports.Component=s("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:E?{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=c(this.onModelLoaded,this),this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this),this.onAxisMoved=c(this.onAxisMoved,this)},init:function(){var D=this;this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(B){A(B.detail.id,"down",D)},this.onButtonUp=function(B){A(B.detail.id,"up",D)},this.onButtonTouchStart=function(B){A(B.detail.id,"touchstart",D)},this.onButtonTouchEnd=function(B){A(B.detail.id,"touchend",D)},this.controllerPresent=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var D=this.el;D.addEventListener("buttonchanged",this.onButtonChanged),D.addEventListener("buttondown",this.onButtonDown),D.addEventListener("buttonup",this.onButtonUp),D.addEventListener("touchstart",this.onButtonTouchStart),D.addEventListener("touchend",this.onButtonTouchEnd),D.addEventListener("model-loaded",this.onModelLoaded),D.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var D=this.el;D.removeEventListener("buttonchanged",this.onButtonChanged),D.removeEventListener("buttondown",this.onButtonDown),D.removeEventListener("buttonup",this.onButtonUp),D.removeEventListener("touchstart",this.onButtonTouchStart),D.removeEventListener("touchend",this.onButtonTouchEnd),D.removeEventListener("model-loaded",this.onModelLoaded),D.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){p(this,y,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var B=this.data;this.el.setAttribute("tracked-controls",{armModel:B.armModel,hand:B.hand,idPrefix:y,orientationOffset:B.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/oculus/go/oculus-go-controller.gltf")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(D){var H,B=D.detail.model;this.data.model&&((H=this.buttonMeshes={}).trigger=B.getObjectByName("oculus_go_button_trigger"),H.trackpad=B.getObjectByName("oculus_go_touchpad"),H.touchpad=B.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(D){var B=this.mapping.buttons[D.detail.id];B&&this.el.emit(B+"changed",D.detail.state)},onAxisMoved:function(D){d(this,this.mapping.axes,D)},updateModel:function(D,B){this.data.model&&this.updateButtonModel(D,B)},updateButtonModel:function(D,B){var H=this.buttonMeshes;if(H&&H[D]){var q,V;switch(B){case"down":q=this.data.buttonHighlightColor;break;case"touchstart":q=this.data.buttonTouchedColor;break;default:q=this.data.buttonColor}(V=H[D]).material.color.set(q),this.rendererSystem.applyColorCorrection(V.material.color)}}})},{"../core/component":130,"../utils/":204,"../utils/bind":198,"../utils/tracked-controls":213}],94:[function(h,C,m){var s=h("../utils/bind"),c=h("../core/component").registerComponent,u=h("../lib/three"),p=h("../utils/tracked-controls"),d=p.checkControllerPresentAndSetup,A=p.emitIfAxesChanged,E=p.onButtonEvent,g=h("../utils/").device.isWebXRAvailable,v="oculus-touch",y=g?v:"Oculus Touch",M="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-",_={left:{modelUrl:M+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new u.Vector3(-.005,.003,-.055),modelPivotRotation:new u.Euler(0,0,0)},right:{modelUrl:M+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new u.Vector3(.005,.003,-.055),modelPivotRotation:new u.Euler(0,0,0)}},O={left:{modelUrl:M+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new u.Vector3(-.005,.036,-.037),modelPivotRotation:new u.Euler(Math.PI/4.5,0,0)},right:{modelUrl:M+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new u.Vector3(.005,.036,-.037),modelPivotRotation:new u.Euler(Math.PI/4.5,0,0)}},B="oculus-touch",H={"oculus-touch":g?O:_,"oculus-touch-v2":{left:{modelUrl:M+"gen2-left.gltf",rayOrigin:{origin:{x:-.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new u.Vector3(0,0,0),modelPivotRotation:new u.Euler(0,0,0)},right:{modelUrl:M+"gen2-right.gltf",rayOrigin:{origin:{x:.01,y:0,z:-.02},direction:{x:0,y:-.5,z:-1}},modelPivotOffset:new u.Vector3(0,0,0),modelPivotRotation:new u.Euler(0,0,0)}},"oculus-touch-v3":{left:{modelUrl:M+"v3-left.glb",rayOrigin:{origin:{x:.015,y:.005,z:0},direction:{x:0,y:0,z:-1}},modelPivotOffset:new u.Vector3(.01,-.01,.05),modelPivotRotation:new u.Euler(Math.PI/4,0,0)},right:{modelUrl:M+"v3-right.glb",rayOrigin:{origin:{x:-.015,y:.005,z:0},direction:{x:0,y:0,z:-1}},modelPivotOffset:new u.Vector3(-.01,-.01,.05),modelPivotRotation:new u.Euler(Math.PI/4,0,0)}}};C.exports.Component=c("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},mapping:g?{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}}:{left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},bindMethods:function(){this.onModelLoaded=s(this.onModelLoaded,this),this.onControllersUpdate=s(this.onControllersUpdate,this),this.checkIfControllerPresent=s(this.checkIfControllerPresent,this),this.onAxisMoved=s(this.onAxisMoved,this)},init:function(){var ae=this;this.onButtonChanged=s(this.onButtonChanged,this),this.onButtonDown=function(fe){E(fe.detail.id,"down",ae,ae.data.hand)},this.onButtonUp=function(fe){E(fe.detail.id,"up",ae,ae.data.hand)},this.onButtonTouchStart=function(fe){E(fe.detail.id,"touchstart",ae,ae.data.hand)},this.onButtonTouchEnd=function(fe){E(fe.detail.id,"touchend",ae,ae.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var ae=this.el;ae.addEventListener("buttonchanged",this.onButtonChanged),ae.addEventListener("buttondown",this.onButtonDown),ae.addEventListener("buttonup",this.onButtonUp),ae.addEventListener("touchstart",this.onButtonTouchStart),ae.addEventListener("touchend",this.onButtonTouchEnd),ae.addEventListener("axismove",this.onAxisMoved),ae.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var ae=this.el;ae.removeEventListener("buttonchanged",this.onButtonChanged),ae.removeEventListener("buttondown",this.onButtonDown),ae.removeEventListener("buttonup",this.onButtonUp),ae.removeEventListener("touchstart",this.onButtonTouchStart),ae.removeEventListener("touchend",this.onButtonTouchEnd),ae.removeEventListener("axismove",this.onAxisMoved),ae.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){d(this,y,{hand:this.data.hand})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(ae){var he,fe=this.data;if(fe.model){if(this.displayModel=H[fe.controllerType]||H[B],"auto"===fe.controllerType){var me=this.el.sceneEl.systems["tracked-controls-webvr"];me&&me.vrDisplay?/^Oculus Quest$/.test(me.vrDisplay.displayName)&&(this.displayModel=H["oculus-touch-v2"]):(he=B,he=-1!==ae.profiles.indexOf("oculus-touch-v2")?"oculus-touch-v2":he,he=-1!==ae.profiles.indexOf("oculus-touch-v3")?"oculus-touch-v3":he,this.displayModel=H[he])}this.el.setAttribute("gltf-model",this.displayModel[fe.hand].modelUrl)}},injectTrackedControls:function(ae){var fe=this.data;this.el.setAttribute("tracked-controls",{id:g?v:"right"===fe.hand?"Oculus Touch (Right)":"Oculus Touch (Left)",hand:fe.hand,orientationOffset:fe.orientationOffset,handTrackingEnabled:!1}),this.loadModel(ae)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(ae){var me,fe=this.mapping[this.data.hand].buttons[ae.detail.id],he=this.buttonMeshes;fe&&(("trigger"===fe||"grip"===fe)&&(me=ae.detail.state.value),he&&("trigger"===fe&&he.trigger&&(he.trigger.rotation.x=this.originalXRotationTrigger-me*(Math.PI/26)),"grip"===fe&&he.grip&&(he.grip.position.x=this.originalXPositionGrip+("left"===this.data.hand?-1:1)*me*.004)),this.el.emit(fe+"changed",ae.detail.state))},onModelLoaded:function(ae){var he,fe=this.controllerObject3D=ae.detail.model;this.data.model&&((he=this.buttonMeshes={}).grip=fe.getObjectByName("buttonHand"),this.originalXPositionGrip=he.grip&&he.grip.position.x,he.thumbstick=fe.getObjectByName("stick"),he.trigger=fe.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=he.trigger&&he.trigger.rotation.x,he.xbutton=fe.getObjectByName("buttonX"),he.abutton=fe.getObjectByName("buttonA"),he.ybutton=fe.getObjectByName("buttonY"),he.bbutton=fe.getObjectByName("buttonB"),fe.position.copy(this.displayModel[this.data.hand].modelPivotOffset),fe.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin}))},onAxisMoved:function(ae){A(this,this.mapping[this.data.hand].axes,ae)},updateModel:function(ae,fe){this.data.model&&this.updateButtonModel(ae,fe)},updateButtonModel:function(ae,fe){var he,P=this.buttonMeshes;this.data.model&&P&&P[ae]&&((he=P[ae]).material.color.set("up"===fe||"touchend"===fe?this.data.buttonColor:"touchstart"===fe?this.data.buttonTouchColor:this.data.buttonHighlightColor),this.rendererSystem.applyColorCorrection(he.material.color))}})},{"../core/component":130,"../lib/three":178,"../utils/":204,"../utils/bind":198,"../utils/tracked-controls":213}],95:[function(h,C,m){var s=h("../core/component").registerComponent;C.exports.Component=s("position",{schema:{type:"vec3"},update:function(){var u=this.data;this.el.object3D.position.set(u.x,u.y,u.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},{"../core/component":130}],96:[function(h,C,m){var v,T,s=h("../core/component").registerComponent,c=h("../lib/three"),p=h("../utils/").debug("components:raycaster:warn"),d=/^[\w\s-.,[\]#]*$/,A={childList:!0,attributes:!0,subtree:!0};function g(v,T){var y;for(v.length=T.length,y=0;y<T.length;y++)v[y]=T[y]}C.exports.Component=s("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new c.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new c.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new c.Vector3,this.otherLineEndVec3=new c.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(v){var T=this.data,y=this.el,M=this.raycaster;M.far=T.far,M.near=T.near,T.showLine&&(T.far!==v.far||T.origin!==v.origin||T.direction!==v.direction||!v.showLine)&&(this.unitLineEndVec3.copy(T.origin).add(T.direction).normalize(),this.drawLine()),!T.showLine&&v.showLine&&y.removeAttribute("line"),T.objects!==v.objects&&!d.test(T.objects)&&p('[raycaster] Selector "'+T.objects+'" may not update automatically with DOM changes.'),T.objects||p('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),T.autoRefresh!==v.autoRefresh&&y.isPlaying&&(T.autoRefresh?this.addEventListeners():this.removeEventListeners()),v.enabled&&!T.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,A),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var T,v=this.data;T=this.el.sceneEl.querySelectorAll(v.objects?v.objects:"*"),this.objects=this.flattenObject3DMaps(T),this.dirty=!1},tock:function(v){var T=this.data,y=this.prevCheckTime;T.enabled&&(y&&v-y<T.interval||(this.prevCheckTime=v,this.checkIntersections()))},checkIntersections:function(){var M,O,v=this.clearedIntersectedEls,T=this.el,y=this.data,_=this.intersectedEls,D=this.intersections,B=this.newIntersectedEls,H=this.newIntersections,q=this.prevIntersectedEls,V=this.rawIntersections;for(this.dirty&&this.refreshObjects(),g(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),V.length=0,this.raycaster.intersectObjects(this.objects,!0,V),D.length=0,_.length=0,M=0;M<V.length;M++)O=V[M],(!y.showLine||O.object!==T.getObject3D("line"))&&O.object.el&&(D.push(O),_.push(O.object.el));for(H.length=0,B.length=0,M=0;M<D.length;M++)-1===q.indexOf(D[M].object.el)&&(H.push(D[M]),B.push(D[M].object.el));for(v.length=0,M=0;M<q.length;M++)-1===_.indexOf(q[M])&&(q[M].emit("raycaster-intersected-cleared",this.intersectedClearedDetail),v.push(q[M]));for(v.length&&T.emit("raycaster-intersection-cleared",this.intersectionClearedDetail),M=0;M<B.length;M++)B[M].emit("raycaster-intersected",this.intersectedDetail);H.length&&(this.intersectionDetail.els=B,this.intersectionDetail.intersections=H,T.emit("raycaster-intersection",this.intersectionDetail)),y.showLine&&setTimeout(this.updateLine)},updateLine:function(){var y,T=this.intersections;T.length&&(y=T[0].object.el===this.el&&T[1]?T[1].distance:T[0].distance),this.drawLine(y)},getIntersection:function(v){var T,y;for(T=0;T<this.intersections.length;T++)if((y=this.intersections[T]).object.el===v)return y;return null},updateOriginDirection:(v=new c.Vector3,T=new c.Vector3,function(){var M=this.el,_=this.data;_.useWorldCoordinates?this.raycaster.set(_.origin,_.direction):(M.object3D.updateMatrixWorld(),T.setFromMatrixPosition(M.object3D.matrixWorld),(0!==_.origin.x||0!==_.origin.y||0!==_.origin.z)&&(T=M.object3D.localToWorld(T.copy(_.origin))),v.copy(_.direction).transformDirection(M.object3D.matrixWorld).normalize(),this.raycaster.set(T,v))}),drawLine:function(v){var M,T=this.data,y=this.el;M=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,void 0===v&&(v=T.far===1/0?1e3:T.far),this.lineData.start=T.origin,this.lineData.end=M.copy(this.unitLineEndVec3).multiplyScalar(v),this.lineData.color=T.lineColor,y.setAttribute("line",this.lineData)},flattenObject3DMaps:function(v){var T,y,M=this.objects;for(M.length=0,y=0;y<v.length;y++)if(v[y].isEntity&&v[y].object3D)for(T in v[y].object3DMap)M.push(v[y].getObject3D(T));return M},clearAllIntersections:function(){var v;for(v=0;v<this.intersectedEls.length;v++)this.intersectedEls[v].emit("raycaster-intersected-cleared",this.intersectedClearedDetail);g(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit("raycaster-intersection-cleared",this.intersectionClearedDetail)}})},{"../core/component":130,"../lib/three":178,"../utils/":204}],97:[function(h,C,m){var s=h("../lib/three").Math.degToRad,c=h("../core/component").registerComponent;C.exports.Component=c("rotation",{schema:{type:"vec3"},update:function(){var u=this.data,p=this.el.object3D;p.rotation.set(s(u.x),s(u.y),s(u.z)),p.rotation.order="YXZ"},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},{"../core/component":130,"../lib/three":178}],98:[function(h,C,m){var s=h("../core/component").registerComponent,c=1e-5;C.exports.Component=s("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var u=this.data;this.el.object3D.scale.set(0===u.x?c:u.x,0===u.y?c:u.y,0===u.z?c:u.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},{"../core/component":130}],99:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../core/component").components;C.exports.Component=s("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},update:function(){var u=this.data;this.el.object3D.background=u.transparent?null:new THREE.Color(u.color)},remove:function(){this.el.object3D.background=this.data.transparent?null:c[this.name].schema.color.default}})},{"../../core/component":130}],100:[function(h,C,m){var s=h("../../core/component").registerComponent;C.exports.Component=s("debug",{schema:{default:!0}})},{"../../core/component":130}],101:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../utils/"),u=c.bind,p=h("../../constants/"),v="a-dialog-buttons-container",T="a-dialog-button";function D(H,q,V){var ne,ae;return(ne=document.createElement("div")).classList.add(v),(ae=document.createElement("button")).classList.add(T,"a-dialog-ok-button"),ae.setAttribute(p.AFRAME_INJECTED,""),ae.innerHTML=H,ne.appendChild(ae),ae.addEventListener("click",function(fe){fe.stopPropagation(),V()}),B(q,ne)}function B(H,q){var V,ne,ae,fe;return(V=document.createElement("div")).classList.add("a-modal"),V.setAttribute(p.AFRAME_INJECTED,""),(ne=document.createElement("div")).className="a-dialog",ne.setAttribute(p.AFRAME_INJECTED,""),V.appendChild(ne),(ae=document.createElement("div")).classList.add("a-dialog-text-container"),ne.appendChild(ae),(fe=document.createElement("div")).classList.add("a-dialog-text"),fe.innerHTML=H,ae.appendChild(fe),ne.appendChild(q),V}C.exports.Component=s("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},mobileDesktopMessage:{default:"Set your browser to request the mobile version of the site and reload the page to enjoy immersive mode."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},init:function(){var H=this;if(this.data.enabled){if("localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&"http:"===location.protocol&&this.showHTTPAlert(),c.device.isMobileDeviceRequestingDesktopSite())return void this.showMobileDesktopModeAlert();if(typeof DeviceOrientationEvent>"u"||!DeviceOrientationEvent.requestPermission)return void(this.permissionGranted=!0);this.onDeviceMotionDialogAllowClicked=u(this.onDeviceMotionDialogAllowClicked,this),this.onDeviceMotionDialogDenyClicked=u(this.onDeviceMotionDialogDenyClicked,this),DeviceOrientationEvent.requestPermission().catch(function(){H.devicePermissionDialogEl=function O(H,q,V,ne,ae){var fe,he,me;return(fe=document.createElement("div")).classList.add(v),(he=document.createElement("button")).classList.add(T,"a-dialog-deny-button"),he.setAttribute(p.AFRAME_INJECTED,""),he.innerHTML=H,fe.appendChild(he),(me=document.createElement("button")).classList.add(T,"a-dialog-allow-button"),me.setAttribute(p.AFRAME_INJECTED,""),me.innerHTML=q,fe.appendChild(me),me.addEventListener("click",function(P){P.stopPropagation(),ne()}),he.addEventListener("click",function(P){P.stopPropagation(),ae()}),B(V,fe)}(H.data.denyButtonText,H.data.allowButtonText,H.data.deviceMotionMessage,H.onDeviceMotionDialogAllowClicked,H.onDeviceMotionDialogDenyClicked),H.el.appendChild(H.devicePermissionDialogEl)}).then(function(){H.el.emit("deviceorientationpermissiongranted"),H.permissionGranted=!0})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showMobileDesktopModeAlert:function(){var H=this,q=D(H.data.cancelButtonText,H.data.mobileDesktopMessage,function(){H.el.removeChild(q)});this.el.appendChild(q)},showHTTPAlert:function(){var H=this,q=D(H.data.cancelButtonText,H.data.httpsMessage,function(){H.el.removeChild(q)});this.el.appendChild(q)},onDeviceMotionDialogAllowClicked:function(){var H=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(q){"granted"===q?(H.el.emit("deviceorientationpermissiongranted"),H.permissionGranted=!0):H.el.emit("deviceorientationpermissionrejected"),H.remove()}).catch(console.error)}})},{"../../constants/":122,"../../core/component":130,"../../utils/":204}],102:[function(h,C,m){var s=h("../../core/component").registerComponent;C.exports.Component=s("embedded",{dependencies:["vr-mode-ui"],schema:{default:!0},update:function(){var c=this.el,u=c.querySelector(".a-enter-vr");!0===this.data?(u&&u.classList.add("embedded"),c.removeFullScreenStyles()):(u&&u.classList.remove("embedded"),c.addFullScreenStyles())}})},{"../../core/component":130}],103:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../lib/three"),p=h("../../utils/debug")("components:fog:warn");C.exports.Component=s("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},update:function(){var A=this.data,E=this.el,g=this.el.object3D.fog;if(E.isScene)return g&&A.type===g.name?void Object.keys(this.schema).forEach(function(v){var T=A[v];"color"===v&&(T=new c.Color(T)),g[v]=T}):(E.object3D.fog=function d(A){var E;return(E="exponential"===A.type?new c.FogExp2(A.color,A.density):new c.Fog(A.color,A.near,A.far)).name=A.type,E}(A),void E.systems.material.updateMaterials());p("Fog component can only be applied to <a-scene>")},remove:function(){var A=this.el.object3D.fog;A&&(A.far=0,A.near=.1)}})},{"../../core/component":130,"../../lib/three":178,"../../utils/debug":200}],104:[function(h,C,m){(function(s){var c=h("../../constants").AFRAME_INJECTED,u=h("../../../package"),p=h("../../core/component").registerComponent,d=h("../../utils/"),g="https://unpkg.com/aframe-inspector@"+function A(M){var _=M.split(".");return _[2]="x",_.join(".")}(u.version)+"/dist/aframe-inspector.min.js";C.exports.Component=p("inspector",{schema:{url:{default:"dev"===s.env.INSPECTOR_VERSION?"https://aframe.io/aframe-inspector/dist/aframe-inspector.js":g}},init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var M;this.firstPlay&&"false"!==(M=d.getUrlParameter("inspector"))&&M&&(this.openInspector(),this.firstPlay=!1)},initOverlay:function(){this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML='Loading Inspector<span class="dots"><span>.</span><span>.</span><span>.</span></span>'},remove:function(){this.removeEventListeners()},onKeydown:function(M){73===M.keyCode&&M.ctrlKey&&M.altKey&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(M){"INJECT_AFRAME_INSPECTOR"===M.data&&this.openInspector()},openInspector:function(M){var O,_=this;AFRAME.INSPECTOR||AFRAME.inspectorInjected?AFRAME.INSPECTOR.open(M):(this.showLoader(),(O=document.createElement("script")).src=this.data.url,O.setAttribute("data-name","aframe-inspector"),O.setAttribute(c,""),O.onload=function(){AFRAME.INSPECTOR.open(M),_.hideLoader(),_.removeEventListeners()},O.onerror=function(){_.loadingMessageEl.innerHTML="Error loading Inspector"},document.head.appendChild(O),AFRAME.inspectorInjected=!0)},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})}).call(this,h("_process"))},{"../../../package":72,"../../constants":122,"../../core/component":130,"../../utils/":204,_process:49}],105:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../utils/").shouldCaptureKeyEvent;C.exports.Component=s("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(u){this.enterVREnabled=this.data.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(u){var p=this.el;c(u)&&(this.enterVREnabled&&70===u.keyCode&&p.enterVR(),this.enterVREnabled&&27===u.keyCode&&p.exitVR())}})},{"../../core/component":130,"../../utils/":204}],106:[function(h,C,m){var s=h("../../utils/debug"),c=h("../../core/component").registerComponent,u=s("components:pool:warn");C.exports.Component=c("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},multiple:!0,initPool:function(){var p;for(this.availableEls=[],this.usedEls=[],this.data.mixin||u("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||u("Container "+this.data.container+" not found.")),this.container=this.container||this.el,p=0;p<this.data.size;++p)this.createEntity()},update:function(p){var d=this.data;(p.mixin!==d.mixin||p.size!==d.size)&&this.initPool()},createEntity:function(){var p;(p=document.createElement("a-entity")).play=this.wrapPlay(p.play),p.setAttribute("mixin",this.data.mixin),p.object3D.visible=!1,p.pause(),this.container.appendChild(p),this.availableEls.push(p)},wrapPlay:function(p){var d=this.usedEls;return function(){-1!==d.indexOf(this)&&p.call(this)}},requestEntity:function(){var p;if(0===this.availableEls.length){if(!1===this.data.dynamic)return void u("Requested entity from empty pool: "+this.attrName);u("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName),this.createEntity()}return p=this.availableEls.shift(),this.usedEls.push(p),p.object3D.visible=!0,p},returnEntity:function(p){var d=this.usedEls.indexOf(p);if(-1!==d)return this.usedEls.splice(d,1),this.availableEls.push(p),p.object3D.visible=!1,p.pause(),p;u("The returned entity was not previously pooled from "+this.attrName)}})},{"../../core/component":130,"../../utils/debug":200}],107:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../lib/three"),u=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),p=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join("\n");C.exports.Component=s("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},init:function(){var d=this.el,A=this;function E(){var g=d.renderer.getContext();g&&(A.cubeMapSize=g.getParameter(g.MAX_CUBE_MAP_TEXTURE_SIZE),A.material=new c.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:u,fragmentShader:p,side:c.DoubleSide}),A.quad=new c.Mesh(new c.PlaneBufferGeometry(1,1),A.material),A.quad.visible=!1,A.camera=new c.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),A.canvas=document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),d.object3D.add(A.quad),A.onKeyDown=A.onKeyDown.bind(A))}d.renderer?E():d.addEventListener("render-target-loaded",E)},getRenderTarget:function(d,A){return new c.WebGLRenderTarget(d,A,{minFilter:c.LinearFilter,magFilter:c.LinearFilter,wrapS:c.ClampToEdgeWrapping,wrapT:c.ClampToEdgeWrapping,format:c.RGBAFormat,type:c.UnsignedByteType})},resize:function(d,A){this.quad.scale.set(d,A,1),this.camera.left=-1*d/2,this.camera.right=d/2,this.camera.top=A/2,this.camera.bottom=-1*A/2,this.camera.updateProjectionMatrix(),this.canvas.width=d,this.canvas.height=A},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(d){this.data&&83===d.keyCode&&d.ctrlKey&&d.altKey&&this.capture(d.shiftKey?"equirectangular":"perspective")},setCapture:function(d){var E,g,v,T,A=this.el;return"perspective"===d?(this.quad.visible=!1,g=this.data.camera&&this.data.camera.components.camera.camera||A.camera,E={width:this.data.width,height:this.data.height}):(g=this.camera,T=new c.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:c.RGBFormat,generateMipmaps:!0,minFilter:c.LinearMipmapLinearFilter,encoding:c.sRGBEncoding}),v=new c.CubeCamera(A.camera.near,A.camera.far,T),A.camera.getWorldPosition(v.position),A.camera.getWorldQuaternion(v.quaternion),v.update(A.renderer,A.object3D),this.quad.material.uniforms.map.value=v.renderTarget.texture,E={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:g,size:E,projection:d}},capture:function(d){var g,A=this.el.renderer.xr.enabled,E=this.el.renderer;E.xr.enabled=!1,g=this.setCapture(d),this.renderCapture(g.camera,g.size,g.projection),this.saveCapture(),E.xr.enabled=A},getCanvas:function(d){var A=this.el.renderer.xr.enabled,E=this.el.renderer,g=this.setCapture(d);return E.xr.enabled=!1,this.renderCapture(g.camera,g.size,g.projection),E.xr.enabled=A,this.canvas},renderCapture:function(d,A,E){var T,y,M,g=this.el.renderer.autoClear,v=this.el,_=v.renderer;y=this.getRenderTarget(A.width,A.height),M=new Uint8Array(4*A.width*A.height),this.resize(A.width,A.height),_.autoClear=!0,_.clear(),_.setRenderTarget(y),_.render(v.object3D,d),_.autoClear=g,_.readRenderTargetPixels(y,0,0,A.width,A.height,M),_.setRenderTarget(null),"perspective"===E&&(M=this.flipPixelsVertically(M,A.width,A.height)),T=new ImageData(new Uint8ClampedArray(M),A.width,A.height),this.quad.visible=!1,this.ctx.putImageData(T,0,0)},flipPixelsVertically:function(d,A,E){for(var g=d.slice(0),v=0;v<A;++v)for(var T=0;T<E;++T)g[4*v+T*A*4]=d[4*v+(E-T)*A*4],g[4*v+1+T*A*4]=d[4*v+1+(E-T)*A*4],g[4*v+2+T*A*4]=d[4*v+2+(E-T)*A*4],g[4*v+3+T*A*4]=d[4*v+3+(E-T)*A*4];return g},saveCapture:function(){this.canvas.toBlob(function(d){var A="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",E=document.createElement("a"),g=URL.createObjectURL(d);E.href=g,E.setAttribute("download",A),E.innerHTML="downloading...",E.style.display="none",document.body.appendChild(E),setTimeout(function(){E.click(),document.body.removeChild(E)},1)},"image/png")}})},{"../../core/component":130,"../../lib/three":178}],108:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../../vendor/rStats"),u=h("../../utils");h("../../../vendor/rStats.extras"),h("../../lib/rStatsAframe");var p=window.aframeStats,d=u.bind,A="a-hidden",E=window.threeStats;C.exports.Component=s("stats",{schema:{default:!0},init:function(){var v=this.el;"false"!==u.getUrlParameter("stats")&&(this.stats=function g(v){var T=new E(v.renderer),y=new p(v);return new c({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:v.isMobile?[]:[T,y]})}(v),this.statsEl=document.querySelector(".rs-base"),this.hideBound=d(this.hide,this),this.showBound=d(this.show,this),v.addEventListener("enter-vr",this.hideBound),v.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var v=this.stats;v&&(v("rAF").tick(),v("FPS").frame(),v().update())},hide:function(){this.statsEl.classList.add(A)},show:function(){this.statsEl.classList.remove(A)}})},{"../../../vendor/rStats":216,"../../../vendor/rStats.extras":215,"../../core/component":130,"../../lib/rStatsAframe":177,"../../utils":204}],109:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../constants/"),u=h("../../utils/"),p=u.bind,v="a-hidden";function O(D){D.addEventListener("touchstart",function(){D.classList.remove("resethover")}),D.addEventListener("touchend",function(){D.classList.add("resethover")})}C.exports.Component=s("vr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},enterVRButton:{default:""},enterARButton:{default:""}},init:function(){var D=this,B=this.el;"false"!==u.getUrlParameter("ui")&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),B.addEventListener("enter-vr",this.updateEnterInterfaces),B.addEventListener("exit-vr",this.updateEnterInterfaces),B.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(H){"loaderReady"===H.data.type&&(D.insideLoader=!0,D.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=p(this.onEnterVRButtonClick,this),this.onEnterARButtonClick=p(this.onEnterARButtonClick,this),this.onModalClick=p(this.onModalClick,this),this.toggleOrientationModalIfNeeded=p(this.toggleOrientationModalIfNeeded,this),this.updateEnterInterfaces=p(this.updateEnterInterfaces,this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var D=this.data,B=this.el;if(!D.enabled||this.insideLoader||"false"===u.getUrlParameter("ui"))return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(D.enterVRButton?(this.enterVREl=document.querySelector(D.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=function y(D){var B,H;return(H=document.createElement("div")).classList.add("a-enter-vr"),H.setAttribute(c.AFRAME_INJECTED,""),(B=document.createElement("button")).className="a-enter-vr-button",B.setAttribute("title","Enter VR mode with a headset or fullscreen mode on a desktop. Visit https://webvr.rocks or https://webvr.info for more information."),B.setAttribute(c.AFRAME_INJECTED,""),u.device.isMobile()&&O(B),H.appendChild(B),B.addEventListener("click",function(q){D(),q.stopPropagation()}),H}(this.onEnterVRButtonClick),B.appendChild(this.enterVREl)),D.enterARButton?(this.enterAREl=document.querySelector(D.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=function M(D){var B,H;return(H=document.createElement("div")).classList.add("a-enter-ar"),H.setAttribute(c.AFRAME_INJECTED,""),(B=document.createElement("button")).className="a-enter-ar-button",B.setAttribute("title","Enter AR mode with a headset or handheld device. Visit https://webvr.rocks or https://webvr.info for more information."),B.setAttribute(c.AFRAME_INJECTED,""),u.device.isMobile()&&O(B),H.appendChild(B),B.addEventListener("click",function(q){D(),q.stopPropagation()}),H}(this.onEnterARButtonClick),B.appendChild(this.enterAREl)),this.orientationModalEl=function _(D){var B=document.createElement("div");B.className="a-orientation-modal",B.classList.add(v),B.setAttribute(c.AFRAME_INJECTED,"");var H=document.createElement("button");return H.setAttribute(c.AFRAME_INJECTED,""),H.innerHTML="Exit VR",H.addEventListener("click",D),B.appendChild(H),B}(this.onModalClick),B.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(D){D&&D.parentNode&&D.parentNode.removeChild(D)})},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){this.enterVREl&&(this.el.is("vr-mode")?this.enterVREl.classList.add(v):this.enterVREl.classList.remove(v))},toggleEnterARButtonIfNeeded:function(){this.enterAREl&&(this.el.is("vr-mode")||!u.device.checkARSupport()?this.enterAREl.classList.add(v):this.enterAREl.classList.remove(v))},toggleOrientationModalIfNeeded:function(){var D=this.el,B=this.orientationModalEl;!B||!D.isMobile||(!u.device.isLandscape()&&D.is("vr-mode")?B.classList.remove(v):B.classList.add(v))}})},{"../../constants/":122,"../../core/component":130,"../../utils/":204}],110:[function(h,C,m){var s=h("../core/component"),c=h("../lib/three"),u=h("../utils/bind");C.exports.Component=(0,s.registerComponent)("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=u(this.update,this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var d=this.data;this.updateDescendants(d.cast,d.receive)},remove:function(){this.el.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(d,A){var E=this.el.sceneEl;this.el.object3D.traverse(function(g){if(g instanceof c.Mesh&&(g.castShadow=d,g.receiveShadow=A,E.hasLoaded&&g.material))for(var v=Array.isArray(g.material)?g.material:[g.material],T=0;T<v.length;T++)v[T].needsUpdate=!0})}})},{"../core/component":130,"../lib/three":178,"../utils/bind":198}],111:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/debug"),u=h("../lib/three"),p=c("components:sound:warn");C.exports.Component=s("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var d=this;this.listener=null,this.audioLoader=new u.AudioLoader,this.pool=new u.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){d.playSound()}},update:function(d){var E,g,A=this.data,v=A.src!==d.src;if(v){if(!A.src)return;this.setupSound()}for(E=0;E<this.pool.children.length;E++)g=this.pool.children[E],A.positional&&(g.setDistanceModel(A.distanceModel),g.setMaxDistance(A.maxDistance),g.setRefDistance(A.refDistance),g.setRolloffFactor(A.rolloffFactor)),g.setLoop(A.loop),g.setVolume(A.volume),g.isPaused=!1;if(A.on!==d.on&&this.updateEventListener(d.on),v){var T=this;this.loaded=!1,this.audioLoader.load(A.src,function(y){for(E=0;E<T.pool.children.length;E++)(g=T.pool.children[E]).setBuffer(y);T.loaded=!0,u.Cache.remove(A.src),(T.data.autoplay||T.mustPlay)&&T.playSound(),T.el.emit("sound-loaded",T.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var d;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(d=0;d<this.pool.children.length;d++)this.pool.children[d].disconnect()}catch{p("Audio source not properly disconnected")}},updateEventListener:function(d){var A=this.el;d&&A.removeEventListener(d,this.playSoundBound),A.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var A,v,d=this.el,E=d.sceneEl,g=this;this.pool.children.length>0&&(this.stopSound(),d.removeObject3D("sound"));var T=this.listener=E.audioListener||new u.AudioListener;for(E.audioListener=T,E.camera&&E.camera.add(T),E.addEventListener("camera-set-active",function(y){y.detail.cameraEl.getObject3D("camera").add(T)}),this.pool=new u.Group,A=0;A<this.data.poolSize;A++)v=this.data.positional?new u.PositionalAudio(T):new u.Audio(T),this.pool.add(v);for(d.setObject3D(this.attrName,this.pool),A=0;A<this.pool.children.length;A++)(v=this.pool.children[A]).onEnded=function(){this.isPlaying=!1,g.el.emit("sound-ended",g.evtDetail,!1)}},pauseSound:function(){var d,A;for(this.isPlaying=!1,d=0;d<this.pool.children.length;d++)(A=this.pool.children[d]).source&&A.source.buffer&&A.isPlaying&&!A.isPaused&&(A.isPaused=!0,A.pause())},playSound:function(d){var A,E,g;if(!this.loaded)return p("Sound not loaded yet. It will be played once it finished loading"),void(this.mustPlay=!0);for(A=!1,this.isPlaying=!0,E=0;E<this.pool.children.length;E++)if(!(g=this.pool.children[E]).isPlaying&&g.buffer&&!A){d&&d(g),g.play(),g.isPaused=!1,A=!0;continue}A?this.mustPlay=!1:p("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el)},stopSound:function(){var d,A;for(this.isPlaying=!1,d=0;d<this.pool.children.length;d++){if(!(A=this.pool.children[d]).source||!A.source.buffer)return;A.stop()}}})},{"../core/component":130,"../lib/three":178,"../utils/debug":200}],112:[function(h,C,m){var s=h("three-bmfont-text"),c=h("load-bmfont"),u=h("../core/component").registerComponent,p=h("../core/shader"),d=h("../lib/three"),A=h("../utils/"),E=A.debug("components:text:error"),g=p.shaders,v=A.debug("components:text:warn"),M="https://cdn.aframe.io/fonts/",_={aileronsemibold:M+"Aileron-Semibold.fnt",dejavu:M+"DejaVu-sdf.fnt",exo2bold:M+"Exo2Bold.fnt",exo2semibold:M+"Exo2SemiBold.fnt",kelsonsans:M+"KelsonSans.fnt",monoid:M+"Monoid.fnt",mozillavr:M+"mozillavr.fnt",roboto:M+"Roboto-msdf.json",sourcecodepro:M+"SourceCodePro.fnt"},O=["roboto"],D="roboto";C.exports.FONTS=_;var W,te,ce,Se,B=new function X(){var W=this.cache={};this.get=function(te,ce){return te in W||(W[te]=ce()),W[te]}},H={},q={},V=/^\w+:/;function me(W,te,ce){return W||(.5+te)*ce}C.exports.Component=u("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:D},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:g},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=s(),this.createOrUpdateMaterial(),this.mesh=new d.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh)},update:function(W){var te=this.data,ce=this.currentFont;q[te.font]?this.texture=q[te.font]:(this.texture=q[te.font]=new d.Texture,this.texture.anisotropy=16),this.createOrUpdateMaterial(),W.font===te.font?ce&&(this.updateGeometry(this.geometry,ce),this.updateLayout()):this.updateFont()},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var te,Se,ze,W=this.data,ce=this.material,_e=this.shaderData;if(ze=W.shader,-1!==O.indexOf(W.font)||W.font.indexOf("-msdf.")>=0?ze="msdf":W.font in _&&-1===O.indexOf(W.font)&&(ze="sdf"),te=(this.shaderObject&&this.shaderObject.name)!==ze,_e.alphaTest=W.alphaTest,_e.color=W.color,_e.map=this.texture,_e.opacity=W.opacity,_e.side=function ne(W){switch(W){case"back":return d.FrontSide;case"double":return d.DoubleSide;default:return d.BackSide}}(W.side),_e.transparent=W.transparent,_e.negate=W.negate,!te)return this.shaderObject.update(_e),ce.transparent=_e.transparent,void(ce.side=_e.side);Se=function he(W,te,ce){var Se,_e;return(_e=new g[te].Shader).el=W,_e.init(ce),_e.update(ce),(Se=_e.material).transparent=ce.transparent,{material:Se,shader:_e}}(this.el,ze,_e),this.material=Se.material,this.shaderObject=Se.shader,this.material.side=_e.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var ce,W=this.data,te=this.el,Se=this.geometry,_e=this;W.font||v("No font specified. Using the default font."),this.mesh.visible=!1,ce=this.lookupFont(W.font||D)||W.font,B.get(ce,function(){return function ae(W,te){return new Promise(function(ce,Se){c(W,function(_e,ze){if(_e)return E("Error loading font",W),void Se(_e);W.indexOf("/Roboto-msdf.json")>=0&&(te=30),te&&ze.chars.map(function(gt){gt.yoffset+=te}),ce(ze)})})}(ce,W.yOffset)}).then(function(rt){var gt;if(1!==rt.pages.length)throw new Error("Currently only single-page bitmap fonts are supported.");H[ce]||(rt.widthFactor=H[rt]=function P(W){var te=0,ce=0,Se=0;return W.chars.map(function(_e){te+=_e.xadvance,_e.id>=48&&_e.id<=57&&(Se++,ce+=_e.xadvance)}),Se?ce/Se:te/W.chars.length}(rt)),_e.updateGeometry(Se,rt),_e.currentFont=rt,_e.updateLayout(),gt=_e.getFontImageSrc(),B.get(gt,function(){return function fe(W){return new Promise(function(te,ce){(new d.ImageLoader).load(W,function(Se){te(Se)},void 0,function(){E("Error loading font image",W),ce(null)})})}(gt)}).then(function(Tt){var $t=_e.texture;$t.image=Tt,$t.needsUpdate=!0,q[W.font]=$t,_e.texture=$t,_e.mesh.visible=!0,te.emit("textfontset",{font:W.font,fontObj:rt})}).catch(function(Tt){E(Tt.message),E(Tt.stack)})}).catch(function(ze){E(ze.message),E(ze.stack)})},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var W=this.lookupFont(this.data.font||D)||this.data.font,te=this.currentFont.pages[0];return te.match(V)&&0!==te.indexOf("http")?W.replace(/(\.fnt)|(\.json)/,".png"):d.LoaderUtils.extractUrlBase(W)+te},updateLayout:function(){var W,te,ze,rt,gt,un,In,sn,tr,ce=this.el,Se=this.data,_e=this.geometry,Tt=this.mesh;if(_e.layout){if(ze=ce.getAttribute("geometry"),rt=(un=(In=Se.width||ze&&ze.width||1)/me(Se.wrapPixels,Se.wrapCount,this.currentFont.widthFactor))*((gt=_e.layout).height+gt.descender),ze&&"plane"===ze.primitive&&(ze.width||ce.setAttribute("geometry","width",In),ze.height||ce.setAttribute("geometry","height",rt)),"left"===(W="align"===Se.anchor?Se.align:Se.anchor))sn=0;else if("right"===W)sn=-1*gt.width;else{if("center"!==W)throw new TypeError("Invalid text.anchor property value",W);sn=-1*gt.width/2}if("bottom"===(te=Se.baseline))tr=0;else if("top"===te)tr=-1*gt.height+gt.ascender;else{if("center"!==te)throw new TypeError("Invalid text.baseline property value",te);tr=-1*gt.height/2}Tt.position.x=sn*un+Se.xOffset,Tt.position.y=tr*un,Tt.position.z=Se.zOffset,Tt.scale.set(un,-1*un,un)}},lookupFont:function(W){return _[W]},updateGeometry:(W={},te={},ce=/\\n/g,Se=/\\t/g,function(_e,ze){var rt=this.data;te.font=ze,te.lineHeight=rt.lineHeight&&isFinite(rt.lineHeight)?rt.lineHeight:ze.common.lineHeight,te.text=rt.value.toString().replace(ce,"\n").replace(Se,"\t"),te.width=me(rt.wrapPixels,rt.wrapCount,ze.widthFactor),_e.update(A.extend(W,rt,te))})})},{"../core/component":130,"../core/shader":140,"../lib/three":178,"../utils/":204,"load-bmfont":37,"three-bmfont-text":62}],113:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/tracked-controls"),u=h("../constants").DEFAULT_CAMERA_HEIGHT,p=h("../lib/three"),d=h("../constants").DEFAULT_HANDEDNESS,g={touches:[]};C.exports.Component=s("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new p.Vector3,this.controllerQuaternion=new p.Quaternion,this.controllerEuler=new p.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(T,y){var M=this.el.getObject3D("mesh");M&&M.update&&M.update(y/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return u},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var T=this.data,y=c.findMatchingControllerWebVR(this.system.controllers,T.id,T.idPrefix,T.hand,T.controller);this.controller=y,this.el.components["tracked-controls"].controller=y,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(T){var D,H,q,V,y=this.controller,M=this.controllerEuler,_=this.controllerQuaternion,O=this.deltaControllerPosition;H=this.getHeadElement().object3D,V=this.defaultUserHeight(),q=y.pose,D=(y?y.hand:void 0)||d,T.copy(H.position),O.set(.175*("left"===D?-1:"right"===D?1:0),-.3,-.03),O.multiplyScalar(V),O.applyAxisAngle(H.up,H.rotation.y),T.add(O),O.set(0,0,-.175),O.multiplyScalar(V),q.orientation?_.fromArray(q.orientation):_.copy(H.quaternion),M.setFromQuaternion(_),M.set(M.x,M.y,0),O.applyEuler(M),T.add(O)},updatePose:function(){var _,D,T=this.controller,y=this.data,M=this.el.object3D,O=this.system.vrDisplay;T&&((_=T.pose).position?M.position.fromArray(_.position):y.armModel&&this.applyArmModel(M.position),_.orientation&&M.quaternion.fromArray(_.orientation),O&&_.position&&(D=this.el.sceneEl.renderer.xr.getStandingMatrix(),M.matrix.compose(M.position,M.quaternion,M.scale),M.matrix.multiplyMatrices(D,M.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),M.rotateX(this.data.orientationOffset.x*p.Math.DEG2RAD),M.rotateY(this.data.orientationOffset.y*p.Math.DEG2RAD),M.rotateZ(this.data.orientationOffset.z*p.Math.DEG2RAD))},updateButtons:function(){var M,y=this.controller;if(y){for(M=0;M<y.buttons.length;++M)this.buttonStates[M]||(this.buttonStates[M]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[M]||(this.buttonEventDetails[M]={id:M,state:this.buttonStates[M]}),this.handleButton(M,y.buttons[M]);this.handleAxes()}},handleButton:function(T,y){return!!(this.handlePress(T,y)|this.handleTouch(T,y)|this.handleValue(T,y))&&(this.el.emit("buttonchanged",this.buttonEventDetails[T],!1),!0)},handleAxes:function(){var M,T=!1,y=this.controller.axes,_=this.axis,O=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),M=0;M<y.length;++M)O.push(_[M]!==y[M]),O[M]&&(T=!0);if(!T)return!1;for(this.axis.splice(0,this.axis.length),M=0;M<y.length;M++)this.axis.push(y[M]);return this.el.emit("axismove",this.axisMoveEventDetail,!1),!0},handlePress:function(T,y){var _=this.buttonStates[T];return y.pressed!==_.pressed&&(this.el.emit(y.pressed?"buttondown":"buttonup",this.buttonEventDetails[T],!1),_.pressed=y.pressed,!0)},handleTouch:function(T,y){var _=this.buttonStates[T];return y.touched!==_.touched&&(this.el.emit(y.touched?"touchstart":"touchend",this.buttonEventDetails[T],!1,g),_.touched=y.touched,!0)},handleValue:function(T,y){var M=this.buttonStates[T];return y.value!==M.value&&(M.value=y.value,!0)}})},{"../constants":122,"../core/component":130,"../lib/three":178,"../utils/tracked-controls":213}],114:[function(h,C,m){var s=h("../utils/tracked-controls"),c=h("../core/component").registerComponent;C.exports.Component=c("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var p=this.el.sceneEl;this.updateController(),p.addEventListener("controllersupdated",this.updateController)},pause:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(p){return!(!this.controller||this.controller.gamepad||"none"!==p.inputSource.handedness&&p.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=s.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var p=this.el.sceneEl,d=this.controller;!d||!p.frame||!this.system.referenceSpace||d.hand||(this.pose=p.frame.getPose(d.targetRaySpace,this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var p=this.el.object3D,d=this.pose;d&&(p.matrix.elements=d.transform.matrix,p.matrix.decompose(p.position,p.rotation,p.scale))},updateButtons:function(){var d,E,A=this.controller;if(A&&A.gamepad){for(E=A.gamepad,d=0;d<E.buttons.length;++d)this.buttonStates[d]||(this.buttonStates[d]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[d]||(this.buttonEventDetails[d]={id:d,state:this.buttonStates[d]}),this.handleButton(d,E.buttons[d]);this.handleAxes()}},handleButton:function(p,d){return!!(this.handlePress(p,d)|this.handleTouch(p,d)|this.handleValue(p,d))&&(this.el.emit("buttonchanged",this.buttonEventDetails[p],!1),!0)},handleAxes:function(){var A,p=!1,d=this.controller.gamepad.axes,E=this.axis,g=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),A=0;A<d.length;++A)g.push(E[A]!==d[A]),g[A]&&(p=!0);if(!p)return!1;for(this.axis.splice(0,this.axis.length),A=0;A<d.length;A++)this.axis.push(d[A]);return this.el.emit("axismove",this.axisMoveEventDetail,!1),!0},handlePress:function(p,d){var E=this.buttonStates[p];return d.pressed!==E.pressed&&(this.el.emit(d.pressed?"buttondown":"buttonup",this.buttonEventDetails[p],!1),E.pressed=d.pressed,!0)},handleTouch:function(p,d){var E=this.buttonStates[p];return d.touched!==E.touched&&(this.el.emit(d.touched?"touchstart":"touchend",this.buttonEventDetails[p],!1),E.touched=d.touched,!0)},handleValue:function(p,d){var A=this.buttonStates[p];return d.value!==A.value&&(A.value=d.value,!0)}})},{"../core/component":130,"../utils/tracked-controls":213}],115:[function(h,C,m){var s=h("../core/component").registerComponent;C.exports.Component=s("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1}},update:function(){var c=this.data,u=this.el;u.sceneEl.hasWebXR?u.setAttribute("tracked-controls-webxr",{id:c.id,hand:c.hand,index:c.controller,iterateControllerProfiles:c.iterateControllerProfiles,handTrackingEnabled:c.handTrackingEnabled}):u.setAttribute("tracked-controls-webvr",c)}})},{"../core/component":130}],116:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../lib/three"),p=h("../utils/tracked-controls"),d=p.checkControllerPresentAndSetup,A=p.emitIfAxesChanged,E=p.onButtonEvent,g="https://cdn.aframe.io/controllers/valve/index/valve-index-",v={left:g+"left.glb",right:g+"right.glb"},T="valve",y=h("../utils/").device.isWebXRAvailable,D={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},B=y?D:{left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},H=y?{left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}}:{left:{x:-.00023692678902063457,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}};C.exports.Component=s("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var q=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(V){E(V.detail.id,"down",q)},this.onButtonUp=function(V){E(V.detail.id,"up",q)},this.onButtonTouchEnd=function(V){E(V.detail.id,"touchend",q)},this.onButtonTouchStart=function(V){E(V.detail.id,"touchstart",q)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=c(this.onModelLoaded,this),this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this),this.onAxisMoved=c(this.onAxisMoved,this)},addEventListeners:function(){var q=this.el;q.addEventListener("buttonchanged",this.onButtonChanged),q.addEventListener("buttondown",this.onButtonDown),q.addEventListener("buttonup",this.onButtonUp),q.addEventListener("touchend",this.onButtonTouchEnd),q.addEventListener("touchstart",this.onButtonTouchStart),q.addEventListener("model-loaded",this.onModelLoaded),q.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var q=this.el;q.removeEventListener("buttonchanged",this.onButtonChanged),q.removeEventListener("buttondown",this.onButtonDown),q.removeEventListener("buttonup",this.onButtonUp),q.removeEventListener("touchend",this.onButtonTouchEnd),q.removeEventListener("touchstart",this.onButtonTouchStart),q.removeEventListener("model-loaded",this.onModelLoaded),q.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var q=this.data;d(this,T,{index:"right"===q.hand?0:"left"===q.hand?1:2,iterateControllerProfiles:!0,hand:q.hand})},injectTrackedControls:function(){var V=this.data;this.el.setAttribute("tracked-controls",{idPrefix:T,controller:"right"===V.hand?1:"left"===V.hand?0:2,hand:V.hand,orientationOffset:V.orientationOffset}),this.loadModel()},loadModel:function(){var q=this.data;q.model&&this.el.setAttribute("gltf-model",""+v[q.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(q){var V=this.mapping.buttons[q.detail.id],ne=this.buttonMeshes;V&&("trigger"===V&&ne&&ne.trigger&&(ne.trigger.rotation.x=this.triggerOriginalRotationX-q.detail.state.value*(Math.PI/40)),this.el.emit(V+"changed",q.detail.state))},onModelLoaded:function(q){var V,ne=q.detail.model,ae=this;this.data.model&&((V=this.buttonMeshes={}).grip={left:ne.getObjectByName("leftgrip"),right:ne.getObjectByName("rightgrip")},V.menu=ne.getObjectByName("menubutton"),V.system=ne.getObjectByName("systembutton"),V.trackpad=ne.getObjectByName("touchpad"),V.trigger=ne.getObjectByName("trigger"),this.triggerOriginalRotationX=V.trigger.rotation.x,Object.keys(V).forEach(function(fe){ae.setButtonColor(fe,ae.data.buttonColor)}),ne.position.copy(H[this.data.hand]),ne.rotation.copy(B[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controlls",model:this.data.model,rayOrigin:new u.Vector3(0,0,0)}))},onAxisMoved:function(q){A(this,this.mapping.axes,q)},updateModel:function(q,V){this.data.model&&-1===V.indexOf("touch")&&this.setButtonColor(q,"up"===V?this.data.buttonColor:this.data.buttonHighlightColor)},setButtonColor:function(q,V){}})},{"../core/component":130,"../lib/three":178,"../utils/":204,"../utils/bind":198,"../utils/tracked-controls":213}],117:[function(h,C,m){var s=h("../core/component").registerComponent;C.exports.Component=s("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},{"../core/component":130}],118:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,v=h("../utils/").device.isWebXRAvailable,M=v?"htc-vive-controller-mv":"OpenVR ";C.exports.Component=s("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:v?{axes:{thumbstick:[0,1]},buttons:["trigger","grip","trackpad","none","menu"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},init:function(){var B=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(H){A(H.detail.id,"down",B)},this.onButtonUp=function(H){A(H.detail.id,"up",B)},this.onButtonTouchEnd=function(H){A(H.detail.id,"touchend",B)},this.onButtonTouchStart=function(H){A(H.detail.id,"touchstart",B)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var B=this.data;this.controllerIndex="right"===B.hand?0:"left"===B.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=c(this.onModelLoaded,this),this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this),this.onAxisMoved=c(this.onAxisMoved,this)},addEventListeners:function(){var B=this.el;B.addEventListener("buttonchanged",this.onButtonChanged),B.addEventListener("buttondown",this.onButtonDown),B.addEventListener("buttonup",this.onButtonUp),B.addEventListener("touchend",this.onButtonTouchEnd),B.addEventListener("touchstart",this.onButtonTouchStart),B.addEventListener("model-loaded",this.onModelLoaded),B.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var B=this.el;B.removeEventListener("buttonchanged",this.onButtonChanged),B.removeEventListener("buttondown",this.onButtonDown),B.removeEventListener("buttonup",this.onButtonUp),B.removeEventListener("touchend",this.onButtonTouchEnd),B.removeEventListener("touchstart",this.onButtonTouchStart),B.removeEventListener("model-loaded",this.onModelLoaded),B.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){p(this,M,{index:this.controllerIndex,hand:this.data.hand})},injectTrackedControls:function(){var H=this.data;this.el.setAttribute("tracked-controls",{idPrefix:M,hand:H.hand,controller:this.controllerIndex,orientationOffset:H.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.obj",mtl:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.mtl"})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(B){var H=this.mapping.buttons[B.detail.id],q=this.buttonMeshes;H&&("trigger"===H&&q&&q.trigger&&(q.trigger.rotation.x=-B.detail.state.value*(Math.PI/12)),this.el.emit(H+"changed",B.detail.state))},onModelLoaded:function(B){var H,q=B.detail.model,V=this;this.data.model&&((H=this.buttonMeshes={}).grip={left:q.getObjectByName("leftgrip"),right:q.getObjectByName("rightgrip")},H.menu=q.getObjectByName("menubutton"),H.system=q.getObjectByName("systembutton"),H.trackpad=q.getObjectByName("touchpad"),H.trigger=q.getObjectByName("trigger"),Object.keys(H).forEach(function(ne){V.setButtonColor(ne,V.data.buttonColor)}),q.position.set(0,-.015,.04))},onAxisMoved:function(B){d(this,this.mapping.axes,B)},updateModel:function(B,H){this.data.model&&-1===H.indexOf("touch")&&this.setButtonColor(B,"up"===H?this.data.buttonColor:this.data.buttonHighlightColor)},setButtonColor:function(B,H){var q=this.buttonMeshes,V=this.rendererSystem;if(q){if("grip"===B)return q.grip.left.material.color.set(H),q.grip.right.material.color.set(H),V.applyColorCorrection(q.grip.left.material.color),void V.applyColorCorrection(q.grip.right.material.color);q[B].material.color.set(H),V.applyColorCorrection(q[B].material.color)}}})},{"../core/component":130,"../utils/":204,"../utils/bind":198,"../utils/tracked-controls":213}],119:[function(h,C,m){var s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,E="HTC Vive Focus";C.exports.Component=s("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=c(this.onModelLoaded,this),this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=c(this.removeControllersUpdateListener,this),this.onAxisMoved=c(this.onAxisMoved,this)},init:function(){var v=this;this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(T){A(T.detail.id,"down",v)},this.onButtonUp=function(T){A(T.detail.id,"up",v)},this.onButtonTouchStart=function(T){A(T.detail.id,"touchstart",v)},this.onButtonTouchEnd=function(T){A(T.detail.id,"touchend",v)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var v=this.el;v.addEventListener("buttonchanged",this.onButtonChanged),v.addEventListener("buttondown",this.onButtonDown),v.addEventListener("buttonup",this.onButtonUp),v.addEventListener("touchstart",this.onButtonTouchStart),v.addEventListener("touchend",this.onButtonTouchEnd),v.addEventListener("model-loaded",this.onModelLoaded),v.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var v=this.el;v.removeEventListener("buttonchanged",this.onButtonChanged),v.removeEventListener("buttondown",this.onButtonDown),v.removeEventListener("buttonup",this.onButtonUp),v.removeEventListener("touchstart",this.onButtonTouchStart),v.removeEventListener("touchend",this.onButtonTouchEnd),v.removeEventListener("model-loaded",this.onModelLoaded),v.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){p(this,E,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var T=this.data;this.el.setAttribute("tracked-controls",{armModel:T.armModel,idPrefix:E,orientationOffset:T.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model","https://cdn.aframe.io/controllers/vive/focus-controller/focus-controller.gltf")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(v){var y,T=v.detail.model;this.data.model&&((y=this.buttonMeshes={}).trigger=T.getObjectByName("BumperKey"),y.triggerPressed=T.getObjectByName("BumperKey_Press"),y.triggerPressed&&(y.triggerPressed.visible=!1),y.trackpad=T.getObjectByName("TouchPad"),y.trackpadPressed=T.getObjectByName("TouchPad_Press"),y.trackpadPressed&&(y.trackpadPressed.visible=!1))},onButtonChanged:function(v){var T=this.mapping.buttons[v.detail.id];T&&this.el.emit(T+"changed",v.detail.state)},onAxisMoved:function(v){d(this,this.mapping.axes,v)},updateModel:function(v,T){this.data.model&&this.updateButtonModel(v,T)},updateButtonModel:function(v,T){var y=this.buttonMeshes,M=v+"Pressed";if(y&&y[v]&&y[M]){var _;switch(T){case"down":_=this.data.buttonHighlightColor;break;case"touchstart":_=this.data.buttonTouchedColor}_&&y[M].material.color.set(_),y[M].visible=!!_,y[v].visible=!_}}})},{"../core/component":130,"../utils/bind":198,"../utils/tracked-controls":213}],120:[function(h,C,m){var y,M,s=h("../constants").keyboardevent.KEYCODE_TO_CODE,c=h("../core/component").registerComponent,u=h("../lib/three"),p=h("../utils/"),d=p.bind,A=p.shouldCaptureKeyEvent,E=1e-5,v=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];C.exports.Component=c("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},init:function(){this.keys={},this.easing=1.1,this.velocity=new u.Vector3,this.onBlur=d(this.onBlur,this),this.onFocus=d(this.onFocus,this),this.onKeyDown=d(this.onKeyDown,this),this.onKeyUp=d(this.onKeyUp,this),this.onVisibilityChange=d(this.onVisibilityChange,this),this.attachVisibilityEventListeners()},tick:function(y,M){var _=this.data,O=this.el,D=this.velocity;!D[_.adAxis]&&!D[_.wsAxis]&&function T(y){var M;for(M in y)return!1;return!0}(this.keys)||(this.updateVelocity(M/=1e3),(D[_.adAxis]||D[_.wsAxis])&&O.object3D.position.add(this.getMovementVector(M)))},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(y){var M,_,O,q,V,D=this.data,B=this.keys,H=this.velocity;if(_=D.adAxis,q=D.wsAxis,y>.2)return H[_]=0,void(H[q]=0);var ne=Math.pow(1/this.easing,60*y);0!==H[_]&&(H[_]=H[_]*ne),0!==H[q]&&(H[q]=H[q]*ne),Math.abs(H[_])<E&&(H[_]=0),Math.abs(H[q])<E&&(H[q]=0),D.enabled&&(M=D.acceleration,D.adEnabled&&(O=D.adInverted?-1:1,(B.KeyA||B.ArrowLeft)&&(H[_]-=O*M*y),(B.KeyD||B.ArrowRight)&&(H[_]+=O*M*y)),D.wsEnabled&&(V=D.wsInverted?-1:1,(B.KeyW||B.ArrowUp)&&(H[q]-=V*M*y),(B.KeyS||B.ArrowDown)&&(H[q]+=V*M*y)))},getMovementVector:(y=new u.Vector3(0,0,0),M=new u.Euler(0,0,0,"YXZ"),function(_){var O=this.el.getAttribute("rotation");return y.copy(this.velocity),y.multiplyScalar(_),O&&(M.set(u.Math.degToRad(this.data.fly?O.x:0),u.Math.degToRad(O.y),0),y.applyEuler(M)),y}),attachVisibilityEventListeners:function(){window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(y){var M;A(y)&&-1!==v.indexOf(M=y.code||s[y.keyCode])&&(this.keys[M]=!0)},onKeyUp:function(y){delete this.keys[y.code||s[y.keyCode]]}})},{"../constants":122,"../core/component":130,"../lib/three":178,"../utils/":204}],121:[function(h,C,m){var ae,s=h("../core/component").registerComponent,c=h("../utils/bind"),u=h("../utils/tracked-controls"),p=u.checkControllerPresentAndSetup,d=u.emitIfAxesChanged,A=u.onButtonEvent,E=h("../utils/"),g=E.debug("components:windows-motion-controls:debug"),v=E.debug("components:windows-motion-controls:warn"),T=h("../constants").DEFAULT_HANDEDNESS,M={left:"left.glb",right:"right.glb",default:"universal.glb"},_=h("../utils/").device.isWebXRAvailable,B=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,H=_?"windows-mixed-reality":"Spatial Controller (Spatial Interaction Source) ";C.exports.Component=s("windows-motion-controls",{schema:{hand:{default:T},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},mapping:_?{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"}:{axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},bindMethods:function(){this.onModelError=c(this.onModelError,this),this.onModelLoaded=c(this.onModelLoaded,this),this.onControllersUpdate=c(this.onControllersUpdate,this),this.checkIfControllerPresent=c(this.checkIfControllerPresent,this),this.onAxisMoved=c(this.onAxisMoved,this)},init:function(){var ae=this,fe=this.el;this.onButtonChanged=c(this.onButtonChanged,this),this.onButtonDown=function(he){A(he.detail.id,"down",ae)},this.onButtonUp=function(he){A(he.detail.id,"up",ae)},this.onButtonTouchStart=function(he){A(he.detail.id,"touchstart",ae)},this.onButtonTouchEnd=function(he){A(he.detail.id,"touchend",ae)},this.onControllerConnected=function(){ae.setModelVisibility(!0)},this.onControllerDisconnected=function(){ae.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},fe.addEventListener("controllerconnected",this.onControllerConnected),fe.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var ae=this.el;ae.addEventListener("buttonchanged",this.onButtonChanged),ae.addEventListener("buttondown",this.onButtonDown),ae.addEventListener("buttonup",this.onButtonUp),ae.addEventListener("touchstart",this.onButtonTouchStart),ae.addEventListener("touchend",this.onButtonTouchEnd),ae.addEventListener("axismove",this.onAxisMoved),ae.addEventListener("model-error",this.onModelError),ae.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var ae=this.el;ae.removeEventListener("buttonchanged",this.onButtonChanged),ae.removeEventListener("buttondown",this.onButtonDown),ae.removeEventListener("buttonup",this.onButtonUp),ae.removeEventListener("touchstart",this.onButtonTouchStart),ae.removeEventListener("touchend",this.onButtonTouchEnd),ae.removeEventListener("axismove",this.onAxisMoved),ae.removeEventListener("model-error",this.onModelError),ae.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){p(this,H,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(this.data.model&&!this.rayOrigin.createdFromMesh){var ae=this.createControllerModelUrl();this.loadModel(ae)}else this.modelReady()},createControllerModelUrl:function(ae){var fe=this.el.components["tracked-controls"],he=fe?fe.controller:null,me="default",P=this.data.hand;if(he&&!window.hasNativeWebXRImplementation&&(P=he.hand,!ae)){var W=he.id.match(B);me=W&&W[0]||me}return"https://cdn.aframe.io/controllers/microsoft/"+me+"/"+(M[P]||M.default)},injectTrackedControls:function(){var ae=this.data;this.el.setAttribute("tracked-controls",{idPrefix:H,controller:ae.pair,hand:ae.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(ae){var fe=this.createControllerModelUrl(!0);ae.detail.src!==fe?(v("Failed to load controller model for device, attempting to load default."),this.loadModel(fe)):v("Failed to load default controller model.")},loadModel:function(ae){this.el.setAttribute("gltf-model","url("+ae+")")},onModelLoaded:function(ae){var me,P,X,W,fe=this.controllerModel=ae.detail.model,he=this.loadedMeshInfo;if(g("Processing model"),he.buttonMeshes={},he.axisMeshes={},fe){for(me=0;me<this.mapping.buttons.length;me++)(P=this.mapping.buttonMeshNames[this.mapping.buttons[me]])?(X=fe.getObjectByName(P))?(W={index:me,value:te(X,"VALUE"),pressed:te(X,"PRESSED"),unpressed:te(X,"UNPRESSED")}).value&&W.pressed&&W.unpressed?he.buttonMeshes[this.mapping.buttons[me]]=W:v("Missing button submesh under mesh with name: "+P+"(VALUE: "+!!W.value+", PRESSED: "+!!W.pressed+", UNPRESSED:"+!!W.unpressed+")"):v("Missing button mesh with name: "+P):g("Skipping unknown button at index: "+me+" with mapped name: "+this.mapping.buttons[me]);for(me=0;me<this.mapping.axisMeshNames.length;me++)(P=this.mapping.axisMeshNames[me])?(X=fe.getObjectByName(P))?(W={index:me,value:te(X,"VALUE"),min:te(X,"MIN"),max:te(X,"MAX")}).value&&W.min&&W.max?he.axisMeshes[me]=W:v("Missing axis submesh under mesh with name: "+P+"(VALUE: "+!!W.value+", MIN: "+!!W.min+", MAX:"+!!W.max+")"):v("Missing axis mesh with name: "+P):g("Skipping unknown axis at index: "+me);this.calculateRayOriginFromMesh(fe),this.setModelVisibility()}function te(ce,Se){for(var _e=0,ze=ce.children.length;_e<ze;_e++){var rt=ce.children[_e];if(rt&&rt.name===Se)return rt}}g("Model load complete.")},calculateRayOriginFromMesh:(ae=new THREE.Quaternion,function(fe){var he;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,he=fe.getObjectByName(this.mapping.pointingPoseMeshName)){var me=fe.parent;me&&(fe.parent=null,fe.updateMatrixWorld(!0),fe.parent=me),he.getWorldPosition(this.rayOrigin.origin),he.getWorldQuaternion(ae),this.rayOrigin.direction.applyQuaternion(ae),me&&fe.updateMatrixWorld(!0)}else g("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}),lerpAxisTransform:function(){var ae=new THREE.Quaternion;return function(fe,he){var me=this.loadedMeshInfo.axisMeshes[fe];if(me){var P=me.min,X=me.max,W=me.value,te=.5*he+.5;W.setRotationFromQuaternion(ae.copy(P.quaternion).slerp(X.quaternion,te)),W.position.lerpVectors(P.position,X.position,te)}}}(),lerpButtonTransform:function(){var ae=new THREE.Quaternion;return function(fe,he){var me=this.loadedMeshInfo.buttonMeshes[fe];if(me){var P=me.unpressed,X=me.pressed,W=me.value;W.setRotationFromQuaternion(ae.copy(P.quaternion).slerp(X.quaternion,he)),W.position.lerpVectors(P.position,X.position,he)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(ae){var fe=this.mapping.buttons[ae.detail.id];fe&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(fe,ae.detail.state.value),this.el.emit(fe+"changed",ae.detail.state))},onAxisMoved:function(ae){var fe=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var he=0;he<fe;he++)this.lerpAxisTransform(he,ae.detail.axis[he]||0);d(this,this.mapping.axes,ae)},setModelVisibility:function(ae){var fe=this.el.getObject3D("mesh");this.modelVisible=ae=void 0!==ae?ae:this.modelVisible,fe&&(fe.visible=ae)}})},{"../constants":122,"../core/component":130,"../utils/":204,"../utils/bind":198,"../utils/tracked-controls":213}],122:[function(h,C,m){C.exports={AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:h("./keyboardevent")}},{"./keyboardevent":123}],123:[function(h,C,m){C.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},{}],124:[function(h,C,m){var s=h("./a-node"),c=h("../utils/bind"),u=h("../utils/debug"),p=h("./a-register-element").registerElement,d=h("../lib/three"),A=new d.FileLoader,E=u("core:a-assets:warn");function g(O){if(O.hasAttribute("autoplay")||"auto"===O.getAttribute("preload"))return new Promise(function(D,B){if(4===O.readyState)return D();if(O.error)return B();function H(){for(var q=0,V=0;V<O.buffered.length;V++)q+=O.buffered.end(V)-O.buffered.start(V);q>=O.duration&&("VIDEO"===O.tagName&&(d.Cache.files[O.getAttribute("src")]=O),D())}O.addEventListener("loadeddata",H,!1),O.addEventListener("progress",H,!1),O.addEventListener("error",B,!1)})}function v(O){var D=function T(O){var B;return!O.hasAttribute("crossorigin")&&(null===(B=O.getAttribute("src"))||-1!==B.indexOf("://")&&function y(O){var D=O.indexOf("://")>-1?O.split("/")[2]:O.split("/")[0];return D.substring(0,D.indexOf(":"))}(B)!==window.location.host)?(E('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',B),O.crossOrigin="anonymous",O.cloneNode(!0)):O}(O);return D.tagName&&"video"===D.tagName.toLowerCase()&&(D.setAttribute("playsinline",""),D.setAttribute("webkit-playsinline","")),D!==O&&(O.parentNode.appendChild(D),O.parentNode.removeChild(O)),D}function M(O){var D=_(O),B=D.lastIndexOf(".");return B>=0&&".glb"===D.slice(B,O.search(/\?|#|$/))?"arraybuffer":"text"}function _(O){var D=document.createElement("a");D.href=O;var B=D.search.replace(/^\?/,""),H=O.replace(B,"").replace("?","");return H.substring(H.lastIndexOf("/")+1)}C.exports=p("a-assets",{prototype:Object.create(s.prototype,{createdCallback:{value:function(){this.isAssets=!0,this.fileLoader=A,this.timeout=null}},attachedCallback:{value:function(){var D,H,q,V,ne,ae,O=this,B=[];if(!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(ne=this.querySelectorAll("img"),D=0;D<ne.length;D++)V=v(ne[D]),B.push(new Promise(function(fe,he){d.Cache.files[ne[D].getAttribute("src")]=V,V.onload=fe,V.onerror=he}));for(q=this.querySelectorAll("audio, video"),D=0;D<q.length;D++)!(H=v(q[D])).src&&!H.srcObject&&E("Audio/video asset has neither `src` nor `srcObject` attributes."),B.push(g(H));Promise.all(B).then(c(this.load,this)),ae=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){O.hasLoaded||(E("Asset loading timed out in ",ae,"ms"),O.emit("timeout"),O.load())},ae)}},detachedCallback:{value:function(){this.timeout&&clearTimeout(this.timeout)}},load:{value:function(){s.prototype.load.call(this,null,function(D){return D.isAssetItem&&D.hasAttribute("src")})}}})}),p("a-asset-item",{prototype:Object.create(s.prototype,{createdCallback:{value:function(){this.data=null,this.isAssetItem=!0}},attachedCallback:{value:function(){var O=this,D=this.getAttribute("src");A.setResponseType(this.getAttribute("response-type")||M(D)),A.load(D,function(H){O.data=H,setTimeout(function(){s.prototype.load.call(O)})},function(H){O.emit("progress",{loadedBytes:H.loaded,totalBytes:H.total,xhr:H})},function(H){O.emit("error",{xhr:H})})}}})}),C.exports.inferResponseType=M,C.exports.getFileNameFromURL=_},{"../lib/three":178,"../utils/bind":198,"../utils/debug":200,"./a-node":128,"./a-register-element":129}],125:[function(h,C,m){var s=h("../utils/debug"),c=h("./a-register-element").registerElement,u=s("core:cubemap:warn");C.exports=c("a-cubemap",{prototype:Object.create(window.HTMLElement.prototype,{attachedCallback:{value:function(){this.srcs=this.validate()},writable:window.debug},validate:{value:function(){var d,p=this.querySelectorAll("[src]"),A=[];if(6===p.length){for(d=0;d<p.length;d++)A.push(p[d].getAttribute("src"));return A}u("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")},writable:window.debug}})})},{"../utils/debug":200,"./a-register-element":129}],126:[function(h,C,m){var A,q,s=h("./a-node"),c=h("./component").components,u=h("./a-register-element").registerElement,p=h("../lib/three"),d=h("../utils/"),E=d.debug("core:a-entity:debug"),g=d.debug("core:a-entity:warn"),v="__",T=["position","rotation","scale","visible"],y={once:!0},M=Object.create(s.prototype,{createdCallback:{value:function(){this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new p.Group,this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}},attributeChangedCallback:{value:function(q,V,ne){var ae=this.components[q];ae&&ae.justInitialized&&""===ne?delete ae.justInitialized:!ae&&null===ne||this.setEntityAttribute(q,V,ne)}},attachedCallback:{value:function(){var q,V=this.sceneEl,ne=this;if(this.addToParent(),!this.isScene){if(!V)return void this.load();if((q=V.querySelector("a-assets"))&&!q.hasLoaded)return void q.addEventListener("loaded",function(){ne.load()});this.load()}}},detachedCallback:{value:function(){var q;if(this.parentEl){for(q in this.components)this.removeComponent(q,!1);this.isScene||(this.removeFromParent(),s.prototype.detachedCallback.call(this),this.object3D.el=null)}}},getObject3D:{value:function(q){return this.object3DMap[q]}},setObject3D:{value:function(q,V){var ne,ae=this;if(!(V instanceof p.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");(ne=this.getObject3D(q))&&this.object3D.remove(ne),V.el=this,V.children.length&&V.traverse(function(he){he.el=ae}),this.object3D.add(V),this.object3DMap[q]=V,this.emit("object3dset",{object:V,type:q})}},removeObject3D:{value:function(q){var V=this.getObject3D(q);V?(this.object3D.remove(V),delete this.object3DMap[q],this.emit("object3dremove",{type:q})):g("Tried to remove `Object3D` of type:",q,"which was not defined.")}},getOrCreateObject3D:{value:function(q,V){var ne=this.getObject3D(q);return!ne&&V&&(ne=new V,this.setObject3D(q,ne)),g("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),ne}},add:{value:function(q){if(!q.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(q.object3D),this.emit("child-attached",{el:q})}},addToParent:{value:function(){var q=this.parentEl=this.parentNode;!q||!q.add||this.attachedToParent||(q.add(this),this.attachedToParent=!0)}},removeFromParent:{value:function(){var q=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,q.emit("child-detached",{el:this})}},load:{value:function(){var q=this;this.hasLoaded||!this.parentEl||s.prototype.load.call(this,function(){q.parentEl&&(q.updateComponents(),(q.isScene||q.parentEl.isPlaying)&&q.play())})},writable:window.debug},remove:{value:function(q){q?this.object3D.remove(q.object3D):this.parentNode.removeChild(this)}},getChildEntities:{value:function(){for(var q=this.children,V=[],ne=0;ne<q.length;ne++){var ae=q[ne];ae instanceof A&&V.push(ae)}return V}},initComponent:{value:function(q,V,ne){var ae,fe,he,me;if(me=(he=d.split(q,v))[0],fe=he.length>2?he.slice(1).join("__"):he[1],c[me]&&(_(this,q)||void 0!==V||ne)&&!(q in this.components)){if(this.initComponentDependencies(me),fe&&!c[me].multiple)throw new Error("Trying to initialize multiple components of type `"+me+"`. There can only be one component of this type per entity.");ae=new c[me].Component(this,V,fe),this.isPlaying&&ae.play(),this.hasAttribute(q)||(ae.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,q,"")),E("Component initialized: %s",q)}},writable:window.debug},initComponentDependencies:{value:function(q){var ae,fe;if(c[q]&&(ae=c[q].dependencies))for(fe=0;fe<ae.length;fe++)this.initComponent(ae[fe],window.HTMLElement.prototype.getAttribute.call(this,ae[fe])||void 0,!0)}},removeComponent:{value:function(q,V){var ne;if(ne=this.components[q]){if(!ne.initialized)return void this.addEventListener("componentinitialized",function ae(fe){fe.detail.name===q&&(this.removeComponent(q,V),this.removeEventListener("componentinitialized",ae))});ne.pause(),ne.remove(),V&&(ne.destroy(),delete this.components[q]),this.emit("componentremoved",ne.evtDetail,!1)}},writable:window.debug},updateComponents:{value:function(){var q,V,ne,ae,fe=this.componentsToUpdate;if(this.hasLoaded){for(ne=0;ne<this.mixinEls.length;ne++)for(ae in this.mixinEls[ne].componentCache)B(ae)&&(fe[ae]=!0);if(this.getExtraComponents)for(ae in V=this.getExtraComponents())B(ae)&&(fe[ae]=!0);for(ne=0;ne<this.attributes.length;++ne)-1===T.indexOf(ae=this.attributes[ne].name)&&B(ae)&&(fe[ae]=!0);for(ne=0;ne<T.length;ne++)this.hasAttribute(ae=T[ne])&&this.updateComponent(ae,this.getDOMAttribute(ae));for(ae in fe)q=D(this.getDOMAttribute(ae),V&&V[ae]),this.updateComponent(ae,q),delete fe[ae]}},writable:window.debug},updateComponent:{value:function(q,V,ne){var ae=this.components[q];if(ae)return null!==V||_(this,q)?void ae.updateProperties(V,ne):void this.removeComponent(q,!0);this.initComponent(q,V,!1)}},removeAttribute:{value:function(q,V){var ne=this.components[q];ne&&void 0===V&&this.removeComponent(q,!0),ne&&void 0!==V?ne.resetProperty(V):("mixin"===q&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,q))}},play:{value:function(){var q,V,ne;if(!this.isPlaying&&this.hasLoaded){for(ne in this.isPlaying=!0,this.components)this.components[ne].play();for(q=this.getChildEntities(),V=0;V<q.length;V++)q[V].play();this.emit("play")}},writable:!0},pause:{value:function(){var q,V,ne;if(this.isPlaying){for(ne in this.isPlaying=!1,this.components)this.components[ne].pause();for(q=this.getChildEntities(),V=0;V<q.length;V++)q[V].pause();this.emit("pause")}},writable:!0},setEntityAttribute:{value:function(q,V,ne){if(c[q]||this.components[q])this.updateComponent(q,ne);else if("mixin"===q){if(ne===this.computedMixinStr)return;this.mixinUpdate(ne,V)}}},mixinUpdate:{value:(q=[],function(V,ne){var ae,fe,he,me,P=this;if(this.hasLoaded){for(ne=ne||this.getAttribute("mixin"),he=this.updateMixins(V,ne),q.length=0,me=0;me<this.mixinEls.length;me++)for(ae in this.mixinEls[me].componentCache)-1===q.indexOf(ae)&&(this.components[ae]?this.components[ae].handleMixinUpdate():this.initComponent(ae,null),q.push(ae));for(me=0;me<he.oldMixinIds.length;me++)if(fe=document.getElementById(he.oldMixinIds[me]))for(ae in fe.componentCache)-1===q.indexOf(ae)&&this.components[ae]&&(this.getDOMAttribute(ae)?this.components[ae].handleMixinUpdate():this.removeComponent(ae,!0))}else this.addEventListener("loaded",function(){P.mixinUpdate(V,ne)},y)})},setAttribute:{value:function(){var q={};return function(V,ne,ae){var fe,he,me,P,W;if(me=(P=V.indexOf(v))>0?V.substring(0,P):V,!c[me])return"mixin"===V&&this.mixinUpdate(ne),void s.prototype.setAttribute.call(this,V,ne);if(!this.components[V]&&this.hasAttribute(V)&&this.updateComponent(V,window.HTMLElement.prototype.getAttribute.call(this,V)),typeof ae<"u"&&"string"==typeof ne&&ne.length>0&&"string"==typeof d.styleParser.parse(ne)){for(W in q)delete q[W];(fe=q)[ne]=ae,he=!1}else fe=ne,he=!0===ae;this.updateComponent(V,fe,he),this.sceneEl&&this.sceneEl.getAttribute("debug")&&this.components[V].flushToDOM()}}(),writable:window.debug},flushToDOM:{value:function(q){var ne,fe,he,V=this.components,ae=this.children;for(he in V)V[he].flushToDOM();if(q)for(fe=0;fe<ae.length;++fe)(ne=ae[fe]).flushToDOM&&ne.flushToDOM(q)}},getAttribute:{value:function(q){var V;return"position"===q?this.object3D.position:"rotation"===q?function H(q){var V=p.Math.radToDeg,ne=q.object3D.rotation,ae=q.rotationObj;return ae.x=V(ne.x),ae.y=V(ne.y),ae.z=V(ne.z),ae}(this):"scale"===q?this.object3D.scale:"visible"===q?this.object3D.visible:(V=this.components[q])?V.data:window.HTMLElement.prototype.getAttribute.call(this,q)},writable:window.debug},getDOMAttribute:{value:function(q){var V=this.components[q];return V?V.attrValue:window.HTMLElement.prototype.getAttribute.call(this,q)},writable:window.debug},addState:{value:function(q){this.is(q)||(this.states.push(q),this.emit("stateadded",q))}},removeState:{value:function(q){var V=this.states.indexOf(q);-1!==V&&(this.states.splice(V,1),this.emit("stateremoved",q))}},is:{value:function(q){return-1!==this.states.indexOf(q)}},inspect:{value:function(){this.sceneEl.components.inspector.openInspector(this)}},destroy:{value:function(){var q;if(this.parentNode)g("Entity can only be destroyed if detached from scenegraph.");else for(q in this.components)this.components[q].destroy()}}});function _(q,V){return!(!q.components[V]||!q.components[V].attrValue)||function O(q,V){var ne,ae=!1;for(ne=0;ne<V.length&&!(ae=V[ne].hasAttribute(q));++ne);return ae}(V,q.mixinEls)}function D(q,V){return V?V.constructor===Object?d.extend(V,d.styleParser.parse(q||{})):q||V:q}function B(q){return-1!==q.indexOf(v)&&(q=d.split(q,v)[0]),!!c[q]}A=u("a-entity",{prototype:M}),C.exports=A},{"../lib/three":178,"../utils/":204,"./a-node":128,"./a-register-element":129,"./component":130}],127:[function(h,C,m){var s=h("./a-node"),c=h("./a-register-element").registerElement,u=h("./component").components,p=h("../utils");C.exports=c("a-mixin",{prototype:Object.create(s.prototype,{createdCallback:{value:function(){this.componentCache={},this.id=this.getAttribute("id"),this.isMixin=!0}},attributeChangedCallback:{value:function(A,E,g){this.cacheAttribute(A,g),this.updateEntities()}},attachedCallback:{value:function(){this.sceneEl=this.closestScene(),this.cacheAttributes(),this.updateEntities(),this.load()}},setAttribute:{value:function(A,E){window.HTMLElement.prototype.setAttribute.call(this,A,E),this.cacheAttribute(A,E)}},cacheAttribute:{value:function(A,E){var g,v;v=p.split(A,"__")[0],(g=u[v])&&(void 0===E&&(E=window.HTMLElement.prototype.getAttribute.call(this,A)),this.componentCache[A]=g.parseAttrValueForCache(E))}},getAttribute:{value:function(A){return this.componentCache[A]||window.HTMLElement.prototype.getAttribute.call(this,A)}},cacheAttributes:{value:function(){var g,A=this.attributes;for(g=0;g<A.length;g++)this.cacheAttribute(A[g].name)}},updateEntities:{value:function(){var A,E,g;if(this.sceneEl)for(E=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),g=0;g<E.length;g++)(A=E[g]).hasLoaded&&!A.isMixin&&A.mixinUpdate(this.id)}}})})},{"../utils":204,"./a-node":128,"./a-register-element":129,"./component":130}],128:[function(h,C,m){var A,E,g,s=h("./a-register-element").registerElement,c=h("./a-register-element").isNode,u=h("../utils/"),p=u.debug("core:a-node:warn"),d=u.debug("core:a-node:error");C.exports=s("a-node",{prototype:Object.create(window.HTMLElement.prototype,{createdCallback:{value:function(){this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]},writable:window.debug},attachedCallback:{value:function(){var A;this.sceneEl=this.closestScene(),this.sceneEl||p("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(A=this.getAttribute("mixin"))&&this.updateMixins(A)},writable:window.debug},attributeChangedCallback:{value:function(A,E,g){g!==this.computedMixinStr&&"mixin"===A&&!this.isMixin&&this.updateMixins(g,E)}},closestScene:{value:function(){for(var E=this;E&&!E.isScene;)E=E.parentElement;return E}},closest:{value:function(E){for(var g=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,v=this;v&&!g.call(v,E);)v=v.parentElement;return v}},detachedCallback:{value:function(){this.hasLoaded=!1}},load:{value:function(A,E){var v,T=this;this.hasLoaded||(E=E||c,v=this.getChildren().filter(E).map(function(y){return new Promise(function(_){if(y.hasLoaded)return _();y.addEventListener("loaded",_)})}),Promise.all(v).then(function(){T.hasLoaded=!0,A&&A(),T.emit("loaded",void 0,!1)}).catch(function(y){d("Failure loading node: ",y)}))},writable:!0},getChildren:{value:function(){return Array.prototype.slice.call(this.children,0)}},updateMixins:{value:(A=[],E=[],g={},function(v,T){var y,M,_;for(A.length=0,E.length=0,M=v?u.split(v.trim(),/\s+/):A,_=T?u.split(T.trim(),/\s+/):E,g.newMixinIds=M,g.oldMixinIds=_,y=0;y<_.length;y++)-1===M.indexOf(_[y])&&this.unregisterMixin(_[y]);for(this.computedMixinStr="",this.mixinEls.length=0,y=0;y<M.length;y++)this.registerMixin(document.getElementById(M[y]));return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),g})},registerMixin:{value:function(A){var E,g,v;if(A){if(v=A.getAttribute("mixin"))for(E=u.split(v.trim(),/\s+/),g=0;g<E.length;g++)this.registerMixin(document.getElementById(E[g]));this.computedMixinStr=this.computedMixinStr+" "+A.id,this.mixinEls.push(A)}}},setAttribute:{value:function(A,E){"mixin"===A&&this.updateMixins(E),window.HTMLElement.prototype.setAttribute.call(this,A,E)}},unregisterMixin:{value:function(A){var E,g=this.mixinEls;for(E=0;E<g.length;++E)if(A===g[E].id){g.splice(E,1);break}}},emit:{value:function(){var A={};return function(E,g,v,T){void 0===v&&(v=!0),A.bubbles=!!v,A.detail=g,T&&(A=u.extend({},T,A)),this.dispatchEvent(new CustomEvent(E,A))}}(),writable:window.debug}})})},{"../utils/":204,"./a-register-element":129}],129:[function(h,C,m){h("document-register-element");var s,c,u=C.exports.knownTags={};function E(T,y,M,_){y.forEach(function(O){!function g(T,y,M,_){var O=M[y],D=_[y];!O||!D||O!==D&&(T[y]={value:function(){return D.apply(this,arguments),O.apply(this,arguments)},writable:window.debug})}(T,O,M,_)})}function v(T,y){Object.getOwnPropertyNames(T).forEach(function(_){var O;y[_]||(O=Object.getOwnPropertyDescriptor(T,_),y[_]={value:T[_],writable:O.writable})})}C.exports.isNode=function(T){return T.tagName.toLowerCase()in u||T.isNode},C.exports.registerElement=function(T,y){var M=Object.getPrototypeOf(y.prototype),_=y,O=s&&M===s.prototype,D=c&&M===c.prototype;return(O||D)&&function p(T){u[T.toLowerCase()]=!0}(T),O&&(_=function d(T){var y={};return E(y,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],T,s.prototype),v(T,y),y}(y.prototype),_={prototype:Object.create(M,_)}),D&&(_=function A(T){var y={};return E(y,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],T,s.prototype),E(y,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],T,c.prototype),v(T,y),y}(y.prototype),_={prototype:Object.create(M,_)}),Object.getOwnPropertyNames(_.prototype).forEach(function(B){var H=_.prototype[B];"function"==typeof H&&(H.displayName=B)}),document.registerElement(T,_)},C.exports.wrapMethods=E,s=h("./a-node"),c=h("./a-entity")},{"./a-entity":126,"./a-node":128,"document-register-element":12}],130:[function(h,C,m){var s=h("./schema"),c=h("./scene/scenes"),u=h("./system"),p=h("../utils/"),d=C.exports.components={},A=s.parseProperties,E=s.parseProperty,g=s.process,v=s.isSingleProperty,T=s.stringifyProperties,y=s.stringifyProperty,M=p.styleParser,_=p.debug("core:component:warn"),O=document.currentScript,D=new RegExp("[A-Z]+"),B={},H=C.exports.Component=function(W,te,ce){var Se=this;this.el=W,this.id=ce,this.attrName=this.name+(ce?"__"+ce:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.isSingleProperty=v(this.schema),this.isSinglePropertyObject=this.isSingleProperty&&P(E(void 0,this.schema))&&!(this.schema.default instanceof window.HTMLElement),this.isObjectBased=!this.isSingleProperty||this.isSinglePropertyObject,this.el.components[this.attrName]=this,this.objectPool=B[this.name];const _e=this.events;this.events={},function q(W,te){var ce;for(ce in te)W.events[ce]=te[ce].bind(W)}(this,_e),this.attrValue=void 0,this.isObjectBased?(this.nextData=this.objectPool.use(),p.objectPool.removeUnusedKeys(this.nextData,this.schema),this.oldData=this.objectPool.use(),p.objectPool.removeUnusedKeys(this.oldData,this.schema),this.previousOldData=this.objectPool.use(),p.objectPool.removeUnusedKeys(this.previousOldData,this.schema),this.parsingAttrValue=this.objectPool.use(),p.objectPool.removeUnusedKeys(this.parsingAttrValue,this.schema)):(this.nextData=void 0,this.oldData=void 0,this.previousOldData=void 0,this.parsingAttrValue=void 0),this.throttledEmitComponentChanged=p.throttle(function(){W.emit("componentchanged",Se.evtDetail,!1)},200),this.updateProperties(te)};if(H.prototype={schema:{},init:function(){},events:{},update:function(W){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},parse:function(W,te){var ce=this.schema;return this.isSingleProperty?E(W,ce):A(M.parse(W),ce,!0,this.name,te)},stringify:function(W){var te=this.schema;return"string"==typeof W?W:this.isSingleProperty?y(W,te):(W=T(W,te),M.stringify(W))},updateCachedAttrValue:function(W,te){var ce,Se,_e;if(void 0!==W){if(null===W)return this.isObjectBased&&this.attrValue&&this.objectPool.recycle(this.attrValue),void(this.attrValue=void 0);if(W instanceof Object&&!(W instanceof window.HTMLElement)?(Se=this.objectPool.use(),ce=p.extend(Se,W)):ce=this.parseAttrValueForCache(W),this.isObjectBased&&!te&&this.attrValue)for(_e in this.attrValue)void 0===ce[_e]&&(ce[_e]=this.attrValue[_e]);this.isObjectBased&&!this.attrValue&&(this.attrValue=this.objectPool.use()),p.objectPool.clearObject(this.attrValue),this.attrValue=ae(this.attrValue,ce,this.isObjectBased),p.objectPool.clearObject(Se)}},parseAttrValueForCache:function(W){var te;return"string"!=typeof W?W:(this.isSingleProperty?"string"==typeof(te=this.schema.parse(W))&&(te=W):(p.objectPool.clearObject(this.parsingAttrValue),te=M.parse(W,this.parsingAttrValue)),te)},flushToDOM:function(W){var te=W?this.data:this.attrValue;null!=te&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(te))},updateProperties:function(W,te){this.el.hasLoaded?(null!==W&&(W=this.parseAttrValueForCache(W)),this.updateCachedAttrValue(W,te),this.initialized?(this.updateComponent(W,te),this.callUpdateHandler()):this.initComponent()):this.updateCachedAttrValue(W)},initComponent:function(){var te,W=this.el;this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!1,!0)),this.data=this.buildData(this.attrValue),!W.initializingComponents[this.name]&&(W.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete W.initializingComponents[this.name],this.oldData=ae(this.oldData,this.data,this.isObjectBased),te=this.isObjectBased?this.objectPool.use():void 0,this.update(te),this.isObjectBased&&this.objectPool.recycle(te),W.isPlaying&&this.play(),W.emit("componentinitialized",this.evtDetail,!1))},updateComponent:function(W,te){var ce,Se;if(te)return this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),void(this.data=this.buildData(this.attrValue,!0,!1));if(this.isSingleProperty)return this.isObjectBased&&E(W,this.schema),void(this.data=W);if(A(W,this.schema,!0,this.name),this.schemaChangeKeys.length)for(ce in W)if(this.schema[ce].schemaChange){Se=!0;break}if(Se)return this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),void(this.data=this.buildData(this.attrValue,!0,!1));for(ce in W)void 0!==W[ce]&&(this.data[ce]=W[ce])},callUpdateHandler:function(){var W;this.previousOldData instanceof Object&&p.objectPool.clearObject(this.previousOldData),this.isObjectBased?ne(this.previousOldData,this.oldData):this.previousOldData=this.oldData,W=!p.deepEqual(this.oldData,this.data),(this.isPositionRotationScale||W)&&(this.oldData instanceof Object&&p.objectPool.clearObject(this.oldData),this.oldData=ae(this.oldData,this.data,this.isObjectBased),this.update(this.previousOldData),this.throttledEmitComponentChanged())},handleMixinUpdate:function(){this.data=this.buildData(this.attrValue),this.callUpdateHandler()},resetProperty:function(W){if(this.isObjectBased){if(!(W in this.attrValue))return;delete this.attrValue[W],this.data[W]=this.schema[W].default}else this.attrValue=this.schema.default,this.data=this.schema.default;this.updateProperties(this.attrValue)},extendSchema:function(W){var te;te=p.extend({},d[this.name].schema),p.extend(te,W),this.schema=g(te),this.el.emit("schemachanged",this.evtDetail)},buildData:function(W,te,ce){var Se,_e,ze,rt,gt,un,sn,Tt=this.nextData,$t=this.schema,In=this.el.mixinEls;if(Se=W&&W.constructor===Array?W.length:null!=W,this.isObjectBased&&p.objectPool.clearObject(Tt),this.isSingleProperty)_e=this.isObjectBased?ne(Tt,$t.default):X($t.default)?p.clone($t.default):$t.default;else for(rt in _e=(sn=!te&&this.attrValue)instanceof Object?ne(Tt,sn):Tt,$t)ze=$t[rt].default,void 0===_e[rt]&&(_e[rt]=X(ze)?p.clone(ze):ze);for(un=0;un<In.length;un++)(gt=In[un].getAttribute(this.attrName))&&(_e=ae(_e,gt,this.isObjectBased));if(Se){if(this.isSingleProperty)return P(W)?(ne(this.parsingAttrValue,W),E(this.parsingAttrValue,$t)):E(W,$t);_e=ae(_e,W,this.isObjectBased)}else if(this.isSingleProperty)return E(_e,$t);return A(_e,$t,void 0,this.name,ce)},eventsAttach:function(){var W;for(W in this.eventsDetach(),this.events)this.el.addEventListener(W,this.events[W])},eventsDetach:function(){var W;for(W in this.events)this.el.removeEventListener(W,this.events[W])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.oldData),this.objectPool.recycle(this.parsingAttrValue),this.attrValue=this.oldData=this.parsingAttrValue=void 0}},window.debug)var V=C.exports.registrationOrderWarnings={};function ne(W,te){var ce,Se;for(Se in te)void 0!==te[Se]&&(W[Se]=X(ce=te[Se])?p.clone(ce):ce);return W}function ae(W,te,ce){var Se;if(ce&&te.constructor===Object){for(Se in te)void 0!==te[Se]&&(W[Se]=te[Se]&&te[Se].constructor===Object?p.clone(te[Se]):te[Se]);return W}return te}function fe(W){return W.tick||W.tock}function P(W){return W&&W.constructor===Object&&!(W instanceof window.HTMLElement)}function X(W){return W&&(W.constructor===Object||W.constructor===Array)&&!(W instanceof window.HTMLElement)}C.exports.registerComponent=function(W,te){var ce,Se,ze,rt,_e={};if(document.currentScript&&document.currentScript!==O&&c.forEach(function(Tt){Tt.hasLoaded||document.currentScript.compareDocumentPosition(Tt)!==Node.DOCUMENT_POSITION_FOLLOWING&&(_("The component `"+W+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(V[W]=!0))}),!0===D.test(W)&&_("The component name `"+W+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+W.toLowerCase()+"`"),-1!==W.indexOf("__"))throw new Error("The component name `"+W+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(te).forEach(function(gt){_e[gt]={value:te[gt],writable:!0}}),d[W])throw new Error("The component `"+W+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");if(((ce=function(gt,Tt,$t){H.call(this,gt,Tt,$t)}).prototype=Object.create(H.prototype,_e)).name=W,ce.prototype.isPositionRotationScale="position"===W||"rotation"===W||"scale"===W,ce.prototype.constructor=ce,ce.prototype.system=u&&u.systems[W],ce.prototype.play=function me(W){return function(){var ce=this.el.sceneEl;!this.initialized||!this.el.isPlaying||this.isPlaying||(W.call(this),this.isPlaying=!0,this.eventsAttach(),fe(this)&&ce.addBehavior(this))}}(ce.prototype.play),ce.prototype.pause=function he(W){return function(){var ce=this.el.sceneEl;this.isPlaying&&(W.call(this),this.isPlaying=!1,this.eventsDetach(),fe(this)&&ce.removeBehavior(this))}}(ce.prototype.pause),ze=p.extend(g(ce.prototype.schema,ce.prototype.name)),!(rt=v(ce.prototype.schema)))for(Se in ce.prototype.schemaChangeKeys=[],ze)ze[Se].schemaChange&&ce.prototype.schemaChangeKeys.push(Se);return B[W]=p.objectPool.createPool(),d[W]={Component:ce,dependencies:ce.prototype.dependencies,isSingleProp:rt,multiple:ce.prototype.multiple,name:W,parse:ce.prototype.parse,parseAttrValueForCache:ce.prototype.parseAttrValueForCache,schema:ze,stringify:ce.prototype.stringify,type:ce.prototype.type},ce}},{"../utils/":204,"./scene/scenes":137,"./schema":139,"./system":141}],131:[function(h,C,m){var c=h("./schema").process,u=C.exports.geometries={},p=C.exports.geometryNames=[],d=h("../lib/three"),A=C.exports.Geometry=function(){};A.prototype={schema:{},init:function(E){return this.geometry=new d.Geometry,this.geometry},update:function(E){}},C.exports.registerGeometry=function(E,g){var v,T={};if(Object.keys(g).forEach(function(M){T[M]={value:g[M],writable:!0}}),u[E])throw new Error("The geometry `"+E+"` has been already registered");return((v=function(){A.call(this)}).prototype=Object.create(A.prototype,T)).name=E,v.prototype.constructor=v,u[E]={Geometry:v,schema:c(v.prototype.schema)},p.push(E),v}},{"../lib/three":178,"./schema":139}],132:[function(h,C,m){var s=h("../utils/coordinates"),c=h("debug"),u=c("core:propertyTypes:warn"),p=c("core:propertyTypes:warn"),d=C.exports.propertyTypes={},A=/[,> .[\]:]/,E=/\url\((.+)\)/;function g(P,X,W,te){"type"in d?u("Property type "+P+" is already registered."):d[P]={default:X,parse:W||M,stringify:te||_}}function y(P){var X,W;return"string"!=typeof P?P:(W=P.match(E))?W[1]:"#"===P.charAt(0)?(X=document.getElementById(P.substring(1)))?"CANVAS"===X.tagName||"VIDEO"===X.tagName||"IMG"===X.tagName?X:X.getAttribute("src"):void p('"'+P+'" asset not found.'):P}function M(P){return P}function _(P){return null===P?"null":P.toString()}function D(P){return parseInt(P,10)}function fe(P){return s.parse(P,this.default)}function me(P,X){return null===P||"object"==typeof P&&Object.keys(P).length===X&&!("number"!=typeof P.x||"number"!=typeof P.y||X>2&&"number"!=typeof P.z||X>3&&"number"!=typeof P.w)}g("audio","",y),g("array",[],function v(P){return Array.isArray(P)?P:P&&"string"==typeof P?P.split(",").map(function X(W){return W.trim()}):[]},function T(P){return P.join(", ")}),g("asset","",y),g("boolean",!1,function O(P){return"false"!==P&&!1!==P}),g("color","#FFF",M,_),g("int",0,D),g("number",0,function B(P){return parseFloat(P,10)}),g("map","",y),g("model","",y),g("selector",null,function H(P){return P?"string"!=typeof P?P:"#"!==P[0]||A.test(P)?document.querySelector(P):document.getElementById(P.substring(1)):null},function V(P){return P.getAttribute?"#"+P.getAttribute("id"):_(P)}),g("selectorAll",null,function q(P){return P?"string"!=typeof P?P:Array.prototype.slice.call(document.querySelectorAll(P),0):null},function ne(P){return P instanceof Array?P.map(function(X){return"#"+X.getAttribute("id")}).join(", "):_(P)}),g("src","",function ae(P){return p("`src` property type is deprecated. Use `asset` instead."),y(P)}),g("string","",M,_),g("time",0,D),g("vec2",{x:0,y:0},fe,s.stringify),g("vec3",{x:0,y:0,z:0},fe,s.stringify),g("vec4",{x:0,y:0,z:0,w:1},fe,s.stringify),C.exports.registerPropertyType=g,C.exports.isValidDefaultValue=function he(P,X){return!("audio"===P&&"string"!=typeof X||"array"===P&&!Array.isArray(X)||"asset"===P&&"string"!=typeof X||"boolean"===P&&"boolean"!=typeof X||"color"===P&&"string"!=typeof X||"int"===P&&"number"!=typeof X||"number"===P&&"number"!=typeof X||"map"===P&&"string"!=typeof X||"model"===P&&"string"!=typeof X||"selector"===P&&"string"!=typeof X&&null!==X||"selectorAll"===P&&"string"!=typeof X&&null!==X||"src"===P&&"string"!=typeof X||"string"===P&&"string"!=typeof X||"time"===P&&"number"!=typeof X)&&("vec2"===P?me(X,2):"vec3"===P?me(X,3):"vec4"!==P||me(X,4))},C.exports.isValidDefaultCoordinate=me},{"../utils/coordinates":199,debug:8}],133:[function(h,C,m){var s=h("./metaTags").inject,c=h("./wakelock"),u=h("./loadingScreen"),p=h("../a-register-element"),d=h("./scenes"),A=h("../system").systems,E=h("../../lib/three"),g=h("../../utils/"),v=h("../a-entity"),T=h("../a-node"),y=h("./postMessage"),M=g.bind,_=g.device.isIOS(),O=g.device.isMobile(),D=g.device.isWebXRAvailable,B=p.registerElement,H=g.debug("core:a-scene:warn");function q(he,me,P,X){return he.parentElement?me?{height:he.parentElement.offsetHeight,width:he.parentElement.offsetWidth}:function V(he,me){var P,X,W=window.devicePixelRatio;return X={height:document.body.offsetHeight,width:document.body.offsetWidth},!he||me||-1===he.width&&-1===he.height||X.width*W<he.width&&X.height*W<he.height||(P=X.width/X.height,X.width*W>he.width&&-1!==he.width&&(X.width=Math.round(he.width/W),X.height=Math.round(he.width/P/W)),X.height*W>he.height&&-1!==he.height&&(X.height=Math.round(he.height/W),X.width=Math.round(he.height*P/W))),X}(P,X):{height:0,width:0}}function fe(he){var me;function P(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||he.exitVR(),document.activeElement.blur(),document.body.focus()}(me=document.createElement("canvas")).classList.add("a-canvas"),me.dataset.aframeCanvas=!0,he.appendChild(me),document.addEventListener("fullscreenchange",P),document.addEventListener("mozfullscreenchange",P),document.addEventListener("webkitfullscreenchange",P),document.addEventListener("MSFullscreenChange",P),me.addEventListener("touchmove",function(X){X.preventDefault()}),he.canvas=me,he.emit("render-target-loaded",{target:me}),setTimeout(M(he.resize,he),0)}_&&h("../../utils/ios-orientationchange-blank-bug"),C.exports.AScene=B("a-scene",{prototype:Object.create(v.prototype,{createdCallback:{value:function(){this.clock=new E.Clock,this.isIOS=_,this.isMobile=O,this.hasWebXR=D,this.isAR=!1,this.isScene=!0,this.object3D=new E.Scene;var he=this;this.object3D.onAfterRender=function(me,P,X){he.isPlaying&&he.tock(he.time,he.delta,X)},this.resize=M(this.resize,this),this.render=M(this.render,this),this.systems={},this.systemNames=[],this.time=this.delta=0,this.behaviors={tick:[],tock:[]},this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("vr-mode-ui",""),this.setAttribute("device-orientation-permission-ui","")}},addFullScreenStyles:{value:function(){document.documentElement.classList.add("a-fullscreen")}},removeFullScreenStyles:{value:function(){document.documentElement.classList.remove("a-fullscreen")}},attachedCallback:{value:function(){var he=this,me=this.hasAttribute("embedded");fe(this),this.setupRenderer(),u.setup(this,q),this.resize(),me||this.addFullScreenStyles(),y(this),s(this),c(this),this.onVRPresentChangeBound=M(this.onVRPresentChange,this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){he.enterVR()},this.exitVRBound=function(){he.exitVR()},this.exitVRTrueBound=function(){he.exitVR(!0)},this.pointerRestrictedBound=function(){he.pointerRestricted()},this.pointerUnrestrictedBound=function(){he.pointerUnrestricted()},D||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){he.attachedCallbackPostCamera()}),this.initSystems(),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){he.enterVR()})}},attachedCallbackPostCamera:{value:function(){var me=this;window.addEventListener("load",void 0),window.addEventListener("resize",function(){me.isIOS?setTimeout(me.resize,100):me.resize()}),this.play(),d.push(this)},writable:window.debug},initSystems:{value:function(){var he;for(he in this.initSystem("camera"),A)"camera"!==he&&this.initSystem(he)}},initSystem:{value:function(he){this.systems[he]||(this.systems[he]=new A[he](this),this.systemNames.push(he))}},detachedCallback:{value:function(){var he=d.indexOf(this);d.splice(he,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize)}},addBehavior:{value:function(he){var me,X,P=this.behaviors;for(X in P)he[X]&&-1===(me=this.behaviors[X]).indexOf(he)&&me.push(he)}},getPointerLockElement:{value:function(){return document.pointerLockElement},writable:window.debug},checkHeadsetConnected:{value:g.device.checkHeadsetConnected,writable:window.debug},enterAR:{value:function(){var he;if(!this.hasWebXR)throw he="Failed to enter AR mode, WebXR not supported.",new Error(he);if(!g.device.checkARSupport())throw he="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(he);return this.enterVR(!0)}},enterVR:{value:function(he){var P,W,me=this,X=me.renderer.xr;if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){if(X.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound),X.setReferenceSpaceType(this.sceneEl.systems.webxr.sessionReferenceSpaceType);var ce=he?"immersive-ar":"immersive-vr";return W=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(gt,Tt){navigator.xr.requestSession(ce,W).then(function(un){me.xrSession=un,X.layersEnabled=-1!==W.requiredFeatures.indexOf("layers"),X.setSession(un),un.addEventListener("end",me.exitVRBound),me.addState(he?"ar-mode":"vr-mode"),ze(gt)},function(un){throw new Error("Failed to enter "+("immersive-ar"===ce?"AR":"VR")+" mode (`requestSession`) "+un)})})}if(P=g.device.getVRDisplay(),me.addState("vr-mode"),X.setDevice(P),P.isPresenting&&!window.hasNativeWebVRImplementation)return ze(),Promise.resolve();var Se=this.getAttribute("renderer");return P.requestPresent([{source:this.canvas,attributes:{highRefreshRate:Se.highRefreshRate,foveationLevel:Se.foveationLevel}}]).then(ze,function rt(gt){throw me.removeState("vr-mode"),gt&&gt.message?new Error("Failed to enter VR mode (`requestPresent`): "+gt.message):new Error("Failed to enter VR mode (`requestPresent`).")})}return ze(),Promise.resolve();function ze(gt){var Tt;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(Tt=new CustomEvent("vrdisplaypresentchange",{detail:{display:g.device.getVRDisplay()}}),window.dispatchEvent(Tt)),me.emit("enter-vr",{target:me}),!D&&me.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),me.addFullScreenStyles(),!me.isMobile&&!me.checkHeadsetConnected()&&function ne(he){(he.requestFullscreen||he.webkitRequestFullscreen||he.mozRequestFullScreen||he.msRequestFullscreen).apply(he,[{navigationUI:"hide"}])}(me.canvas),me.renderer.setAnimationLoop(me.render),me.resize(),gt&&gt()}},writable:!0},exitVR:{value:function(){var me,he=this,P=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(P.enabled=!1,me=g.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0,P.setSession(null);else if(me.isPresenting)return me.exitPresent().then(X,function W(te){throw te&&te.message?new Error("Failed to exit VR mode (`exitPresent`): "+te.message):new Error("Failed to exit VR mode (`exitPresent`).")})}else!function ae(){(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}();return X(),Promise.resolve();function X(){he.removeState("vr-mode"),he.removeState("ar-mode"),he.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),he.hasAttribute("embedded")&&he.removeFullScreenStyles(),he.resize(),he.isIOS&&g.forceCanvasResizeSafariMobile(he.canvas),he.renderer.setPixelRatio(window.devicePixelRatio),he.emit("exit-vr",{target:he})}},writable:!0},pointerRestricted:{value:function(){if(this.canvas){var he=this.getPointerLockElement();he&&he!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}},pointerUnrestricted:{value:function(){var he=this.getPointerLockElement();he&&he===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}},onVRPresentChange:{value:function(he){var me=he.display||he.detail.display;me&&me.isPresenting?this.enterVR():this.exitVR()}},getAttribute:{value:function(he){var me=this.systems[he];return me?me.data:v.prototype.getAttribute.call(this,he)}},getComputedAttribute:{value:function(he){H("`getComputedAttribute` is deprecated. Use `getAttribute` instead."),this.getAttribute(he)}},getDOMAttribute:{value:function(he){var me=this.systems[he];return me?me.data:v.prototype.getDOMAttribute.call(this,he)}},setAttribute:{value:function(he,me,P){var X=this.systems[he];if(X)return T.prototype.setAttribute.call(this,he,me),void X.updateProperties(me);v.prototype.setAttribute.call(this,he,me,P)}},removeBehavior:{value:function(he){var me,P,W,X=this.behaviors;for(P in X)he[P]&&-1!==(W=(me=this.behaviors[P]).indexOf(he))&&me.splice(W,1)}},resize:{value:function(){var X,W,he=this.camera,me=this.canvas;X=this.renderer.xr.enabled&&this.renderer.xr.isPresenting,he&&me&&(!this.is("vr-mode")||!this.isMobile&&!X)&&(W=q(me,this.getAttribute("embedded")&&!this.is("vr-mode"),this.maxCanvasSize,this.is("vr-mode")),he.aspect=W.width/W.height,he.updateProjectionMatrix(),this.renderer.setSize(W.width,W.height,!1),this.emit("rendererresize",null,!1))},writable:!0},setupRenderer:{value:function(){var me,P,X,W,he=this;W={alpha:!0,antialias:!O,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:1920,width:1920},this.hasAttribute("renderer")&&(X=this.getAttribute("renderer"),(P=g.styleParser.parse(X)).precision&&(W.precision=P.precision+"p"),P.antialias&&"auto"!==P.antialias&&(W.antialias="true"===P.antialias),P.logarithmicDepthBuffer&&"auto"!==P.logarithmicDepthBuffer&&(W.logarithmicDepthBuffer="true"===P.logarithmicDepthBuffer),P.alpha&&(W.alpha="true"===P.alpha),this.maxCanvasSize={width:P.maxCanvasWidth?parseInt(P.maxCanvasWidth):this.maxCanvasSize.width,height:P.maxCanvasHeight?parseInt(P.maxCanvasHeight):this.maxCanvasSize.height}),(me=this.renderer=new E.WebGLRenderer(W)).setPixelRatio(window.devicePixelRatio),me.sortObjects=!1,this.camera&&me.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){me.xr.setPoseTarget(he.camera.el.object3D)})},writable:window.debug},play:{value:function(){var he=this,me=this;this.renderStarted?v.prototype.play.call(this):(this.addEventListener("loaded",function(){var X,P=this.renderer,W=this.renderer.xr;v.prototype.play.call(this),!me.renderStarted&&(me.resize(),me.renderer&&(window.performance&&window.performance.mark("render-started"),u.remove(),(X=g.device.getVRDisplay())&&X.isPresenting&&(W.setDevice(X),W.enabled=!0,me.enterVR()),P.setAnimationLoop(this.render),me.renderStarted=!0,me.emit("renderstart")))}),setTimeout(function(){v.prototype.load.call(he)}))}},updateComponent:{value:function(he){he in A||v.prototype.updateComponent.apply(this,arguments)}},tick:{value:function(he,me){var P,X=this.systems;for(P=0;P<this.behaviors.tick.length;P++)this.behaviors.tick[P].el.isPlaying&&this.behaviors.tick[P].tick(he,me);for(P=0;P<this.systemNames.length;P++)X[this.systemNames[P]].tick&&X[this.systemNames[P]].tick(he,me)}},tock:{value:function(he,me,P){var X,W=this.systems;for(X=0;X<this.behaviors.tock.length;X++)this.behaviors.tock[X].el.isPlaying&&this.behaviors.tock[X].tock(he,me,P);for(X=0;X<this.systemNames.length;X++)W[this.systemNames[X]].tock&&W[this.systemNames[X]].tock(he,me,P)}},render:{value:function(he,me){var P=this.renderer;this.frame=me,this.delta=1e3*this.clock.getDelta(),this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,this.delta);var X=null;this.is("ar-mode")&&(X=this.object3D.background,this.object3D.background=null),P.render(this.object3D,this.camera),X&&(this.object3D.background=X)},writable:!0}})}),C.exports.setupCanvas=fe},{"../../lib/three":178,"../../utils/":204,"../../utils/ios-orientationchange-blank-bug":205,"../a-entity":126,"../a-node":128,"../a-register-element":129,"../system":141,"./loadingScreen":134,"./metaTags":135,"./postMessage":136,"./scenes":137,"./wakelock":138}],134:[function(h,C,m){var u,p,d,c=h("../../utils/").styleParser,A="loading-screen";function g(T){var y=u.hasAttribute("embedded"),M=d(u.canvas,y,u.maxCanvasSize,u.is("vr-mode"));T.aspect=M.width/M.height,T.updateProjectionMatrix(),u.renderer.setSize(M.width,M.height,!1)}C.exports.setup=function(y,M){d=M;var H,q,V,ne,ae,fe,he,me,P,X,_=(u=y).hasAttribute(A)?c.parse(u.getAttribute(A)):void 0,O=_&&_.dotsColor||"white",D=_&&_.backgroundColor||"#24CAFF";(void 0===_||"true"===_.enabled||void 0===_.enabled)&&(H=new THREE.Scene,q=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),V=new THREE.MeshBasicMaterial({color:O}),ne=new THREE.Mesh(q,V),ae=ne.clone(),fe=ne.clone(),he=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),me=new THREE.Clock,P=0,X=function(){u.renderer.render(H,he),P=me.getElapsedTime()%4,ne.visible=P>=1,ae.visible=P>=2,fe.visible=P>=3},H.background=new THREE.Color(D),H.add(he),ne.position.set(-1,0,-15),ae.position.set(0,0,-15),fe.position.set(1,0,-15),he.add(ne),he.add(ae),he.add(fe),function v(){(p=document.createElement("div")).className="a-loader-title",p.innerHTML=document.title,p.style.display="none",u.appendChild(p)}(),setTimeout(function(){u.hasLoaded||(g(he),p.style.display="block",window.addEventListener("resize",function(){g(he)}),u.renderer.setAnimationLoop(X))},200))},C.exports.remove=function(){window.removeEventListener("resize",g),p&&(p.style.display="none")}},{"../../utils/":204}],135:[function(h,C,m){var s=h("../../constants/"),c=h("../../utils").extend,u=C.exports.MOBILE_HEAD_TAGS=[d({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),d({name:"mobile-web-app-capable",content:"yes"}),d({name:"theme-color",content:"black"})],p=[d({name:"apple-mobile-web-app-capable",content:"yes"}),d({name:"apple-mobile-web-app-status-bar-style",content:"black"}),function A(g){return{tagName:"link",attributes:g,exists:function(){return document.querySelector('link[rel="'+g.rel+'"]')}}}({rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"})];function d(g){return{tagName:"meta",attributes:g,exists:function(){return document.querySelector('meta[name="'+g.name+'"]')}}}C.exports.inject=function(v){var M,T=document.head,y=T.querySelector("script"),_=[];return u.forEach(O),v.isIOS&&p.forEach(O),_;function O(D){!D||D.exists()||(M=function E(g){if(g&&g.tagName){var v=document.createElement(g.tagName);return v.setAttribute(s.AFRAME_INJECTED,""),c(v,g.attributes)}}(D),M&&(y?y.parentNode.insertBefore(M,y):T.appendChild(M),_.push(M)))}}},{"../../constants/":122,"../../utils":204}],136:[function(h,C,m){var s=h("../../utils/bind"),c=h("../../utils/").isIframed;function u(p){if(p.data&&"vr"===p.data.type)switch(p.data.data){case"enter":this.enterVR();break;case"exit":this.exitVR()}}C.exports=function(d){c()&&window.addEventListener("message",s(u,d))}},{"../../utils/":204,"../../utils/bind":198}],137:[function(h,C,m){C.exports=[]},{}],138:[function(h,C,m){var s=h("../../../vendor/wakelock/wakelock");C.exports=function(u){if(u.isMobile){var p=u.wakelock=new s;u.addEventListener("enter-vr",function(){p.request()}),u.addEventListener("exit-vr",function(){p.release()})}}},{"../../../vendor/wakelock/wakelock":219}],139:[function(h,C,m){var y,s=h("../utils/"),c=h("./propertyTypes"),p=c.isValidDefaultValue,d=c.propertyTypes,A=(0,s.debug)("core:schema:warn");function E(y){return"type"in y?"string"==typeof y.type:"default"in y}function g(y,M){var O,D,_=y.default,B=y.type;return y.type?"bool"===y.type?B="boolean":"float"===y.type&&(B="number"):B=void 0===_||"boolean"!=typeof _&&"number"!=typeof _?Array.isArray(_)?"array":"string":typeof _,(D=d[B])||A("Unknown property type for component `"+M+"`: "+B),O=!!y.parse,y.parse=y.parse||D.parse,y.stringify=y.stringify||D.stringify,y.type=B,"default"in y?!O&&!p(B,_)&&A("Default value `"+_+"` does not match type `"+B+"` in component `"+M+"`"):y.default=D.default,y}function v(y,M){return(null==y||""===y)&&(y=M.default,Array.isArray(y)&&(y=y.slice())),M.parse(y,M.default)}function T(y,M){return"object"!=typeof y?y:M&&null!==y?M.stringify(y):JSON.stringify(y)}C.exports.isSingleProperty=E,C.exports.process=function(y,M){var _;if(E(y))return g(y,M);for(_ in y)y[_]=g(y[_],M);return y},C.exports.processPropertyDefinition=g,C.exports.parseProperties=(y=[],function(M,_,O,D,B){var H,q;for(q in y.length=0,O?M:_)O&&void 0===M[q]||y.push(q);if(null===M||"object"!=typeof M)return M;for(q in M)void 0!==M[q]&&!_[q]&&!B&&A("Unknown property `"+q+"` for component/system `"+D+"`.");for(H=0;H<y.length;H++){if(!_[q=y[H]])return;M[q]=v(M[q],_[q])}return M}),C.exports.parseProperty=v,C.exports.stringifyProperties=function(y,M){var _,O,D,H,B={};for(_ in y)O=M[_],"object"==typeof(H=D=y[_])&&(H=T(D,O),O||A("Unknown component property: "+_)),B[_]=H;return B},C.exports.stringifyProperty=T},{"../utils/":204,"./propertyTypes":132}],140:[function(h,C,m){var c=h("./schema").process,u=C.exports.shaders={},p=C.exports.shaderNames=[],d=h("../lib/three"),A=h("../utils"),E={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},g=C.exports.Shader=function(){};g.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(v){return this.attributes=this.initVariables(v,"attribute"),this.uniforms=this.initVariables(v,"uniform"),this.material=new(this.raw?d.RawShaderMaterial:d.ShaderMaterial)({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initVariables:function(v,T){var y,M=this.schema,_={};for(y in M)M[y].is===T&&(_[y]={type:E[M[y].type],value:void 0});return _},update:function(v){this.updateVariables(v,"attribute"),this.updateVariables(v,"uniform")},updateVariables:function(v,T){var y,M,O,_=this.schema;for(y in O="uniform"===T?this.uniforms:this.attributes,v)if(_[y]&&_[y].is===T){if("map"===_[y].type){if(!O[y]||O[y].value===v[y])continue;this.setMapOnTextureLoad(O,y,M="_texture_"+y),A.material.updateMapMaterialFromData(M,y,this,v);continue}O[y].value=this.parseValue(_[y].type,v[y]),O[y].needsUpdate=!0}},parseValue:function(v,T){var y;switch(v){case"vec2":return new d.Vector2(T.x,T.y);case"vec3":return new d.Vector3(T.x,T.y,T.z);case"vec4":return new d.Vector4(T.x,T.y,T.z,T.w);case"color":return y=new d.Color(T),new d.Vector3(y.r,y.g,y.b);case"map":return d.ImageUtils.loadTexture(T);default:return T}},setMapOnTextureLoad:function(v,T,y){var M=this;this.el.addEventListener("materialtextureloaded",function(){v[T].value=M.material[y],v[T].needsUpdate=!0})}},C.exports.registerShader=function(v,T){var y,M={};if(Object.keys(T).forEach(function(_){M[_]={value:T[_],writable:!0}}),u[v])throw new Error("The shader "+v+" has been already registered");return((y=function(){g.call(this)}).prototype=Object.create(g.prototype,M)).name=v,y.prototype.constructor=y,u[v]={Shader:y,schema:c(y.prototype.schema)},p.push(v),y}},{"../lib/three":178,"../utils":204,"./schema":139}],141:[function(h,C,m){var s=h("./component"),c=h("./schema"),u=h("../utils/"),p=c.parseProperties,d=c.parseProperty,A=c.process,E=c.isSingleProperty,g=u.styleParser,v=C.exports.systems={},T=C.exports.System=function(y){var M=s&&s.components[this.name];this.el=y,this.sceneEl=y,M&&(M.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};T.prototype={schema:{},init:function(){},update:function(y){},updateProperties:function(y){var M=this.data;Object.keys(c).length&&(this.buildData(y),this.update(M))},buildData:function(y){var M=this.schema;Object.keys(M).length&&(y=y||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),this.data=E(M)?d(y,M):p(g.parse(y)||{},M))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},C.exports.registerSystem=function(y,M){var _,O,D={},B=u.findAllScenes(document);if(Object.keys(M).forEach(function(H){D[H]={value:M[H],writable:!0}}),v[y])throw new Error("The system `"+y+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");for(((O=function(H){T.call(this,H)}).prototype=Object.create(T.prototype,D)).name=y,O.prototype.constructor=O,O.prototype.schema=u.extend(A(O.prototype.schema)),v[y]=O,_=0;_<B.length;_++)B[_].initSystem(y)}},{"../utils/":204,"./component":130,"./schema":139}],142:[function(h,C,m){h("./pivot")},{"./pivot":143}],143:[function(h,C,m){var s=h("../../core/component").registerComponent,c=h("../../lib/three"),u=new c.Vector3,p=new c.Vector3;s("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var d=this.data,A=this.el,E=A.object3D.parent,g=A.object3D,v=new c.Group;u.copy(g.position),p.copy(g.rotation),E.remove(g),v.add(g),E.add(v),A.object3D=v,g.position.set(-1*d.x,-1*d.y,-1*d.z),v.position.set(d.x+u.x,d.y+u.y,d.z+u.z),v.rotation.copy(g.rotation),g.rotation.set(0,0,0)}})},{"../../core/component":130,"../../lib/three":178}],144:[function(h,C,m){var s=h("../../core/component").components,c=h("../../core/shader").shaders,u=h("../../utils/"),p={};function d(A){var E=A.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();"fog"===A&&(E="material-fog"),"visible"===A&&(E="material-visible"),p[E]="material."+A}Object.keys(s.material.schema).forEach(d),Object.keys(c.standard.schema).forEach(d),C.exports=function(){return{defaultComponents:{material:{}},mappings:u.extend({},p)}}},{"../../core/component":130,"../../core/shader":140,"../../utils/":204}],145:[function(h,C,m){h("./primitives/a-camera"),h("./primitives/a-cursor"),h("./primitives/a-curvedimage"),h("./primitives/a-gltf-model"),h("./primitives/a-image"),h("./primitives/a-light"),h("./primitives/a-link"),h("./primitives/a-obj-model"),h("./primitives/a-sky"),h("./primitives/a-sound"),h("./primitives/a-text"),h("./primitives/a-video"),h("./primitives/a-videosphere"),h("./primitives/meshPrimitives")},{"./primitives/a-camera":147,"./primitives/a-cursor":148,"./primitives/a-curvedimage":149,"./primitives/a-gltf-model":150,"./primitives/a-image":151,"./primitives/a-light":152,"./primitives/a-link":153,"./primitives/a-obj-model":154,"./primitives/a-sky":155,"./primitives/a-sound":156,"./primitives/a-text":157,"./primitives/a-video":158,"./primitives/a-videosphere":159,"./primitives/meshPrimitives":160}],146:[function(h,C,m){var s=h("../../core/a-entity"),c=h("../../core/component").components,u=h("../../core/a-register-element").registerElement,p=h("../../utils/"),d=p.debug,A=p.entity.setComponentProperty,E=d("extras:primitives:debug"),g=d("extras:primitives:warn"),v=C.exports.primitives={};C.exports.registerPrimitive=function(_,O){_=_.toLowerCase(),E("Registering <%s>",_),O.defaultAttributes&&g("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var D=u(_,{prototype:Object.create(s.prototype,{defaultComponentsFromPrimitive:{value:O.defaultComponents||O.defaultAttributes||{}},deprecated:{value:O.deprecated||null},deprecatedMappings:{value:O.deprecatedMappings||{}},mappings:{value:O.mappings||{}},createdCallback:{value:function(){O.deprecated&&console.warn(O.deprecated),this.resolveMappingCollisions()}},resolveMappingCollisions:{value:function(){var B=this.mappings,H=this;Object.keys(B).forEach(function(V){var ne;V!==V.toLowerCase()&&g("Mapping keys should be specified in lower case. The mapping key "+V+" may not be recognized"),c[V]&&(ne=B[V].replace(".","-"),B[ne]=B[V],delete B[V],console.warn("The primitive "+H.tagName.toLowerCase()+" has a mapping collision. The attribute "+V+" has the same name as a registered component and has been renamed to "+ne))})}},getExtraComponents:{value:function(){var B,H,q,V,ne,ae,fe=this;for(H=p.clone(this.defaultComponentsFromPrimitive),(ne=this.getAttribute("mixin"))&&(ne=ne.trim().split(" ")).forEach(function(te){var ce=fe.sceneEl.querySelector("#"+te).componentCache;Object.keys(ce).forEach(function(_e){H[_e]=function he(W,te){return me(W)?P(te):me(te)?P(W):X(W)&&X(te)?p.extendDeep(W,te):P(te)}(H[_e],ce[_e])})}),q=0;q<this.attributes.length;q++)if(V=this.mappings[(B=this.attributes[q]).name]){(ae=p.entity.getComponentPropertyPath(V)).constructor===Array?(H[ae[0]]=H[ae[0]]||{},H[ae[0]][ae[1]]=B.value.trim()):H[ae]=B.value.trim();continue}return H;function me(W){return typeof W>"u"}function P(W){return X(W)?p.extendDeep({},W):W}function X(W){return null!==W&&W.constructor===Object}}},attributeChangedCallback:{value:function(B,H,q){var V=this.mappings[B];B in this.deprecatedMappings&&console.warn(this.deprecatedMappings[B]),B&&V&&A(this,V,q)}}})});return v[_]=D,D},C.exports.definePrimitive=function y(M,_,O){O=O||{},Object.keys(_).map(function(B){!function T(M,_){Object.keys(c[M].schema).map(function(D){var B=D.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();void 0!==_[B]&&(B=M+"-"+D),_[B]=M+"."+D})}(B,O)}),C.exports.registerPrimitive(M,p.extendDeep({},null,{defaultComponents:_,mappings:O}))}},{"../../core/a-entity":126,"../../core/a-register-element":129,"../../core/component":130,"../../utils/":204}],147:[function(h,C,m){(0,h("../primitives").registerPrimitive)("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},{"../primitives":146}],148:[function(h,C,m){var s=h("../getMeshMixin");(0,h("../primitives").registerPrimitive)("a-cursor",h("../../../utils/").extendDeep({},s(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},{"../../../utils/":204,"../getMeshMixin":144,"../primitives":146}],149:[function(h,C,m){var s=h("../getMeshMixin");(0,h("../primitives").registerPrimitive)("a-curvedimage",h("../../../utils/").extendDeep({},s(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},{"../../../utils/":204,"../getMeshMixin":144,"../primitives":146}],150:[function(h,C,m){(0,h("../primitives").registerPrimitive)("a-gltf-model",{mappings:{src:"gltf-model"}})},{"../primitives":146}],151:[function(h,C,m){var s=h("../getMeshMixin");(0,h("../primitives").registerPrimitive)("a-image",h("../../../utils/").extendDeep({},s(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":204,"../getMeshMixin":144,"../primitives":146}],152:[function(h,C,m){(0,h("../primitives").registerPrimitive)("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target"}})},{"../primitives":146}],153:[function(h,C,m){(0,h("../primitives").registerPrimitive)("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},{"../primitives":146}],154:[function(h,C,m){var s=h("../getMeshMixin")();(0,h("../primitives").registerPrimitive)("a-obj-model",h("../../../utils/").extendDeep({},s,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},{"../../../utils/":204,"../getMeshMixin":144,"../primitives":146}],155:[function(h,C,m){var s=h("../getMeshMixin"),c=h("../primitives").registerPrimitive,u=h("../../../utils/"),p=h("./meshPrimitives");c("a-sky",u.extendDeep({},s(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:u.extendDeep({},p["a-sphere"].prototype.mappings)}))},{"../../../utils/":204,"../getMeshMixin":144,"../primitives":146,"./meshPrimitives":160}],156:[function(h,C,m){(0,h("../primitives").registerPrimitive)("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},{"../primitives":146}],157:[function(h,C,m){(0,h("../primitives").definePrimitive)("a-text",{text:{anchor:"align",width:5}})},{"../primitives":146}],158:[function(h,C,m){var s=h("../getMeshMixin");(0,h("../primitives").registerPrimitive)("a-video",h("../../../utils/").extendDeep({},s(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":204,"../getMeshMixin":144,"../primitives":146}],159:[function(h,C,m){var s=h("../getMeshMixin");(0,h("../primitives").registerPrimitive)("a-videosphere",h("../../../utils/").extendDeep({},s(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},{"../../../utils/":204,"../getMeshMixin":144,"../primitives":146}],160:[function(h,C,m){var s=h("../getMeshMixin"),c=h("../../../core/geometry").geometries,u=h("../../../core/geometry").geometryNames,p=h("../primitives").registerPrimitive,d=h("../../../utils/"),A=C.exports={};function E(g){return g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}u.forEach(function(v){var T=c[v],y=E(v),M={};Object.keys(T.schema).forEach(function(B){M[E(B)]="geometry."+B});var _="a-"+y,O=p(_,d.extendDeep({},s(),{defaultComponents:{geometry:{primitive:v}},mappings:M}));A[_]=O})},{"../../../core/geometry":131,"../../../utils/":204,"../getMeshMixin":144,"../primitives":146}],161:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three");s("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(u){this.geometry=new c.BoxGeometry(u.width,u.height,u.depth,u.segmentsWidth,u.segmentsHeight,u.segmentsDepth)}})},{"../core/geometry":131,"../lib/three":178}],162:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three"),u=c.Math.degToRad;s("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(p){this.geometry=new c.CircleGeometry(p.radius,p.segments,u(p.thetaStart),u(p.thetaLength))}})},{"../core/geometry":131,"../lib/three":178}],163:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three"),u=c.Math.degToRad;s("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(p){this.geometry=new c.CylinderGeometry(p.radiusTop,p.radiusBottom,p.height,p.segmentsRadial,p.segmentsHeight,p.openEnded,u(p.thetaStart),u(p.thetaLength))}})},{"../core/geometry":131,"../lib/three":178}],164:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three"),u=c.Math.degToRad;s("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(p){this.geometry=new c.CylinderGeometry(p.radius,p.radius,p.height,p.segmentsRadial,p.segmentsHeight,p.openEnded,u(p.thetaStart),u(p.thetaLength))}})},{"../core/geometry":131,"../lib/three":178}],165:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three");s("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(u){this.geometry=new c.DodecahedronGeometry(u.radius,u.detail)}})},{"../core/geometry":131,"../lib/three":178}],166:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three");s("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(u){this.geometry=new c.IcosahedronGeometry(u.radius,u.detail)}})},{"../core/geometry":131,"../lib/three":178}],167:[function(h,C,m){h("./box.js"),h("./circle.js"),h("./cone.js"),h("./cylinder.js"),h("./dodecahedron.js"),h("./icosahedron.js"),h("./octahedron.js"),h("./plane.js"),h("./ring.js"),h("./sphere.js"),h("./tetrahedron.js"),h("./torus.js"),h("./torusKnot.js"),h("./triangle.js")},{"./box.js":161,"./circle.js":162,"./cone.js":163,"./cylinder.js":164,"./dodecahedron.js":165,"./icosahedron.js":166,"./octahedron.js":168,"./plane.js":169,"./ring.js":170,"./sphere.js":171,"./tetrahedron.js":172,"./torus.js":173,"./torusKnot.js":174,"./triangle.js":175}],168:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three");s("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(u){this.geometry=new c.OctahedronGeometry(u.radius,u.detail)}})},{"../core/geometry":131,"../lib/three":178}],169:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three");s("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(u){this.geometry=new c.PlaneGeometry(u.width,u.height,u.segmentsWidth,u.segmentsHeight)}})},{"../core/geometry":131,"../lib/three":178}],170:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three"),u=c.Math.degToRad;s("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(p){this.geometry=new c.RingGeometry(p.radiusInner,p.radiusOuter,p.segmentsTheta,p.segmentsPhi,u(p.thetaStart),u(p.thetaLength))}})},{"../core/geometry":131,"../lib/three":178}],171:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three"),u=c.Math.degToRad;s("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(p){this.geometry=new c.SphereGeometry(p.radius,p.segmentsWidth,p.segmentsHeight,u(p.phiStart),u(p.phiLength),u(p.thetaStart),u(p.thetaLength))}})},{"../core/geometry":131,"../lib/three":178}],172:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three");s("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(u){this.geometry=new c.TetrahedronGeometry(u.radius,u.detail)}})},{"../core/geometry":131,"../lib/three":178}],173:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three"),u=c.Math.degToRad;s("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(p){this.geometry=new c.TorusGeometry(p.radius,2*p.radiusTubular,p.segmentsRadial,p.segmentsTubular,u(p.arc))}})},{"../core/geometry":131,"../lib/three":178}],174:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three");s("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(u){this.geometry=new c.TorusKnotGeometry(u.radius,2*u.radiusTubular,u.segmentsTubular,u.segmentsRadial,u.p,u.q)}})},{"../core/geometry":131,"../lib/three":178}],175:[function(h,C,m){var s=h("../core/geometry").registerGeometry,c=h("../lib/three"),u=new c.Quaternion,p=new c.Vector3(0,0,1),d=new c.Vector2,A=new c.Vector2,E=new c.Vector2;s("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(g){var v,T,y,M,_,O;(y=new c.Triangle).a.set(g.vertexA.x,g.vertexA.y,g.vertexA.z),y.b.set(g.vertexB.x,g.vertexB.y,g.vertexB.z),y.c.set(g.vertexC.x,g.vertexC.y,g.vertexC.z),T=y.getNormal(new c.Vector3),u.setFromUnitVectors(T,p),M=y.a.clone().applyQuaternion(u),_=y.b.clone().applyQuaternion(u),O=y.c.clone().applyQuaternion(u),d.set(Math.min(M.x,_.x,O.x),Math.min(M.y,_.y,O.y)),A.set(Math.max(M.x,_.x,O.x),Math.max(M.y,_.y,O.y)),E.set(0,0).subVectors(A,d),M=(new c.Vector2).subVectors(M,d).divide(E),_=(new c.Vector2).subVectors(_,d).divide(E),O=(new c.Vector2).subVectors(O,d).divide(E),(v=this.geometry=new c.Geometry).vertices.push(y.a),v.vertices.push(y.b),v.vertices.push(y.c),v.faces.push(new c.Face3(0,1,2,T)),v.faceVertexUvs[0]=[[M,_,O]]}})},{"../core/geometry":131,"../lib/three":178}],176:[function(h,C,m){if(window.Promise=window.Promise||h("promise-polyfill"),window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=void 0!==navigator.xr,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var c=h("./utils/isIOSOlderThan10")(window.navigator.userAgent)?1/window.devicePixelRatio:1,u=h("webvr-polyfill"),p={BUFFER_SCALE:c,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new u(p)}var d=h("./utils/"),A=d.debug;d.isIE11&&(h("custom-event-polyfill"),h("../vendor/starts-with-polyfill"));var E=A("A-Frame:error"),g=A("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&g("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),!window.cordova&&"file:"===window.location.protocol&&E("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/0.5.0/introduction/getting-started.html#using-a-local-server."),h("present"),d.device.isBrowserEnvironment&&(h("./style/aframe.css"),h("./style/rStats.css"));var v=h("./core/scene/a-scene").AScene,T=h("./core/component").components,y=h("./core/component").registerComponent,M=h("./core/geometry").registerGeometry,_=h("./extras/primitives/primitives").registerPrimitive,O=h("./core/shader").registerShader,D=h("./core/system").registerSystem,B=h("./core/shader").shaders,H=h("./core/system").systems,q=window.THREE=h("./lib/three"),V=h("../package");h("./components/index"),h("./geometries/index"),h("./shaders/index"),h("./systems/index");var ne=h("./core/a-node"),ae=h("./core/a-entity");h("./core/a-assets"),h("./core/a-cubemap"),h("./core/a-mixin"),h("./extras/components/"),h("./extras/primitives/"),console.log("A-Frame Version: 1.1.0 (Date 2020-12-03, Commit #8aefd214)"),console.log("THREE Version (https://github.com/supermedium/three.js):",V.dependencies["super-three"]),console.log("WebVR Polyfill Version:",V.dependencies["webvr-polyfill"]),C.exports=window.AFRAME={AComponent:h("./core/component").Component,AEntity:ae,ANode:ne,ANIME:h("super-animejs"),AScene:v,components:T,coreComponents:Object.keys(T),geometries:h("./core/geometry").geometries,registerComponent:y,registerElement:h("./core/a-register-element").registerElement,registerGeometry:M,registerPrimitive:_,registerShader:O,registerSystem:D,primitives:{getMeshMixin:h("./extras/primitives/getMeshMixin"),primitives:h("./extras/primitives/primitives").primitives},scenes:h("./core/scene/scenes"),schema:h("./core/schema"),shaders:B,systems:H,THREE:q,utils:d,version:V.version}},{"../package":72,"../vendor/starts-with-polyfill":217,"./components/index":83,"./core/a-assets":124,"./core/a-cubemap":125,"./core/a-entity":126,"./core/a-mixin":127,"./core/a-node":128,"./core/a-register-element":129,"./core/component":130,"./core/geometry":131,"./core/scene/a-scene":133,"./core/scene/scenes":137,"./core/schema":139,"./core/shader":140,"./core/system":141,"./extras/components/":142,"./extras/primitives/":145,"./extras/primitives/getMeshMixin":144,"./extras/primitives/primitives":146,"./geometries/index":167,"./lib/three":178,"./shaders/index":180,"./style/aframe.css":185,"./style/rStats.css":186,"./systems/index":190,"./utils/":204,"./utils/isIOSOlderThan10":207,"custom-event-polyfill":7,present:48,"promise-polyfill":50,"super-animejs":56,"webvr-polyfill":67}],177:[function(h,C,m){window.aframeStats=function(s){var c=null,u=s;return{update:function A(){c("te").set(function E(){var y=u.querySelectorAll("*");return Array.prototype.slice.call(y).filter(function(M){return M.isEntity}),y.length}()),window.performance.getEntriesByName&&c("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))},start:function g(){},end:function v(){},attach:function T(y){c=y},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}},"object"==typeof C&&(C.exports={aframeStats:window.aframeStats})},{}],178:[function(h,C,m){(function(s){var c=s.THREE=h("super-three");c.TextureLoader&&(c.TextureLoader.prototype.crossOrigin="anonymous"),c.ImageLoader&&(c.ImageLoader.prototype.crossOrigin="anonymous"),c.Cache&&(c.Cache.enabled=!0),h("../../vendor/DeviceOrientationControls"),h("super-three/examples/js/loaders/DRACOLoader"),h("super-three/examples/js/loaders/GLTFLoader"),h("super-three/examples/js/loaders/OBJLoader"),h("super-three/examples/js/loaders/MTLLoader"),c.DRACOLoader.prototype.crossOrigin="anonymous",c.GLTFLoader.prototype.crossOrigin="anonymous",c.MTLLoader.prototype.crossOrigin="anonymous",c.OBJLoader.prototype.crossOrigin="anonymous",C.exports=c}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"../../vendor/DeviceOrientationControls":214,"super-three":57,"super-three/examples/js/loaders/DRACOLoader":58,"super-three/examples/js/loaders/GLTFLoader":59,"super-three/examples/js/loaders/MTLLoader":60,"super-three/examples/js/loaders/OBJLoader":61}],179:[function(h,C,m){var s=h("../core/shader").registerShader,c=h("../lib/three"),u=h("../utils/");function p(d,A){return A.color.set(d.color),A.fog=d.fog,A.wireframe=d.wireframe,A.wireframeLinewidth=d.wireframeLinewidth,A}C.exports.Shader=s("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(d){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new c.Color},this.textureSrc=null,p(d,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new c.MeshBasicMaterial(this.materialData),u.material.updateMap(this,d)},update:function(d){this.updateMaterial(d),u.material.updateMap(this,d)},updateMaterial:function(d){var A;for(A in p(d,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.materialData)this.material[A]=this.materialData[A]}})},{"../core/shader":140,"../lib/three":178,"../utils/":204}],180:[function(h,C,m){h("./flat"),h("./standard"),h("./sdf"),h("./msdf"),h("./ios10hls")},{"./flat":179,"./ios10hls":181,"./msdf":182,"./sdf":183,"./standard":184}],181:[function(h,C,m){var s=h("../core/shader").registerShader;C.exports.Shader=s("ios10hls",{schema:{src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D src;","uniform float opacity;","varying vec2 vUV;","void main() {","  vec2 offset = vec2(0, 0);","  vec2 repeat = vec2(1, 1);","  vec4 color = texture2D(src, vec2(vUV.x / repeat.x + offset.x, (1.0 - vUV.y) / repeat.y + offset.y)).bgra;","  gl_FragColor = vec4(color.rgb, opacity);","}"].join("\n")})},{"../core/shader":140}],182:[function(h,C,m){var s=h("../core/shader").registerShader,c=!!document.createElement("canvas").getContext("webgl2"),u=["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),p=["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),d=c?p:u,A=["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture2D(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","}"].join("\n"),E=["#version 300 es","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  fragColor = vec4(color.xyz, alpha * opacity);","}"].join("\n");C.exports.Shader=s("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:d,fragmentShader:c?E:A})},{"../core/shader":140}],183:[function(h,C,m){var s=h("../core/shader").registerShader;C.exports.Shader=s("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["#version 300 es","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture(map, box.xy).a, width)","        + contour(texture(map, box.zw).a, width)","        + contour(texture(map, box.xw).a, width)","        + contour(texture(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  fragColor = vec4(color, opacity * alpha);","}"].join("\n")})},{"../core/shader":140}],184:[function(h,C,m){var s=h("../core/shader").registerShader,c=h("../lib/three"),u=h("../utils/"),p=new c.CubeTextureLoader,d={};function A(E,g){return g.color.set(E.color),g.emissive.set(E.emissive),g.emissiveIntensity=E.emissiveIntensity,g.fog=E.fog,g.metalness=E.metalness,g.roughness=E.roughness,g.wireframe=E.wireframe,g.wireframeLinewidth=E.wireframeLinewidth,E.normalMap&&(g.normalScale=E.normalScale),E.ambientOcclusionMap&&(g.aoMapIntensity=E.ambientOcclusionMapIntensity),E.displacementMap&&(g.displacementScale=E.displacementScale,g.displacementBias=E.displacementBias),g}C.exports.Shader=s("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(E){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new c.Color,emissive:new c.Color},A(E,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.material=new c.MeshStandardMaterial(this.materialData),u.material.updateMap(this,E),E.normalMap&&u.material.updateDistortionMap("normal",this,E),E.displacementMap&&u.material.updateDistortionMap("displacement",this,E),E.ambientOcclusionMap&&u.material.updateDistortionMap("ambientOcclusion",this,E),E.metalnessMap&&u.material.updateDistortionMap("metalness",this,E),E.roughnessMap&&u.material.updateDistortionMap("roughness",this,E),this.updateEnvMap(E)},update:function(E){this.updateMaterial(E),u.material.updateMap(this,E),E.normalMap&&u.material.updateDistortionMap("normal",this,E),E.displacementMap&&u.material.updateDistortionMap("displacement",this,E),E.ambientOcclusionMap&&u.material.updateDistortionMap("ambientOcclusion",this,E),E.metalnessMap&&u.material.updateDistortionMap("metalness",this,E),E.roughnessMap&&u.material.updateDistortionMap("roughness",this,E),this.updateEnvMap(E)},updateMaterial:function(E){var g,v=this.material;for(g in A(E,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.materialData)v[g]=this.materialData[g]},updateEnvMap:function(E){var g=this,v=this.material,T=E.envMap,y=E.sphericalEnvMap;if(!T&&!y||this.isLoadingEnvMap)return v.envMap=null,void(v.needsUpdate=!0);this.isLoadingEnvMap=!0,y?this.el.sceneEl.systems.material.loadTexture(y,{src:y},function(_){g.isLoadingEnvMap=!1,_.mapping=c.SphericalReflectionMapping,v.envMap=_,u.material.handleTextureEvents(g.el,_),v.needsUpdate=!0}):d[T]?d[T].then(function(M){g.isLoadingEnvMap=!1,v.envMap=M,u.material.handleTextureEvents(g.el,M),v.needsUpdate=!0}):d[T]=new Promise(function(M){u.srcLoader.validateCubemapSrc(T,function(O){p.load(O,function(D){g.isLoadingEnvMap=!1,v.envMap=D,u.material.handleTextureEvents(g.el,D),M(D)})})})}})},{"../core/shader":140,"../lib/three":178,"../utils/":204}],185:[function(h,C,m){var s="html.a-fullscreen{bottom:0;left:0;position:fixed;right:0;top:0}html.a-fullscreen body{height:100%;margin:0;overflow:hidden;padding:0;width:100%}html.a-fullscreen .a-canvas{width:100%!important;height:100%!important;top:0!important;left:0!important;right:0!important;bottom:0!important;position:fixed!important}html:not(.a-fullscreen) .a-enter-ar,html:not(.a-fullscreen) .a-enter-vr{right:5px;bottom:5px}:-webkit-full-screen{background-color:transparent}.a-hidden{display:none!important}.a-canvas{height:100%;left:0;position:absolute;top:0;width:100%}.a-canvas.a-grab-cursor:hover{cursor:grab;cursor:-moz-grab;cursor:-webkit-grab}canvas.a-canvas.a-mouse-cursor-hover:hover{cursor:pointer}.a-inspector-loader{background-color:#ed3160;position:fixed;left:3px;top:3px;padding:6px 10px;color:#fff;text-decoration:none;font-size:12px;font-family:Roboto,sans-serif;text-align:center;z-index:99999;width:204px}@keyframes dots-1{from{opacity:0}25%{opacity:1}}@keyframes dots-2{from{opacity:0}50%{opacity:1}}@keyframes dots-3{from{opacity:0}75%{opacity:1}}@-webkit-keyframes dots-1{from{opacity:0}25%{opacity:1}}@-webkit-keyframes dots-2{from{opacity:0}50%{opacity:1}}@-webkit-keyframes dots-3{from{opacity:0}75%{opacity:1}}.a-inspector-loader .dots span{animation:dots-1 2s infinite steps(1);-webkit-animation:dots-1 2s infinite steps(1)}.a-inspector-loader .dots span:first-child+span{animation-name:dots-2;-webkit-animation-name:dots-2}.a-inspector-loader .dots span:first-child+span+span{animation-name:dots-3;-webkit-animation-name:dots-3}a-scene{display:block;position:relative;height:100%;width:100%}a-assets,a-scene audio,a-scene img,a-scene video{display:none}.a-enter-vr-modal,.a-orientation-modal{font-family:Consolas,Andale Mono,Courier New,monospace}.a-enter-vr-modal a{border-bottom:1px solid #fff;padding:2px 0;text-decoration:none;transition:.1s color ease-in}.a-enter-vr-modal a:hover{background-color:#fff;color:#111;padding:2px 4px;position:relative;left:-4px}.a-enter-ar,.a-enter-vr{font-family:sans-serif,monospace;font-size:13px;width:100%;font-weight:200;line-height:16px;position:absolute;right:20px;bottom:20px}.a-enter-ar{right:80px}.a-enter-vr-button,.a-enter-vr-modal,.a-enter-vr-modal a{color:#fff;user-select:none;outline:0}.a-enter-vr-button{background:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat rgba(0,0,0,.35)}.a-enter-ar-button{background:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat rgba(0,0,0,.2)}.a-enter-ar-button,.a-enter-vr-button{background-size:90% 90%;border:0;bottom:0;cursor:pointer;min-width:58px;min-height:34px;padding-right:0;padding-top:0;position:absolute;right:0;transition:background-color .05s ease;-webkit-transition:background-color .05s ease;z-index:9999;border-radius:8px;touch-action:manipulation}.a-enter-ar-button{background-size:100% 90%;margin-right:10px;border-radius:7px}.a-enter-ar-button:active,.a-enter-ar-button:hover,.a-enter-vr-button:active,.a-enter-vr-button:hover{background-color:#ef2d5e}.a-enter-vr-button.resethover{background-color:rgba(0,0,0,.35)}[data-a-enter-vr-no-webvr] .a-enter-vr-button{border-color:#666;opacity:.65}[data-a-enter-vr-no-webvr] .a-enter-vr-button:active,[data-a-enter-vr-no-webvr] .a-enter-vr-button:hover{background-color:rgba(0,0,0,.35);cursor:not-allowed}.a-enter-vr-modal{background-color:#666;border-radius:0;display:none;min-height:32px;margin-right:70px;padding:9px;width:280px;right:2%;position:absolute}.a-enter-vr-modal:after{border-bottom:10px solid transparent;border-left:10px solid #666;border-top:10px solid transparent;display:inline-block;content:'';position:absolute;right:-5px;top:5px;width:0;height:0}.a-enter-vr-modal a,.a-enter-vr-modal p{display:inline}.a-enter-vr-modal p{margin:0}.a-enter-vr-modal p:after{content:' '}[data-a-enter-vr-no-headset].a-enter-vr:hover .a-enter-vr-modal,[data-a-enter-vr-no-webvr].a-enter-vr:hover .a-enter-vr-modal{display:block}.a-orientation-modal{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center/50% 50% no-repeat rgba(244,244,244,1);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-orientation-modal:after{color:#666;content:\"Insert phone into Cardboard holder.\";display:block;position:absolute;text-align:center;top:70%;transform:translateY(-70%);width:100%}.a-orientation-modal button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;border:none;height:50px;text-indent:-9999px;width:50px}.a-loader-title{background-color:rgba(0,0,0,.6);font-family:sans-serif,monospace;text-align:center;font-size:20px;height:50px;font-weight:300;line-height:50px;position:absolute;right:0;left:0;top:0;color:#fff}.a-modal{background:0 0/50% 50% rgba(0,0,0,.6);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-dialog{position:relative;left:50%;top:50%;transform:translate(-50%,-50%);z-index:199995;width:300px;height:200px;background-size:contain;background-color:#fff;font-family:sans-serif,monospace;font-size:20px;border-radius:3px;padding:6px}.a-dialog-text-container{width:100%;height:70%;align-self:flex-start;display:flex;justify-content:center;align-content:center;flex-direction:column}.a-dialog-text{display:inline-block;font-weight:400;font-size:14pt;margin:8px}.a-dialog-buttons-container{display:inline-flex;align-self:flex-end;width:100%;height:30%}.a-dialog-button{cursor:pointer;align-self:center;opacity:.9;height:80%;width:50%;font-size:12pt;margin:4px;border-radius:2px;text-align:center;border:none;display:inline-block;-webkit-transition:all .25s ease-in-out;transition:all .25s ease-in-out;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.2);user-select:none}.a-dialog-permission-button:hover{box-shadow:0 7px 14px rgba(0,0,0,.2),0 2px 2px rgba(0,0,0,.2)}.a-dialog-allow-button{background-color:#00ceff}.a-dialog-deny-button{background-color:#ff005b}.a-dialog-ok-button{background-color:#00ceff;width:100%}";h("browserify-css").createStyle(s,{href:"src/style/aframe.css"}),C.exports=s},{"browserify-css":4}],186:[function(h,C,m){var s=".rs-base{background-color:#333;color:#fafafa;border-radius:0;font:10px monospace;left:5px;line-height:1em;opacity:.85;overflow:hidden;padding:10px;position:fixed;top:5px;width:300px;z-index:10000}.rs-base div.hidden{display:none}.rs-base h1{color:#fff;cursor:pointer;font-size:1.4em;font-weight:300;margin:0 0 5px;padding:0}.rs-group{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column-reverse;flex-direction:column-reverse;margin-bottom:5px}.rs-group:last-child{margin-bottom:0}.rs-counter-base{align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:10px;-webkit-justify-content:space-between;justify-content:space-between;margin:2px 0}.rs-counter-base.alarm{color:#b70000;text-shadow:0 0 0 #b70000,0 0 1px #fff,0 0 1px #fff,0 0 2px #fff,0 0 2px #fff,0 0 3px #fff,0 0 3px #fff,0 0 4px #fff,0 0 4px #fff}.rs-counter-id{font-weight:300;-webkit-box-ordinal-group:0;-webkit-order:0;order:0;width:54px}.rs-counter-value{font-weight:300;-webkit-box-ordinal-group:1;-webkit-order:1;order:1;text-align:right;width:35px}.rs-canvas{-webkit-box-ordinal-group:2;-webkit-order:2;order:2}@media (min-width:480px){.rs-base{left:20px;top:20px}}";h("browserify-css").createStyle(s,{href:"src/style/rStats.css"}),C.exports=s},{"browserify-css":4}],187:[function(h,C,m){var s=h("../constants/"),c=h("../core/system").registerSystem,u="data-aframe-default-camera";C.exports.System=c("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var d,A,E=this.sceneEl,g=this;if(!E.camera||E.camera.el.getAttribute("camera").spectator)if((d=E.querySelectorAll("a-camera, [camera]")).length)for(this.numUserCameras=d.length,A=0;A<d.length;A++)d[A].addEventListener("object3dset",function(v){"camera"===v.detail.type&&g.checkUserCamera(this)}),d[A].isNode?d[A].load():d[A].addEventListener("nodeready",function(){this.load()});else this.createDefaultCamera();else E.emit("cameraready",{cameraEl:E.camera.el})},checkUserCamera:function(d){var A,E=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(!(A=d.getAttribute("camera")).active||A.spectator)return void(this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera());this.initialCameraFound=!0,E.camera=d.getObject3D("camera"),E.emit("cameraready",{cameraEl:d})}},createDefaultCamera:function(){var d,A=this.sceneEl;(d=document.createElement("a-entity")).setAttribute("camera",{active:!0}),d.setAttribute("position",{x:0,y:s.DEFAULT_CAMERA_HEIGHT,z:0}),d.setAttribute("wasd-controls",""),d.setAttribute("look-controls",""),d.setAttribute(s.AFRAME_INJECTED,""),d.addEventListener("object3dset",function(E){"camera"===E.detail.type&&(A.camera=E.detail.object,A.emit("cameraready",{cameraEl:d}))}),A.appendChild(d)},disableActiveCamera:function(){var d;(d=this.sceneEl.querySelectorAll("[camera]"))[d.length-1].setAttribute("camera","active",!0)},setActiveCamera:function(d){var A,E,g,v,T=this.activeCameraEl,y=this.sceneEl;if((v=d.getObject3D("camera"))&&d!==this.activeCameraEl){var M=y.querySelector("["+u+"]");for(d!==(M&&M.querySelector("[camera]"))&&function p(d){var A;d.camera&&((A=d.querySelector("["+u+"]"))&&d.removeChild(A))}(y),this.activeCameraEl=d,this.activeCameraEl.play(),y.camera=v,T&&T.setAttribute("camera","active",!1),E=y.querySelectorAll("[camera]"),g=0;g<E.length;g++)(A=E[g]).isEntity&&d!==A&&(A.setAttribute("camera","active",!1),A.pause());y.emit("camera-set-active",{cameraEl:d})}},setSpectatorCamera:function(d){var v,E=this.spectatorCameraEl,g=this.sceneEl;d.getObject3D("camera")&&d!==this.spectatorCameraEl&&(E&&E.setAttribute("camera","spectator",!1),v=this.spectatorCameraEl=d,g.addEventListener("enter-vr",this.wrapRender),g.addEventListener("exit-vr",this.unwrapRender),v.setAttribute("camera","active",!1),v.play(),g.emit("camera-set-spectator",{cameraEl:d}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){!this.spectatorCameraEl||this.originalRender||(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(d,A){var E,v,g=this.sceneEl;E=g.renderer.xr.enabled,this.originalRender.call(g.renderer,d,A),this.spectatorCameraEl&&!g.isMobile&&E&&(v=this.spectatorCameraEl.components.camera.camera,g.renderer.xr.enabled=!1,this.originalRender.call(g.renderer,d,v),g.renderer.xr.enabled=E)}})},{"../constants/":122,"../core/system":141}],188:[function(h,C,m){var s=h("../core/geometry").geometries,c=h("../core/system").registerSystem,u=h("../lib/three");function p(g){var v=g.primitive,T=s[v]&&s[v].Geometry,y=new T;if(!T)throw new Error("Unknown geometry `"+v+"`");return y.init(g),function E(g,v){var T;return v?((T=(new u.BufferGeometry).fromGeometry(g)).metadata={type:g.type,parameters:g.parameters||{}},g.dispose(),T):g}(y.geometry,g.buffer)}C.exports.System=c("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(g){var T,y,v=this.cache;return g.skipCache?p(g):(T=v[y=this.hash(g)],function A(g,v){g[v]=void 0===g[v]?1:g[v]+1}(this.cacheCount,y),T||(T=p(g),v[y]=T,T))},unuseGeometry:function(g){var M,v=this.cache,T=this.cacheCount;g.skipCache||v[M=this.hash(g)]&&(function d(g,v){g[v]--}(T,M),!(T[M]>0)&&(v[M].dispose(),delete v[M],delete T[M]))},hash:function(g){return JSON.stringify(g)}})},{"../core/geometry":131,"../core/system":141,"../lib/three":178}],189:[function(h,C,m){var s=h("../core/system").registerSystem,c=h("../lib/three");C.exports.System=s("gltf-model",{schema:{dracoDecoderPath:{default:""}},init:function(){var u=this.data.dracoDecoderPath;this.dracoLoader=new c.DRACOLoader,this.dracoLoader.setDecoderPath(u)},update:function(){var u;this.dracoLoader||(u=this.data.dracoDecoderPath,this.dracoLoader=new c.DRACOLoader,this.dracoLoader.setDecoderPath(u))},getDRACOLoader:function(){return this.dracoLoader}})},{"../core/system":141,"../lib/three":178}],190:[function(h,C,m){h("./camera"),h("./geometry"),h("./gltf-model"),h("./light"),h("./material"),h("./renderer"),h("./shadow"),h("./tracked-controls-webvr"),h("./tracked-controls-webxr"),h("./webxr")},{"./camera":187,"./geometry":188,"./gltf-model":189,"./light":191,"./material":192,"./renderer":193,"./shadow":194,"./tracked-controls-webvr":195,"./tracked-controls-webxr":196,"./webxr":197}],191:[function(h,C,m){var s=h("../core/system").registerSystem,c=h("../utils/bind"),u=h("../constants/"),p="data-aframe-default-light";C.exports.System=s("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",c(this.setupDefaultLights,this))},registerLight:function(d){d.hasAttribute(p)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var d,A=this.sceneEl;if(this.defaultLights){d=document.querySelectorAll("["+p+"]");for(var E=0;E<d.length;E++)A.removeChild(d[E]);this.defaultLights=!1}},setupDefaultLights:function(){var A,E,d=this.sceneEl;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||((A=document.createElement("a-entity")).setAttribute("light",{color:"#BBB",type:"ambient"}),A.setAttribute(p,""),A.setAttribute(u.AFRAME_INJECTED,""),d.appendChild(A),(E=document.createElement("a-entity")).setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),E.setAttribute("position",{x:-.5,y:1,z:1}),E.setAttribute(p,""),E.setAttribute(u.AFRAME_INJECTED,""),d.appendChild(E),this.defaultLights=!0)}})},{"../constants/":122,"../core/system":141,"../utils/bind":198}],192:[function(h,C,m){var s=h("../core/system").registerSystem,c=h("../lib/three"),u=h("../utils/"),p=h("../utils/material").isHLS,d=u.bind,A=u.debug,E=A("components:texture:error"),g=new c.TextureLoader,v=A("components:texture:warn");function M(D,B){var H=B.offset||{x:0,y:0},q=B.repeat||{x:1,y:1};!!B.npot&&(D.wrapS=c.ClampToEdgeWrapping,D.wrapT=c.ClampToEdgeWrapping,D.magFilter=c.LinearFilter,D.minFilter=c.LinearFilter),(1!==q.x||1!==q.y)&&(D.wrapS=c.RepeatWrapping,D.wrapT=c.RepeatWrapping,D.repeat.set(q.x,q.y)),(0!==H.x||0!==H.y)&&D.offset.set(H.x,H.y)}g.setCrossOrigin("anonymous"),C.exports.System=s("material",{init:function(){this.materials={},this.textureCounts={},this.textureCache={},this.sceneEl.addEventListener("materialtextureloaded",d(this.onMaterialTextureLoaded,this))},clearTextureCache:function(){this.textureCache={}},loadTexture:function(D,B,H){var q=this;if("CANVAS"!==D.tagName){if("VIDEO"===D.tagName)return!D.src&&!D.srcObject&&!D.childElementCount&&v("Video element was defined with neither `source` elements nor `src` / `srcObject` attributes."),void this.loadVideo(D,B,H);u.srcLoader.validateSrc(D,function V(ae){q.loadImage(ae,B,H)},function ne(ae){q.loadVideo(ae,B,H)})}else this.loadCanvas(D,B,H)},loadImage:function(D,B,H){var q=this.hash(B),V=this.textureCache;V[q]||(V[q]=function y(D,B){return new Promise(function H(q,V){function ae(fe){M(fe,B),fe.needsUpdate=!0,q(fe)}"string"!=typeof D?ae(new c.Texture(D)):g.load(D,ae,function(){},function(fe){E("`$s` could not be fetched (Error code: %s; Response: %s)",fe.status,fe.statusText)})})}(D,B)),V[q].then(H)},loadCanvas:function(D,B,H){var q;M(q=new c.CanvasTexture(D),B),H(q)},loadVideo:function(D,B,H){var q,V,ae,fe,ne=this.textureCache;function he(me){me.texture.needsUpdate=!0,H(me.texture,me.videoEl)}if("string"!=typeof D){if(ne[q=this.hashVideo(B,ae=D)])return void ne[q].then(he);!function O(D){D.autoplay=D.hasAttribute("autoplay")&&"false"!==D.getAttribute("autoplay"),D.controls=D.hasAttribute("controls")&&"false"!==D.getAttribute("controls"),"false"===D.getAttribute("loop")&&D.removeAttribute("loop"),"false"===D.getAttribute("preload")&&(D.preload="none"),D.crossOrigin=D.crossOrigin||"anonymous",D.setAttribute("playsinline",""),D.setAttribute("webkit-playsinline","")}(ae)}ae=ae||function _(D,B,H){var q=document.createElement("video");return q.width=B,q.height=H,q.setAttribute("playsinline",""),q.setAttribute("webkit-playsinline",""),q.autoplay=!0,q.loop=!0,q.crossOrigin="anonymous",q.addEventListener("error",function(){v("`$s` is not a valid video",D)},!0),q.src=D,q}(D,B.width,B.height),ne[q=this.hashVideo(B,ae)]?ne[q].then(he):((V=new c.VideoTexture(ae)).minFilter=c.LinearFilter,M(V,B),this.sceneEl.isIOS&&p(ae.src||ae.getAttribute("src"),ae.type||ae.getAttribute("type"))&&(V.format=c.RGBAFormat,V.needsCorrectionBGRA=!0,V.flipY=!1,V.needsCorrectionFlipY=!0),fe={texture:V,videoEl:ae},ne[q]=Promise.resolve(fe),he(fe))},hash:function(D){return D.src.tagName&&((D=u.extendDeep({},D)).src=D.src.src),JSON.stringify(D)},hashVideo:function(D,B){return function T(D,B){var H,V,ne,q=B.getAttribute("id");if(q)return q;for(V="",ne=D||{},H=0;H<B.attributes.length;H++)ne[B.attributes[H].name]=B.attributes[H].value;return Object.keys(ne).sort().forEach(function(ae){V+=ae+":"+ne[ae]+";"}),V}(D,B)},registerMaterial:function(D){this.materials[D.uuid]=D},unregisterMaterial:function(D){delete this.materials[D.uuid];var B=this.textureCounts;Object.keys(D).filter(function(H){return D[H]&&D[H].isTexture}).forEach(function(H){B[D[H].uuid]--,B[D[H].uuid]<=0&&D[H].dispose()})},updateMaterials:function(D){var B=this.materials;Object.keys(B).forEach(function(H){B[H].needsUpdate=!0})},onMaterialTextureLoaded:function(D){this.textureCounts[D.detail.texture.uuid]||(this.textureCounts[D.detail.texture.uuid]=0),this.textureCounts[D.detail.texture.uuid]++}})},{"../core/system":141,"../lib/three":178,"../utils/":204,"../utils/material":208}],193:[function(h,C,m){var s=h("../core/system").registerSystem,c=h("../utils/"),u=h("../lib/three"),d=(0,c.debug)("components:renderer:warn");C.exports.System=s("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:c.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:1920},maxCanvasHeight:{default:1920},physicallyCorrectLights:{default:!1},precision:{default:"high",oneOf:["high","medium","low"]},sortObjects:{default:!1},colorManagement:{default:!1},gammaOutput:{default:!1},alpha:{default:!0},foveationLevel:{default:0}},init:function(){var A=this.data,E=this.el,g=E.renderer;g.sortObjects=A.sortObjects,g.physicallyCorrectLights=A.physicallyCorrectLights,(A.colorManagement||A.gammaOutput)&&(g.outputEncoding=u.sRGBEncoding,A.gammaOutput&&d('Property `gammaOutput` is deprecated. Use `renderer="colorManagement: true;"` instead.')),E.hasAttribute("antialias")&&d('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),E.hasAttribute("logarithmicDepthBuffer")&&d('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.')},applyColorCorrection:function(A){!this.data.colorManagement||!A||(A.isColor?A.convertSRGBToLinear():A.isTexture&&(A.encoding=u.sRGBEncoding))}})},{"../core/system":141,"../lib/three":178,"../utils/":204}],194:[function(h,C,m){var s=h("../core/system").registerSystem,c=h("../lib/three"),u={basic:c.BasicShadowMap,pcf:c.PCFShadowMap,pcfsoft:c.PCFSoftShadowMap};C.exports.System=s("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var p=this.sceneEl,d=this.data;this.shadowMapEnabled=!1,p.renderer&&(p.renderer.shadowMap.type=u[d.type],p.renderer.shadowMap.autoUpdate=d.autoUpdate,this.setShadowMapEnabled(this.shadowMapEnabled))},update:function(p){p.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.data.enabled)},setShadowMapEnabled:function(p){var d=this.sceneEl.renderer;this.shadowMapEnabled=this.data.enabled&&p,d&&(d.shadowMap.enabled=this.shadowMapEnabled)}})},{"../core/system":141,"../lib/three":178}],195:[function(h,C,m){var s=h("../core/system").registerSystem,c=h("../utils"),u=c.device.isWebXRAvailable;C.exports.System=s("tracked-controls-webvr",{init:function(){var p=this;this.controllers=[],this.isChrome=-1!==navigator.userAgent.indexOf("Chrome"),this.updateControllerList(),this.throttledUpdateControllerList=c.throttle(this.updateControllerList,500,this),!u&&navigator.getVRDisplays&&this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(d){d.length&&(p.vrDisplay=d[0])})})},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var d,A,E,g,p=this.controllers;if(A=navigator.getGamepads&&navigator.getGamepads()){for(g=p.length,p.length=0,E=0;E<A.length;++E)(d=A[E])&&d.pose&&p.push(d);p.length!==g&&this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":141,"../utils":204}],196:[function(h,C,m){var s=h("../core/system").registerSystem,c=h("../utils");C.exports.System=s("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=c.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var u=this,p=this.el.xrSession;if(!p)return this.referenceSpace=void 0,this.controllers=[],void(this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1)));var d=u.el.sceneEl.systems.webxr.sessionReferenceSpaceType;p.requestReferenceSpace(d).then(function(A){u.referenceSpace=A}).catch(function(A){throw u.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(d,'tracked-controls-webxr uses reference space "'+d+'".'),A})},updateControllerList:function(){var d,u=this.el.xrSession,p=this.oldControllers;if(!u){if(0===this.oldControllersLength)return;return this.oldControllersLength=0,this.controllers=[],void this.el.emit("controllersupdated",void 0,!1)}if(u.inputSources){if(this.controllers=u.inputSources,this.oldControllersLength===this.controllers.length){var A=!0;for(d=0;d<this.controllers.length;++d)if(this.controllers[d]!==p[d]||this.controllers[d].gamepad!==p[d].gamepad){A=!1;break}if(A)return}for(p.length=0,d=0;d<this.controllers.length;d++)p.push(this.controllers[d]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":141,"../utils":204}],197:[function(h,C,m){var s=h("../core/system").registerSystem,u=h("../utils/").debug("systems:webxr:warn");C.exports.System=s("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var p=this.data;this.sessionConfiguration={requiredFeatures:p.requiredFeatures,optionalFeatures:p.optionalFeatures},this.sessionReferenceSpaceType=p.referenceSpaceType,p.overlayElement&&(this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:p.overlayElement})},wasFeatureRequested:function(p){return!("viewer"!==p&&"local"!==p&&!this.sessionConfiguration.requiredFeatures.includes(p)&&!this.sessionConfiguration.optionalFeatures.includes(p))},warnIfFeatureNotRequested:function(p,d){this.wasFeatureRequested(p)||u((d?d+" ":"")+'Please add the feature "'+p+"\" to a-scene's webxr system options in requiredFeatures/optionalFeatures.")}})},{"../core/system":141,"../utils/":204}],198:[function(h,C,m){C.exports=function(c,u){return p=Array.prototype.slice.call(arguments,2),function(){var A=p.concat(Array.prototype.slice.call(arguments,0));return c.apply(u,A)};var p}},{}],199:[function(h,C,m){var s=h("./debug"),c=h("object-assign"),u=s("utils:coordinates:warn"),p=["x","y","z","w"],d=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;C.exports.regex=d;var A="object",E=/\s+/g;function T(M){return d.test(M)}function y(M){return null!=M&&M.constructor===String?parseFloat(M,10):M}C.exports.parse=function g(M,_){var O,D,B,H,q,V,ne,ae,fe;if(M&&M instanceof Object)return ne=void 0===M.y?_&&_.y:M.y,ae=void 0===M.z?_&&_.z:M.z,fe=void 0===M.w?_&&_.w:M.w,null!=(V=void 0===M.x?_&&_.x:M.x)&&(M.x=y(V)),null!=ne&&(M.y=y(ne)),null!=ae&&(M.z=y(ae)),null!=fe&&(M.w=y(fe)),M;if(null==M)return typeof _===A?c({},_):_;for(O=M.trim().split(E),q={},H=0;H<p.length;H++)if(B=p[H],O[H])q[B]=parseFloat(O[H],10);else{if(void 0===(D=_&&_[B]))continue;q[B]=y(D)}return q},C.exports.stringify=function v(M){var _;return typeof M!==A?M:(_=M.x+" "+M.y,null!=M.z&&(_+=" "+M.z),null!=M.w&&(_+=" "+M.w),_)},C.exports.isCoordinates=T,C.exports.isCoordinate=function(M){return u("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),T(M)},C.exports.toVector3=function(M){return new THREE.Vector3(M.x,M.y,M.z)}},{"./debug":200,"object-assign":39}],200:[function(h,C,m){(function(s){var c=h("debug"),u=h("object-assign"),p={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}},d=function(T){var y=c(T);return y.color=function E(T){var y=function A(T){var y=T.split(":");return y[y.length-1]}(T);return p.colors&&p.colors[y]||null}(T),y};u(d,c);var v=function g(){try{return window.localStorage}catch{}}();v&&(parseInt(v.logs,10)||"true"===v.logs)?d.enable("*"):d.enable("*:error,*:info,*:warn"),s.browser&&(window.logs=d),C.exports=d}).call(this,h("_process"))},{_process:49,debug:8,"object-assign":39}],201:[function(h,C,m){(function(s){var u,c=h("debug")("device:error"),p=!1,d=!1,A=C.exports.isWebXRAvailable=!window.debug&&void 0!==navigator.xr;if(window.addEventListener("vrdisplayactivate",function(ne){var ae;A||(ae=document.createElement("canvas"),u=ne.display,ae.getContext("webgl",{}),u.requestPresent([{source:ae}]).then(function(){},function(){}))}),A){var E=function(){var ne=document.querySelector("a-scene");ne?ne.hasLoaded?ne.components["vr-mode-ui"].updateEnterInterfaces():ne.addEventListener("loaded",E):window.addEventListener("DOMContentLoaded",E)},g=function(ne){c("WebXR session support error: "+ne.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(ne){p=ne,E()}).catch(g),navigator.xr.isSessionSupported("immersive-ar").then(function(ne){d=ne,E()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){p=!0,E()}).catch(g),navigator.xr.supportsSession("immersive-ar").then(function(){d=!0,E()}).catch(function(){})):c("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(ne){var ae=document.querySelector("a-scene");u=ne.length&&ne[0],ae&&ae.emit("displayconnected",{vrDisplay:u})});function v(){return u}C.exports.getVRDisplay=v,C.exports.checkHeadsetConnected=function T(){return p||d||!!v()},C.exports.checkARSupport=function y(){return d};var ae,ne,M=(ne=!1,ae=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(ae)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ae.substr(0,4)))&&(ne=!0),(O()||_()||V())&&(ne=!0),q()&&(ne=!1),function(){return ne});function _(ne){var ae=ne||window.navigator.userAgent;return/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(ae)}function O(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function B(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function H(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function q(){return B()||H()}function V(){return/R7 Build/.test(window.navigator.userAgent)}C.exports.isMobile=M,C.exports.isTablet=_,C.exports.isIOS=O,C.exports.isMobileDeviceRequestingDesktopSite=function D(){return!M()&&!q()&&void 0!==window.orientation},C.exports.isOculusBrowser=B,C.exports.isFirefoxReality=H,C.exports.isMobileVR=q,C.exports.isR7=V,C.exports.isLandscape=function(){var ne=window.orientation;return V()&&(ne+=90),90===ne||-90===ne},C.exports.isBrowserEnvironment=!(s&&!s.browser),C.exports.isNodeEnvironment=!C.exports.isBrowserEnvironment}).call(this,h("_process"))},{_process:49,debug:8}],202:[function(h,C,m){var s={};function c(u,p){return s[p=p||"."]||(s[p]={}),s[p][u]=-1!==u.indexOf(p)?u.split(p):u,s[p][u]}C.exports.getComponentPropertyPath=c,C.exports.propertyPathCache=s,C.exports.getComponentProperty=function(u,p,d){var A;return-1!==p.indexOf(d=d||".")?(A=c(p,d)).constructor===String?u.getAttribute(A):u.getAttribute(A[0])[A[1]]:u.getAttribute(p)},C.exports.setComponentProperty=function(u,p,d,A){var E;-1===p.indexOf(A=A||".")?u.setAttribute(p,d):(E=c(p,A)).constructor===String?u.setAttribute(E,d):u.setAttribute(E[0],E[1],d)}},{}],203:[function(h,C,m){C.exports=function(c){var u=c.style.width,p=c.style.height;c.style.width=parseInt(u,10)+1+"px",c.style.height=parseInt(p,10)+1+"px",setTimeout(function(){c.style.width=u,c.style.height=p},200)}},{}],204:[function(h,C,m){var s=h("./debug"),c=h("deep-assign"),u=h("./device"),p=h("object-assign"),d=h("./object-pool"),A=s("utils:warn");C.exports.bind=h("./bind"),C.exports.coordinates=h("./coordinates"),C.exports.debug=s,C.exports.device=u,C.exports.entity=h("./entity"),C.exports.forceCanvasResizeSafariMobile=h("./forceCanvasResizeSafariMobile"),C.exports.isIE11=h("./is-ie11"),C.exports.material=h("./material"),C.exports.objectPool=d,C.exports.split=h("./split").split,C.exports.styleParser=h("./styleParser"),C.exports.trackedControls=h("./tracked-controls"),C.exports.checkHeadsetConnected=function(){return A("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),u.checkHeadsetConnected(arguments)},C.exports.isGearVR=C.exports.device.isGearVR=function(){A("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},C.exports.isIOS=function(){return A("`utils.isIOS` has moved to `utils.device.isIOS`"),u.isIOS(arguments)},C.exports.isOculusGo=C.exports.device.isOculusGo=function(){A("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},C.exports.isMobile=function(){return A("`utils.isMobile has moved to `utils.device.isMobile`"),u.isMobile(arguments)},C.exports.throttle=function(g,v,T){var y;return T&&(g=C.exports.bind(g,T)),function(){var M=Date.now(),_=typeof y>"u"?v:M-y;(typeof y>"u"||_>=v)&&(y=M,g.apply(null,arguments))}},C.exports.throttleTick=function(g,v,T){var y;return T&&(g=C.exports.bind(g,T)),function(M,_){var O=typeof y>"u"?_:M-y;(typeof y>"u"||O>=v)&&(y=M,g(M,O))}},C.exports.debounce=function(g,v,T){var y;return function(){var M=this,_=arguments,O=function(){y=null,T||g.apply(M,_)},D=T&&!y;clearTimeout(y),y=setTimeout(O,v),D&&g.apply(M,_)}},C.exports.extend=p,C.exports.extendDeep=c,C.exports.clone=function(g){return JSON.parse(JSON.stringify(g))};var g,E=(g=d.createPool(function(){return[]}),function(v,T){var y,M,_,O,D,B;if(void 0===v||void 0===T||null===v||null===T||!(v&&T&&v.constructor===Object&&T.constructor===Object||v.constructor===Array&&T.constructor===Array))return v===T;for(y in M=g.use(),_=g.use(),M.length=0,_.length=0,v)M.push(y);for(y in T)_.push(y);if(M.length!==_.length)return g.recycle(M),g.recycle(_),!1;for(O=0;O<M.length;++O)if(B=T[M[O]],"object"==typeof(D=v[M[O]])||"object"==typeof B||Array.isArray(D)&&Array.isArray(B)){if(D===B)continue;if(!E(D,B))return g.recycle(M),g.recycle(_),!1}else if(D!==B)return g.recycle(M),g.recycle(_),!1;return g.recycle(M),g.recycle(_),!0});C.exports.deepEqual=E,C.exports.diff=function(){var g=[];return function(v,T,y){var M,_,O,D,B,H,q;for(B in D=y||{},g.length=0,v)g.push(B);if(!T)return D;for(O in T)-1===g.indexOf(O)&&g.push(O);for(H=0;H<g.length;H++)_=T[B=g[H]],((q=(M=v[B])&&_&&M.constructor===Object&&_.constructor===Object)&&!E(M,_)||!q&&M!==_)&&(D[B]=_);return D}}(),C.exports.shouldCaptureKeyEvent=function(g){return!g.metaKey&&document.activeElement===document.body},C.exports.splitString=function(g,v){typeof v>"u"&&(v=" ");var T=new RegExp(v,"g");return(g=(g||"").replace(T,v)).split(v)},C.exports.getElData=function(g,v){v=v||{};var T={};return Object.keys(v).forEach(function y(M){g.hasAttribute(M)&&(T[M]=g.getAttribute(M))}),T},C.exports.getUrlParameter=function(g){g=g.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var T=new RegExp("[\\?&]"+g+"=([^&#]*)").exec(location.search);return null===T?"":decodeURIComponent(T[1].replace(/\+/g," "))},C.exports.isIframed=function(){return window.top!==window.self},C.exports.findAllScenes=function(g){for(var v=[],T=g.getElementsByTagName("*"),y=0,M=T.length;y<M;y++)T[y].isScene&&v.push(T[y]);return v},C.exports.srcLoader=h("./src-loader")},{"./bind":198,"./coordinates":199,"./debug":200,"./device":201,"./entity":202,"./forceCanvasResizeSafariMobile":203,"./is-ie11":206,"./material":208,"./object-pool":209,"./split":210,"./src-loader":211,"./styleParser":212,"./tracked-controls":213,"deep-assign":10,"object-assign":39}],205:[function(h,C,m){window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},{}],206:[function(h,C,m){C.exports=11===function s(){var c=-1,u=navigator.userAgent;return"Microsoft Internet Explorer"===navigator.appName?null!=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})").exec(u)&&(c=parseFloat(RegExp.$1)):"Netscape"===navigator.appName&&null!=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})").exec(u)&&(c=parseFloat(RegExp.$1)),c}()},{}],207:[function(h,C,m){C.exports=function(c){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(c)}},{}],208:[function(h,C,m){var s=h("../lib/three"),c=["application/x-mpegurl","application/vnd.apple.mpegurl"],u=new Set(["emissiveMap","envMap","map","specularMap"]);function p(d,A){A&&(d.emit("materialtextureloaded",{src:A.image,texture:A}),A.image&&"VIDEO"===A.image.tagName&&(A.image.addEventListener("loadeddata",function(){!d.components||!d.components.material||(A.needsCorrectionBGRA&&A.needsCorrectionFlipY&&-1!==["standard","flat"].indexOf(d.components.material.data.shader)&&d.setAttribute("material","shader","ios10hls"),d.emit("materialvideoloadeddata",{src:A.image,texture:A}))}),A.image.addEventListener("ended",function(){d.emit("materialvideoended",{src:A.image,texture:A})})))}C.exports.updateMapMaterialFromData=function(d,A,E,g){var v=E.el,T=E.material,y=v.sceneEl.systems.renderer,M=g[A];if(E.materialSrcs||(E.materialSrcs={}),!M)return delete E.materialSrcs[d],void O(null);function O(D){T[d]=D,D&&u.has(d)&&y.applyColorCorrection(D),T.needsUpdate=!0,p(v,D)}M!==E.materialSrcs[d]&&(E.materialSrcs[d]=M,M instanceof s.Texture?O(M):v.sceneEl.systems.material.loadTexture(M,{src:M,repeat:g.repeat,offset:g.offset,npot:g.npot},function _(D){E.materialSrcs[d]===M&&O(D)}))},C.exports.updateMap=function(d,A){return C.exports.updateMapMaterialFromData("map","src",d,A)},C.exports.updateDistortionMap=function(d,A,E){var g=d;"ambientOcclusion"===d&&(g="ao");var v=A.el,T=A.material,y=v.sceneEl.systems.renderer,M=E[d+"Map"],_={};if(_.src=M,_.offset=E[d+"TextureOffset"],_.repeat=E[d+"TextureRepeat"],_.wrap=E[d+"TextureWrap"],M){if(M===A[d+"TextureSrc"])return;return A[d+"TextureSrc"]=M,void v.sceneEl.systems.material.loadTexture(M,_,O)}function O(D){var B=g+"Map";T[B]=D,D&&u.has(B)&&y.applyColorCorrection(D),T.needsUpdate=!0,p(v,D)}T.map&&O(null)},C.exports.handleTextureEvents=p,C.exports.isHLS=function(d,A){return!!(A&&c.includes(A.toLowerCase())||d&&d.toLowerCase().indexOf(".m3u8")>0)}},{"../lib/three":178}],209:[function(h,C,m){var s=Object.freeze(Object.create(null));function c(){return{}}function u(d){var A;if(d&&d.constructor===Object)for(A in d)d[A]=void 0}C.exports.createPool=function(A){var E=[],g=null;function y(_){var O,D;if((_=void 0===_?E.length:_)>0&&null==g&&(g=0),_>0)for(O=E.length,E.length+=Number(_),D=O;D<E.length;D++)E[D]=A();return E.length}return A=A||c,{grow:y,pool:E,recycle:function T(_){if(_ instanceof Object){if(null===g||-1===g)return void(E[E.length]=_);E[--g]=_}},size:function M(){return E.length},use:function v(){var _;return(null===g||g===E.length)&&y(E.length||5),_=E[g],E[g++]=s,u(_),_}}},C.exports.clearObject=u,C.exports.removeUnusedKeys=function p(d,A){var E;if(d&&d.constructor===Object)for(E in d)E in A||delete d[E]}},{}],210:[function(h,C,m){var s;C.exports.split=(s={},function(c,u){return u in s||(s[u]={}),c in s[u]||(s[u][c]=c.split(u)),s[u][c]})},{}],211:[function(h,C,m){var c=h("./debug")("utils:src-loader:warn");function u(v,T,y){!function A(v,T){var y;v.tagName?T("IMG"===v.tagName):((y=new XMLHttpRequest).open("HEAD",v),y.addEventListener("load",function(M){var _;y.status>=200&&y.status<300?null==(_=y.getResponseHeader("Content-Type"))?E(v,T):_.startsWith("image")?T(!0):T(!1):E(v,T),y.abort()}),y.send())}(v,function(_){_?T(v):y(v)})}function d(v){var T=v.match(/\url\((.+)\)/);if(T)return T[1]}function E(v,T){var y=new Image;y.addEventListener("load",function M(){T(!0)}),y.addEventListener("error",function _(){T(!1)}),y.src=v}C.exports={parseUrl:d,validateSrc:u,validateCubemapSrc:function p(v,T){var y,_,O,M="",D=[];for(_=0;_<5;_++)M+="(url\\((?:[^\\)]+)\\),\\s*)";function B(H){D.push(H),6===D.length&&T(D)}if(M+="(url\\((?:[^\\)]+)\\)\\s*)",O=v.match(new RegExp(M)))for(_=1;_<7;_++)u(d(O[_]),B);else if(y=function g(v){try{var T=document.querySelector(v);return T||c('No element was found matching the selector: "%s"',v),T}catch{return void c('"%s" is not a valid selector',v)}}(v)){if("A-CUBEMAP"===y.tagName&&y.srcs)return T(y.srcs);c('Selector "%s" does not point to <a-cubemap>',v)}}}},{"./debug":200}],212:[function(h,C,m){var s=/-([a-z])/g;function c(g){return g.replace(s,E)}function u(g){var v,T;for(T in g)T!==(v=c(T))&&(g[v]=g[T],delete g[T]);return g}C.exports.parse=function(g,v){var T;return"string"!=typeof g||(T=function d(g,v){var T,y,M,_,O,D;for(v=v||{},T=p(g),y=0;y<T.length;y++)(M=T[y])&&(_=M.indexOf(":"),O=M.substr(0,_).trim(),D=M.substr(_+1).trim(),v[O]=D);return v}(g,v),T[""])?g:u(T)},C.exports.stringify=function(g){return"string"==typeof g?g:function A(g){var v,T=0,y=0,M="";for(v in g)T++;for(v in g)M+=v+": "+g[v],y<T-1&&(M+="; "),y++;return M}(g)},C.exports.toCamelCase=c,C.exports.transformKeysToCamelCase=u;var g,v,p=(g=[],v=/url\([^)]+$/,function(y){var _,M="",O=0;for(g.length=0;O<y.length;)-1===(_=y.indexOf(";",O))&&(_=y.length),M+=y.substring(O,_),v.test(M)?(M+=";",O=_+1):(g.push(M.trim()),M="",O=_+1);return g});function E(g){return g[1].toUpperCase()}},{}],213:[function(h,C,m){var s=h("../constants").DEFAULT_HANDEDNESS,c=["x","y","z","w"];function p(g,v,T){var y,_,M=g.el.sceneEl;return!!(v&&(_=M&&M.systems["tracked-controls-webvr"],_)&&(y=_.controllers,y.length))&&!!A(y,null,v,T.hand,T.index||0)}function d(g,v,T){var y,M=g.el.sceneEl,_=M&&M.systems["tracked-controls-webxr"];return!!(_&&(y=_.controllers,y&&y.length))&&E(y,v,T.hand,T.index,T.iterateControllerProfiles,T.handTracking)}function A(g,v,T,y,M){var _,O,D=0;for(O=0;O<g.length;O++)if(_=g[O],(!T||_.id.startsWith(T))&&(T||_.id===v)&&(!y||!_.hand||y===_.hand)){if(!y||_.hand)return _;if(D===2*M+(y===s?0:1))return _;++D}}function E(g,v,T,y,M,_){var O,D,B,V,H=!1;for(O=0;O<g.length;O++){if(V=(B=g[O]).profiles,_)H=B.hand;else if(M)for(D=0;D<V.length&&!(H=V[D].startsWith(v));D++);else H=V.length>0&&V[0].startsWith(v);if(H)if("right"===B.handedness||"left"===B.handedness){if(B.handedness===T)return g[O]}else if(O===y)return g[O]}}C.exports.checkControllerPresentAndSetup=function(g,v,T){var M,D,y=g.el,_=y.sceneEl.hasWebXR;if(D=!!(M=(_?d:p)(g,v,T)),g.controllerPresent&&!g.controllerEventsActive&&!_&&g.addEventListeners(),D===g.controllerPresent)return D;g.controllerPresent=D,D?(g.addEventListeners(),g.injectTrackedControls(M),y.emit("controllerconnected",{name:g.name,component:g})):(g.removeEventListeners(),y.emit("controllerdisconnected",{name:g.name,component:g}))},C.exports.isControllerPresentWebVR=p,C.exports.isControllerPresentWebXR=d,C.exports.findMatchingControllerWebVR=A,C.exports.findMatchingControllerWebXR=E,C.exports.emitIfAxesChanged=function(g,v,T){var y,M,_,O,D;for(M in v){for(y=v[M],_=!1,D=0;D<y.length;D++)T.detail.changed[y[D]]&&(_=!0);if(_){for(O={},D=0;D<y.length;D++)O[c[D]]=T.detail.axis[y[D]];g.el.emit(M+"moved",O)}}},C.exports.onButtonEvent=function(g,v,T,y){var _=(y?T.mapping[y]:T.mapping).buttons[g];T.el.emit(_+v),T.updateModel&&T.updateModel(_,v)}},{"../constants":122}],214:[function(h,C,m){THREE.DeviceOrientationControls=function(s){var c=this;this.object=s,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var A,E,g,v,u=function(A){c.deviceOrientation=A},p=function(){c.screenOrientation=window.orientation||0},d=(A=new THREE.Vector3(0,0,1),E=new THREE.Euler,g=new THREE.Quaternion,v=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(T,y,M,_,O){E.set(M,y,-_,"YXZ"),T.setFromEuler(E),T.multiply(v),T.multiply(g.setFromAxisAngle(A,-O))});this.connect=function(){p(),window.addEventListener("orientationchange",p,!1),window.addEventListener("deviceorientation",u,!1),c.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",p,!1),window.removeEventListener("deviceorientation",u,!1),c.enabled=!1},this.update=function(){if(!1!==c.enabled){var A=c.deviceOrientation;if(A){var E=A.alpha?THREE.Math.degToRad(A.alpha)+c.alphaOffset:0,g=A.beta?THREE.Math.degToRad(A.beta):0,v=A.gamma?THREE.Math.degToRad(A.gamma):0,T=c.screenOrientation?THREE.Math.degToRad(c.screenOrientation):0;d(c.object.quaternion,E,g,v,T)}}},this.dispose=function(){c.disconnect()},this.connect()}},{}],215:[function(h,C,m){window.glStats=function(){var s=null,c=0,u=0,p=0,d=0,A=0,E=0,g=0;function v(H,q){return function(){q.apply(this,arguments),H.apply(this,arguments)}}return WebGLRenderingContext.prototype.drawArrays=v(WebGLRenderingContext.prototype.drawArrays,function(){c++,arguments[0]==this.POINTS?E+=arguments[2]:A+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=v(WebGLRenderingContext.prototype.drawElements,function(){u++,d+=arguments[1]/3,A+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=v(WebGLRenderingContext.prototype.useProgram,function(){p++}),WebGLRenderingContext.prototype.bindTexture=v(WebGLRenderingContext.prototype.bindTexture,function(){g++}),{update:function _(){s("allcalls").set(c+u),s("drawElements").set(u),s("drawArrays").set(c),s("bindTexture").set(g),s("useProgram").set(p),s("glfaces").set(d),s("glvertices").set(A),s("glpoints").set(E)},start:function O(){c=0,u=0,p=0,d=0,A=0,E=0,g=0},end:function D(){},attach:function B(H){s=H},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}},window.threeStats=function(s){var c=null;return{update:function A(){c("renderer.info.memory.geometries").set(s.info.memory.geometries),c("renderer.info.programs").set(s.info.programs.length),c("renderer.info.memory.textures").set(s.info.memory.textures),c("renderer.info.render.calls").set(s.info.render.calls),c("renderer.info.render.triangles").set(s.info.render.triangles),c("renderer.info.render.points").set(s.info.render.points)},start:function E(){},end:function g(){},attach:function v(T){c=T},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}},window.BrowserStats=function(){var s=null,c=0,u=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var E=Math.log(1024);function g(_){var D=Math.floor(Math.log(_)/E);return Math.round(100*_/Math.pow(1024,D))/100}return{update:function v(){c=g(performance.memory.usedJSHeapSize),u=g(performance.memory.totalJSHeapSize),s("memory").set(c),s("total").set(u)},start:function T(){c=0},end:function y(){},attach:function M(_){s=_},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}},"object"==typeof C&&(C.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats})},{}],216:[function(h,C,m){"use strict";(function(){"performance"in window||(window.performance={});var s=window.performance;if(!("now"in s)){var c=Date.now();s.timing&&s.timing.navigationStart&&(c=s.timing.navigationStart),s.now=function(){return Date.now()-c}}s.mark||(s.mark=function(){}),s.measure||(s.measure=function(){})})(),window.rStats=function(c){function u(fe,he){for(var me=Object.keys(fe),P=0,X=me.length;P<X;P++)he(me[P])}var d=c||{},A=d.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];(d.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",(d.CSSPath?d.CSSPath:"")+"rStats.css"]).forEach(function(fe){!function p(fe){var he=document.createElement("link");he.href=fe,he.rel="stylesheet",he.type="text/css",document.getElementsByTagName("head")[0].appendChild(he)}(fe)}),d.values||(d.values={});var T,y,M=10,O={};function D(fe,he,me){var P=me||{},X=document.createElement("canvas"),W=X.getContext("2d"),te=0,ce=0,Se=P.color?P.color:"#666666",_e=document.createElement("canvas"),ze=_e.getContext("2d");_e.width=1,_e.height=20,ze.fillStyle="#444444",ze.fillRect(0,0,1,20),ze.fillStyle=Se,ze.fillRect(0,M,1,M),ze.fillStyle="#ffffff",ze.globalAlpha=.5,ze.fillRect(0,M,1,1),ze.globalAlpha=1;var rt=document.createElement("canvas"),gt=rt.getContext("2d");return rt.width=1,rt.height=20,gt.fillStyle="#444444",gt.fillRect(0,0,1,20),gt.fillStyle="#b70000",gt.fillRect(0,M,1,M),gt.globalAlpha=.5,gt.fillStyle="#ffffff",gt.fillRect(0,M,1,1),gt.globalAlpha=1,function Tt(){X.width=200,X.height=M,X.style.width=X.width+"px",X.style.height=X.height+"px",X.className="rs-canvas",fe.appendChild(X),W.fillStyle="#444444",W.fillRect(0,0,X.width,X.height)}(),{draw:function $t(un,In){(ce+=.1*(un-ce))>(te*=.99)&&(te=ce),W.drawImage(X,1,0,X.width-1,X.height,0,0,X.width-1,X.height),W.drawImage(In?rt:_e,X.width-1,X.height-ce*X.height/te-M)}}}function B(fe,he){var me=document.createElement("canvas"),P=me.getContext("2d");return function X(){me.width=200,me.height=M*he,me.style.width=me.width+"px",me.style.height=me.height+"px",me.className="rs-canvas",fe.appendChild(me),P.fillStyle="#444444",P.fillRect(0,0,me.width,me.height)}(),{draw:function W(te){P.drawImage(me,1,0,me.width-1,me.height,0,0,me.width-1,me.height);var ce=0;u(te,function(Se){var _e=te[Se]*me.height;P.fillStyle=A[Se],P.fillRect(me.width-1,ce,1,_e),ce+=_e})}}}function H(fe,he){var P,me=fe,X=0,W=0,te=0,ce=0,Se=performance.now(),_e=0,ze=document.createElement("div"),rt=document.createElement("span"),gt=document.createElement("div"),Tt=document.createTextNode(""),$t=d?d.values[me.toLowerCase()]:null,un=new D(ze,me,$t),In=!1;function sn(Ve){if($t&&$t.average){ce+=Ve,_e++;var Ke=performance.now();Ke-Se>=($t.avgMs||1e3)&&(te=ce/_e,ce=0,Se=Ke,_e=0)}}function tr(){P=performance.now(),d.userTimingAPI&&performance.mark(me+"-start"),In=!0}function Cr(){X=performance.now()-P,d.userTimingAPI&&(performance.mark(me+"-end"),In&&performance.measure(me,me+"-start",me+"-end")),sn(X)}return rt.className="rs-counter-id",rt.textContent=$t&&$t.caption?$t.caption:me,gt.className="rs-counter-value",gt.appendChild(Tt),ze.appendChild(rt),ze.appendChild(gt),he?he.div.appendChild(ze):y.appendChild(ze),P=performance.now(),{set:function $e(Ve){sn(X=Ve)},start:tr,tick:function Un(){Cr(),tr()},end:Cr,frame:function Oe(){var Ve=performance.now(),Ke=Ve-P;W++,Ke>1e3&&(X=$t&&!1===$t.interpolate?W:1e3*W/Ke,W=0,P=Ve,sn(X))},value:function(){return X},draw:function Re(){Tt.nodeValue=Math.round(100*($t&&$t.average?te:X))/100;var Ke=$t&&($t.below&&X<$t.below||$t.over&&X>$t.over);un.draw(X,Ke),ze.className=Ke?"rs-counter-base alarm":"rs-counter-base"}}}function V(fe){var he=fe.toLowerCase();if(void 0===he&&(he="default"),O[he])return O[he];var me=null;d&&d.groups&&u(d.groups,function(X){var W=d.groups[parseInt(X,10)];!me&&-1!==W.values.indexOf(he.toLowerCase())&&(me=W)});var P=new H(he,me);return O[he]=P,P}function ae(){u(d.plugins,function(fe){d.plugins[fe].update()}),u(O,function(fe){O[fe].draw()}),d&&d.fractions&&u(d.fractions,function(fe){var he=d.fractions[parseInt(fe,10)],me=[],P=O[he.base.toLowerCase()];P&&(P=P.value(),u(d.fractions[fe].steps,function(X){var W=d.fractions[fe].steps[parseInt(X,10)].toLowerCase(),te=O[W];te&&me.push(te.value()/P)})),he.graph.draw(me)})}return function ne(){if(d.plugins){d.values||(d.values={}),d.groups||(d.groups=[]),d.fractions||(d.fractions=[]);for(var fe=0;fe<d.plugins.length;fe++)d.plugins[fe].attach(V),u(d.plugins[fe].values,function(he){d.values[he]=d.plugins[fe].values[he]}),d.groups=d.groups.concat(d.plugins[fe].groups),d.fractions=d.fractions.concat(d.plugins[fe].fractions)}else d.plugins={};(T=document.createElement("div")).className="rs-base",(y=document.createElement("div")).className="rs-container",y.style.height="auto",T.appendChild(y),document.body.appendChild(T),d&&(d.groups&&u(d.groups,function(he){var me=d.groups[parseInt(he,10)],P=document.createElement("div");P.className="rs-group",me.div=P;var X=document.createElement("h1");X.textContent=me.caption,X.addEventListener("click",function(W){this.classList.toggle("hidden"),W.preventDefault()}.bind(P)),y.appendChild(X),y.appendChild(P)}),d.fractions&&u(d.fractions,function(he){var me=d.fractions[parseInt(he,10)],P=document.createElement("div");P.className="rs-fraction";var X=document.createElement("div");X.className="rs-legend";var W=0;u(d.fractions[he].steps,function(ce){var Se=document.createElement("p");Se.textContent=d.fractions[he].steps[ce],Se.style.color=A[W],X.appendChild(Se),W++}),P.appendChild(X),P.style.height=W*M+"px",me.div=P;var te=new B(P,W);me.graph=te,y.appendChild(P)}))}(),function(fe){return fe?V(fe):{element:T,update:ae}}},"object"==typeof C&&(C.exports=window.rStats)},{}],217:[function(h,C,m){String.prototype.startsWith||(String.prototype.startsWith=function(s,c){return this.substr(c=c||0,s.length)===s})},{}],218:[function(h,C,m){C.exports={base64:function(c,u){return"data:"+c+";base64,"+u},isMobile:function(){var u,c=!1;return u=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(u)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(u.substr(0,4)))&&(c=!0),c},isIOS:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch{return!0}},appendQueryParameter:function(c,u,p){var d=c.indexOf("?")<0?"?":"&";return c+(d+u+"=")+p},getQueryParameter:function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var p=new RegExp("[\\?&]"+c+"=([^&#]*)").exec(location.search);return null===p?"":decodeURIComponent(p[1].replace(/\+/g," "))},isLandscapeMode:function(){return 90==window.orientation||-90==window.orientation}}},{}],219:[function(h,C,m){var s=h("./util.js");function c(){var d=document.createElement("video");d.addEventListener("ended",function(){d.play()}),this.request=function(){d.paused&&(d.src=s.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),d.play())},this.release=function(){d.pause(),d.src=""}}function u(){var d=null;this.request=function(){d||(d=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){d&&(clearInterval(d),d=null)}}C.exports=function p(){var d=navigator.userAgent||navigator.vendor||window.opera;return d.match(/iPhone/i)||d.match(/iPod/i)?u:c}()},{"./util.js":218}]},{},[176])(176)}),function(ee){var be={};function ue(h){if(be[h])return be[h].exports;var C=be[h]={i:h,l:!1,exports:{}};return ee[h].call(C.exports,C,C.exports,ue),C.l=!0,C.exports}ue.m=ee,ue.c=be,ue.d=function(h,C,m){ue.o(h,C)||Object.defineProperty(h,C,{enumerable:!0,get:m})},ue.r=function(h){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},ue.t=function(h,C){if(1&C&&(h=ue(h)),8&C||4&C&&"object"==typeof h&&h&&h.__esModule)return h;var m=Object.create(null);if(ue.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:h}),2&C&&"string"!=typeof h)for(var s in h)ue.d(m,s,function(c){return h[c]}.bind(null,s));return m},ue.n=function(h){var C=h&&h.__esModule?function(){return h.default}:function(){return h};return ue.d(C,"a",C),C},ue.o=function(h,C){return Object.prototype.hasOwnProperty.call(h,C)},ue.p="",ue(ue.s=0)}([function(ee,be,ue){ue(1)},function(ee,be,ue){if(typeof AFRAME>"u")throw new Error("Component attempted to register before AFRAME was available.");const h=ue(2);AFRAME.registerComponent("htmlembed",{schema:{ppu:{type:"number",default:256}},init:function(){var C=new h(this.el,()=>{m&&(m.needsUpdate=!0)},(p,d)=>{switch(p){case"resize":this.el.emit("resize");break;case"rendered":this.el.emit("rendered");break;case"focusableenter":this.el.emit("focusableenter",d);break;case"focusableleave":this.el.emit("focusableleave",d);break;case"inputrequired":this.el.emit("inputrequired",d)}});this.htmlcanvas=C;var m=new THREE.CanvasTexture(C.canvas);m.minFilter=THREE.LinearFilter,m.wrapS=THREE.ClampToEdgeWrapping,m.wrapT=THREE.ClampToEdgeWrapping;const s=new THREE.MeshBasicMaterial({map:m,transparent:!0});var c=new THREE.PlaneGeometry,u=new THREE.Mesh(c,s);this.el.setObject3D("screen",u),this.screen=u,this.el.addEventListener("raycaster-intersected",p=>{this.raycaster=p.detail.el}),this.el.addEventListener("raycaster-intersected-cleared",p=>{this.htmlcanvas.clearHover(),this.raycaster=null}),this.el.addEventListener("mousedown",p=>{p instanceof CustomEvent?this.htmlcanvas.mousedown(this.lastX,this.lastY):p.stopPropagation()}),this.el.addEventListener("mouseup",p=>{p instanceof CustomEvent?this.htmlcanvas.mouseup(this.lastX,this.lastY):p.stopPropagation()}),this.resize()},resize(){this.width=this.htmlcanvas.width/this.data.ppu,this.height=this.htmlcanvas.height/this.data.ppu,this.screen.scale.x=this.width,this.screen.scale.y=this.height},update(){this.resize()},forceRender(){this.htmlcanvas.forceRender()},tick:function(){if(this.resize(),this.raycaster){var C=this.raycaster.components.raycaster.getIntersection(this.el);if(C){var m=C.point;this.el.object3D.worldToLocal(m);var c=this.height/2,u=Math.round((m.x+this.width/2)/this.width*this.htmlcanvas.canvas.width),p=Math.round((1-(m.y+c)/this.height)*this.htmlcanvas.canvas.height);this.lastX==u&&this.lastY==p||this.htmlcanvas.mousemove(u,p),this.lastX=u,this.lastY=p}}},remove:function(){this.el.removeObject3D("screen")}})},function(ee,be){(function(){var ue=document.createElement("style");ue.innerHTML="input, select,textarea{border: 1px solid #000000;margin: 0;background-color: #ffffff;-webkit-appearance: none;}:-webkit-autofill {color: #fff !important;}input[type='checkbox']{width: 20px;height: 20px;display: inline-block;}input[type='radio']{width: 20px;height: 20px;display: inline-block;border-radius: 50%;}input[type='checkbox'][checked],input[type='radio'][checked]{background-color: #555555;}a-entity[htmlembed] img{display:inline-block}a-entity[htmlembed]{display:none}";var h=document.querySelector("head");h.insertBefore(ue,h.firstChild)})(),ee.exports=class{constructor(ue,h,C){if(!ue)throw"Container Element is Required";var m;this.updateCallback=h,this.eventCallback=C,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.html=ue,this.html.style.display="block",this.width=0,this.height=0,this.html.style.display="none",this.html.style.position="absolute",this.html.style.top="0",this.html.style.left="0",this.html.style.overflow="hidden",this.mousemovehtml=c=>{c.stopPropagation()},this.html.addEventListener("mousemove",this.mousemovehtml),this.hashChangeEvent=()=>{this.hashChanged()},window.addEventListener("hashchange",this.hashChangeEvent,!1),this.overElements=[],this.focusElement=null,this.img=new Image,this.img.addEventListener("load",()=>{this.render()}),this.csshack();var s=new MutationObserver((c,u)=>{if(!this.nowatch)for(var p=0;p<c.length;p++)if(c[p].target!=this.html||"attributes"!=c[p].type){if(!c[p].target.styleRef||"class"==c[p].attributeName){var d=this.csssig(c[p].target);if(c[p].target.styleRef==d)continue;c[p].target.styleRef=d}m||(m=setTimeout(()=>{this.svgToImg(),m=!1}))}});s.observe(this.html,{attributes:!0,childList:!0,subtree:!0}),this.observer=s,this.cssgenerated=[],this.cssembed=[],this.serializer=new XMLSerializer,this.hashChanged()}forceRender(){Array.from(document.querySelectorAll("*")).map(ue=>ue.classCache={}),this.svgToImg()}hashChanged(){if(window.clearedHash!=window.location.hash){Array.from(document.querySelectorAll("*")).map(C=>C.classCache={});var ue=document.querySelector(".targethack");if(ue&&ue.classList.remove("targethack"),window.location.hash){var h=document.querySelector(window.location.hash);h&&h.classList.add("targethack")}}window.clearedHash=window.location.hash,this.svgToImg()}cleanUp(){this.observer.disconnect(),window.removeEventListener("hashchange",this.hashChangeEvent),this.html.addEventListener("mousemove",this.mousrmovehtml)}csshack(){for(var ue=document.styleSheets,h=0;h<ue.length;h++)try{for(var C=ue[h].cssRules,m=[],s=0;s<C.length;s++){C[s].cssText.indexOf(":hover")>-1&&m.push(C[s].cssText.replace(new RegExp(":hover","g"),".hoverhack")),C[s].cssText.indexOf(":active")>-1&&m.push(C[s].cssText.replace(new RegExp(":active","g"),".activehack")),C[s].cssText.indexOf(":focus")>-1&&m.push(C[s].cssText.replace(new RegExp(":focus","g"),".focushack")),C[s].cssText.indexOf(":target")>-1&&m.push(C[s].cssText.replace(new RegExp(":target","g"),".targethack"));var c=m.indexOf(C[s].cssText);c>-1&&m.splice(c,1)}for(s=0;s<m.length;s++)ue[h].insertRule(m[s])}catch{}}dbj2(ue){for(var h=5381,C=0;C<ue.length;C++)h=(h<<5)+h+ue.charCodeAt(C);return h}csssig(ue){if(ue.classCache||(ue.classCache={}),!ue.classCache[ue.className]){for(var h=getComputedStyle(ue),C="",m=0;m<h.length;m++)C+=h[h[m]];ue.classCache[ue.className]=this.dbj2(C)}return ue.classCache[ue.className]}arrayBufferToBase64(ue){for(var h="",C=ue.byteLength,m=0;m<C;m++)h+=String.fromCharCode(ue[m]);return window.btoa(h)}embedCss(ue,h){return new Promise(C=>{var m,s=[];h=(h=(h=(h=h.replace(new RegExp(":hover","g"),".hoverhack")).replace(new RegExp(":active","g"),".activehack")).replace(new RegExp(":focus","g"),".focushack")).replace(new RegExp(":target","g"),".targethack");const c=RegExp(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/gi);for(;m=c.exec(h);)s.push(this.getDataURL(new URL(m[1],ue)).then((u=>p=>{h=h.replace(u[1],p)})(m)));Promise.all(s).then(u=>{C(h)})})}getURL(ue){return ue=new URL(ue,window.location).href,new Promise(h=>{var C=new XMLHttpRequest;C.open("GET",ue,!0),C.responseType="arraybuffer",C.onload=()=>{h(C)},C.send()})}generatePageCSS(){for(var ue=Array.from(document.querySelectorAll("style, link[type='text/css'],link[rel='stylesheet']")),h=[],C=0;C<ue.length;C++){var m=ue[C];if(-1==this.cssgenerated.indexOf(m)){this.csshack();var s=this.cssgenerated.length;this.cssgenerated.push(m),h.push("STYLE"==m.tagName?this.embedCss(window.location,m.innerHTML).then(((c,u)=>p=>{this.cssembed[u]=p})(0,s)):this.getURL(m.getAttribute("href")).then((c=>u=>{var p=new TextDecoder("utf-8").decode(u.response);return this.embedCss(window.location,p).then(((d,A)=>E=>{this.cssembed[A]=E})(0,c))})(s)))}}return Promise.all(h)}getDataURL(ue){return new Promise(h=>{this.getURL(ue).then(C=>{var m=new Uint8Array(C.response),s=C.getResponseHeader("Content-Type").split(";")[0];if("text/css"==s){var c=new TextDecoder("utf-8").decode(m);this.embedCss(ue,c).then(p=>{var d=window.btoa(p);h(d.length>0?"data:"+s+";base64,"+d:"")})}else{var u=this.arrayBufferToBase64(m);h("data:"+s+";base64,"+u)}})})}embededSVG(){for(var ue=[],h=this.html.querySelectorAll("*"),C=0;C<h.length;C++){var m=h[C].getAttributeNS("http://www.w3.org/1999/xlink","href");if(m&&ue.push(this.getDataURL(m).then((u=>p=>{u.removeAttributeNS("http://www.w3.org/1999/xlink","href"),u.setAttribute("href",p)})(h[C]))),"IMG"==h[C].tagName&&"data"!=h[C].src.substr(0,4)&&ue.push(this.getDataURL(h[C].src).then((u=>p=>{u.setAttribute("src",p)})(h[C]))),"http://www.w3.org/1999/xhtml"==h[C].namespaceURI&&h[C].hasAttribute("style")){var s=h[C].getAttribute("style");ue.push(this.embedCss(window.location,s).then(((u,p)=>d=>{u!=d&&p.setAttribute("style",d)})(s,h[C])))}}var c=this.html.querySelectorAll("style");for(C=0;C<c.length;C++)ue.push(this.embedCss(window.location,c[C].innerHTML).then((u=>p=>{u.innerHTML!=p&&(u.innerHTML=p)})(c[C])));return Promise.all(ue)}updateFocusBlur(){for(var ue=this.html.querySelectorAll("*"),h=0;h<ue.length;h++){var C=ue[h];C.tabIndex>-1?(C.hasOwnProperty("focus")||(C.focus=(m=>()=>this.setFocus(m))(C)),C.hasOwnProperty("blur")||(C.blur=(m=>()=>this.focusElement==m&&this.setBlur())(C))):(delete C.focus,delete C.blur)}}getParents(){var ue=[],h=[],C=this.html.parentNode;do{var m=C.tagName.toLowerCase();if("a-"==m.substr(0,2)&&(m="div"),ue.unshift("<"+("body"==m?'body xmlns="http://www.w3.org/1999/xhtml"':m)+' style="transform: none;left: 0;top: 0;position:static;display: block" class="'+C.className+'"'+(C.id?' id="'+C.id+'"':"")+">"),h.push("</"+m+">"),"body"==m)break}while(C=C.parentNode);return[ue.join(""),h.join("")]}updateCheckedAttributes(){for(var ue=this.html.getElementsByTagName("input"),h=0;h<ue.length;h++){var C=ue[h];C.hasAttribute("checked")?C.checked||C.removeAttribute("checked"):C.checked&&C.setAttribute("checked","")}}svgToImg(){this.updateFocusBlur(),Promise.all([this.embededSVG(),this.generatePageCSS()]).then(()=>{this.html.style.display="block",this.width==this.html.offsetWidth&&this.height==this.html.offsetHeight||(this.width=this.html.offsetWidth,this.height=this.html.offsetHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.eventCallback&&this.eventCallback("resized"));var ue=this.serializer.serializeToString(this.html),h=this.getParents();ue='<svg width="'+this.width+'" height="'+this.height+'" xmlns="http://www.w3.org/2000/svg"><defs><style type="text/css"><![CDATA[a[href]{color:#0000EE;text-decoration:underline;}'+this.cssembed.join("")+']]></style></defs><foreignObject x="0" y="0" width="'+this.width+'" height="'+this.height+'">'+h[0]+ue+h[1]+"</foreignObject></svg>",this.img.src="data:image/svg+xml;utf8,"+encodeURIComponent(ue),this.html.style.display="none"})}render(){this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0),this.updateCallback&&this.updateCallback(),this.eventCallback&&this.eventCallback("rendered")}transformPoint(ue,h,C,m,s){var c=ue.transform;if(0==c.indexOf("matrix(")){var u=new THREE.Matrix4,p=c.substring(7,c.length-1).split(", ").map(parseFloat);u.elements[0]=p[0],u.elements[1]=p[1],u.elements[4]=p[2],u.elements[5]=p[3],u.elements[12]=p[4],u.elements[13]=p[5]}else{if(0!=c.indexOf("matrix3d("))return[h,C,z];u=new THREE.Matrix4,p=c.substring(9,c.length-1).split(", ").map(parseFloat),u.elements=p}var d=ue["transform-origin"],A=m+(d=d.replace(new RegExp("px","g"),"").split(" ").map(parseFloat))[0],E=s+d[1],g=0;d[2]&&(g+=d[2]);var v=(new THREE.Matrix4).makeTranslation(-A,-E,-g);u=(new THREE.Matrix4).makeTranslation(A,E,g).multiply(u).multiply(v);var T=(new THREE.Matrix4).getInverse(u),y=new THREE.Vector3(h,C,0),M=new THREE.Vector3(h,C,-1);y.applyMatrix4(T),M.applyMatrix4(T);var _=M.sub(y).normalize();if(0==_.z)return!1;var O=_.multiplyScalar(-y.z/_.z).add(y);return[O.x,O.y]}getBorderRadii(ue,h){for(var C,m=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"],s=[],c=0;c<m.length;c++){for(var u=h[m[c]],p=/(\d*)([a-z%]{1,3})/gi,d=[];C=p.exec(u);)d.push({value:C[1],unit:C[2]});1==d.length&&d.push(d[0]),s.push(d)}const A={px:1,"%":ue.offsetWidth/100};var E=[];for(c=0;c<s.length;c++){for(var g=s[c],v=(d=[],0);v<g.length;v++)d.push(g[v].value*A[g[v].unit]);E.push(d)}var T=1,y=1,M=1,_=1,O=E[0][0]+E[1][0];if(O>ue.offsetWidth){var D=1/O*ue.offsetWidth;T=Math.min(T,D),y=Math.min(y,D)}var B=E[1][1]+E[2][1];B>ue.offsetHeight&&(D=1/B*ue.offsetHeight,M=Math.min(M,D),y=Math.min(y,D));var H=E[2][0]+E[3][0];H>ue.offsetWidth&&(D=1/H*ue.offsetWidth,M=Math.min(M,D),_=Math.min(_,D));var q=E[0][1]+E[3][1];return q>ue.offsetHeight&&(D=1/q*ue.offsetHeight,T=Math.min(T,D),_=Math.min(_,D)),E[0][0]=E[0][0]*T,E[0][1]=E[0][1]*T,E[1][0]=E[1][0]*y,E[1][1]=E[1][1]*y,E[2][0]=E[2][0]*M,E[2][1]=E[2][1]*M,E[3][0]=E[3][0]*_,E[3][1]=E[3][1]*_,E}checkInBorder(ue,h,C,m,s,c){if("0px"==h["border-radius"])return!0;var u,p,d=ue.offsetWidth,A=ue.offsetHeight,E=this.getBorderRadii(ue,h);return!(C<E[0][0]+s&&m<E[0][1]+c&&(u=(E[0][0]+s-C)/E[0][0])*u+(p=(E[0][1]+c-m)/E[0][1])*p>1||C>s+d-E[1][0]&&m<E[1][1]+c&&(u=(C-(s+d-E[1][0]))/E[1][0])*u+(p=(E[1][1]+c-m)/E[1][1])*p>1||C>s+d-E[2][0]&&m>c+A-E[2][1]&&(u=(C-(s+d-E[2][0]))/E[2][0])*u+(p=(m-(c+A-E[2][1]))/E[2][1])*p>1||C<E[3][0]+s&&m>c+A-E[3][1]&&(u=(E[3][0]+s-C)/E[3][0])*u+(p=(m-(c+A-E[3][1]))/E[3][1])*p>1)}checkElement(ue,h,C,m,s,c,u,p){if(u.offsetParent){var d=window.getComputedStyle(u),A=u.offsetLeft+C,E=u.offsetTop+m,g=u.offsetWidth,v=u.offsetHeight,T=d["z-index"];if("auto"!=T&&(s=0,c=parseInt(T)),"static"!=d.position&&u!=this.html&&"auto"==T&&(s+=1),("block"==d.display||"inline-block"==d.display)&&"none"!=d.transform){var y=this.transformPoint(d,ue,h,A,E);if(!y)return;ue=y[0],h=y[1],"auto"==T&&(s+=1)}if(ue>A&&ue<A+g&&h>E&&h<E+v)this.checkInBorder(u,d,ue,h,A,E)&&(s>=p.zIndex||c>p.level)&&c>=p.level&&"none"!=d["pointer-events"]&&(p.zIndex=s,p.ele=u,p.level=c);else if("visible"!=d.overflow)return;var M=u.firstChild;if(M)do{1==M.nodeType&&(M.offsetParent==u?this.checkElement(ue,h,C+A,m+E,s,c,M,p):this.checkElement(ue,h,C,m,s,c,M,p))}while(M=M.nextSibling)}}elementAt(ue,h){this.html.style.display="block";var C={zIndex:0,ele:null,level:0};return this.checkElement(ue,h,0,0,0,0,this.html,C),this.html.style.display="none",C.ele}moveMouse(){var ue=this.moveX,h=this.moveY,C=this.moveButton,m={screenX:ue,screenY:h,clientX:ue,clientY:h,button:C||0,bubbles:!0,cancelable:!0},s={clientX:ue,clientY:h,button:C||0,bubbles:!1},c=this.elementAt(ue,h);if(c!=this.lastEle)if(c){c.tabIndex>-1&&this.eventCallback&&this.eventCallback("focusableenter",{target:c}),this.lastEle&&this.lastEle.tabIndex>-1&&this.eventCallback&&this.eventCallback("focusableleave",{target:this.lastEle});var u=[],p=c;this.lastEle&&this.lastEle.dispatchEvent(new MouseEvent("mouseout",m)),c.dispatchEvent(new MouseEvent("mouseover",m));do{if(p==this.html)break;-1==this.overElements.indexOf(p)&&(p.classList&&p.classList.add("hoverhack"),p.dispatchEvent(new MouseEvent("mouseenter",s)),this.overElements.push(p)),u.push(p)}while(p=p.parentNode);for(var d=0;d<this.overElements.length;d++){var A=this.overElements[d];-1==u.indexOf(A)&&(A.classList&&A.classList.remove("hoverhack"),A.dispatchEvent(new MouseEvent("mouseleave",s)),this.overElements.splice(d,1),d--)}}else for(;A=this.overElements.pop();)A.classList&&A.classList.remove("hoverhack"),A.dispatchEvent(new MouseEvent("mouseout",m));c&&-1==this.overElements.indexOf(c)&&this.overElements.push(c),this.lastEle=c,c&&c.dispatchEvent(new MouseEvent("mousemove",m)),this.moveTimer=!1}mousemove(ue,h,C){this.moveX=ue,this.moveY=h,this.moveButton=C,this.moveTimer||(this.moveTimer=setTimeout(this.moveMouse.bind(this),20))}mousedown(ue,h,C){var m={screenX:ue,screenY:h,clientX:ue,clientY:h,button:C||0,bubbles:!0,cancelable:!0},s=this.elementAt(ue,h);s&&(this.activeElement=s,s.classList.add("activehack"),s.classList.remove("hoverhack"),s.dispatchEvent(new MouseEvent("mousedown",m))),this.mousedownElement=s}setFocus(ue){ue.dispatchEvent(new FocusEvent("focus")),ue.dispatchEvent(new CustomEvent("focusin",{bubbles:!0,cancelable:!1})),ue.classList.add("focushack"),this.focusElement=ue}setBlur(){this.focusElement&&(this.focusElement.classList.remove("focushack"),this.focusElement.dispatchEvent(new FocusEvent("blur")),this.focusElement.dispatchEvent(new CustomEvent("focusout",{bubbles:!0,cancelable:!1})))}clearHover(){var ue;for(this.moveTimer&&(clearTimeout(this.moveTimer),this.moveTimer=!1);ue=this.overElements.pop();)ue.classList&&ue.classList.remove("hoverhack"),ue.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,cancelable:!0}));this.lastEle&&this.lastEle.dispatchEvent(new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0})),this.lastEle=null;var h=document.querySelector(".activeElement");h&&(h.classList.remove("activehack"),this.activeElement=null)}mouseup(ue,h,C){var m={screenX:ue,screenY:h,clientX:ue,clientY:h,button:C||0,bubbles:!0,cancelable:!0},s=this.elementAt(ue,h);this.activeElement&&(this.activeElement.classList.remove("activehack"),s&&(s.classList.add("hoverhack"),-1==this.overElements.indexOf(s)&&this.overElements.push(s)),this.activeElement=null),s?(s.dispatchEvent(new MouseEvent("mouseup",m)),s!=this.focusElement&&(this.setBlur(),s.tabIndex>-1?this.setFocus(s):this.focusElement=null),s==this.mousedownElement&&(s.dispatchEvent(new MouseEvent("click",m)),"INPUT"==s.tagName&&this.updateCheckedAttributes(),"INPUT"!=s.tagName&&"TEXTAREA"!=s.tagName&&"SELECT"!=s.tagName||this.eventCallback&&this.eventCallback("inputrequired",{target:s}))):(this.focusElement&&this.focusElement.dispatchEvent(new FocusEvent("blur")),this.focusElement=null)}}}]),function ee(be,ue,h){function C(c,u){if(!ue[c]){if(!be[c]){var p="function"==typeof require&&require;if(!u&&p)return p(c,!0);if(m)return m(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var A=ue[c]={exports:{}};be[c][0].call(A.exports,function(E){return C(be[c][1][E]||E)},A,A.exports,ee,be,ue,h)}return ue[c].exports}for(var m="function"==typeof require&&require,s=0;s<h.length;s++)C(h[s]);return C}({1:[function(ee,be,ue){var h=ee("cannon-es");ee("./src/components/math"),ee("./src/components/body/ammo-body"),ee("./src/components/body/body"),ee("./src/components/body/dynamic-body"),ee("./src/components/body/static-body"),ee("./src/components/shape/shape"),ee("./src/components/shape/ammo-shape"),ee("./src/components/ammo-constraint"),ee("./src/components/constraint"),ee("./src/components/spring"),ee("./src/system"),be.exports={registerAll:function(){console.warn("registerAll() is deprecated. Components are automatically registered.")}},window.CANNON=window.CANNON||h},{"./src/components/ammo-constraint":8,"./src/components/body/ammo-body":9,"./src/components/body/body":10,"./src/components/body/dynamic-body":11,"./src/components/body/static-body":12,"./src/components/constraint":13,"./src/components/math":14,"./src/components/shape/ammo-shape":16,"./src/components/shape/shape":17,"./src/components/spring":18,"./src/system":28,"cannon-es":4}],2:[function(ee,be,ue){var h=ee("cannon-es");h.shape2mesh=function(C){for(var m=new THREE.Object3D,s=0;s<C.shapes.length;s++){var c,u=C.shapes[s];switch(u.type){case h.Shape.types.SPHERE:var p=new THREE.SphereGeometry(u.radius,8,8);c=new THREE.Mesh(p,this.currentMaterial);break;case h.Shape.types.PARTICLE:c=new THREE.Mesh(this.particleGeo,this.particleMaterial);var d=this.settings;c.scale.set(d.particleSize,d.particleSize,d.particleSize);break;case h.Shape.types.PLANE:var A=new THREE.PlaneGeometry(10,10,4,4);c=new THREE.Object3D;var E=new THREE.Object3D,g=new THREE.Mesh(A,this.currentMaterial);g.scale.set(100,100,100),E.add(g),g.castShadow=!0,g.receiveShadow=!0,c.add(E);break;case h.Shape.types.BOX:var v=new THREE.BoxGeometry(2*u.halfExtents.x,2*u.halfExtents.y,2*u.halfExtents.z);c=new THREE.Mesh(v,this.currentMaterial);break;case h.Shape.types.CONVEXPOLYHEDRON:for(var T=new THREE.Geometry,y=0;y<u.vertices.length;y++){var M=u.vertices[y];T.vertices.push(new THREE.Vector3(M.x,M.y,M.z))}for(y=0;y<u.faces.length;y++)for(var _=u.faces[y],O=_[0],D=1;D<_.length-1;D++)T.faces.push(new THREE.Face3(O,_[D],_[D+1]));T.computeBoundingSphere(),T.computeFaceNormals(),c=new THREE.Mesh(T,this.currentMaterial);break;case h.Shape.types.HEIGHTFIELD:A=new THREE.Geometry;for(var q=new h.Vec3,V=new h.Vec3,ne=new h.Vec3,ae=0;ae<u.data.length-1;ae++)for(var fe=0;fe<u.data[ae].length-1;fe++)for(var he=0;he<2;he++)u.getConvexTrianglePillar(ae,fe,0===he),q.copy(u.pillarConvex.vertices[0]),V.copy(u.pillarConvex.vertices[1]),ne.copy(u.pillarConvex.vertices[2]),q.vadd(u.pillarOffset,q),V.vadd(u.pillarOffset,V),ne.vadd(u.pillarOffset,ne),A.vertices.push(new THREE.Vector3(q.x,q.y,q.z),new THREE.Vector3(V.x,V.y,V.z),new THREE.Vector3(ne.x,ne.y,ne.z)),y=A.vertices.length-3,A.faces.push(new THREE.Face3(y,y+1,y+2));A.computeBoundingSphere(),A.computeFaceNormals(),c=new THREE.Mesh(A,this.currentMaterial);break;case h.Shape.types.TRIMESH:for(A=new THREE.Geometry,q=new h.Vec3,V=new h.Vec3,ne=new h.Vec3,y=0;y<u.indices.length/3;y++)u.getTriangleVertices(y,q,V,ne),A.vertices.push(new THREE.Vector3(q.x,q.y,q.z),new THREE.Vector3(V.x,V.y,V.z),new THREE.Vector3(ne.x,ne.y,ne.z)),D=A.vertices.length-3,A.faces.push(new THREE.Face3(D,D+1,D+2));A.computeBoundingSphere(),A.computeFaceNormals(),c=new THREE.Mesh(A,this.currentMaterial);break;default:throw"Visual type not recognized: "+u.type}if(c.receiveShadow=!0,c.castShadow=!0,c.children)for(y=0;y<c.children.length;y++)if(c.children[y].castShadow=!0,c.children[y].receiveShadow=!0,c.children[y])for(D=0;D<c.children[y].length;D++)c.children[y].children[D].castShadow=!0,c.children[y].children[D].receiveShadow=!0;var me=C.shapeOffsets[s],P=C.shapeOrientations[s];c.position.set(me.x,me.y,me.z),c.quaternion.set(P.x,P.y,P.z,P.w),m.add(c)}return m},be.exports=h.shape2mesh},{"cannon-es":4}],3:[function(ee,be,ue){THREE.AmmoDebugConstants={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295},THREE.AmmoDebugDrawer=function(h,C,m){this.scene=h,this.world=C,this.debugDrawMode=(m=m||{}).debugDrawMode||THREE.AmmoDebugConstants.DrawWireframe;var s=this.debugDrawMode&THREE.AmmoDebugConstants.DrawOnTop||!1,c=m.maxBufferSize||1e6;this.geometry=new THREE.BufferGeometry;var u=new Float32Array(3*c),p=new Float32Array(3*c);this.geometry.addAttribute("position",new THREE.BufferAttribute(u,3).setDynamic(!0)),this.geometry.addAttribute("color",new THREE.BufferAttribute(p,3).setDynamic(!0)),this.index=0;var d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!s});this.mesh=new THREE.LineSegments(this.geometry,d),s&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.debugDrawer.enable=this.enable.bind(this),this.debugDrawer.disable=this.disable.bind(this),this.debugDrawer.update=this.update.bind(this),this.world.setDebugDrawer(this.debugDrawer)},THREE.AmmoDebugDrawer.prototype=function(){return this.debugDrawer},THREE.AmmoDebugDrawer.prototype.enable=function(){this.enabled=!0,this.scene.add(this.mesh)},THREE.AmmoDebugDrawer.prototype.disable=function(){this.enabled=!1,this.scene.remove(this.mesh)},THREE.AmmoDebugDrawer.prototype.update=function(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))},THREE.AmmoDebugDrawer.prototype.drawLine=function(h,C,m){const s=Ammo.HEAPF32,c=s[(m+0)/4],u=s[(m+4)/4],p=s[(m+8)/4];this.geometry.attributes.position.setXYZ(this.index,s[(h+0)/4],s[(h+4)/4],s[(h+8)/4]),this.geometry.attributes.color.setXYZ(this.index++,c,u,p),this.geometry.attributes.position.setXYZ(this.index,s[(C+0)/4],s[(C+4)/4],s[(C+8)/4]),this.geometry.attributes.color.setXYZ(this.index++,c,u,p)},THREE.AmmoDebugDrawer.prototype.drawContactPoint=function(h,C,m,s,c){const u=Ammo.HEAPF32,p=u[(c+0)/4],d=u[(c+4)/4],A=u[(c+8)/4],E=u[(h+0)/4],g=u[(h+4)/4],v=u[(h+8)/4];this.geometry.attributes.position.setXYZ(this.index,E,g,v),this.geometry.attributes.color.setXYZ(this.index++,p,d,A),this.geometry.attributes.position.setXYZ(this.index,E+u[(C+0)/4]*m,g+u[(C+4)/4]*m,v+u[(C+8)/4]*m),this.geometry.attributes.color.setXYZ(this.index++,p,d,A)},THREE.AmmoDebugDrawer.prototype.reportErrorWarning=function(h){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(h)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))},THREE.AmmoDebugDrawer.prototype.draw3dText=function(h,C){console.warn("TODO: draw3dText")},THREE.AmmoDebugDrawer.prototype.setDebugMode=function(h){this.debugDrawMode=h},THREE.AmmoDebugDrawer.prototype.getDebugMode=function(){return this.debugDrawMode}},{}],4:[function(ee,be,ue){"use strict";Object.defineProperty(ue,"__esModule",{value:!0});var h=function(){function Ne(){this.matrix={}}var pe=Ne.prototype;return pe.get=function(R,w){var x=R.id,I=w.id;if(I>x){var N=I;I=x,x=N}return x+"-"+I in this.matrix},pe.set=function(R,w,x){var I=R.id,N=w.id;if(N>I){var Y=N;N=I,I=Y}x?this.matrix[I+"-"+N]=!0:delete this.matrix[I+"-"+N]},pe.reset=function(){this.matrix={}},pe.setNumObjects=function(R){},Ne}(),C=function(){function Ne(R){void 0===R&&(R=[0,0,0,0,0,0,0,0,0]),this.elements=R}var pe=Ne.prototype;return pe.identity=function(){var R=this.elements;R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=1,R[5]=0,R[6]=0,R[7]=0,R[8]=1},pe.setZero=function(){var R=this.elements;R[0]=0,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=0,R[6]=0,R[7]=0,R[8]=0},pe.setTrace=function(R){var w=this.elements;w[0]=R.x,w[4]=R.y,w[8]=R.z},pe.getTrace=function(R){void 0===R&&(R=new m);var w=this.elements;R.x=w[0],R.y=w[4],R.z=w[8]},pe.vmult=function(R,w){void 0===w&&(w=new m);var x=this.elements,I=R.x,N=R.y,Y=R.z;return w.x=x[0]*I+x[1]*N+x[2]*Y,w.y=x[3]*I+x[4]*N+x[5]*Y,w.z=x[6]*I+x[7]*N+x[8]*Y,w},pe.smult=function(R){for(var w=0;w<this.elements.length;w++)this.elements[w]*=R},pe.mmult=function(R,w){void 0===w&&(w=new Ne);for(var x=R.elements,I=0;I<3;I++)for(var N=0;N<3;N++){for(var Y=0,se=0;se<3;se++)Y+=x[I+3*se]*this.elements[se+3*N];w.elements[I+3*N]=Y}return w},pe.scale=function(R,w){void 0===w&&(w=new Ne);for(var x=this.elements,I=w.elements,N=0;3!==N;N++)I[3*N+0]=R.x*x[3*N+0],I[3*N+1]=R.y*x[3*N+1],I[3*N+2]=R.z*x[3*N+2];return w},pe.solve=function(R,w){void 0===w&&(w=new m);var x,I,N=[];for(x=0;x<12;x++)N.push(0);for(x=0;x<3;x++)for(I=0;I<3;I++)N[x+4*I]=this.elements[x+3*I];N[3]=R.x,N[7]=R.y,N[11]=R.z;var Y,se,de=3,ge=de;do{if(0===N[(x=ge-de)+4*x])for(I=x+1;I<ge;I++)if(0!==N[x+4*I]){Y=4;do{N[(se=4-Y)+4*x]+=N[se+4*I]}while(--Y);break}if(0!==N[x+4*x])for(I=x+1;I<ge;I++){var Ee=N[x+4*I]/N[x+4*x];Y=4;do{N[(se=4-Y)+4*I]=se<=x?0:N[se+4*I]-N[se+4*x]*Ee}while(--Y)}}while(--de);if(w.z=N[11]/N[10],w.y=(N[7]-N[6]*w.z)/N[5],w.x=(N[3]-N[2]*w.z-N[1]*w.y)/N[0],isNaN(w.x)||isNaN(w.y)||isNaN(w.z)||w.x===1/0||w.y===1/0||w.z===1/0)throw"Could not solve equation! Got x=["+w.toString()+"], b=["+R.toString()+"], A=["+this.toString()+"]";return w},pe.e=function(R,w,x){if(void 0===x)return this.elements[w+3*R];this.elements[w+3*R]=x},pe.copy=function(R){for(var w=0;w<R.elements.length;w++)this.elements[w]=R.elements[w];return this},pe.toString=function(){for(var R="",w=0;w<9;w++)R+=this.elements[w]+",";return R},pe.reverse=function(R){void 0===R&&(R=new Ne);var w,x,I=[];for(w=0;w<18;w++)I.push(0);for(w=0;w<3;w++)for(x=0;x<3;x++)I[w+6*x]=this.elements[w+3*x];I[3]=1,I[9]=0,I[15]=0,I[4]=0,I[10]=1,I[16]=0,I[5]=0,I[11]=0,I[17]=1;var N,Y,se=3,de=se;do{if(0===I[(w=de-se)+6*w])for(x=w+1;x<de;x++)if(0!==I[w+6*x]){N=6;do{I[(Y=6-N)+6*w]+=I[Y+6*x]}while(--N);break}if(0!==I[w+6*w])for(x=w+1;x<de;x++){var ge=I[w+6*x]/I[w+6*w];N=6;do{I[(Y=6-N)+6*x]=Y<=w?0:I[Y+6*x]-I[Y+6*w]*ge}while(--N)}}while(--se);w=2;do{x=w-1;do{var Ee=I[w+6*x]/I[w+6*w];N=6;do{I[(Y=6-N)+6*x]=I[Y+6*x]-I[Y+6*w]*Ee}while(--N)}while(x--)}while(--w);w=2;do{var De=1/I[w+6*w];N=6;do{I[(Y=6-N)+6*w]=I[Y+6*w]*De}while(--N)}while(w--);w=2;do{x=2;do{if(Y=I[3+x+6*w],isNaN(Y)||Y===1/0)throw"Could not reverse! A=["+this.toString()+"]";R.e(w,x,Y)}while(x--)}while(w--);return R},pe.setRotationFromQuaternion=function(R){var w=R.x,x=R.y,I=R.z,N=R.w,Y=w+w,se=x+x,de=I+I,ge=w*Y,Ee=w*se,De=w*de,Ie=x*se,He=x*de,it=I*de,mt=N*Y,bt=N*se,pt=N*de,zt=this.elements;return zt[0]=1-(Ie+it),zt[1]=Ee-pt,zt[2]=De+bt,zt[3]=Ee+pt,zt[4]=1-(ge+it),zt[5]=He-mt,zt[6]=De-bt,zt[7]=He+mt,zt[8]=1-(ge+Ie),this},pe.transpose=function(R){void 0===R&&(R=new Ne);for(var w=R.elements,x=this.elements,I=0;3!==I;I++)for(var N=0;3!==N;N++)w[3*I+N]=x[3*N+I];return R},Ne}(),m=function(){function Ne(R,w,x){void 0===R&&(R=0),void 0===w&&(w=0),void 0===x&&(x=0),this.x=R,this.y=w,this.z=x}var pe=Ne.prototype;return pe.cross=function(R,w){void 0===w&&(w=new Ne);var x=R.x,I=R.y,N=R.z,Y=this.x,se=this.y,de=this.z;return w.x=se*N-de*I,w.y=de*x-Y*N,w.z=Y*I-se*x,w},pe.set=function(R,w,x){return this.x=R,this.y=w,this.z=x,this},pe.setZero=function(){this.x=this.y=this.z=0},pe.vadd=function(R,w){if(!w)return new Ne(this.x+R.x,this.y+R.y,this.z+R.z);w.x=R.x+this.x,w.y=R.y+this.y,w.z=R.z+this.z},pe.vsub=function(R,w){if(!w)return new Ne(this.x-R.x,this.y-R.y,this.z-R.z);w.x=this.x-R.x,w.y=this.y-R.y,w.z=this.z-R.z},pe.crossmat=function(){return new C([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},pe.normalize=function(){var R=this.x,w=this.y,x=this.z,I=Math.sqrt(R*R+w*w+x*x);if(I>0){var N=1/I;this.x*=N,this.y*=N,this.z*=N}else this.x=0,this.y=0,this.z=0;return I},pe.unit=function(R){void 0===R&&(R=new Ne);var w=this.x,x=this.y,I=this.z,N=Math.sqrt(w*w+x*x+I*I);return N>0?(R.x=w*(N=1/N),R.y=x*N,R.z=I*N):(R.x=1,R.y=0,R.z=0),R},pe.length=function(){var R=this.x,w=this.y,x=this.z;return Math.sqrt(R*R+w*w+x*x)},pe.lengthSquared=function(){return this.dot(this)},pe.distanceTo=function(R){var w=this.x,x=this.y,I=this.z,N=R.x,Y=R.y,se=R.z;return Math.sqrt((N-w)*(N-w)+(Y-x)*(Y-x)+(se-I)*(se-I))},pe.distanceSquared=function(R){var w=this.x,x=this.y,I=this.z,N=R.x,Y=R.y,se=R.z;return(N-w)*(N-w)+(Y-x)*(Y-x)+(se-I)*(se-I)},pe.scale=function(R,w){void 0===w&&(w=new Ne);var I=this.y,N=this.z;return w.x=R*this.x,w.y=R*I,w.z=R*N,w},pe.vmul=function(R,w){return void 0===w&&(w=new Ne),w.x=R.x*this.x,w.y=R.y*this.y,w.z=R.z*this.z,w},pe.addScaledVector=function(R,w,x){return void 0===x&&(x=new Ne),x.x=this.x+R*w.x,x.y=this.y+R*w.y,x.z=this.z+R*w.z,x},pe.dot=function(R){return this.x*R.x+this.y*R.y+this.z*R.z},pe.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},pe.negate=function(R){return void 0===R&&(R=new Ne),R.x=-this.x,R.y=-this.y,R.z=-this.z,R},pe.tangents=function(R,w){var x=this.length();if(x>0){var I=s,N=1/x;I.set(this.x*N,this.y*N,this.z*N);var Y=c;Math.abs(I.x)<.9?(Y.set(1,0,0),I.cross(Y,R)):(Y.set(0,1,0),I.cross(Y,R)),I.cross(R,w)}else R.set(1,0,0),w.set(0,1,0)},pe.toString=function(){return this.x+","+this.y+","+this.z},pe.toArray=function(){return[this.x,this.y,this.z]},pe.copy=function(R){return this.x=R.x,this.y=R.y,this.z=R.z,this},pe.lerp=function(R,w,x){var I=this.x,N=this.y,Y=this.z;x.x=I+(R.x-I)*w,x.y=N+(R.y-N)*w,x.z=Y+(R.z-Y)*w},pe.almostEquals=function(R,w){return void 0===w&&(w=1e-6),!(Math.abs(this.x-R.x)>w||Math.abs(this.y-R.y)>w||Math.abs(this.z-R.z)>w)},pe.almostZero=function(R){return void 0===R&&(R=1e-6),!(Math.abs(this.x)>R||Math.abs(this.y)>R||Math.abs(this.z)>R)},pe.isAntiparallelTo=function(R,w){return this.negate(u),u.almostEquals(R,w)},pe.clone=function(){return new Ne(this.x,this.y,this.z)},Ne}();m.ZERO=new m(0,0,0),m.UNIT_X=new m(1,0,0),m.UNIT_Y=new m(0,1,0),m.UNIT_Z=new m(0,0,1);var s=new m,c=new m,u=new m,p=function(){function Ne(R){void 0===R&&(R={}),this.lowerBound=new m,this.upperBound=new m,R.lowerBound&&this.lowerBound.copy(R.lowerBound),R.upperBound&&this.upperBound.copy(R.upperBound)}var pe=Ne.prototype;return pe.setFromPoints=function(R,w,x,I){var N=this.lowerBound,Y=this.upperBound,se=x;N.copy(R[0]),se&&se.vmult(N,N),Y.copy(N);for(var de=1;de<R.length;de++){var ge=R[de];se&&(se.vmult(ge,d),ge=d),ge.x>Y.x&&(Y.x=ge.x),ge.x<N.x&&(N.x=ge.x),ge.y>Y.y&&(Y.y=ge.y),ge.y<N.y&&(N.y=ge.y),ge.z>Y.z&&(Y.z=ge.z),ge.z<N.z&&(N.z=ge.z)}return w&&(w.vadd(N,N),w.vadd(Y,Y)),I&&(N.x-=I,N.y-=I,N.z-=I,Y.x+=I,Y.y+=I,Y.z+=I),this},pe.copy=function(R){return this.lowerBound.copy(R.lowerBound),this.upperBound.copy(R.upperBound),this},pe.clone=function(){return(new Ne).copy(this)},pe.extend=function(R){this.lowerBound.x=Math.min(this.lowerBound.x,R.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,R.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,R.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,R.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,R.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,R.upperBound.z)},pe.overlaps=function(R){var w=this.lowerBound,x=this.upperBound,I=R.lowerBound,N=R.upperBound;return(I.x<=x.x&&x.x<=N.x||w.x<=N.x&&N.x<=x.x)&&(I.y<=x.y&&x.y<=N.y||w.y<=N.y&&N.y<=x.y)&&(I.z<=x.z&&x.z<=N.z||w.z<=N.z&&N.z<=x.z)},pe.volume=function(){var R=this.lowerBound,w=this.upperBound;return(w.x-R.x)*(w.y-R.y)*(w.z-R.z)},pe.contains=function(R){var w=this.lowerBound,x=this.upperBound,I=R.lowerBound,N=R.upperBound;return w.x<=I.x&&x.x>=N.x&&w.y<=I.y&&x.y>=N.y&&w.z<=I.z&&x.z>=N.z},pe.getCorners=function(R,w,x,I,N,Y,se,de){var ge=this.lowerBound,Ee=this.upperBound;R.copy(ge),w.set(Ee.x,ge.y,ge.z),x.set(Ee.x,Ee.y,ge.z),I.set(ge.x,Ee.y,Ee.z),N.set(Ee.x,ge.y,Ee.z),Y.set(ge.x,Ee.y,ge.z),se.set(ge.x,ge.y,Ee.z),de.copy(Ee)},pe.toLocalFrame=function(R,w){var x=A;this.getCorners(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7]);for(var Ie=0;8!==Ie;Ie++){var He=x[Ie];R.pointToLocal(He,He)}return w.setFromPoints(x)},pe.toWorldFrame=function(R,w){var x=A;this.getCorners(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7]);for(var Ie=0;8!==Ie;Ie++){var He=x[Ie];R.pointToWorld(He,He)}return w.setFromPoints(x)},pe.overlapsRay=function(R){var w=R.direction,x=R.from,I=1/w.x,N=1/w.y,Y=1/w.z,se=(this.lowerBound.x-x.x)*I,de=(this.upperBound.x-x.x)*I,ge=(this.lowerBound.y-x.y)*N,Ee=(this.upperBound.y-x.y)*N,De=(this.lowerBound.z-x.z)*Y,Ie=(this.upperBound.z-x.z)*Y,He=Math.max(Math.max(Math.min(se,de),Math.min(ge,Ee)),Math.min(De,Ie)),it=Math.min(Math.min(Math.max(se,de),Math.max(ge,Ee)),Math.max(De,Ie));return!(it<0||He>it)},Ne}(),d=new m,A=[new m,new m,new m,new m,new m,new m,new m,new m],E=function(){function Ne(){this.matrix=[]}var pe=Ne.prototype;return pe.get=function(R,w){var x=R.index,I=w.index;if(I>x){var N=I;I=x,x=N}return this.matrix[(x*(x+1)>>1)+I-1]},pe.set=function(R,w,x){var I=R.index,N=w.index;if(N>I){var Y=N;N=I,I=Y}this.matrix[(I*(I+1)>>1)+N-1]=x?1:0},pe.reset=function(){for(var R=0,w=this.matrix.length;R!==w;R++)this.matrix[R]=0},pe.setNumObjects=function(R){this.matrix.length=R*(R-1)>>1},Ne}();function g(Ne,pe){Ne.prototype=Object.create(pe.prototype),Ne.prototype.constructor=Ne,Ne.__proto__=pe}function v(Ne){if(void 0===Ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ne}var T=function(){function Ne(){}var pe=Ne.prototype;return pe.addEventListener=function(R,w){void 0===this._listeners&&(this._listeners={});var x=this._listeners;return void 0===x[R]&&(x[R]=[]),x[R].includes(w)||x[R].push(w),this},pe.hasEventListener=function(R,w){if(void 0===this._listeners)return!1;var x=this._listeners;return!(void 0===x[R]||!x[R].includes(w))},pe.hasAnyEventListener=function(R){return void 0!==this._listeners&&void 0!==this._listeners[R]},pe.removeEventListener=function(R,w){if(void 0===this._listeners)return this;var x=this._listeners;if(void 0===x[R])return this;var I=x[R].indexOf(w);return-1!==I&&x[R].splice(I,1),this},pe.dispatchEvent=function(R){if(void 0===this._listeners)return this;var w=this._listeners[R.type];if(void 0!==w){R.target=this;for(var x=0,I=w.length;x<I;x++)w[x].call(this,R)}return this},Ne}(),y=function(){function Ne(R,w,x,I){void 0===R&&(R=0),void 0===w&&(w=0),void 0===x&&(x=0),void 0===I&&(I=1),this.x=R,this.y=w,this.z=x,this.w=I}var pe=Ne.prototype;return pe.set=function(R,w,x,I){return this.x=R,this.y=w,this.z=x,this.w=I,this},pe.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},pe.toArray=function(){return[this.x,this.y,this.z,this.w]},pe.setFromAxisAngle=function(R,w){var x=Math.sin(.5*w);return this.x=R.x*x,this.y=R.y*x,this.z=R.z*x,this.w=Math.cos(.5*w),this},pe.toAxisAngle=function(R){void 0===R&&(R=new m),this.normalize();var w=2*Math.acos(this.w),x=Math.sqrt(1-this.w*this.w);return x<.001?(R.x=this.x,R.y=this.y,R.z=this.z):(R.x=this.x/x,R.y=this.y/x,R.z=this.z/x),[R,w]},pe.setFromVectors=function(R,w){if(R.isAntiparallelTo(w)){var x=M;R.tangents(x,_),this.setFromAxisAngle(x,Math.PI)}else{var N=R.cross(w);this.x=N.x,this.y=N.y,this.z=N.z,this.w=Math.sqrt(Math.pow(R.length(),2)*Math.pow(w.length(),2))+R.dot(w),this.normalize()}return this},pe.mult=function(R,w){void 0===w&&(w=new Ne);var x=this.x,I=this.y,N=this.z,Y=this.w,se=R.x,de=R.y,ge=R.z,Ee=R.w;return w.x=x*Ee+Y*se+I*ge-N*de,w.y=I*Ee+Y*de+N*se-x*ge,w.z=N*Ee+Y*ge+x*de-I*se,w.w=Y*Ee-x*se-I*de-N*ge,w},pe.inverse=function(R){void 0===R&&(R=new Ne);var w=this.x,x=this.y,I=this.z,N=this.w;this.conjugate(R);var Y=1/(w*w+x*x+I*I+N*N);return R.x*=Y,R.y*=Y,R.z*=Y,R.w*=Y,R},pe.conjugate=function(R){return void 0===R&&(R=new Ne),R.x=-this.x,R.y=-this.y,R.z=-this.z,R.w=this.w,R},pe.normalize=function(){var R=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===R?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=R=1/R,this.y*=R,this.z*=R,this.w*=R),this},pe.normalizeFast=function(){var R=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===R?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=R,this.y*=R,this.z*=R,this.w*=R),this},pe.vmult=function(R,w){void 0===w&&(w=new m);var x=R.x,I=R.y,N=R.z,Y=this.x,se=this.y,de=this.z,ge=this.w,Ee=ge*x+se*N-de*I,De=ge*I+de*x-Y*N,Ie=ge*N+Y*I-se*x,He=-Y*x-se*I-de*N;return w.x=Ee*ge+He*-Y+De*-de-Ie*-se,w.y=De*ge+He*-se+Ie*-Y-Ee*-de,w.z=Ie*ge+He*-de+Ee*-se-De*-Y,w},pe.copy=function(R){return this.x=R.x,this.y=R.y,this.z=R.z,this.w=R.w,this},pe.toEuler=function(R,w){var x,I,N;void 0===w&&(w="YZX");var Y=this.x,se=this.y,de=this.z,ge=this.w;if("YZX"!==w)throw new Error("Euler order "+w+" not supported yet.");var Ee=Y*se+de*ge;if(Ee>.499&&(x=2*Math.atan2(Y,ge),I=Math.PI/2,N=0),Ee<-.499&&(x=-2*Math.atan2(Y,ge),I=-Math.PI/2,N=0),void 0===x){var De=Y*Y,He=de*de;x=Math.atan2(2*se*ge-2*Y*de,1-se*se*2-2*He),I=Math.asin(2*Ee),N=Math.atan2(2*Y*ge-2*se*de,1-2*De-2*He)}R.y=x,R.z=I,R.x=N},pe.setFromEuler=function(R,w,x,I){void 0===I&&(I="XYZ");var N=Math.cos(R/2),Y=Math.cos(w/2),se=Math.cos(x/2),de=Math.sin(R/2),ge=Math.sin(w/2),Ee=Math.sin(x/2);return"XYZ"===I?(this.x=de*Y*se+N*ge*Ee,this.y=N*ge*se-de*Y*Ee,this.z=N*Y*Ee+de*ge*se,this.w=N*Y*se-de*ge*Ee):"YXZ"===I?(this.x=de*Y*se+N*ge*Ee,this.y=N*ge*se-de*Y*Ee,this.z=N*Y*Ee-de*ge*se,this.w=N*Y*se+de*ge*Ee):"ZXY"===I?(this.x=de*Y*se-N*ge*Ee,this.y=N*ge*se+de*Y*Ee,this.z=N*Y*Ee+de*ge*se,this.w=N*Y*se-de*ge*Ee):"ZYX"===I?(this.x=de*Y*se-N*ge*Ee,this.y=N*ge*se+de*Y*Ee,this.z=N*Y*Ee-de*ge*se,this.w=N*Y*se+de*ge*Ee):"YZX"===I?(this.x=de*Y*se+N*ge*Ee,this.y=N*ge*se+de*Y*Ee,this.z=N*Y*Ee-de*ge*se,this.w=N*Y*se-de*ge*Ee):"XZY"===I&&(this.x=de*Y*se-N*ge*Ee,this.y=N*ge*se-de*Y*Ee,this.z=N*Y*Ee+de*ge*se,this.w=N*Y*se+de*ge*Ee),this},pe.clone=function(){return new Ne(this.x,this.y,this.z,this.w)},pe.slerp=function(R,w,x){void 0===x&&(x=new Ne);var I,N,Y,se,de,ge=this.x,Ee=this.y,De=this.z,Ie=this.w,He=R.x,it=R.y,mt=R.z,bt=R.w;return(N=ge*He+Ee*it+De*mt+Ie*bt)<0&&(N=-N,He=-He,it=-it,mt=-mt,bt=-bt),1-N>1e-6?(I=Math.acos(N),Y=Math.sin(I),se=Math.sin((1-w)*I)/Y,de=Math.sin(w*I)/Y):(se=1-w,de=w),x.x=se*ge+de*He,x.y=se*Ee+de*it,x.z=se*De+de*mt,x.w=se*Ie+de*bt,x},pe.integrate=function(R,w,x,I){void 0===I&&(I=new Ne);var N=R.x*x.x,Y=R.y*x.y,se=R.z*x.z,de=this.x,ge=this.y,Ee=this.z,De=this.w,Ie=.5*w;return I.x+=Ie*(N*De+Y*Ee-se*ge),I.y+=Ie*(Y*De+se*de-N*Ee),I.z+=Ie*(se*De+N*ge-Y*de),I.w+=Ie*(-N*de-Y*ge-se*Ee),I},Ne}(),M=new m,_=new m,O={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256},D=function(){function Ne(R){void 0===R&&(R={}),this.id=Ne.idCounter++,this.type=R.type||0,this.boundingSphereRadius=0,this.collisionResponse=!R.collisionResponse||R.collisionResponse,this.collisionFilterGroup=void 0!==R.collisionFilterGroup?R.collisionFilterGroup:1,this.collisionFilterMask=void 0!==R.collisionFilterMask?R.collisionFilterMask:-1,this.material=R.material?R.material:null,this.body=null}var pe=Ne.prototype;return pe.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},pe.volume=function(){throw"volume() not implemented for shape type "+this.type},pe.calculateLocalInertia=function(R,w){throw"calculateLocalInertia() not implemented for shape type "+this.type},pe.calculateWorldAABB=function(R,w,x,I){throw"calculateWorldAABB() not implemented for shape type "+this.type},Ne}();D.idCounter=0,D.types=O;var B=function(){function Ne(R){void 0===R&&(R={}),this.position=new m,this.quaternion=new y,R.position&&this.position.copy(R.position),R.quaternion&&this.quaternion.copy(R.quaternion)}var pe=Ne.prototype;return pe.pointToLocal=function(R,w){return Ne.pointToLocalFrame(this.position,this.quaternion,R,w)},pe.pointToWorld=function(R,w){return Ne.pointToWorldFrame(this.position,this.quaternion,R,w)},pe.vectorToWorldFrame=function(R,w){return void 0===w&&(w=new m),this.quaternion.vmult(R,w),w},Ne.pointToLocalFrame=function(R,w,x,I){return void 0===I&&(I=new m),x.vsub(R,I),w.conjugate(H),H.vmult(I,I),I},Ne.pointToWorldFrame=function(R,w,x,I){return void 0===I&&(I=new m),w.vmult(x,I),I.vadd(R,I),I},Ne.vectorToWorldFrame=function(R,w,x){return void 0===x&&(x=new m),R.vmult(w,x),x},Ne.vectorToLocalFrame=function(R,w,x,I){return void 0===I&&(I=new m),w.w*=-1,w.vmult(x,I),w.w*=-1,I},Ne}(),H=new y,q=function(Ne){function pe(w){var x;void 0===w&&(w={});var N=w.vertices,Y=void 0===N?[]:N,se=w.faces,de=void 0===se?[]:se,ge=w.normals,Ee=void 0===ge?[]:ge,De=w.axes,Ie=w.boundingSphereRadius;return(x=Ne.call(this,{type:D.types.CONVEXPOLYHEDRON})||this).vertices=Y,x.faces=de,x.faceNormals=Ee,0===x.faceNormals.length&&x.computeNormals(),Ie?x.boundingSphereRadius=Ie:x.updateBoundingSphereRadius(),x.worldVertices=[],x.worldVerticesNeedsUpdate=!0,x.worldFaceNormals=[],x.worldFaceNormalsNeedsUpdate=!0,x.uniqueAxes=De?De.slice():null,x.uniqueEdges=[],x.computeEdges(),x}g(pe,Ne);var R=pe.prototype;return R.computeEdges=function(){var w=this.faces,x=this.vertices,I=this.uniqueEdges;I.length=0;for(var N=new m,Y=0;Y!==w.length;Y++)for(var se=w[Y],de=se.length,ge=0;ge!==de;ge++){x[se[ge]].vsub(x[se[(ge+1)%de]],N),N.normalize();for(var De=!1,Ie=0;Ie!==I.length;Ie++)if(I[Ie].almostEquals(N)||I[Ie].almostEquals(N)){De=!0;break}De||I.push(N.clone())}},R.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var w=0;w<this.faces.length;w++){for(var x=0;x<this.faces[w].length;x++)if(!this.vertices[this.faces[w][x]])throw new Error("Vertex "+this.faces[w][x]+" not found!");var I=this.faceNormals[w]||new m;if(this.getFaceNormal(w,I),I.negate(I),this.faceNormals[w]=I,I.dot(this.vertices[this.faces[w][0]])<0){console.error(".faceNormals["+w+"] = Vec3("+I.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var Y=0;Y<this.faces[w].length;Y++)console.warn(".vertices["+this.faces[w][Y]+"] = Vec3("+this.vertices[this.faces[w][Y]].toString()+")")}}},R.getFaceNormal=function(w,x){var I=this.faces[w];pe.computeNormal(this.vertices[I[0]],this.vertices[I[1]],this.vertices[I[2]],x)},R.clipAgainstHull=function(w,x,I,N,Y,se,de,ge,Ee){for(var De=new m,Ie=-1,He=-Number.MAX_VALUE,it=0;it<I.faces.length;it++){De.copy(I.faceNormals[it]),Y.vmult(De,De);var mt=De.dot(se);mt>He&&(He=mt,Ie=it)}for(var bt=[],pt=0;pt<I.faces[Ie].length;pt++){var zt=I.vertices[I.faces[Ie][pt]],Lt=new m;Lt.copy(zt),Y.vmult(Lt,Lt),N.vadd(Lt,Lt),bt.push(Lt)}Ie>=0&&this.clipFaceAgainstHull(se,w,x,bt,de,ge,Ee)},R.findSeparatingAxis=function(w,x,I,N,Y,se,de,ge){var Ee=new m,De=new m,Ie=new m,He=new m,it=new m,mt=new m,bt=Number.MAX_VALUE;if(this.uniqueAxes)for(var pt=0;pt!==this.uniqueAxes.length;pt++){I.vmult(this.uniqueAxes[pt],Ee);var zt=this.testSepAxis(Ee,w,x,I,N,Y);if(!1===zt)return!1;zt<bt&&(bt=zt,se.copy(Ee))}else for(var Lt=de?de.length:this.faces.length,dn=0;dn<Lt;dn++){Ee.copy(this.faceNormals[de?de[dn]:dn]),I.vmult(Ee,Ee);var An=this.testSepAxis(Ee,w,x,I,N,Y);if(!1===An)return!1;An<bt&&(bt=An,se.copy(Ee))}if(w.uniqueAxes)for(var Tn=0;Tn!==w.uniqueAxes.length;Tn++){Y.vmult(w.uniqueAxes[Tn],De);var Vn=this.testSepAxis(De,w,x,I,N,Y);if(!1===Vn)return!1;Vn<bt&&(bt=Vn,se.copy(De))}else for(var Jn=ge?ge.length:w.faces.length,Nn=0;Nn<Jn;Nn++){De.copy(w.faceNormals[ge?ge[Nn]:Nn]),Y.vmult(De,De);var Tr=this.testSepAxis(De,w,x,I,N,Y);if(!1===Tr)return!1;Tr<bt&&(bt=Tr,se.copy(De))}for(var kn=0;kn!==this.uniqueEdges.length;kn++){I.vmult(this.uniqueEdges[kn],He);for(var $r=0;$r!==w.uniqueEdges.length;$r++)if(Y.vmult(w.uniqueEdges[$r],it),He.cross(it,mt),!mt.almostZero()){mt.normalize();var Ur=this.testSepAxis(mt,w,x,I,N,Y);if(!1===Ur)return!1;Ur<bt&&(bt=Ur,se.copy(mt))}}return N.vsub(x,Ie),Ie.dot(se)>0&&se.negate(se),!0},R.testSepAxis=function(w,x,I,N,Y,se){pe.project(this,w,I,N,V),pe.project(x,w,Y,se,ne);var de=V[0],ge=V[1],Ee=ne[0],De=ne[1];if(de<De||Ee<ge)return!1;var Ie=de-De,He=Ee-ge;return Ie<He?Ie:He},R.calculateLocalInertia=function(w,x){var I=new m,N=new m;this.computeLocalAABB(N,I);var Y=I.x-N.x,se=I.y-N.y,de=I.z-N.z;x.x=1/12*w*(2*se*2*se+2*de*2*de),x.y=1/12*w*(2*Y*2*Y+2*de*2*de),x.z=1/12*w*(2*se*2*se+2*Y*2*Y)},R.getPlaneConstantOfFace=function(w){return-this.faceNormals[w].dot(this.vertices[this.faces[w][0]])},R.clipFaceAgainstHull=function(w,x,I,N,Y,se,de){for(var ge=new m,Ee=new m,De=new m,Ie=new m,He=new m,it=new m,mt=new m,bt=new m,pt=N,zt=[],Lt=-1,dn=Number.MAX_VALUE,fn=0;fn<this.faces.length;fn++){ge.copy(this.faceNormals[fn]),I.vmult(ge,ge);var An=ge.dot(w);An<dn&&(dn=An,Lt=fn)}if(!(Lt<0)){var Tn=this.faces[Lt];Tn.connectedFaces=[];for(var Vn=0;Vn<this.faces.length;Vn++)for(var Jn=0;Jn<this.faces[Vn].length;Jn++)-1!==Tn.indexOf(this.faces[Vn][Jn])&&Vn!==Lt&&-1===Tn.connectedFaces.indexOf(Vn)&&Tn.connectedFaces.push(Vn);for(var Nn=Tn.length,Mn=0;Mn<Nn;Mn++){var Tr=this.vertices[Tn[Mn]];Tr.vsub(this.vertices[Tn[(Mn+1)%Nn]],Ee),De.copy(Ee),I.vmult(De,De),x.vadd(De,De),Ie.copy(this.faceNormals[Lt]),I.vmult(Ie,Ie),x.vadd(Ie,Ie),De.cross(Ie,He),He.negate(He),it.copy(Tr),I.vmult(it,it),x.vadd(it,it);var $r=Tn.connectedFaces[Mn];mt.copy(this.faceNormals[$r]);var Ur=this.getPlaneConstantOfFace($r);bt.copy(mt),I.vmult(bt,bt);var gr=Ur-bt.dot(x);for(this.clipFaceAgainstPlane(pt,zt,bt,gr);pt.length;)pt.shift();for(;zt.length;)pt.push(zt.shift())}mt.copy(this.faceNormals[Lt]);var Fr=this.getPlaneConstantOfFace(Lt);bt.copy(mt),I.vmult(bt,bt);for(var $n=Fr-bt.dot(x),Or=0;Or<pt.length;Or++){var _r=bt.dot(pt[Or])+$n;_r<=Y&&(console.log("clamped: depth="+_r+" to minDist="+Y),_r=Y),_r<=se&&_r<=1e-6&&de.push({point:pt[Or],normal:bt,depth:_r})}}},R.clipFaceAgainstPlane=function(w,x,I,N){var Y,se,de=w.length;if(de<2)return x;var ge=w[w.length-1],Ee=w[0];Y=I.dot(ge)+N;for(var De=0;De<de;De++){if(se=I.dot(Ee=w[De])+N,Y<0)if(se<0){var Ie=new m;Ie.copy(Ee),x.push(Ie)}else{var He=new m;ge.lerp(Ee,Y/(Y-se),He),x.push(He)}else if(se<0){var it=new m;ge.lerp(Ee,Y/(Y-se),it),x.push(it),x.push(Ee)}ge=Ee,Y=se}return x},R.computeWorldVertices=function(w,x){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new m);for(var I=this.vertices,N=this.worldVertices,Y=0;Y!==this.vertices.length;Y++)x.vmult(I[Y],N[Y]),w.vadd(N[Y],N[Y]);this.worldVerticesNeedsUpdate=!1},R.computeLocalAABB=function(w,x){var I=this.vertices;w.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var N=0;N<this.vertices.length;N++){var Y=I[N];Y.x<w.x?w.x=Y.x:Y.x>x.x&&(x.x=Y.x),Y.y<w.y?w.y=Y.y:Y.y>x.y&&(x.y=Y.y),Y.z<w.z?w.z=Y.z:Y.z>x.z&&(x.z=Y.z)}},R.computeWorldFaceNormals=function(w){for(var x=this.faceNormals.length;this.worldFaceNormals.length<x;)this.worldFaceNormals.push(new m);for(var I=this.faceNormals,N=this.worldFaceNormals,Y=0;Y!==x;Y++)w.vmult(I[Y],N[Y]);this.worldFaceNormalsNeedsUpdate=!1},R.updateBoundingSphereRadius=function(){for(var w=0,x=this.vertices,I=0;I!==x.length;I++){var N=x[I].lengthSquared();N>w&&(w=N)}this.boundingSphereRadius=Math.sqrt(w)},R.calculateWorldAABB=function(w,x,I,N){for(var Y,se,de,ge,Ee,De,Ie=this.vertices,He=new m,it=0;it<Ie.length;it++)He.copy(Ie[it]),x.vmult(He,He),w.vadd(He,He),(void 0===Y||He.x<Y)&&(Y=He.x),(void 0===ge||He.x>ge)&&(ge=He.x),(void 0===se||He.y<se)&&(se=He.y),(void 0===Ee||He.y>Ee)&&(Ee=He.y),(void 0===de||He.z<de)&&(de=He.z),(void 0===De||He.z>De)&&(De=He.z);I.set(Y,se,de),N.set(ge,Ee,De)},R.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},R.getAveragePointLocal=function(w){void 0===w&&(w=new m);for(var x=this.vertices,I=0;I<x.length;I++)w.vadd(x[I],w);return w.scale(1/x.length,w),w},R.transformAllPoints=function(w,x){var I=this.vertices.length,N=this.vertices;if(x){for(var Y=0;Y<I;Y++){var se=N[Y];x.vmult(se,se)}for(var de=0;de<this.faceNormals.length;de++){var ge=this.faceNormals[de];x.vmult(ge,ge)}}if(w)for(var Ee=0;Ee<I;Ee++){var De=N[Ee];De.vadd(w,De)}},R.pointIsInside=function(w){var x=this.vertices,I=this.faces,N=this.faceNormals,Y=new m;this.getAveragePointLocal(Y);for(var se=0;se<this.faces.length;se++){var de=N[se],ge=x[I[se][0]],Ee=new m;w.vsub(ge,Ee);var De=de.dot(Ee),Ie=new m;Y.vsub(ge,Ie);var He=de.dot(Ie);if(De<0&&He>0||De>0&&He<0)return!1}return-1},pe}(D);q.computeNormal=function(Ne,pe,R,w){var x=new m,I=new m;pe.vsub(Ne,I),R.vsub(pe,x),x.cross(I,w),w.isZero()||w.normalize()};var V=[],ne=[];q.project=function(Ne,pe,R,w,x){var I=Ne.vertices.length,N=new m,Y=0,se=0,de=new m,ge=Ne.vertices;de.setZero(),B.vectorToLocalFrame(R,w,pe,N),B.pointToLocalFrame(R,w,de,de);var Ee=de.dot(N);se=Y=ge[0].dot(N);for(var De=1;De<I;De++){var Ie=ge[De].dot(N);Ie>Y&&(Y=Ie),Ie<se&&(se=Ie)}if((se-=Ee)>(Y-=Ee)){var He=se;se=Y,Y=He}x[0]=Y,x[1]=se};var ae=function(Ne){function pe(w){var x;return(x=Ne.call(this,{type:D.types.BOX})||this).halfExtents=w,x.convexPolyhedronRepresentation=null,x.updateConvexPolyhedronRepresentation(),x.updateBoundingSphereRadius(),x}g(pe,Ne);var R=pe.prototype;return R.updateConvexPolyhedronRepresentation=function(){var w=this.halfExtents.x,x=this.halfExtents.y,I=this.halfExtents.z,N=m,Y=[new N(-w,-x,-I),new N(w,-x,-I),new N(w,x,-I),new N(-w,x,-I),new N(-w,-x,I),new N(w,-x,I),new N(w,x,I),new N(-w,x,I)],se=[new N(0,0,1),new N(0,1,0),new N(1,0,0)],de=new q({vertices:Y,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:se});this.convexPolyhedronRepresentation=de,de.material=this.material},R.calculateLocalInertia=function(w,x){return void 0===x&&(x=new m),pe.calculateInertia(this.halfExtents,w,x),x},R.getSideNormals=function(w,x){var I=w,N=this.halfExtents;if(I[0].set(N.x,0,0),I[1].set(0,N.y,0),I[2].set(0,0,N.z),I[3].set(-N.x,0,0),I[4].set(0,-N.y,0),I[5].set(0,0,-N.z),void 0!==x)for(var Y=0;Y!==I.length;Y++)x.vmult(I[Y],I[Y]);return I},R.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},R.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.length()},R.forEachWorldCorner=function(w,x,I){for(var N=this.halfExtents,Y=[[N.x,N.y,N.z],[-N.x,N.y,N.z],[-N.x,-N.y,N.z],[-N.x,-N.y,-N.z],[N.x,-N.y,-N.z],[N.x,N.y,-N.z],[-N.x,N.y,-N.z],[N.x,-N.y,N.z]],se=0;se<Y.length;se++)fe.set(Y[se][0],Y[se][1],Y[se][2]),x.vmult(fe,fe),w.vadd(fe,fe),I(fe.x,fe.y,fe.z)},R.calculateWorldAABB=function(w,x,I,N){var Y=this.halfExtents;he[0].set(Y.x,Y.y,Y.z),he[1].set(-Y.x,Y.y,Y.z),he[2].set(-Y.x,-Y.y,Y.z),he[3].set(-Y.x,-Y.y,-Y.z),he[4].set(Y.x,-Y.y,-Y.z),he[5].set(Y.x,Y.y,-Y.z),he[6].set(-Y.x,Y.y,-Y.z),he[7].set(Y.x,-Y.y,Y.z);var se=he[0];x.vmult(se,se),w.vadd(se,se),N.copy(se),I.copy(se);for(var de=1;de<8;de++){var ge=he[de];x.vmult(ge,ge),w.vadd(ge,ge);var Ee=ge.x,De=ge.y,Ie=ge.z;Ee>N.x&&(N.x=Ee),De>N.y&&(N.y=De),Ie>N.z&&(N.z=Ie),Ee<I.x&&(I.x=Ee),De<I.y&&(I.y=De),Ie<I.z&&(I.z=Ie)}},pe}(D);ae.calculateInertia=function(Ne,pe,R){var w=Ne;R.x=1/12*pe*(2*w.y*2*w.y+2*w.z*2*w.z),R.y=1/12*pe*(2*w.x*2*w.x+2*w.z*2*w.z),R.z=1/12*pe*(2*w.y*2*w.y+2*w.x*2*w.x)};var fe=new m,he=[new m,new m,new m,new m,new m,new m,new m,new m],me={AWAKE:0,SLEEPY:1,SLEEPING:2},P=function(Ne){function pe(w){var x;void 0===w&&(w={}),(x=Ne.call(this)||this).id=pe.idCounter++,x.index=-1,x.world=null,x.preStep=null,x.postStep=null,x.vlambda=new m,x.collisionFilterGroup="number"==typeof w.collisionFilterGroup?w.collisionFilterGroup:1,x.collisionFilterMask="number"==typeof w.collisionFilterMask?w.collisionFilterMask:-1,x.collisionResponse="boolean"!=typeof w.collisionResponse||w.collisionResponse,x.position=new m,x.previousPosition=new m,x.interpolatedPosition=new m,x.initPosition=new m,w.position&&(x.position.copy(w.position),x.previousPosition.copy(w.position),x.interpolatedPosition.copy(w.position),x.initPosition.copy(w.position)),x.velocity=new m,w.velocity&&x.velocity.copy(w.velocity),x.initVelocity=new m,x.force=new m;var I="number"==typeof w.mass?w.mass:0;return x.mass=I,x.invMass=I>0?1/I:0,x.material=w.material||null,x.linearDamping="number"==typeof w.linearDamping?w.linearDamping:.01,x.type=I<=0?pe.STATIC:pe.DYNAMIC,typeof w.type==typeof pe.STATIC&&(x.type=w.type),x.allowSleep=void 0===w.allowSleep||w.allowSleep,x.sleepState=0,x.sleepSpeedLimit=void 0!==w.sleepSpeedLimit?w.sleepSpeedLimit:.1,x.sleepTimeLimit=void 0!==w.sleepTimeLimit?w.sleepTimeLimit:1,x.timeLastSleepy=0,x.wakeUpAfterNarrowphase=!1,x.torque=new m,x.quaternion=new y,x.initQuaternion=new y,x.previousQuaternion=new y,x.interpolatedQuaternion=new y,w.quaternion&&(x.quaternion.copy(w.quaternion),x.initQuaternion.copy(w.quaternion),x.previousQuaternion.copy(w.quaternion),x.interpolatedQuaternion.copy(w.quaternion)),x.angularVelocity=new m,w.angularVelocity&&x.angularVelocity.copy(w.angularVelocity),x.initAngularVelocity=new m,x.shapes=[],x.shapeOffsets=[],x.shapeOrientations=[],x.inertia=new m,x.invInertia=new m,x.invInertiaWorld=new C,x.invMassSolve=0,x.invInertiaSolve=new m,x.invInertiaWorldSolve=new C,x.fixedRotation=void 0!==w.fixedRotation&&w.fixedRotation,x.angularDamping=void 0!==w.angularDamping?w.angularDamping:.01,x.linearFactor=new m(1,1,1),w.linearFactor&&x.linearFactor.copy(w.linearFactor),x.angularFactor=new m(1,1,1),w.angularFactor&&x.angularFactor.copy(w.angularFactor),x.aabb=new p,x.aabbNeedsUpdate=!0,x.boundingRadius=0,x.wlambda=new m,w.shape&&x.addShape(w.shape),x.updateMassProperties(),x}g(pe,Ne);var R=pe.prototype;return R.wakeUp=function(){var w=this.sleepState;this.sleepState=0,this.wakeUpAfterNarrowphase=!1,w===pe.SLEEPING&&this.dispatchEvent(pe.wakeupEvent)},R.sleep=function(){this.sleepState=pe.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1},R.sleepTick=function(w){if(this.allowSleep){var x=this.sleepState,I=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),N=Math.pow(this.sleepSpeedLimit,2);x===pe.AWAKE&&I<N?(this.sleepState=pe.SLEEPY,this.timeLastSleepy=w,this.dispatchEvent(pe.sleepyEvent)):x===pe.SLEEPY&&I>N?this.wakeUp():x===pe.SLEEPY&&w-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(pe.sleepEvent))}},R.updateSolveMassProperties=function(){this.sleepState===pe.SLEEPING||this.type===pe.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},R.pointToLocalFrame=function(w,x){return void 0===x&&(x=new m),w.vsub(this.position,x),this.quaternion.conjugate().vmult(x,x),x},R.vectorToLocalFrame=function(w,x){return void 0===x&&(x=new m),this.quaternion.conjugate().vmult(w,x),x},R.pointToWorldFrame=function(w,x){return void 0===x&&(x=new m),this.quaternion.vmult(w,x),x.vadd(this.position,x),x},R.vectorToWorldFrame=function(w,x){return void 0===x&&(x=new m),this.quaternion.vmult(w,x),x},R.addShape=function(w,x,I){var N=new m,Y=new y;return x&&N.copy(x),I&&Y.copy(I),this.shapes.push(w),this.shapeOffsets.push(N),this.shapeOrientations.push(Y),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,w.body=this,this},R.updateBoundingRadius=function(){for(var w=this.shapes,x=this.shapeOffsets,I=w.length,N=0,Y=0;Y!==I;Y++){var se=w[Y];se.updateBoundingSphereRadius();var de=x[Y].length(),ge=se.boundingSphereRadius;de+ge>N&&(N=de+ge)}this.boundingRadius=N},R.computeAABB=function(){for(var w=this.shapes,x=this.shapeOffsets,I=this.shapeOrientations,N=w.length,Y=X,se=W,de=this.quaternion,ge=this.aabb,Ee=te,De=0;De!==N;De++){var Ie=w[De];de.vmult(x[De],Y),Y.vadd(this.position,Y),de.mult(I[De],se),Ie.calculateWorldAABB(Y,se,Ee.lowerBound,Ee.upperBound),0===De?ge.copy(Ee):ge.extend(Ee)}this.aabbNeedsUpdate=!1},R.updateInertiaWorld=function(w){var x=this.invInertia;if(x.x!==x.y||x.y!==x.z||w){var I=ce,N=Se;I.setRotationFromQuaternion(this.quaternion),I.transpose(N),I.scale(x,I),I.mmult(N,this.invInertiaWorld)}},R.applyForce=function(w,x){if(this.type===pe.DYNAMIC){var I=_e;x.cross(w,I),this.force.vadd(w,this.force),this.torque.vadd(I,this.torque)}},R.applyLocalForce=function(w,x){if(this.type===pe.DYNAMIC){var I=ze,N=rt;this.vectorToWorldFrame(w,I),this.vectorToWorldFrame(x,N),this.applyForce(I,N)}},R.applyImpulse=function(w,x){if(this.type===pe.DYNAMIC){var I=x,N=gt;N.copy(w),N.scale(this.invMass,N),this.velocity.vadd(N,this.velocity);var Y=Tt;I.cross(w,Y),this.invInertiaWorld.vmult(Y,Y),this.angularVelocity.vadd(Y,this.angularVelocity)}},R.applyLocalImpulse=function(w,x){if(this.type===pe.DYNAMIC){var I=$t,N=un;this.vectorToWorldFrame(w,I),this.vectorToWorldFrame(x,N),this.applyImpulse(I,N)}},R.updateMassProperties=function(){var w=In;this.invMass=this.mass>0?1/this.mass:0;var x=this.inertia,I=this.fixedRotation;this.computeAABB(),w.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),ae.calculateInertia(w,this.mass,x),this.invInertia.set(x.x>0&&!I?1/x.x:0,x.y>0&&!I?1/x.y:0,x.z>0&&!I?1/x.z:0),this.updateInertiaWorld(!0)},R.getVelocityAtWorldPoint=function(w,x){var I=new m;return w.vsub(this.position,I),this.angularVelocity.cross(I,x),this.velocity.vadd(x,x),x},R.integrate=function(w,x,I){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===pe.DYNAMIC||this.type===pe.KINEMATIC)&&this.sleepState!==pe.SLEEPING){var N=this.velocity,Y=this.angularVelocity,se=this.position,de=this.force,ge=this.torque,Ee=this.quaternion,Ie=this.invInertiaWorld,He=this.linearFactor,it=this.invMass*w;N.x+=de.x*it*He.x,N.y+=de.y*it*He.y,N.z+=de.z*it*He.z;var mt=Ie.elements,bt=this.angularFactor,pt=ge.x*bt.x,zt=ge.y*bt.y,Lt=ge.z*bt.z;Y.x+=w*(mt[0]*pt+mt[1]*zt+mt[2]*Lt),Y.y+=w*(mt[3]*pt+mt[4]*zt+mt[5]*Lt),Y.z+=w*(mt[6]*pt+mt[7]*zt+mt[8]*Lt),se.x+=N.x*w,se.y+=N.y*w,se.z+=N.z*w,Ee.integrate(this.angularVelocity,w,this.angularFactor,Ee),x&&(I?Ee.normalizeFast():Ee.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}},pe}(T);P.COLLIDE_EVENT_NAME="collide",P.DYNAMIC=1,P.STATIC=2,P.KINEMATIC=4,P.AWAKE=me.AWAKE,P.SLEEPY=me.SLEEPY,P.SLEEPING=me.SLEEPING,P.idCounter=0,P.wakeupEvent={type:"wakeup"},P.sleepyEvent={type:"sleepy"},P.sleepEvent={type:"sleep"};var X=new m,W=new y,te=new p,ce=new C,Se=new C,_e=(new C,new m),ze=new m,rt=new m,gt=new m,Tt=new m,$t=new m,un=new m,In=new m,sn=function(){function Ne(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var pe=Ne.prototype;return pe.collisionPairs=function(R,w,x){throw new Error("collisionPairs not implemented for this BroadPhase class!")},pe.needBroadphaseCollision=function(R,w){return 0!=(R.collisionFilterGroup&w.collisionFilterMask)&&0!=(w.collisionFilterGroup&R.collisionFilterMask)&&(0==(R.type&P.STATIC)&&R.sleepState!==P.SLEEPING||0==(w.type&P.STATIC)&&w.sleepState!==P.SLEEPING)},pe.intersectionTest=function(R,w,x,I){this.useBoundingBoxes?this.doBoundingBoxBroadphase(R,w,x,I):this.doBoundingSphereBroadphase(R,w,x,I)},pe.doBoundingSphereBroadphase=function(R,w,x,I){var N=tr;w.position.vsub(R.position,N);var Y=Math.pow(R.boundingRadius+w.boundingRadius,2);N.lengthSquared()<Y&&(x.push(R),I.push(w))},pe.doBoundingBoxBroadphase=function(R,w,x,I){R.aabbNeedsUpdate&&R.computeAABB(),w.aabbNeedsUpdate&&w.computeAABB(),R.aabb.overlaps(w.aabb)&&(x.push(R),I.push(w))},pe.makePairsUnique=function(R,w){for(var x=Cr,I=Un,N=Re,Y=R.length,se=0;se!==Y;se++)I[se]=R[se],N[se]=w[se];R.length=0,w.length=0;for(var de=0;de!==Y;de++){var ge=I[de].id,Ee=N[de].id,De=ge<Ee?ge+","+Ee:Ee+","+ge;x[De]=de,x.keys.push(De)}for(var Ie=0;Ie!==x.keys.length;Ie++){var He=x.keys.pop(),it=x[He];R.push(I[it]),w.push(N[it]),delete x[He]}},pe.setWorld=function(R){},pe.aabbQuery=function(R,w,x){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]},Ne}(),tr=new m,Cr=(new m,new y,new m,{keys:[]}),Un=[],Re=[];new m,sn.boundingSphereCheck=function(Ne,pe){var R=new m;return Ne.position.vsub(pe.position,R),Math.pow(Ne.shapes[0].boundingSphereRadius+pe.shapes[0].boundingSphereRadius,2)>R.lengthSquared()};var Oe=function(Ne){function pe(R,w,x,I,N){var Y;void 0===R&&(R=new m(100,100,100)),void 0===w&&(w=new m(-100,-100,-100)),void 0===x&&(x=10),void 0===I&&(I=10),void 0===N&&(N=10),(Y=Ne.call(this)||this).nx=x,Y.ny=I,Y.nz=N,Y.aabbMin=R,Y.aabbMax=w;var se=Y.nx*Y.ny*Y.nz;if(se<=0)throw"GridBroadphase: Each dimension's n must be >0";Y.bins=[],Y.binLengths=[],Y.bins.length=se,Y.binLengths.length=se;for(var de=0;de<se;de++)Y.bins[de]=[],Y.binLengths[de]=0;return Y}return g(pe,Ne),pe.prototype.collisionPairs=function(R,w,x){for(var I=R.numObjects(),N=R.bodies,Y=this.aabbMax,se=this.aabbMin,de=this.nx,ge=this.ny,Ee=this.nz,De=ge*Ee,Ie=Ee,it=Y.x,mt=Y.y,bt=Y.z,pt=se.x,zt=se.y,Lt=se.z,dn=de/(it-pt),fn=ge/(mt-zt),An=Ee/(bt-Lt),Tn=(it-pt)/de,Vn=(mt-zt)/ge,Jn=(bt-Lt)/Ee,Nn=.5*Math.sqrt(Tn*Tn+Vn*Vn+Jn*Jn),Mn=D.types,Tr=Mn.SPHERE,kn=Mn.PLANE,$r=this.bins,Ur=this.binLengths,gr=this.bins.length,Fr=0;Fr!==gr;Fr++)Ur[Fr]=0;var $n=Math.ceil;function Or(Dh,Ih,Oh,Bh,Fh,Nh,kh){var Us=(Dh-pt)*dn|0,fs=(Ih-zt)*fn|0,ps=(Oh-Lt)*An|0,vs=$n((Bh-pt)*dn),ms=$n((Fh-zt)*fn),gs=$n((Nh-Lt)*An);Us<0?Us=0:Us>=de&&(Us=de-1),fs<0?fs=0:fs>=ge&&(fs=ge-1),ps<0?ps=0:ps>=Ee&&(ps=Ee-1),vs<0?vs=0:vs>=de&&(vs=de-1),ms<0?ms=0:ms>=ge&&(ms=ge-1),gs<0?gs=0:gs>=Ee&&(gs=Ee-1),fs*=Ie,ps*=1,vs*=De,ms*=Ie,gs*=1;for(var ic=Us*=De;ic<=vs;ic+=De)for(var ac=fs;ac<=ms;ac+=Ie)for(var oc=ps;oc<=gs;oc+=1){var lu=ic+ac+oc;$r[lu][Ur[lu]++]=kh}}for(var _r=0;_r!==I;_r++){var jn=N[_r],Kr=jn.shapes[0];switch(Kr.type){case Tr:var dr=jn.position.x,fa=jn.position.y,ri=jn.position.z,hi=Kr.radius;Or(dr-hi,fa-hi,ri-hi,dr+hi,fa+hi,ri+hi,jn);break;case kn:var ai=Kr;ai.worldNormalNeedsUpdate&&ai.computeWorldNormal(jn.quaternion);var Di=ai.worldNormal,oi=zt+.5*Vn-jn.position.y,pa=Lt+.5*Jn-jn.position.z,wi=$e;wi.set(pt+.5*Tn-jn.position.x,oi,pa);for(var Ji=0,Ii=0;Ji!==de;Ji++,Ii+=De,wi.y=oi,wi.x+=Tn)for(var ia=0,ho=0;ia!==ge;ia++,ho+=Ie,wi.z=pa,wi.y+=Vn)for(var Da=0,ii=0;Da!==Ee;Da++,ii+=1,wi.z+=Jn)if(wi.dot(Di)<Nn){var ru=Ii+ho+ii;$r[ru][Ur[ru]++]=jn}break;default:jn.aabbNeedsUpdate&&jn.computeAABB(),Or(jn.aabb.lowerBound.x,jn.aabb.lowerBound.y,jn.aabb.lowerBound.z,jn.aabb.upperBound.x,jn.aabb.upperBound.y,jn.aabb.upperBound.z,jn)}}for(var yl=0;yl!==gr;yl++){var iu=Ur[yl];if(iu>1)for(var au=$r[yl],Al=0;Al!==iu;Al++)for(var ou=au[Al],rc=0;rc!==Al;rc++){var su=au[rc];this.needBroadphaseCollision(ou,su)&&this.intersectionTest(ou,su,w,x)}}this.makePairsUnique(w,x)},pe}(sn),$e=new m,Ve=(new m,function(Ne){function pe(){return Ne.call(this)||this}g(pe,Ne);var R=pe.prototype;return R.collisionPairs=function(w,x,I){for(var N,Y,se=w.bodies,de=se.length,ge=0;ge!==de;ge++)for(var Ee=0;Ee!==ge;Ee++)this.needBroadphaseCollision(N=se[ge],Y=se[Ee])&&this.intersectionTest(N,Y,x,I)},R.aabbQuery=function(w,x,I){void 0===I&&(I=[]);for(var N=0;N<w.bodies.length;N++){var Y=w.bodies[N];Y.aabbNeedsUpdate&&Y.computeAABB(),Y.aabb.overlaps(x)&&I.push(Y)}return I},pe}(sn)),Ke=function(){function Ne(){this.rayFromWorld=new m,this.rayToWorld=new m,this.hitNormalWorld=new m,this.hitPointWorld=new m,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}var pe=Ne.prototype;return pe.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1},pe.abort=function(){this.shouldStop=!0},pe.set=function(R,w,x,I,N,Y,se){this.rayFromWorld.copy(R),this.rayToWorld.copy(w),this.hitNormalWorld.copy(x),this.hitPointWorld.copy(I),this.shape=N,this.body=Y,this.distance=se},Ne}(),nt=function(){function Ne(R,w){void 0===R&&(R=new m),void 0===w&&(w=new m),this.from=R.clone(),this.to=w.clone(),this.direction=new m,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ne.ANY,this.result=new Ke,this.hasHit=!1,this.callback=function(x){}}var pe=Ne.prototype;return pe.intersectWorld=function(R,w){return this.mode=w.mode||Ne.ANY,this.result=w.result||new Ke,this.skipBackfaces=!!w.skipBackfaces,this.collisionFilterMask=void 0!==w.collisionFilterMask?w.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==w.collisionFilterGroup?w.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===w.checkCollisionResponse||w.checkCollisionResponse,w.from&&this.from.copy(w.from),w.to&&this.to.copy(w.to),this.callback=w.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ut),ht.length=0,R.broadphase.aabbQuery(R,ut,ht),this.intersectBodies(ht),this.hasHit},pe.intersectBody=function(R,w){w&&(this.result=w,this.updateDirection());var x=this.checkCollisionResponse;if((!x||R.collisionResponse)&&this.collisionFilterGroup&R.collisionFilterMask&&R.collisionFilterGroup&this.collisionFilterMask)for(var I=rn,N=mn,Y=0,se=R.shapes.length;Y<se;Y++){var de=R.shapes[Y];if((!x||de.collisionResponse)&&(R.quaternion.mult(R.shapeOrientations[Y],N),R.quaternion.vmult(R.shapeOffsets[Y],I),I.vadd(R.position,I),this.intersectShape(de,N,I,R),this.result.shouldStop))break}},pe.intersectBodies=function(R,w){w&&(this.result=w,this.updateDirection());for(var x=0,I=R.length;!this.result.shouldStop&&x<I;x++)this.intersectBody(R[x])},pe.updateDirection=function(){this.to.vsub(this.from,this.direction),this.direction.normalize()},pe.intersectShape=function(R,w,x,I){if(!(function(Y,se,de){de.vsub(Y,kt);var ge=kt.dot(se);return se.scale(ge,Ft),Ft.vadd(Y,Ft),de.distanceTo(Ft)}(this.from,this.direction,x)>R.boundingSphereRadius)){var N=this[R.type];N&&N.call(this,R,w,x,I,R)}},pe._intersectBox=function(R,w,x,I,N){return this._intersectConvex(R.convexPolyhedronRepresentation,w,x,I,N)},pe._intersectPlane=function(R,w,x,I,N){var Y=this.from,se=this.to,de=this.direction,ge=new m(0,0,1);w.vmult(ge,ge);var Ee=new m;Y.vsub(x,Ee);var De=Ee.dot(ge);if(se.vsub(x,Ee),!(De*Ee.dot(ge)>0||Y.distanceTo(se)<De)){var Ie=ge.dot(de);if(!(Math.abs(Ie)<this.precision)){var He=new m,it=new m,mt=new m;Y.vsub(x,He);var bt=-ge.dot(He)/Ie;de.scale(bt,it),Y.vadd(it,mt),this.reportIntersection(ge,mt,N,I,-1)}}},pe.getAABB=function(R){var w=R.lowerBound,x=R.upperBound,I=this.to,N=this.from;w.x=Math.min(I.x,N.x),w.y=Math.min(I.y,N.y),w.z=Math.min(I.z,N.z),x.x=Math.max(I.x,N.x),x.y=Math.max(I.y,N.y),x.z=Math.max(I.z,N.z)},pe._intersectHeightfield=function(R,w,x,I,N){var Y=Me;Y.from.copy(this.from),Y.to.copy(this.to),B.pointToLocalFrame(x,w,Y.from,Y.from),B.pointToLocalFrame(x,w,Y.to,Y.to),Y.updateDirection();var se,de,ge,Ee,De=qe;se=de=0,ge=Ee=R.data.length-1;var Ie=new p;Y.getAABB(Ie),R.getIndexOfPosition(Ie.lowerBound.x,Ie.lowerBound.y,De,!0),se=Math.max(se,De[0]),de=Math.max(de,De[1]),R.getIndexOfPosition(Ie.upperBound.x,Ie.upperBound.y,De,!0),ge=Math.min(ge,De[0]+1),Ee=Math.min(Ee,De[1]+1);for(var He=se;He<ge;He++)for(var it=de;it<Ee;it++){if(this.result.shouldStop)return;if(R.getAabbAtIndex(He,it,Ie),Ie.overlapsRay(Y)){if(R.getConvexTrianglePillar(He,it,!1),B.pointToWorldFrame(x,w,R.pillarOffset,Pt),this._intersectConvex(R.pillarConvex,w,Pt,I,N,Ye),this.result.shouldStop)return;R.getConvexTrianglePillar(He,it,!0),B.pointToWorldFrame(x,w,R.pillarOffset,Pt),this._intersectConvex(R.pillarConvex,w,Pt,I,N,Ye)}}},pe._intersectSphere=function(R,w,x,I,N){var Y=this.from,se=this.to,de=R.radius,ge=Math.pow(se.x-Y.x,2)+Math.pow(se.y-Y.y,2)+Math.pow(se.z-Y.z,2),Ee=2*((se.x-Y.x)*(Y.x-x.x)+(se.y-Y.y)*(Y.y-x.y)+(se.z-Y.z)*(Y.z-x.z)),De=Math.pow(Y.x-x.x,2)+Math.pow(Y.y-x.y,2)+Math.pow(Y.z-x.z,2)-Math.pow(de,2),Ie=Math.pow(Ee,2)-4*ge*De,He=at,it=ot;if(!(Ie<0))if(0===Ie)Y.lerp(se,Ie,He),He.vsub(x,it),it.normalize(),this.reportIntersection(it,He,N,I,-1);else{var mt=(-Ee-Math.sqrt(Ie))/(2*ge),bt=(-Ee+Math.sqrt(Ie))/(2*ge);if(mt>=0&&mt<=1&&(Y.lerp(se,mt,He),He.vsub(x,it),it.normalize(),this.reportIntersection(it,He,N,I,-1)),this.result.shouldStop)return;bt>=0&&bt<=1&&(Y.lerp(se,bt,He),He.vsub(x,it),it.normalize(),this.reportIntersection(it,He,N,I,-1))}},pe._intersectConvex=function(R,w,x,I,N,Y){for(var se=dt,de=St,ge=Y&&Y.faceList||null,Ee=R.faces,De=R.vertices,Ie=R.faceNormals,He=this.direction,it=this.from,bt=it.distanceTo(this.to),pt=ge?ge.length:Ee.length,zt=this.result,Lt=0;!zt.shouldStop&&Lt<pt;Lt++){var dn=ge?ge[Lt]:Lt,fn=Ee[dn],An=Ie[dn],Tn=w,Vn=x;de.copy(De[fn[0]]),Tn.vmult(de,de),de.vadd(Vn,de),de.vsub(it,de),Tn.vmult(An,se);var Jn=He.dot(se);if(!(Math.abs(Jn)<this.precision)){var Nn=se.dot(de)/Jn;if(!(Nn<0)){He.scale(Nn,Ce),Ce.vadd(it,Ce),ie.copy(De[fn[0]]),Tn.vmult(ie,ie),Vn.vadd(ie,ie);for(var Mn=1;!zt.shouldStop&&Mn<fn.length-1;Mn++){le.copy(De[fn[Mn]]),Fe.copy(De[fn[Mn+1]]),Tn.vmult(le,le),Tn.vmult(Fe,Fe),Vn.vadd(le,le),Vn.vadd(Fe,Fe);var Tr=Ce.distanceTo(it);!Kt(Ce,ie,le,Fe)&&!Kt(Ce,le,ie,Fe)||Tr>bt||this.reportIntersection(se,Ce,N,I,dn)}}}}},pe._intersectTrimesh=function(R,w,x,I,N,Y){var se=It,de=Mt,ge=Ht,Ee=St,De=Zt,Ie=Xt,He=Vt,it=ft,mt=We,bt=R.indices,pt=this.from,zt=this.to,Lt=this.direction;ge.position.copy(x),ge.quaternion.copy(w),B.vectorToLocalFrame(x,w,Lt,De),B.pointToLocalFrame(x,w,pt,Ie),B.pointToLocalFrame(x,w,zt,He),He.x*=R.scale.x,He.y*=R.scale.y,He.z*=R.scale.z,Ie.x*=R.scale.x,Ie.y*=R.scale.y,Ie.z*=R.scale.z,He.vsub(Ie,De),De.normalize();var dn=Ie.distanceSquared(He);R.tree.rayQuery(this,ge,de);for(var fn=0,An=de.length;!this.result.shouldStop&&fn!==An;fn++){var Tn=de[fn];R.getNormal(Tn,se),R.getVertex(bt[3*Tn],ie),ie.vsub(Ie,Ee);var Vn=De.dot(se),Jn=se.dot(Ee)/Vn;if(!(Jn<0)){De.scale(Jn,Ce),Ce.vadd(Ie,Ce),R.getVertex(bt[3*Tn+1],le),R.getVertex(bt[3*Tn+2],Fe);var Nn=Ce.distanceSquared(Ie);!Kt(Ce,le,ie,Fe)&&!Kt(Ce,ie,le,Fe)||Nn>dn||(B.vectorToWorldFrame(w,se,mt),B.pointToWorldFrame(x,w,Ce,it),this.reportIntersection(mt,it,N,I,Tn))}}de.length=0},pe.reportIntersection=function(R,w,x,I,N){var Y=this.from,se=this.to,de=Y.distanceTo(w),ge=this.result;if(!(this.skipBackfaces&&R.dot(this.direction)>0))switch(ge.hitFaceIndex=void 0!==N?N:-1,this.mode){case Ne.ALL:this.hasHit=!0,ge.set(Y,se,R,w,x,I,de),ge.hasHit=!0,this.callback(ge);break;case Ne.CLOSEST:(de<ge.distance||!ge.hasHit)&&(this.hasHit=!0,ge.hasHit=!0,ge.set(Y,se,R,w,x,I,de));break;case Ne.ANY:this.hasHit=!0,ge.hasHit=!0,ge.set(Y,se,R,w,x,I,de),ge.shouldStop=!0}},Ne}();nt.CLOSEST=1,nt.ANY=2,nt.ALL=4;var ut=new p,ht=[],_t=new m,Bt=new m;function Kt(Ne,pe,R,w){w.vsub(pe,kt),R.vsub(pe,_t),Ne.vsub(pe,Bt);var x,I,N=kt.dot(kt),Y=kt.dot(_t),se=kt.dot(Bt),de=_t.dot(_t),ge=_t.dot(Bt);return(x=de*se-Y*ge)>=0&&(I=N*ge-Y*se)>=0&&x+I<N*de-Y*Y}nt.pointInTriangle=Kt;var rn=new m,mn=new y,Ce=(new m,new m,new m),ie=new m,le=new m,Fe=new m;new m,new Ke,nt.prototype[D.types.BOX]=nt.prototype._intersectBox,nt.prototype[D.types.PLANE]=nt.prototype._intersectPlane;var Ye={faceList:[0]},Pt=new m,Me=new nt,qe=[];nt.prototype[D.types.HEIGHTFIELD]=nt.prototype._intersectHeightfield;var at=new m,ot=new m;nt.prototype[D.types.SPHERE]=nt.prototype._intersectSphere;var dt=new m,St=(new m,new m,new m);nt.prototype[D.types.CONVEXPOLYHEDRON]=nt.prototype._intersectConvex;var It=new m,Zt=new m,Xt=new m,Vt=new m,We=new m,ft=new m,Mt=(new p,[]),Ht=new B;nt.prototype[D.types.TRIMESH]=nt.prototype._intersectTrimesh;var kt=new m,Ft=new m,jt=function(Ne){function pe(w){var x;(x=Ne.call(this)||this).axisList=[],x.world=null,x.axisIndex=0;var I=x.axisList;return x._addBodyHandler=function(N){I.push(N.body)},x._removeBodyHandler=function(N){var Y=I.indexOf(N.body);-1!==Y&&I.splice(Y,1)},w&&x.setWorld(w),x}g(pe,Ne);var R=pe.prototype;return R.setWorld=function(w){this.axisList.length=0;for(var x=0;x<w.bodies.length;x++)this.axisList.push(w.bodies[x]);w.removeEventListener("addBody",this._addBodyHandler),w.removeEventListener("removeBody",this._removeBodyHandler),w.addEventListener("addBody",this._addBodyHandler),w.addEventListener("removeBody",this._removeBodyHandler),this.world=w,this.dirty=!0},R.collisionPairs=function(w,x,I){var N,Y,se=this.axisList,de=se.length,ge=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),N=0;N!==de;N++){var Ee=se[N];for(Y=N+1;Y<de;Y++){var De=se[Y];if(this.needBroadphaseCollision(Ee,De)){if(!pe.checkBounds(Ee,De,ge))break;this.intersectionTest(Ee,De,x,I)}}}},R.sortList=function(){for(var w=this.axisList,x=this.axisIndex,I=w.length,N=0;N!==I;N++){var Y=w[N];Y.aabbNeedsUpdate&&Y.computeAABB()}0===x?pe.insertionSortX(w):1===x?pe.insertionSortY(w):2===x&&pe.insertionSortZ(w)},R.autoDetectAxis=function(){for(var w=0,x=0,I=0,N=0,Y=0,se=0,de=this.axisList,ge=de.length,Ee=1/ge,De=0;De!==ge;De++){var Ie=de[De],He=Ie.position.x;w+=He,x+=He*He;var it=Ie.position.y;I+=it,N+=it*it;var mt=Ie.position.z;Y+=mt,se+=mt*mt}var bt=x-w*w*Ee,pt=N-I*I*Ee,zt=se-Y*Y*Ee;this.axisIndex=bt>pt?bt>zt?0:2:pt>zt?1:2},R.aabbQuery=function(w,x,I){void 0===I&&(I=[]),this.dirty&&(this.sortList(),this.dirty=!1);for(var se=this.axisList,de=0;de<se.length;de++){var ge=se[de];ge.aabbNeedsUpdate&&ge.computeAABB(),ge.aabb.overlaps(x)&&I.push(ge)}return I},pe}(sn);function ln(){}jt.insertionSortX=function(Ne){for(var pe=1,R=Ne.length;pe<R;pe++){var w=Ne[pe],x=void 0;for(x=pe-1;x>=0&&!(Ne[x].aabb.lowerBound.x<=w.aabb.lowerBound.x);x--)Ne[x+1]=Ne[x];Ne[x+1]=w}return Ne},jt.insertionSortY=function(Ne){for(var pe=1,R=Ne.length;pe<R;pe++){var w=Ne[pe],x=void 0;for(x=pe-1;x>=0&&!(Ne[x].aabb.lowerBound.y<=w.aabb.lowerBound.y);x--)Ne[x+1]=Ne[x];Ne[x+1]=w}return Ne},jt.insertionSortZ=function(Ne){for(var pe=1,R=Ne.length;pe<R;pe++){var w=Ne[pe],x=void 0;for(x=pe-1;x>=0&&!(Ne[x].aabb.lowerBound.z<=w.aabb.lowerBound.z);x--)Ne[x+1]=Ne[x];Ne[x+1]=w}return Ne},jt.checkBounds=function(Ne,pe,R){var w,x;return 0===R?(w=Ne.position.x,x=pe.position.x):1===R?(w=Ne.position.y,x=pe.position.y):2===R&&(w=Ne.position.z,x=pe.position.z),x-pe.boundingRadius<w+Ne.boundingRadius},ln.defaults=function(Ne,pe){for(var R in void 0===Ne&&(Ne={}),pe)R in Ne||(Ne[R]=pe[R]);return Ne};var vn=function(){function Ne(R,w,x){void 0===x&&(x={}),x=ln.defaults(x,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=R,this.bodyB=w,this.id=Ne.idCounter++,this.collideConnected=x.collideConnected,x.wakeUpBodies&&(R&&R.wakeUp(),w&&w.wakeUp())}var pe=Ne.prototype;return pe.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},pe.enable=function(){for(var R=this.equations,w=0;w<R.length;w++)R[w].enabled=!0},pe.disable=function(){for(var R=this.equations,w=0;w<R.length;w++)R[w].enabled=!1},Ne}();vn.idCounter=0;var hn=function(){function Ne(){this.spatial=new m,this.rotational=new m}var pe=Ne.prototype;return pe.multiplyElement=function(R){return R.spatial.dot(this.spatial)+R.rotational.dot(this.rotational)},pe.multiplyVectors=function(R,w){return R.dot(this.spatial)+w.dot(this.rotational)},Ne}(),zn=function(){function Ne(R,w,x,I){void 0===x&&(x=-1e6),void 0===I&&(I=1e6),this.id=Ne.id++,this.minForce=x,this.maxForce=I,this.bi=R,this.bj=w,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new hn,this.jacobianElementB=new hn,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}var pe=Ne.prototype;return pe.setSpookParams=function(R,w,x){var I=w,N=R,Y=x;this.a=4/(Y*(1+4*I)),this.b=4*I/(1+4*I),this.eps=4/(Y*Y*N*(1+4*I))},pe.computeB=function(R,w,x){var I=this.computeGW();return-this.computeGq()*R-I*w-this.computeGiMf()*x},pe.computeGq=function(){var w=this.jacobianElementB,Y=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+w.spatial.dot(Y)},pe.computeGW=function(){var w=this.jacobianElementB,x=this.bi,I=this.bj,Y=I.velocity,de=I.angularVelocity;return this.jacobianElementA.multiplyVectors(x.velocity,x.angularVelocity)+w.multiplyVectors(Y,de)},pe.computeGWlambda=function(){var w=this.jacobianElementB,x=this.bi,I=this.bj,Y=I.vlambda,de=I.wlambda;return this.jacobianElementA.multiplyVectors(x.vlambda,x.wlambda)+w.multiplyVectors(Y,de)},pe.computeGiMf=function(){var R=this.jacobianElementA,w=this.jacobianElementB,x=this.bi,I=this.bj,Y=x.torque,se=I.force,de=I.torque,Ee=I.invMassSolve;return x.force.scale(x.invMassSolve,xn),se.scale(Ee,nr),x.invInertiaWorldSolve.vmult(Y,Pn),I.invInertiaWorldSolve.vmult(de,jr),R.multiplyVectors(xn,Pn)+w.multiplyVectors(nr,jr)},pe.computeGiMGt=function(){var R=this.jacobianElementA,w=this.jacobianElementB,x=this.bi,I=this.bj,de=I.invInertiaWorldSolve,ge=x.invMassSolve+I.invMassSolve;return x.invInertiaWorldSolve.vmult(R.rotational,Xr),ge+=Xr.dot(R.rotational),de.vmult(w.rotational,Xr),ge+Xr.dot(w.rotational)},pe.addToWlambda=function(R){var w=this.jacobianElementA,x=this.jacobianElementB,I=this.bi,N=this.bj,Y=ur;I.vlambda.addScaledVector(I.invMassSolve*R,w.spatial,I.vlambda),N.vlambda.addScaledVector(N.invMassSolve*R,x.spatial,N.vlambda),I.invInertiaWorldSolve.vmult(w.rotational,Y),I.wlambda.addScaledVector(R,Y,I.wlambda),N.invInertiaWorldSolve.vmult(x.rotational,Y),N.wlambda.addScaledVector(R,Y,N.wlambda)},pe.computeC=function(){return this.computeGiMGt()+this.eps},Ne}();zn.id=0;var xn=new m,nr=new m,Pn=new m,jr=new m,Xr=new m,ur=new m,Si=function(Ne){function pe(w,x,I){var N;return void 0===I&&(I=1e6),(N=Ne.call(this,w,x,0,I)||this).restitution=0,N.ri=new m,N.rj=new m,N.ni=new m,N}g(pe,Ne);var R=pe.prototype;return R.computeB=function(w){var x=this.a,I=this.b,N=this.bi,Y=this.bj,se=this.ri,de=this.rj,ge=ti,Ee=Pr,De=N.velocity,Ie=N.angularVelocity,He=Y.velocity,it=Y.angularVelocity,mt=xa,bt=this.jacobianElementA,pt=this.jacobianElementB,zt=this.ni;se.cross(zt,ge),de.cross(zt,Ee),zt.negate(bt.spatial),ge.negate(bt.rotational),pt.spatial.copy(zt),pt.rotational.copy(Ee),mt.copy(Y.position),mt.vadd(de,mt),mt.vsub(N.position,mt),mt.vsub(se,mt);var Lt=zt.dot(mt),dn=this.restitution+1;return-Lt*x-(dn*He.dot(zt)-dn*De.dot(zt)+it.dot(Ee)-Ie.dot(ge))*I-w*this.computeGiMf()},R.getImpactVelocityAlongNormal=function(){var w=Pe,x=Qe,I=yt,N=Nt,Y=Dt;return this.bi.position.vadd(this.ri,I),this.bj.position.vadd(this.rj,N),this.bi.getVelocityAtWorldPoint(I,w),this.bj.getVelocityAtWorldPoint(N,x),w.vsub(x,Y),this.ni.dot(Y)},pe}(zn),ti=new m,Pr=new m,xa=new m,Pe=new m,Qe=new m,yt=new m,Nt=new m,Dt=new m,Qt=function(Ne){function pe(R,w,x,I,N){var Y;void 0===w&&(w=new m),void 0===I&&(I=new m),void 0===N&&(N=1e6),(Y=Ne.call(this,R,x)||this).pivotA=w.clone(),Y.pivotB=I.clone();var se=Y.equationX=new Si(R,x),de=Y.equationY=new Si(R,x),ge=Y.equationZ=new Si(R,x);return Y.equations.push(se,de,ge),se.minForce=de.minForce=ge.minForce=-N,se.maxForce=de.maxForce=ge.maxForce=N,se.ni.set(1,0,0),de.ni.set(0,1,0),ge.ni.set(0,0,1),Y}return g(pe,Ne),pe.prototype.update=function(){var w=this.bodyB,x=this.equationX,I=this.equationY,N=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,x.ri),w.quaternion.vmult(this.pivotB,x.rj),I.ri.copy(x.ri),I.rj.copy(x.rj),N.ri.copy(x.ri),N.rj.copy(x.rj)},pe}(vn),gn=function(Ne){function pe(R,w,x){var I;void 0===x&&(x={});var N=void 0!==x.maxForce?x.maxForce:1e6;return(I=Ne.call(this,R,w,-N,N)||this).axisA=x.axisA?x.axisA.clone():new m(1,0,0),I.axisB=x.axisB?x.axisB.clone():new m(0,1,0),I.angle=void 0!==x.angle?x.angle:0,I}return g(pe,Ne),pe.prototype.computeB=function(R){var w=this.a,x=this.b,I=this.axisA,N=this.axisB,Y=On,se=bn,de=this.jacobianElementA,ge=this.jacobianElementB;return I.cross(N,Y),N.cross(I,se),de.rotational.copy(se),ge.rotational.copy(Y),-(Math.cos(this.angle)-I.dot(N))*w-this.computeGW()*x-R*this.computeGiMf()},pe}(zn),On=new m,bn=new m,Wt=function(Ne){function pe(R,w,x){var I;void 0===x&&(x={});var N=void 0!==x.maxForce?x.maxForce:1e6;return(I=Ne.call(this,R,w,-N,N)||this).axisA=x.axisA?x.axisA.clone():new m(1,0,0),I.axisB=x.axisB?x.axisB.clone():new m(0,1,0),I.maxAngle=Math.PI/2,I}return g(pe,Ne),pe.prototype.computeB=function(R){var w=this.a,x=this.b,I=this.axisA,N=this.axisB,Y=Wn,se=qn,de=this.jacobianElementA,ge=this.jacobianElementB;return I.cross(N,Y),N.cross(I,se),de.rotational.copy(se),ge.rotational.copy(Y),-(Math.cos(this.maxAngle)-I.dot(N))*w-this.computeGW()*x-R*this.computeGiMf()},pe}(zn),Wn=new m,qn=new m,rr=function(Ne){function pe(R,w,x){var I;void 0===x&&(x={});var N=void 0!==x.maxForce?x.maxForce:1e6,Y=x.pivotA?x.pivotA.clone():new m,se=x.pivotB?x.pivotB.clone():new m;(I=Ne.call(this,R,Y,w,se,N)||this).axisA=x.axisA?x.axisA.clone():new m,I.axisB=x.axisB?x.axisB.clone():new m,I.collideConnected=!!x.collideConnected,I.angle=void 0!==x.angle?x.angle:0;var de=I.coneEquation=new gn(R,w,x),ge=I.twistEquation=new Wt(R,w,x);return I.twistAngle=void 0!==x.twistAngle?x.twistAngle:0,de.maxForce=0,de.minForce=-N,ge.maxForce=0,ge.minForce=-N,I.equations.push(de,ge),I}return g(pe,Ne),pe.prototype.update=function(){var R=this.bodyA,w=this.bodyB,x=this.coneEquation,I=this.twistEquation;Ne.prototype.update.call(this),R.vectorToWorldFrame(this.axisA,x.axisA),w.vectorToWorldFrame(this.axisB,x.axisB),this.axisA.tangents(I.axisA,I.axisA),R.vectorToWorldFrame(I.axisA,I.axisA),this.axisB.tangents(I.axisB,I.axisB),w.vectorToWorldFrame(I.axisB,I.axisB),x.angle=this.angle,I.maxAngle=this.twistAngle},pe}(Qt),pi=(new m,new m,function(Ne){function pe(R,w,x,I){var N;void 0===I&&(I=1e6),N=Ne.call(this,R,w)||this,void 0===x&&(x=R.position.distanceTo(w.position)),N.distance=x;var Y=N.distanceEquation=new Si(R,w);return N.equations.push(Y),Y.minForce=-I,Y.maxForce=I,N}return g(pe,Ne),pe.prototype.update=function(){var x=this.distanceEquation,I=.5*this.distance,N=x.ni;this.bodyB.position.vsub(this.bodyA.position,N),N.normalize(),N.scale(I,x.ri),N.scale(-I,x.rj)},pe}(vn)),xr=function(Ne){function pe(R,w,x){var I;void 0===x&&(x={});var N=void 0!==x.maxForce?x.maxForce:1e6,Y=new m,se=new m,de=new m;R.position.vadd(w.position,de),de.scale(.5,de),w.pointToLocalFrame(de,se),R.pointToLocalFrame(de,Y),(I=Ne.call(this,R,Y,w,se,N)||this).xA=R.vectorToLocalFrame(m.UNIT_X),I.xB=w.vectorToLocalFrame(m.UNIT_X),I.yA=R.vectorToLocalFrame(m.UNIT_Y),I.yB=w.vectorToLocalFrame(m.UNIT_Y),I.zA=R.vectorToLocalFrame(m.UNIT_Z),I.zB=w.vectorToLocalFrame(m.UNIT_Z);var ge=I.rotationalEquation1=new Wt(R,w,x),Ee=I.rotationalEquation2=new Wt(R,w,x),De=I.rotationalEquation3=new Wt(R,w,x);return I.equations.push(ge,Ee,De),I}return g(pe,Ne),pe.prototype.update=function(){var R=this.bodyA,w=this.bodyB,x=this.rotationalEquation1,I=this.rotationalEquation2,N=this.rotationalEquation3;Ne.prototype.update.call(this),R.vectorToWorldFrame(this.xA,x.axisA),w.vectorToWorldFrame(this.yB,x.axisB),R.vectorToWorldFrame(this.yA,I.axisA),w.vectorToWorldFrame(this.zB,I.axisB),R.vectorToWorldFrame(this.zA,N.axisA),w.vectorToWorldFrame(this.xB,N.axisB)},pe}(Qt),ir=(new m,new m,function(Ne){function pe(R,w,x){var I;return void 0===x&&(x=1e6),(I=Ne.call(this,R,w,-x,x)||this).axisA=new m,I.axisB=new m,I.targetVelocity=0,I}return g(pe,Ne),pe.prototype.computeB=function(R){var w=this.b,I=this.axisB,Y=this.jacobianElementB;return this.jacobianElementA.rotational.copy(this.axisA),I.negate(Y.rotational),-(this.computeGW()-this.targetVelocity)*w-R*this.computeGiMf()},pe}(zn)),cr=function(Ne){function pe(w,x,I){var N;void 0===I&&(I={});var Y=void 0!==I.maxForce?I.maxForce:1e6,se=I.pivotA?I.pivotA.clone():new m,de=I.pivotB?I.pivotB.clone():new m;((N=Ne.call(this,w,se,x,de,Y)||this).axisA=I.axisA?I.axisA.clone():new m(1,0,0)).normalize(),(N.axisB=I.axisB?I.axisB.clone():new m(1,0,0)).normalize(),N.collideConnected=!!I.collideConnected;var ge=N.rotationalEquation1=new Wt(w,x,I),Ee=N.rotationalEquation2=new Wt(w,x,I),De=N.motorEquation=new ir(w,x,Y);return De.enabled=!1,N.equations.push(ge,Ee,De),N}g(pe,Ne);var R=pe.prototype;return R.enableMotor=function(){this.motorEquation.enabled=!0},R.disableMotor=function(){this.motorEquation.enabled=!1},R.setMotorSpeed=function(w){this.motorEquation.targetVelocity=w},R.setMotorMaxForce=function(w){this.motorEquation.maxForce=w,this.motorEquation.minForce=-w},R.update=function(){var w=this.bodyA,x=this.bodyB,I=this.motorEquation,N=this.rotationalEquation1,Y=this.rotationalEquation2,se=Jr,de=li,ge=this.axisA,Ee=this.axisB;Ne.prototype.update.call(this),w.quaternion.vmult(ge,se),x.quaternion.vmult(Ee,de),se.tangents(N.axisA,Y.axisA),N.axisB.copy(de),Y.axisB.copy(de),this.motorEquation.enabled&&(w.quaternion.vmult(this.axisA,I.axisA),x.quaternion.vmult(this.axisB,I.axisB))},pe}(Qt),Jr=new m,li=new m,hr=function(Ne){function pe(R,w,x){var I;return(I=Ne.call(this,R,w,-x,x)||this).ri=new m,I.rj=new m,I.t=new m,I}return g(pe,Ne),pe.prototype.computeB=function(R){var w=this.b,I=this.rj,N=Ir,Y=Br,se=this.t;this.ri.cross(se,N),I.cross(se,Y);var de=this.jacobianElementA,ge=this.jacobianElementB;return se.negate(de.spatial),N.negate(de.rotational),ge.spatial.copy(se),ge.rotational.copy(Y),-this.computeGW()*w-R*this.computeGiMf()},pe}(zn),Ir=new m,Br=new m,ta=function Ne(pe,R,w){w=ln.defaults(w,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Ne.idCounter++,this.materials=[pe,R],this.friction=w.friction,this.restitution=w.restitution,this.contactEquationStiffness=w.contactEquationStiffness,this.contactEquationRelaxation=w.contactEquationRelaxation,this.frictionEquationStiffness=w.frictionEquationStiffness,this.frictionEquationRelaxation=w.frictionEquationRelaxation};ta.idCounter=0;var ci=function Ne(pe){void 0===pe&&(pe={});var R="";"string"==typeof pe&&(R=pe,pe={}),this.name=R,this.id=Ne.idCounter++,this.friction=void 0!==pe.friction?pe.friction:-1,this.restitution=void 0!==pe.restitution?pe.restitution:-1};ci.idCounter=0;var bi=function(){function Ne(R,w,x){void 0===x&&(x={}),this.restLength="number"==typeof x.restLength?x.restLength:1,this.stiffness=x.stiffness||100,this.damping=x.damping||1,this.bodyA=R,this.bodyB=w,this.localAnchorA=new m,this.localAnchorB=new m,x.localAnchorA&&this.localAnchorA.copy(x.localAnchorA),x.localAnchorB&&this.localAnchorB.copy(x.localAnchorB),x.worldAnchorA&&this.setWorldAnchorA(x.worldAnchorA),x.worldAnchorB&&this.setWorldAnchorB(x.worldAnchorB)}var pe=Ne.prototype;return pe.setWorldAnchorA=function(R){this.bodyA.pointToLocalFrame(R,this.localAnchorA)},pe.setWorldAnchorB=function(R){this.bodyB.pointToLocalFrame(R,this.localAnchorB)},pe.getWorldAnchorA=function(R){this.bodyA.pointToWorldFrame(this.localAnchorA,R)},pe.getWorldAnchorB=function(R){this.bodyB.pointToWorldFrame(this.localAnchorB,R)},pe.applyForce=function(){var R=this.stiffness,w=this.damping,x=this.restLength,I=this.bodyA,N=this.bodyB,Y=J,se=$,de=ye,ge=xe,Ee=Ut,De=Ue,Ie=ct,He=Et,it=an,mt=on,bt=Ct;this.getWorldAnchorA(De),this.getWorldAnchorB(Ie),De.vsub(I.position,He),Ie.vsub(N.position,it),Ie.vsub(De,Y);var pt=Y.length();se.copy(Y),se.normalize(),N.velocity.vsub(I.velocity,de),N.angularVelocity.cross(it,Ee),de.vadd(Ee,de),I.angularVelocity.cross(He,Ee),de.vsub(Ee,de),se.scale(-R*(pt-x)-w*de.dot(se),ge),I.force.vsub(ge,I.force),N.force.vadd(ge,N.force),He.cross(ge,mt),it.cross(ge,bt),I.torque.vsub(mt,I.torque),N.torque.vadd(bt,N.torque)},Ne}(),J=new m,$=new m,ye=new m,xe=new m,Ue=new m,ct=new m,Et=new m,an=new m,on=new m,Ct=new m,Ut=new m,pn=function(){function Ne(pe){void 0===pe&&(pe={}),pe=ln.defaults(pe,{chassisConnectionPointLocal:new m,chassisConnectionPointWorld:new m,directionLocal:new m,directionWorld:new m,axleLocal:new m,axleWorld:new m,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,slipInfo:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=pe.maxSuspensionTravel,this.customSlidingRotationalSpeed=pe.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=pe.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=pe.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=pe.chassisConnectionPointWorld.clone(),this.directionLocal=pe.directionLocal.clone(),this.directionWorld=pe.directionWorld.clone(),this.axleLocal=pe.axleLocal.clone(),this.axleWorld=pe.axleWorld.clone(),this.suspensionRestLength=pe.suspensionRestLength,this.suspensionMaxLength=pe.suspensionMaxLength,this.radius=pe.radius,this.suspensionStiffness=pe.suspensionStiffness,this.dampingCompression=pe.dampingCompression,this.dampingRelaxation=pe.dampingRelaxation,this.frictionSlip=pe.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=pe.rollInfluence,this.maxSuspensionForce=pe.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=pe.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.slipInfo=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new Ke,this.worldTransform=new B,this.isInContact=!1}return Ne.prototype.updateWheel=function(pe){var R=this.raycastResult;if(this.isInContact){var w=R.hitNormalWorld.dot(R.directionWorld);R.hitPointWorld.vsub(pe.position,Yn),pe.getVelocityAtWorldPoint(Yn,Bn);var x=R.hitNormalWorld.dot(Bn);if(w>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var I=-1/w;this.suspensionRelativeVelocity=x*I,this.clippedInvContactDotSuspension=I}}else R.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,R.directionWorld.scale(-1,R.hitNormalWorld),this.clippedInvContactDotSuspension=1},Ne}(),Bn=new m,Yn=new m,or=function(){function Ne(R){this.chassisBody=R.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==R.indexRightAxis?R.indexRightAxis:1,this.indexForwardAxis=void 0!==R.indexForwardAxis?R.indexForwardAxis:0,this.indexUpAxis=void 0!==R.indexUpAxis?R.indexUpAxis:2,this.constraints=[],this.preStepCallback=function(){},this.currentVehicleSpeedKmHour=0}var pe=Ne.prototype;return pe.addWheel=function(R){void 0===R&&(R={});var w=new pn(R),x=this.wheelInfos.length;return this.wheelInfos.push(w),x},pe.setSteeringValue=function(R,w){this.wheelInfos[w].steering=R},pe.applyEngineForce=function(R,w){this.wheelInfos[w].engineForce=R},pe.setBrake=function(R,w){this.wheelInfos[w].brake=R},pe.addToWorld=function(R){R.addBody(this.chassisBody);var w=this;this.preStepCallback=function(){w.updateVehicle(R.dt)},R.addEventListener("preStep",this.preStepCallback),this.world=R},pe.getVehicleAxisWorld=function(R,w){w.set(0===R?1:0,1===R?1:0,2===R?1:0),this.chassisBody.vectorToWorldFrame(w,w)},pe.updateVehicle=function(R){for(var w=this.wheelInfos,x=w.length,I=this.chassisBody,N=0;N<x;N++)this.updateWheelTransform(N);this.currentVehicleSpeedKmHour=3.6*I.velocity.length();var Y=new m;this.getVehicleAxisWorld(this.indexForwardAxis,Y),Y.dot(I.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var se=0;se<x;se++)this.castRay(w[se]);this.updateSuspension(R);for(var de=new m,ge=new m,Ee=0;Ee<x;Ee++){var De=w[Ee],Ie=De.suspensionForce;Ie>De.maxSuspensionForce&&(Ie=De.maxSuspensionForce),De.raycastResult.hitNormalWorld.scale(Ie*R,de),De.raycastResult.hitPointWorld.vsub(I.position,ge),I.applyImpulse(de,ge)}this.updateFriction(R);for(var He=new m,it=new m,mt=new m,bt=0;bt<x;bt++){var pt=w[bt];I.getVelocityAtWorldPoint(pt.chassisConnectionPointWorld,mt);var zt=1;if(1===this.indexUpAxis&&(zt=-1),pt.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,it);var Lt=it.dot(pt.raycastResult.hitNormalWorld);pt.raycastResult.hitNormalWorld.scale(Lt,He),it.vsub(He,it);var dn=it.dot(mt);pt.deltaRotation=zt*dn*R/pt.radius}!pt.sliding&&pt.isInContact||0===pt.engineForce||!pt.useCustomSlidingRotationalSpeed||(pt.deltaRotation=(pt.engineForce>0?1:-1)*pt.customSlidingRotationalSpeed*R),Math.abs(pt.brake)>Math.abs(pt.engineForce)&&(pt.deltaRotation=0),pt.rotation+=pt.deltaRotation,pt.deltaRotation*=.99}},pe.updateSuspension=function(R){for(var w=this.chassisBody.mass,x=this.wheelInfos,I=x.length,N=0;N<I;N++){var Y=x[N];if(Y.isInContact){var se=void 0;se=Y.suspensionStiffness*(Y.suspensionRestLength-Y.suspensionLength)*Y.clippedInvContactDotSuspension;var ge=Y.suspensionRelativeVelocity;Y.suspensionForce=(se-=(ge<0?Y.dampingCompression:Y.dampingRelaxation)*ge)*w,Y.suspensionForce<0&&(Y.suspensionForce=0)}else Y.suspensionForce=0}},pe.removeFromWorld=function(R){R.removeBody(this.chassisBody),R.removeEventListener("preStep",this.preStepCallback),this.world=null},pe.castRay=function(R){var w=ni,x=Ci;this.updateWheelTransformWorld(R);var I=this.chassisBody,N=-1;R.directionWorld.scale(R.suspensionRestLength+R.radius,w);var se=R.chassisConnectionPointWorld;se.vadd(w,x);var de=R.raycastResult;de.reset();var ge=I.collisionResponse;I.collisionResponse=!1,this.world.rayTest(se,x,de),I.collisionResponse=ge;var Ee=de.body;if(R.raycastResult.groundObject=0,Ee){N=de.distance,R.raycastResult.hitNormalWorld=de.hitNormalWorld,R.isInContact=!0,R.suspensionLength=de.distance-R.radius;var Ie=R.suspensionRestLength-R.maxSuspensionTravel,He=R.suspensionRestLength+R.maxSuspensionTravel;R.suspensionLength<Ie&&(R.suspensionLength=Ie),R.suspensionLength>He&&(R.suspensionLength=He,R.raycastResult.reset());var it=R.raycastResult.hitNormalWorld.dot(R.directionWorld),mt=new m;I.getVelocityAtWorldPoint(R.raycastResult.hitPointWorld,mt);var bt=R.raycastResult.hitNormalWorld.dot(mt);if(it>=-.1)R.suspensionRelativeVelocity=0,R.clippedInvContactDotSuspension=10;else{var pt=-1/it;R.suspensionRelativeVelocity=bt*pt,R.clippedInvContactDotSuspension=pt}}else R.suspensionLength=R.suspensionRestLength+0*R.maxSuspensionTravel,R.suspensionRelativeVelocity=0,R.directionWorld.scale(-1,R.raycastResult.hitNormalWorld),R.clippedInvContactDotSuspension=1;return N},pe.updateWheelTransformWorld=function(R){R.isInContact=!1;var w=this.chassisBody;w.pointToWorldFrame(R.chassisConnectionPointLocal,R.chassisConnectionPointWorld),w.vectorToWorldFrame(R.directionLocal,R.directionWorld),w.vectorToWorldFrame(R.axleLocal,R.axleWorld)},pe.updateWheelTransform=function(R){var w=Mr,x=Ar,I=vr,N=this.wheelInfos[R];this.updateWheelTransformWorld(N),N.directionLocal.scale(-1,w),x.copy(N.axleLocal),w.cross(x,I),I.normalize(),x.normalize();var Y=N.steering,se=new y;se.setFromAxisAngle(w,Y);var de=new y;de.setFromAxisAngle(x,N.rotation);var ge=N.worldTransform.quaternion;this.chassisBody.quaternion.mult(se,ge),ge.mult(de,ge),ge.normalize();var Ee=N.worldTransform.position;Ee.copy(N.directionWorld),Ee.scale(N.suspensionLength,Ee),Ee.vadd(N.chassisConnectionPointWorld,Ee)},pe.getWheelTransformWorld=function(R){return this.wheelInfos[R].worldTransform},pe.updateFriction=function(R){for(var w=_i,x=this.wheelInfos,I=x.length,N=this.chassisBody,Y=aa,se=ji,de=0;de<I;de++){var ge=x[de];ge.sideImpulse=0,ge.forwardImpulse=0,Y[de]||(Y[de]=new m),se[de]||(se[de]=new m)}for(var Ee=0;Ee<I;Ee++){var De=x[Ee],Ie=De.raycastResult.body;if(Ie){var He=se[Ee];this.getWheelTransformWorld(Ee).vectorToWorldFrame(ki[this.indexRightAxis],He);var it=De.raycastResult.hitNormalWorld,mt=He.dot(it);it.scale(mt,w),He.vsub(w,He),He.normalize(),it.cross(He,Y[Ee]),Y[Ee].normalize(),De.sideImpulse=Ho(N,De.raycastResult.hitPointWorld,Ie,De.raycastResult.hitPointWorld,He),De.sideImpulse*=oa}}this.sliding=!1;for(var bt=0;bt<I;bt++){var pt=x[bt],zt=pt.raycastResult.body,Lt=0;if(pt.slipInfo=1,zt){var dn=pt.brake?pt.brake:0;Lt=Ba(N,zt,pt.raycastResult.hitPointWorld,Y[bt],dn);var fn=dn/(Lt+=pt.engineForce*R);pt.slipInfo*=fn}if(pt.forwardImpulse=0,pt.skidInfo=1,zt){pt.skidInfo=1;var An=pt.suspensionForce*R*pt.frictionSlip,Tn=An*An;pt.forwardImpulse=Lt;var Vn=.5*pt.forwardImpulse,Jn=1*pt.sideImpulse,Nn=Vn*Vn+Jn*Jn;if(pt.sliding=!1,Nn>Tn){this.sliding=!0,pt.sliding=!0;var Mn=An/Math.sqrt(Nn);pt.skidInfo*=Mn}}}if(this.sliding)for(var Tr=0;Tr<I;Tr++){var kn=x[Tr];0!==kn.sideImpulse&&kn.skidInfo<1&&(kn.forwardImpulse*=kn.skidInfo,kn.sideImpulse*=kn.skidInfo)}for(var $r=0;$r<I;$r++){var Ur=x[$r],gr=new m;if(Ur.raycastResult.hitPointWorld.vsub(N.position,gr),0!==Ur.forwardImpulse){var Fr=new m;Y[$r].scale(Ur.forwardImpulse,Fr),N.applyImpulse(Fr,gr)}if(0!==Ur.sideImpulse){var $n=Ur.raycastResult.body,Or=new m;Ur.raycastResult.hitPointWorld.vsub($n.position,Or);var _r=new m;se[$r].scale(Ur.sideImpulse,_r),N.vectorToLocalFrame(gr,gr),gr["xyz"[this.indexUpAxis]]*=Ur.rollInfluence,N.vectorToWorldFrame(gr,gr),N.applyImpulse(_r,gr),_r.scale(-1,_r),$n.applyImpulse(_r,Or)}}},Ne}(),Mr=(new m,new m,new m,new m),Ar=new m,vr=new m,ni=(new nt,new m,new m),Ci=new m,ki=[new m(1,0,0),new m(0,1,0),new m(0,0,1)],_i=new m,ji=[],aa=[],oa=1,sa=new m,la=new m,Oa=new m;function Ba(Ne,pe,R,w,x){var I=0,N=R,Y=sa,se=la,de=Oa;return Ne.getVelocityAtWorldPoint(N,Y),pe.getVelocityAtWorldPoint(N,se),Y.vsub(se,de),x<(I=-w.dot(de)*(1/(Pa(Ne,R,w)+Pa(pe,R,w))))&&(I=x),I<-x&&(I=-x),I}var Fa=new m,Ka=new m,Ma=new m,Ta=new m;function Pa(Ne,pe,R){var w=Fa,x=Ka,I=Ma,N=Ta;return pe.vsub(Ne.position,w),w.cross(R,x),Ne.invInertiaWorld.vmult(x,N),N.cross(w,I),Ne.invMass+R.dot(I)}var Qa=new m,ro=new m,Eo=new m;function Ho(Ne,pe,R,w,x){if(x.lengthSquared()>1.1)return 0;var I=Qa,N=ro,Y=Eo;return Ne.getVelocityAtWorldPoint(pe,I),R.getVelocityAtWorldPoint(w,N),I.vsub(N,Y),-.2*x.dot(Y)*(1/(Ne.invMass+R.invMass))}var xo=function(Ne){function pe(w){var x;if((x=Ne.call(this,{type:D.types.SPHERE})||this).radius=void 0!==w?w:1,x.radius<0)throw new Error("The sphere radius cannot be negative.");return x.updateBoundingSphereRadius(),x}g(pe,Ne);var R=pe.prototype;return R.calculateLocalInertia=function(w,x){void 0===x&&(x=new m);var I=2*w*this.radius*this.radius/5;return x.x=I,x.y=I,x.z=I,x},R.volume=function(){return 4*Math.PI*Math.pow(this.radius,3)/3},R.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},R.calculateWorldAABB=function(w,x,I,N){for(var Y=this.radius,se=["x","y","z"],de=0;de<se.length;de++){var ge=se[de];I[ge]=w[ge]-Y,N[ge]=w[ge]+Y}},pe}(D),qr=function(){function Ne(R){void 0===R&&(R={}),this.wheelBodies=[],this.coordinateSystem=void 0!==R.coordinateSystem?R.coordinateSystem.clone():new m(1,2,3),this.chassisBody=R.chassisBody?R.chassisBody:new P({mass:1,shape:new ae(new m(5,2,.5))}),this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var pe=Ne.prototype;return pe.addWheel=function(R){var w;void 0===R&&(R={}),w=R.body?R.body:new P({mass:1,shape:new xo(1.2)}),this.wheelBodies.push(w),this.wheelForces.push(0),new m;var x=void 0!==R.position?R.position.clone():new m,I=new m;this.chassisBody.pointToWorldFrame(x,I),w.position.set(I.x,I.y,I.z);var N=void 0!==R.axis?R.axis.clone():new m(0,1,0);this.wheelAxes.push(N);var Y=new cr(this.chassisBody,w,{pivotA:x,axisA:N,pivotB:m.ZERO,axisB:N,collideConnected:!1});return this.constraints.push(Y),this.wheelBodies.length-1},pe.setSteeringValue=function(R,w){var x=this.wheelAxes[w],I=Math.cos(R),N=Math.sin(R),Y=x.x,se=x.y;this.constraints[w].axisA.set(I*Y-N*se,N*Y+I*se,0)},pe.setMotorSpeed=function(R,w){var x=this.constraints[w];x.enableMotor(),x.motorTargetVelocity=R},pe.disableMotor=function(R){this.constraints[R].disableMotor()},pe.setWheelForce=function(R,w){this.wheelForces[w]=R},pe.applyWheelForce=function(R,w){var I=this.wheelBodies[w],N=I.torque;this.wheelAxes[w].scale(R,Mo),I.vectorToWorldFrame(Mo,Mo),N.vadd(Mo,N)},pe.addToWorld=function(R){for(var w=this.constraints,x=this.wheelBodies.concat([this.chassisBody]),I=0;I<x.length;I++)R.addBody(x[I]);for(var N=0;N<w.length;N++)R.addConstraint(w[N]);R.addEventListener("preStep",this._update.bind(this))},pe._update=function(){for(var R=this.wheelForces,w=0;w<R.length;w++)this.applyWheelForce(R[w],w)},pe.removeFromWorld=function(R){for(var w=this.constraints,x=this.wheelBodies.concat([this.chassisBody]),I=0;I<x.length;I++)R.removeBody(x[I]);for(var N=0;N<w.length;N++)R.removeConstraint(w[N])},pe.getWheelSpeed=function(R){var x=this.wheelBodies[R].angularVelocity;return this.chassisBody.vectorToWorldFrame(this.wheelAxes[R],Ps),x.dot(Ps)},Ne}(),Mo=new m,Ps=new m,nl=function(){function Ne(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}var pe=Ne.prototype;return pe.add=function(R){this.particles.push(R),this.neighbors.length<this.particles.length&&this.neighbors.push([])},pe.remove=function(R){var w=this.particles.indexOf(R);-1!==w&&(this.particles.splice(w,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())},pe.getNeighbors=function(R,w){for(var x=this.particles.length,I=R.id,N=this.smoothingRadius*this.smoothingRadius,Y=kc,se=0;se!==x;se++){var de=this.particles[se];de.position.vsub(R.position,Y),I!==de.id&&Y.lengthSquared()<N&&w.push(de)}},pe.update=function(){for(var R=this.particles.length,w=Gl,x=this.speedOfSound,I=this.eps,N=0;N!==R;N++){var Y=this.particles[N],se=this.neighbors[N];se.length=0,this.getNeighbors(Y,se),se.push(this.particles[N]);for(var de=se.length,ge=0,Ee=0;Ee!==de;Ee++){Y.position.vsub(se[Ee].position,w);var De=w.length(),Ie=this.w(De);ge+=se[Ee].mass*Ie}this.densities[N]=ge,this.pressures[N]=x*x*(this.densities[N]-this.density)}for(var He=zl,it=Vl,mt=Hc,bt=Uc,pt=Uo,zt=0;zt!==R;zt++){var Lt=this.particles[zt];He.set(0,0,0),it.set(0,0,0);for(var dn=void 0,fn=void 0,An=this.neighbors[zt],Tn=An.length,Vn=0;Vn!==Tn;Vn++){var Jn=An[Vn];Lt.position.vsub(Jn.position,bt);var Nn=bt.length();dn=-Jn.mass*(this.pressures[zt]/(this.densities[zt]*this.densities[zt]+I)+this.pressures[Vn]/(this.densities[Vn]*this.densities[Vn]+I)),this.gradw(bt,mt),mt.scale(dn,mt),He.vadd(mt,He),Jn.velocity.vsub(Lt.velocity,pt),pt.scale(1/(1e-4+this.densities[zt]*this.densities[Vn])*this.viscosity*Jn.mass,pt),fn=this.nablaw(Nn),pt.scale(fn,pt),it.vadd(pt,it)}it.scale(Lt.mass,it),He.scale(Lt.mass,He),Lt.force.vadd(it,Lt.force),Lt.force.vadd(He,Lt.force)}},pe.w=function(R){var w=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(w,9))*Math.pow(w*w-R*R,3)},pe.gradw=function(R,w){var x=R.length(),I=this.smoothingRadius;R.scale(945/(32*Math.PI*Math.pow(I,9))*Math.pow(I*I-x*x,2),w)},pe.nablaw=function(R){var w=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(w,9))*(w*w-R*R)*(7*R*R-3*w*w)},Ne}(),kc=new m,Gl=new m,zl=new m,Vl=new m,Hc=new m,Uc=new m,Uo=new m,Gc=function(Ne){function pe(R,w,x,I){var N=I,Y=[],se=[],de=[],ge=[],Ee=[],De=Math.cos,Ie=Math.sin;Y.push(new m(w*De(0),w*Ie(0),.5*-x)),ge.push(0),Y.push(new m(R*De(0),R*Ie(0),.5*x)),Ee.push(1);for(var He=0;He<N;He++){var it=2*Math.PI/N*(He+1),mt=2*Math.PI/N*(He+.5);He<N-1?(Y.push(new m(w*De(it),w*Ie(it),.5*-x)),ge.push(2*He+2),Y.push(new m(R*De(it),R*Ie(it),.5*x)),Ee.push(2*He+3),de.push([2*He+2,2*He+3,2*He+1,2*He])):de.push([0,1,2*He+1,2*He]),(N%2==1||He<N/2)&&se.push(new m(De(mt),Ie(mt),0))}de.push(Ee),se.push(new m(0,0,1));for(var bt=[],pt=0;pt<ge.length;pt++)bt.push(ge[ge.length-pt-1]);return de.push(bt),Ne.call(this,{vertices:Y,faces:de,axes:se})||this}return g(pe,Ne),pe}(q),lh=function(Ne){function pe(){return Ne.call(this,{type:D.types.PARTICLE})||this}g(pe,Ne);var R=pe.prototype;return R.calculateLocalInertia=function(w,x){return void 0===x&&(x=new m),x.set(0,0,0),x},R.volume=function(){return 0},R.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},R.calculateWorldAABB=function(w,x,I,N){I.copy(w),N.copy(w)},pe}(D),rl=function(Ne){function pe(){var w;return(w=Ne.call(this,{type:D.types.PLANE})||this).worldNormal=new m,w.worldNormalNeedsUpdate=!0,w.boundingSphereRadius=Number.MAX_VALUE,w}g(pe,Ne);var R=pe.prototype;return R.computeWorldNormal=function(w){var x=this.worldNormal;x.set(0,0,1),w.vmult(x,x),this.worldNormalNeedsUpdate=!1},R.calculateLocalInertia=function(w,x){return void 0===x&&(x=new m),x},R.volume=function(){return Number.MAX_VALUE},R.calculateWorldAABB=function(w,x,I,N){io.set(0,0,1),x.vmult(io,io);var Y=Number.MAX_VALUE;I.set(-Y,-Y,-Y),N.set(Y,Y,Y),1===io.x?N.x=w.x:-1===io.x&&(I.x=w.x),1===io.y?N.y=w.y:-1===io.y&&(I.y=w.y),1===io.z?N.z=w.z:-1===io.z&&(I.z=w.z)},R.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE},pe}(D),io=new m,ch=function(Ne){function pe(w,x){var I;return void 0===x&&(x={}),x=ln.defaults(x,{maxValue:null,minValue:null,elementSize:1}),(I=Ne.call(this,{type:D.types.HEIGHTFIELD})||this).data=w,I.maxValue=x.maxValue,I.minValue=x.minValue,I.elementSize=x.elementSize,null===x.minValue&&I.updateMinValue(),null===x.maxValue&&I.updateMaxValue(),I.cacheEnabled=!0,I.pillarConvex=new q,I.pillarOffset=new m,I.updateBoundingSphereRadius(),I._cachedPillars={},I}g(pe,Ne);var R=pe.prototype;return R.update=function(){this._cachedPillars={}},R.updateMinValue=function(){for(var w=this.data,x=w[0][0],I=0;I!==w.length;I++)for(var N=0;N!==w[I].length;N++){var Y=w[I][N];Y<x&&(x=Y)}this.minValue=x},R.updateMaxValue=function(){for(var w=this.data,x=w[0][0],I=0;I!==w.length;I++)for(var N=0;N!==w[I].length;N++){var Y=w[I][N];Y>x&&(x=Y)}this.maxValue=x},R.setHeightValueAtIndex=function(w,x,I){this.data[w][x]=I,this.clearCachedConvexTrianglePillar(w,x,!1),w>0&&(this.clearCachedConvexTrianglePillar(w-1,x,!0),this.clearCachedConvexTrianglePillar(w-1,x,!1)),x>0&&(this.clearCachedConvexTrianglePillar(w,x-1,!0),this.clearCachedConvexTrianglePillar(w,x-1,!1)),x>0&&w>0&&this.clearCachedConvexTrianglePillar(w-1,x-1,!0)},R.getRectMinMax=function(w,x,I,N,Y){void 0===Y&&(Y=[]);for(var se=this.data,de=this.minValue,ge=w;ge<=I;ge++)for(var Ee=x;Ee<=N;Ee++){var De=se[ge][Ee];De>de&&(de=De)}Y[0]=this.minValue,Y[1]=de},R.getIndexOfPosition=function(w,x,I,N){var Y=this.elementSize,se=this.data,de=Math.floor(w/Y),ge=Math.floor(x/Y);return I[0]=de,I[1]=ge,N&&(de<0&&(de=0),ge<0&&(ge=0),de>=se.length-1&&(de=se.length-1),ge>=se[0].length-1&&(ge=se[0].length-1)),!(de<0||ge<0||de>=se.length-1||ge>=se[0].length-1)},R.getTriangleAt=function(w,x,I,N,Y,se){var de=zc;this.getIndexOfPosition(w,x,de,I);var ge=de[0],Ee=de[1],De=this.data;I&&(ge=Math.min(De.length-2,Math.max(0,ge)),Ee=Math.min(De[0].length-2,Math.max(0,Ee)));var Ie=this.elementSize,He=Math.pow(w/Ie-ge,2)+Math.pow(x/Ie-Ee,2)>Math.pow(w/Ie-(ge+1),2)+Math.pow(x/Ie-(Ee+1),2);return this.getTriangle(ge,Ee,He,N,Y,se),He},R.getNormalAt=function(w,x,I,N){var Y=fh,se=ph,de=vh,ge=mh,Ee=gh;this.getTriangleAt(w,x,I,Y,se,de),se.vsub(Y,ge),de.vsub(Y,Ee),ge.cross(Ee,N),N.normalize()},R.getAabbAtIndex=function(w,x,I){var Y=I.upperBound,se=this.data,de=this.elementSize;I.lowerBound.set(w*de,x*de,se[w][x]),Y.set((w+1)*de,(x+1)*de,se[w+1][x+1])},R.getHeightAt=function(w,x,I){var N=this.data,Y=uh,se=hh,de=dh,ge=zc;this.getIndexOfPosition(w,x,ge,I);var Ee=ge[0],De=ge[1];I&&(Ee=Math.min(N.length-2,Math.max(0,Ee)),De=Math.min(N[0].length-2,Math.max(0,De)));var it,mt,bt,pt,zt,Lt,dn,fn,An,Ie=this.getTriangleAt(w,x,I,Y,se,de);return(An=Vc).x=(((Lt=se.y)-(fn=de.y))*((it=w)-(dn=de.x))+(dn-(zt=se.x))*((mt=x)-fn))/((Lt-fn)*((bt=Y.x)-dn)+(dn-zt)*((pt=Y.y)-fn)),An.y=((fn-pt)*(it-dn)+(bt-dn)*(mt-fn))/((Lt-fn)*(bt-dn)+(dn-zt)*(pt-fn)),An.z=1-An.x-An.y,Ie?N[Ee+1][De+1]*Vc.x+N[Ee][De+1]*Vc.y+N[Ee+1][De]*Vc.z:N[Ee][De]*Vc.x+N[Ee+1][De]*Vc.y+N[Ee][De+1]*Vc.z},R.getCacheConvexTrianglePillarKey=function(w,x,I){return w+"_"+x+"_"+(I?1:0)},R.getCachedConvexTrianglePillar=function(w,x,I){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(w,x,I)]},R.setCachedConvexTrianglePillar=function(w,x,I,N,Y){this._cachedPillars[this.getCacheConvexTrianglePillarKey(w,x,I)]={convex:N,offset:Y}},R.clearCachedConvexTrianglePillar=function(w,x,I){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(w,x,I)]},R.getTriangle=function(w,x,I,N,Y,se){var de=this.data,ge=this.elementSize;I?(N.set((w+1)*ge,(x+1)*ge,de[w+1][x+1]),Y.set(w*ge,(x+1)*ge,de[w][x+1]),se.set((w+1)*ge,x*ge,de[w+1][x])):(N.set(w*ge,x*ge,de[w][x]),Y.set((w+1)*ge,x*ge,de[w+1][x]),se.set(w*ge,(x+1)*ge,de[w][x+1]))},R.getConvexTrianglePillar=function(w,x,I){var N=this.pillarConvex,Y=this.pillarOffset;if(this.cacheEnabled){var se=this.getCachedConvexTrianglePillar(w,x,I);if(se)return this.pillarConvex=se.convex,void(this.pillarOffset=se.offset);N=new q,Y=new m,this.pillarConvex=N,this.pillarOffset=Y}var de=this.data,ge=this.elementSize,Ee=N.faces;N.vertices.length=6;for(var De=0;De<6;De++)N.vertices[De]||(N.vertices[De]=new m);Ee.length=5;for(var Ie=0;Ie<5;Ie++)Ee[Ie]||(Ee[Ie]=[]);var He=N.vertices,it=(Math.min(de[w][x],de[w+1][x],de[w][x+1],de[w+1][x+1])-this.minValue)/2+this.minValue;I?(Y.set((w+.75)*ge,(x+.75)*ge,it),He[0].set(.25*ge,.25*ge,de[w+1][x+1]-it),He[1].set(-.75*ge,.25*ge,de[w][x+1]-it),He[2].set(.25*ge,-.75*ge,de[w+1][x]-it),He[3].set(.25*ge,.25*ge,-it-1),He[4].set(-.75*ge,.25*ge,-it-1),He[5].set(.25*ge,-.75*ge,-it-1),Ee[0][0]=0,Ee[0][1]=1,Ee[0][2]=2,Ee[1][0]=5,Ee[1][1]=4,Ee[1][2]=3,Ee[2][0]=2,Ee[2][1]=5,Ee[2][2]=3,Ee[2][3]=0,Ee[3][0]=3,Ee[3][1]=4,Ee[3][2]=1,Ee[3][3]=0,Ee[4][0]=1,Ee[4][1]=4,Ee[4][2]=5,Ee[4][3]=2):(Y.set((w+.25)*ge,(x+.25)*ge,it),He[0].set(-.25*ge,-.25*ge,de[w][x]-it),He[1].set(.75*ge,-.25*ge,de[w+1][x]-it),He[2].set(-.25*ge,.75*ge,de[w][x+1]-it),He[3].set(-.25*ge,-.25*ge,-it-1),He[4].set(.75*ge,-.25*ge,-it-1),He[5].set(-.25*ge,.75*ge,-it-1),Ee[0][0]=0,Ee[0][1]=1,Ee[0][2]=2,Ee[1][0]=5,Ee[1][1]=4,Ee[1][2]=3,Ee[2][0]=0,Ee[2][1]=2,Ee[2][2]=5,Ee[2][3]=3,Ee[3][0]=1,Ee[3][1]=0,Ee[3][2]=3,Ee[3][3]=4,Ee[4][0]=4,Ee[4][1]=5,Ee[4][2]=2,Ee[4][3]=1),N.computeNormals(),N.computeEdges(),N.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(w,x,I,N,Y)},R.calculateLocalInertia=function(w,x){return void 0===x&&(x=new m),x.set(0,0,0),x},R.volume=function(){return Number.MAX_VALUE},R.calculateWorldAABB=function(w,x,I,N){I.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),N.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},R.updateBoundingSphereRadius=function(){var w=this.data,x=this.elementSize;this.boundingSphereRadius=new m(w.length*x,w[0].length*x,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()},R.setHeightsFromImage=function(w,x){var I=x.x,N=x.z,Y=x.y,se=document.createElement("canvas");se.width=w.width,se.height=w.height;var de=se.getContext("2d");de.drawImage(w,0,0);var ge=de.getImageData(0,0,w.width,w.height),Ee=this.data;Ee.length=0,this.elementSize=Math.abs(I)/ge.width;for(var De=0;De<ge.height;De++){for(var Ie=[],He=0;He<ge.width;He++){var it=(ge.data[4*(De*ge.height+He)]+ge.data[4*(De*ge.height+He)+1]+ge.data[4*(De*ge.height+He)+2])/4/255*N;I<0?Ie.push(it):Ie.unshift(it)}Y<0?Ee.unshift(Ie):Ee.push(Ie)}this.updateMaxValue(),this.updateMinValue(),this.update()},pe}(D),zc=[],Vc=new m,uh=new m,hh=new m,dh=new m,fh=new m,ph=new m,vh=new m,mh=new m,gh=new m,yh=function(Ne){function pe(R,w){var x;return void 0===w&&(w={}),(x=Ne.call(this,{root:null,aabb:R})||this).maxDepth=void 0!==w.maxDepth?w.maxDepth:8,x}return g(pe,Ne),pe}(function(){function Ne(R){void 0===R&&(R={}),this.root=R.root||null,this.aabb=R.aabb?R.aabb.clone():new p,this.data=[],this.children=[]}var pe=Ne.prototype;return pe.reset=function(){this.children.length=this.data.length=0},pe.insert=function(R,w,x){void 0===x&&(x=0);var I=this.data;if(!this.aabb.contains(R))return!1;var N=this.children;if(x<(this.maxDepth||this.root.maxDepth)){var Y=!1;N.length||(this.subdivide(),Y=!0);for(var se=0;8!==se;se++)if(N[se].insert(R,w,x+1))return!0;Y&&(N.length=0)}return I.push(w),!0},pe.subdivide=function(){var R=this.aabb,w=R.lowerBound,x=R.upperBound,I=this.children;I.push(new Ne({aabb:new p({lowerBound:new m(0,0,0)})}),new Ne({aabb:new p({lowerBound:new m(1,0,0)})}),new Ne({aabb:new p({lowerBound:new m(1,1,0)})}),new Ne({aabb:new p({lowerBound:new m(1,1,1)})}),new Ne({aabb:new p({lowerBound:new m(0,1,1)})}),new Ne({aabb:new p({lowerBound:new m(0,0,1)})}),new Ne({aabb:new p({lowerBound:new m(1,0,1)})}),new Ne({aabb:new p({lowerBound:new m(0,1,0)})})),x.vsub(w,To),To.scale(.5,To);for(var N=this.root||this,Y=0;8!==Y;Y++){var se=I[Y];se.root=N;var de=se.aabb.lowerBound;de.x*=To.x,de.y*=To.y,de.z*=To.z,de.vadd(w,de),de.vadd(To,se.aabb.upperBound)}},pe.aabbQuery=function(R,w){for(var x=[this];x.length;){var I=x.pop();I.aabb.overlaps(R)&&Array.prototype.push.apply(w,I.data),Array.prototype.push.apply(x,I.children)}return w},pe.rayQuery=function(R,w,x){return R.getAABB(So),So.toLocalFrame(w,So),this.aabbQuery(So,x),x},pe.removeEmptyNodes=function(){for(var R=this.children.length-1;R>=0;R--)this.children[R].removeEmptyNodes(),this.children[R].children.length||this.children[R].data.length||this.children.splice(R,1)},Ne}()),To=new m,So=new p,Za=function(Ne){function pe(w,x){var I;return(I=Ne.call(this,{type:D.types.TRIMESH})||this).vertices=new Float32Array(w),I.indices=new Int16Array(x),I.normals=new Float32Array(x.length),I.aabb=new p,I.edges=null,I.scale=new m(1,1,1),I.tree=new yh,I.updateEdges(),I.updateNormals(),I.updateAABB(),I.updateBoundingSphereRadius(),I.updateTree(),I}g(pe,Ne);var R=pe.prototype;return R.updateTree=function(){var w=this.tree;w.reset(),w.aabb.copy(this.aabb);var x=this.scale;w.aabb.lowerBound.x*=1/x.x,w.aabb.lowerBound.y*=1/x.y,w.aabb.lowerBound.z*=1/x.z,w.aabb.upperBound.x*=1/x.x,w.aabb.upperBound.y*=1/x.y,w.aabb.upperBound.z*=1/x.z;for(var I=new p,N=new m,Y=new m,se=new m,de=[N,Y,se],ge=0;ge<this.indices.length/3;ge++){var Ee=3*ge;this._getUnscaledVertex(this.indices[Ee],N),this._getUnscaledVertex(this.indices[Ee+1],Y),this._getUnscaledVertex(this.indices[Ee+2],se),I.setFromPoints(de),w.insert(I,ge)}w.removeEmptyNodes()},R.getTrianglesInAABB=function(w,x){il.copy(w);var I=this.scale,N=I.x,Y=I.y,se=I.z,de=il.lowerBound,ge=il.upperBound;return de.x/=N,de.y/=Y,de.z/=se,ge.x/=N,ge.y/=Y,ge.z/=se,this.tree.aabbQuery(il,x)},R.setScale=function(w){this.scale.x===this.scale.y&&this.scale.y===this.scale.z&&w.x===w.y&&w.y===w.z||this.updateNormals(),this.scale.copy(w),this.updateAABB(),this.updateBoundingSphereRadius()},R.updateNormals=function(){for(var w=Ah,x=this.normals,I=0;I<this.indices.length/3;I++){var N=3*I,se=this.indices[N+1],de=this.indices[N+2];this.getVertex(this.indices[N],Xc),this.getVertex(se,qc),this.getVertex(de,al),pe.computeNormal(qc,Xc,al,w),x[N]=w.x,x[N+1]=w.y,x[N+2]=w.z}},R.updateEdges=function(){for(var w={},x=function(Ie,He){w[Ie<He?Ie+"_"+He:He+"_"+Ie]=!0},I=0;I<this.indices.length/3;I++){var N=3*I,Y=this.indices[N],se=this.indices[N+1],de=this.indices[N+2];x(Y,se),x(se,de),x(de,Y)}var ge=Object.keys(w);this.edges=new Int16Array(2*ge.length);for(var Ee=0;Ee<ge.length;Ee++){var De=ge[Ee].split("_");this.edges[2*Ee]=parseInt(De[0],10),this.edges[2*Ee+1]=parseInt(De[1],10)}},R.getEdgeVertex=function(w,x,I){this.getVertex(this.edges[2*w+(x?1:0)],I)},R.getEdgeVector=function(w,x){var I=bh,N=wh;this.getEdgeVertex(w,0,I),this.getEdgeVertex(w,1,N),N.vsub(I,x)},R.getVertex=function(w,x){var I=this.scale;return this._getUnscaledVertex(w,x),x.x*=I.x,x.y*=I.y,x.z*=I.z,x},R._getUnscaledVertex=function(w,x){var I=3*w,N=this.vertices;return x.set(N[I],N[I+1],N[I+2])},R.getWorldVertex=function(w,x,I,N){return this.getVertex(w,N),B.pointToWorldFrame(x,I,N,N),N},R.getTriangleVertices=function(w,x,I,N){var Y=3*w;this.getVertex(this.indices[Y],x),this.getVertex(this.indices[Y+1],I),this.getVertex(this.indices[Y+2],N)},R.getNormal=function(w,x){var I=3*w;return x.set(this.normals[I],this.normals[I+1],this.normals[I+2])},R.calculateLocalInertia=function(w,x){this.computeLocalAABB(na);var I=na.upperBound.x-na.lowerBound.x,N=na.upperBound.y-na.lowerBound.y,Y=na.upperBound.z-na.lowerBound.z;return x.set(1/12*w*(2*N*2*N+2*Y*2*Y),1/12*w*(2*I*2*I+2*Y*2*Y),1/12*w*(2*N*2*N+2*I*2*I))},R.computeLocalAABB=function(w){var x=w.lowerBound,I=w.upperBound,N=this.vertices.length,Y=ra;this.getVertex(0,Y),x.copy(Y),I.copy(Y);for(var se=0;se!==N;se++)this.getVertex(se,Y),Y.x<x.x?x.x=Y.x:Y.x>I.x&&(I.x=Y.x),Y.y<x.y?x.y=Y.y:Y.y>I.y&&(I.y=Y.y),Y.z<x.z?x.z=Y.z:Y.z>I.z&&(I.z=Y.z)},R.updateAABB=function(){this.computeLocalAABB(this.aabb)},R.updateBoundingSphereRadius=function(){for(var w=0,x=this.vertices,I=new m,N=0,Y=x.length/3;N!==Y;N++){this.getVertex(N,I);var se=I.lengthSquared();se>w&&(w=se)}this.boundingSphereRadius=Math.sqrt(w)},R.calculateWorldAABB=function(w,x,I,N){var Y=Ds,se=ol;Y.position=w,Y.quaternion=x,this.aabb.toWorldFrame(Y,se),I.copy(se.lowerBound),N.copy(se.upperBound)},R.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},pe}(D),Ah=new m,il=new p,bh=new m,wh=new m,Wc=new m,jc=new m;Za.computeNormal=function(Ne,pe,R,w){pe.vsub(Ne,jc),R.vsub(pe,Wc),Wc.cross(jc,w),w.isZero()||w.normalize()};var Xc=new m,qc=new m,al=new m,na=new p,ra=new m,Ds=new B,ol=new p;Za.createTorus=function(Ne,pe,R,w,x){void 0===Ne&&(Ne=1),void 0===pe&&(pe=.5),void 0===R&&(R=8),void 0===w&&(w=6),void 0===x&&(x=2*Math.PI);for(var I=[],N=[],Y=0;Y<=R;Y++)for(var se=0;se<=w;se++){var de=se/w*x,ge=Y/R*Math.PI*2,Ee=(Ne+pe*Math.cos(ge))*Math.cos(de),De=(Ne+pe*Math.cos(ge))*Math.sin(de),Ie=pe*Math.sin(ge);I.push(Ee,De,Ie)}for(var He=1;He<=R;He++)for(var it=1;it<=w;it++){var bt=(w+1)*(He-1)+it-1,pt=(w+1)*(He-1)+it,zt=(w+1)*He+it;N.push((w+1)*He+it-1,bt,zt),N.push(bt,pt,zt)}return new Za(I,N)};var pr=function(){function Ne(){this.equations=[]}var pe=Ne.prototype;return pe.solve=function(R,w){return 0},pe.addEquation=function(R){R.enabled&&this.equations.push(R)},pe.removeEquation=function(R){var w=this.equations,x=w.indexOf(R);-1!==x&&w.splice(x,1)},pe.removeAllEquations=function(){this.equations.length=0},Ne}(),Wl=function(Ne){function pe(){var R;return(R=Ne.call(this)||this).iterations=10,R.tolerance=1e-7,R}return g(pe,Ne),pe.prototype.solve=function(R,w){var N,Y,se,de=0,ge=this.iterations,Ee=this.tolerance*this.tolerance,De=this.equations,Ie=De.length,He=w.bodies,it=He.length,mt=R;if(0!==Ie)for(var bt=0;bt!==it;bt++)He[bt].updateSolveMassProperties();var pt=Qn,zt=rs,Lt=sl;pt.length=Ie,zt.length=Ie,Lt.length=Ie;for(var dn=0;dn!==Ie;dn++){var fn=De[dn];Lt[dn]=0,zt[dn]=fn.computeB(mt),pt[dn]=1/fn.computeC()}if(0!==Ie){for(var An=0;An!==it;An++){var Tn=He[An],Jn=Tn.wlambda;Tn.vlambda.set(0,0,0),Jn.set(0,0,0)}for(de=0;de!==ge;de++){Y=0;for(var Nn=0;Nn!==Ie;Nn++){var Mn=De[Nn];(se=Lt[Nn])+(N=pt[Nn]*(zt[Nn]-Mn.computeGWlambda()-Mn.eps*se))<Mn.minForce?N=Mn.minForce-se:se+N>Mn.maxForce&&(N=Mn.maxForce-se),Lt[Nn]+=N,Y+=N>0?N:-N,Mn.addToWlambda(N)}if(Y*Y<Ee)break}for(var Tr=0;Tr!==it;Tr++){var kn=He[Tr],$r=kn.velocity,Ur=kn.angularVelocity;kn.vlambda.vmul(kn.linearFactor,kn.vlambda),$r.vadd(kn.vlambda,$r),kn.wlambda.vmul(kn.angularFactor,kn.wlambda),Ur.vadd(kn.wlambda,Ur)}for(var gr=De.length,Fr=1/mt;gr--;)De[gr].multiplier=Lt[gr]*Fr}return de},pe}(pr),sl=[],Qn=[],rs=[],cn=function(Ne){function pe(w){var x;for((x=Ne.call(this)||this).iterations=10,x.tolerance=1e-7,x.subsolver=w,x.nodes=[],x.nodePool=[];x.nodePool.length<128;)x.nodePool.push(x.createNode());return x}g(pe,Ne);var R=pe.prototype;return R.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},R.solve=function(w,x){for(var I,N=da,Y=this.nodePool,se=x.bodies,de=this.equations,ge=de.length,Ee=se.length,De=this.subsolver;Y.length<Ee;)Y.push(this.createNode());N.length=Ee;for(var Ie=0;Ie<Ee;Ie++)N[Ie]=Y[Ie];for(var He=0;He!==Ee;He++){var it=N[He];it.body=se[He],it.children.length=0,it.eqs.length=0,it.visited=!1}for(var mt=0;mt!==ge;mt++){var bt=de[mt],pt=se.indexOf(bt.bi),zt=se.indexOf(bt.bj),Lt=N[pt],dn=N[zt];Lt.children.push(dn),Lt.eqs.push(bt),dn.children.push(Lt),dn.eqs.push(bt)}var fn=0,An=is;De.tolerance=this.tolerance,De.iterations=this.iterations;for(var Tn=Go;I=vi(N);){An.length=0,Tn.bodies.length=0,ui(I,Sa,Tn.bodies,An);var Vn=An.length;An=An.sort(jl);for(var Jn=0;Jn!==Vn;Jn++)De.addEquation(An[Jn]);De.solve(w,Tn),De.removeAllEquations(),fn++}return fn},pe}(pr),da=[],is=[],Go={bodies:[]},Eh=P.STATIC;function vi(Ne){for(var pe=Ne.length,R=0;R!==pe;R++){var w=Ne[R];if(!(w.visited||w.body.type&Eh))return w}return!1}var as=[];function ui(Ne,pe,R,w){for(as.push(Ne),Ne.visited=!0,pe(Ne,R,w);as.length;)for(var x=as.pop(),I=void 0;I=vi(x.children);)I.visited=!0,pe(I,R,w),as.push(I)}function Sa(Ne,pe,R){pe.push(Ne.body);for(var w=Ne.eqs.length,x=0;x!==w;x++){var I=Ne.eqs[x];R.includes(I)||R.push(I)}}function jl(Ne,pe){return pe.id-Ne.id}var Zi=function(){function Ne(){this.objects=[],this.type=Object}var pe=Ne.prototype;return pe.release=function(){for(var R=arguments.length,w=0;w!==R;w++)this.objects.push(w<0||arguments.length<=w?void 0:arguments[w]);return this},pe.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},pe.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")},pe.resize=function(R){for(var w=this.objects;w.length>R;)w.pop();for(;w.length<R;)w.push(this.constructObject());return this},Ne}(),ke=function(Ne){function pe(){var R;return(R=Ne.call(this)||this).type=m,R}return g(pe,Ne),pe.prototype.constructObject=function(){return new m},pe}(Zi),Hi={sphereSphere:D.types.SPHERE,spherePlane:D.types.SPHERE|D.types.PLANE,boxBox:D.types.BOX|D.types.BOX,sphereBox:D.types.SPHERE|D.types.BOX,planeBox:D.types.PLANE|D.types.BOX,convexConvex:D.types.CONVEXPOLYHEDRON,sphereConvex:D.types.SPHERE|D.types.CONVEXPOLYHEDRON,planeConvex:D.types.PLANE|D.types.CONVEXPOLYHEDRON,boxConvex:D.types.BOX|D.types.CONVEXPOLYHEDRON,sphereHeightfield:D.types.SPHERE|D.types.HEIGHTFIELD,boxHeightfield:D.types.BOX|D.types.HEIGHTFIELD,convexHeightfield:D.types.CONVEXPOLYHEDRON|D.types.HEIGHTFIELD,sphereParticle:D.types.PARTICLE|D.types.SPHERE,planeParticle:D.types.PLANE|D.types.PARTICLE,boxParticle:D.types.BOX|D.types.PARTICLE,convexParticle:D.types.PARTICLE|D.types.CONVEXPOLYHEDRON,sphereTrimesh:D.types.SPHERE|D.types.TRIMESH,planeTrimesh:D.types.PLANE|D.types.TRIMESH},kr=function(){function Ne(R){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new ke,this.world=R,this.currentContactMaterial=R.defaultContactMaterial,this.enableFrictionReduction=!1}var pe=Ne.prototype;return pe.createContactEquation=function(R,w,x,I,N,Y){var se;this.contactPointPool.length?((se=this.contactPointPool.pop()).bi=R,se.bj=w):se=new Si(R,w),se.enabled=R.collisionResponse&&w.collisionResponse&&x.collisionResponse&&I.collisionResponse;var de=this.currentContactMaterial;se.restitution=de.restitution,se.setSpookParams(de.contactEquationStiffness,de.contactEquationRelaxation,this.world.dt);var ge=x.material||R.material,Ee=I.material||w.material;return ge&&Ee&&ge.restitution>=0&&Ee.restitution>=0&&(se.restitution=ge.restitution*Ee.restitution),se.si=N||x,se.sj=Y||I,se},pe.createFrictionEquationsFromContact=function(R,w){var x=R.bi,I=R.bj,se=this.world,de=this.currentContactMaterial,ge=de.friction,Ee=R.si.material||x.material,De=R.sj.material||I.material;if(Ee&&De&&Ee.friction>=0&&De.friction>=0&&(ge=Ee.friction*De.friction),ge>0){var Ie=ge*se.gravity.length(),He=x.invMass+I.invMass;He>0&&(He=1/He);var it=this.frictionEquationPool,mt=it.length?it.pop():new hr(x,I,Ie*He),bt=it.length?it.pop():new hr(x,I,Ie*He);return mt.bi=bt.bi=x,mt.bj=bt.bj=I,mt.minForce=bt.minForce=-Ie*He,mt.maxForce=bt.maxForce=Ie*He,mt.ri.copy(R.ri),mt.rj.copy(R.rj),bt.ri.copy(R.ri),bt.rj.copy(R.rj),R.ni.tangents(mt.t,bt.t),mt.setSpookParams(de.frictionEquationStiffness,de.frictionEquationRelaxation,se.dt),bt.setSpookParams(de.frictionEquationStiffness,de.frictionEquationRelaxation,se.dt),mt.enabled=bt.enabled=R.enabled,w.push(mt,bt),!0}return!1},pe.createFrictionFromAverage=function(R){var w=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(w,this.frictionResult)&&1!==R){var x=this.frictionResult[this.frictionResult.length-2],I=this.frictionResult[this.frictionResult.length-1];ca.setZero(),Co.setZero(),ma.setZero();for(var N=w.bi,Y=0;Y!==R;Y++)(w=this.result[this.result.length-1-Y]).bi!==N?(ca.vadd(w.ni,ca),Co.vadd(w.ri,Co),ma.vadd(w.rj,ma)):(ca.vsub(w.ni,ca),Co.vadd(w.rj,Co),ma.vadd(w.ri,ma));var se=1/R;Co.scale(se,x.ri),ma.scale(se,x.rj),I.ri.copy(x.ri),I.rj.copy(x.rj),ca.normalize(),ca.tangents(x.t,I.t)}},pe.getContacts=function(R,w,x,I,N,Y,se){this.contactPointPool=N,this.frictionEquationPool=se,this.result=I,this.frictionResult=Y;for(var de=os,ge=ss,Ee=Is,De=Xl,Ie=0,He=R.length;Ie!==He;Ie++){var it=R[Ie],mt=w[Ie],bt=null;it.material&&mt.material&&(bt=x.getContactMaterial(it.material,mt.material)||null);for(var pt=it.type&P.KINEMATIC&&mt.type&P.STATIC||it.type&P.STATIC&&mt.type&P.KINEMATIC||it.type&P.KINEMATIC&&mt.type&P.KINEMATIC,zt=0;zt<it.shapes.length;zt++){it.quaternion.mult(it.shapeOrientations[zt],de),it.quaternion.vmult(it.shapeOffsets[zt],Ee),Ee.vadd(it.position,Ee);for(var Lt=it.shapes[zt],dn=0;dn<mt.shapes.length;dn++){mt.quaternion.mult(mt.shapeOrientations[dn],ge),mt.quaternion.vmult(mt.shapeOffsets[dn],De),De.vadd(mt.position,De);var fn=mt.shapes[dn];if(Lt.collisionFilterMask&fn.collisionFilterGroup&&fn.collisionFilterMask&Lt.collisionFilterGroup&&!(Ee.distanceTo(De)>Lt.boundingSphereRadius+fn.boundingSphereRadius)){var An=null;Lt.material&&fn.material&&(An=x.getContactMaterial(Lt.material,fn.material)||null),this.currentContactMaterial=An||bt||x.defaultContactMaterial;var Tn=this[Lt.type|fn.type];Tn&&(Lt.type<fn.type?Tn.call(this,Lt,fn,Ee,De,de,ge,it,mt,Lt,fn,pt):Tn.call(this,fn,Lt,De,Ee,ge,de,mt,it,Lt,fn,pt))&&pt&&(x.shapeOverlapKeeper.set(Lt.id,fn.id),x.bodyOverlapKeeper.set(it.id,mt.id))}}}}},pe.sphereSphere=function(R,w,x,I,N,Y,se,de,ge,Ee,De){if(De)return x.distanceSquared(I)<Math.pow(R.radius+w.radius,2);var Ie=this.createContactEquation(se,de,R,w,ge,Ee);I.vsub(x,Ie.ni),Ie.ni.normalize(),Ie.ri.copy(Ie.ni),Ie.rj.copy(Ie.ni),Ie.ri.scale(R.radius,Ie.ri),Ie.rj.scale(-w.radius,Ie.rj),Ie.ri.vadd(x,Ie.ri),Ie.ri.vsub(se.position,Ie.ri),Ie.rj.vadd(I,Ie.rj),Ie.rj.vsub(de.position,Ie.rj),this.result.push(Ie),this.createFrictionEquationsFromContact(Ie,this.frictionResult)},pe.spherePlane=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=this.createContactEquation(se,de,R,w,ge,Ee);if(Ie.ni.set(0,0,1),Y.vmult(Ie.ni,Ie.ni),Ie.ni.negate(Ie.ni),Ie.ni.normalize(),Ie.ni.scale(R.radius,Ie.ri),x.vsub(I,br),Ie.ni.scale(Ie.ni.dot(br),Wo),br.vsub(Wo,Ie.rj),-br.dot(Ie.ni)<=R.radius){if(De)return!0;var He=Ie.ri,it=Ie.rj;He.vadd(x,He),He.vsub(se.position,He),it.vadd(I,it),it.vsub(de.position,it),this.result.push(Ie),this.createFrictionEquationsFromContact(Ie,this.frictionResult)}},pe.boxBox=function(R,w,x,I,N,Y,se,de,ge,Ee,De){return R.convexPolyhedronRepresentation.material=R.material,w.convexPolyhedronRepresentation.material=w.material,R.convexPolyhedronRepresentation.collisionResponse=R.collisionResponse,w.convexPolyhedronRepresentation.collisionResponse=w.collisionResponse,this.convexConvex(R.convexPolyhedronRepresentation,w.convexPolyhedronRepresentation,x,I,N,Y,se,de,R,w,De)},pe.sphereBox=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=this.v3pool,He=Kc;x.vsub(I,jo),w.getSideNormals(He,Y);for(var it=R.radius,mt=!1,bt=Sh,pt=Qc,zt=us,Lt=null,dn=0,fn=0,An=0,Tn=null,Vn=0,Jn=He.length;Vn!==Jn&&!1===mt;Vn++){var Nn=Ca;Nn.copy(He[Vn]);var Mn=Nn.length();Nn.normalize();var Tr=jo.dot(Nn);if(Tr<Mn+it&&Tr>0){var kn=dl,$r=Yc;kn.copy(He[(Vn+1)%3]),$r.copy(He[(Vn+2)%3]);var Ur=kn.length(),gr=$r.length();kn.normalize(),$r.normalize();var Fr=jo.dot(kn),$n=jo.dot($r);if(Fr<Ur&&Fr>-Ur&&$n<gr&&$n>-gr){var Or=Math.abs(Tr-Mn-it);if((null===Tn||Or<Tn)&&(Tn=Or,fn=Fr,An=$n,Lt=Mn,bt.copy(Nn),pt.copy(kn),zt.copy($r),dn++,De))return!0}}}if(dn){mt=!0;var _r=this.createContactEquation(se,de,R,w,ge,Ee);bt.scale(-it,_r.ri),_r.ni.copy(bt),_r.ni.negate(_r.ni),bt.scale(Lt,bt),pt.scale(fn,pt),bt.vadd(pt,bt),zt.scale(An,zt),bt.vadd(zt,_r.rj),_r.ri.vadd(x,_r.ri),_r.ri.vsub(se.position,_r.ri),_r.rj.vadd(I,_r.rj),_r.rj.vsub(de.position,_r.rj),this.result.push(_r),this.createFrictionEquationsFromContact(_r,this.frictionResult)}for(var jn=Ie.get(),Kr=Ql,xi=0;2!==xi&&!mt;xi++)for(var dr=0;2!==dr&&!mt;dr++)for(var fa=0;2!==fa&&!mt;fa++)if(jn.set(0,0,0),xi?jn.vadd(He[0],jn):jn.vsub(He[0],jn),dr?jn.vadd(He[1],jn):jn.vsub(He[1],jn),fa?jn.vadd(He[2],jn):jn.vsub(He[2],jn),I.vadd(jn,Kr),Kr.vsub(x,Kr),Kr.lengthSquared()<it*it){if(De)return!0;mt=!0;var ri=this.createContactEquation(se,de,R,w,ge,Ee);ri.ri.copy(Kr),ri.ri.normalize(),ri.ni.copy(ri.ri),ri.ri.scale(it,ri.ri),ri.rj.copy(jn),ri.ri.vadd(x,ri.ri),ri.ri.vsub(se.position,ri.ri),ri.rj.vadd(I,ri.rj),ri.rj.vsub(de.position,ri.rj),this.result.push(ri),this.createFrictionEquationsFromContact(ri,this.frictionResult)}Ie.release(jn),jn=null;for(var hi=Ie.get(),ai=Ie.get(),Di=Ie.get(),Gi=Ie.get(),oi=Ie.get(),pa=He.length,wi=0;wi!==pa&&!mt;wi++)for(var Ji=0;Ji!==pa&&!mt;Ji++)if(wi%3!=Ji%3){He[Ji].cross(He[wi],hi),hi.normalize(),He[wi].vadd(He[Ji],ai),Di.copy(x),Di.vsub(ai,Di),Di.vsub(I,Di);var Ii=Di.dot(hi);hi.scale(Ii,Gi);for(var ia=0;ia===wi%3||ia===Ji%3;)ia++;oi.copy(x),oi.vsub(Gi,oi),oi.vsub(ai,oi),oi.vsub(I,oi);var ho=Math.abs(Ii),Da=oi.length();if(ho<He[ia].length()&&Da<it){if(De)return!0;mt=!0;var ii=this.createContactEquation(se,de,R,w,ge,Ee);ai.vadd(Gi,ii.rj),ii.rj.copy(ii.rj),oi.negate(ii.ni),ii.ni.normalize(),ii.ri.copy(ii.rj),ii.ri.vadd(I,ii.ri),ii.ri.vsub(x,ii.ri),ii.ri.normalize(),ii.ri.scale(it,ii.ri),ii.ri.vadd(x,ii.ri),ii.ri.vsub(se.position,ii.ri),ii.rj.vadd(I,ii.rj),ii.rj.vsub(de.position,ii.rj),this.result.push(ii),this.createFrictionEquationsFromContact(ii,this.frictionResult)}}Ie.release(hi,ai,Di,Gi,oi)},pe.planeBox=function(R,w,x,I,N,Y,se,de,ge,Ee,De){return w.convexPolyhedronRepresentation.material=w.material,w.convexPolyhedronRepresentation.collisionResponse=w.collisionResponse,w.convexPolyhedronRepresentation.id=w.id,this.planeConvex(R,w.convexPolyhedronRepresentation,x,I,N,Y,se,de,R,w,De)},pe.convexConvex=function(R,w,x,I,N,Y,se,de,ge,Ee,De,Ie,He){var it=Ja;if(!(x.distanceTo(I)>R.boundingSphereRadius+w.boundingSphereRadius)&&R.findSeparatingAxis(w,x,N,I,Y,it,Ie,He)){var mt=[],bt=ka;R.clipAgainstHull(x,N,w,I,Y,it,-100,100,mt);for(var pt=0,zt=0;zt!==mt.length;zt++){if(De)return!0;var Lt=this.createContactEquation(se,de,R,w,ge,Ee),dn=Lt.ri,fn=Lt.rj;it.negate(Lt.ni),mt[zt].normal.negate(bt),bt.scale(mt[zt].depth,bt),mt[zt].point.vadd(bt,dn),fn.copy(mt[zt].point),dn.vsub(x,dn),fn.vsub(I,fn),dn.vadd(x,dn),dn.vsub(se.position,dn),fn.vadd(I,fn),fn.vsub(de.position,fn),this.result.push(Lt),pt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Lt,this.frictionResult)}this.enableFrictionReduction&&pt&&this.createFrictionFromAverage(pt)}},pe.sphereConvex=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=this.v3pool;x.vsub(I,so);for(var He=w.faceNormals,it=w.faces,mt=w.vertices,bt=R.radius,pt=!1,zt=0;zt!==mt.length;zt++){var dn=_h;Y.vmult(mt[zt],dn),I.vadd(dn,dn);var fn=Ch;if(dn.vsub(x,fn),fn.lengthSquared()<bt*bt){if(De)return!0;pt=!0;var An=this.createContactEquation(se,de,R,w,ge,Ee);return An.ri.copy(fn),An.ri.normalize(),An.ni.copy(An.ri),An.ri.scale(bt,An.ri),dn.vsub(I,An.rj),An.ri.vadd(x,An.ri),An.ri.vsub(se.position,An.ri),An.rj.vadd(I,An.rj),An.rj.vsub(de.position,An.rj),this.result.push(An),void this.createFrictionEquationsFromContact(An,this.frictionResult)}}for(var Tn=0,Vn=it.length;Tn!==Vn&&!1===pt;Tn++){var Nn=it[Tn],Mn=Zc;Y.vmult(He[Tn],Mn);var Tr=Jc;Y.vmult(mt[Nn[0]],Tr),Tr.vadd(I,Tr);var kn=$c;Mn.scale(-bt,kn),x.vadd(kn,kn);var $r=Rh;kn.vsub(Tr,$r);var Ur=$r.dot(Mn),gr=eu;if(x.vsub(Tr,gr),Ur<0&&gr.dot(Mn)>0){for(var Fr=[],$n=0,Or=Nn.length;$n!==Or;$n++){var _r=Ie.get();Y.vmult(mt[Nn[$n]],_r),I.vadd(_r,_r),Fr.push(_r)}if(Po(Fr,Mn,x)){if(De)return!0;pt=!0;var jn=this.createContactEquation(se,de,R,w,ge,Ee);Mn.scale(-bt,jn.ri),Mn.negate(jn.ni);var Kr=Ie.get();Mn.scale(-Ur,Kr);var xi=Ie.get();Mn.scale(-bt,xi),x.vsub(I,jn.rj),jn.rj.vadd(xi,jn.rj),jn.rj.vadd(Kr,jn.rj),jn.rj.vadd(I,jn.rj),jn.rj.vsub(de.position,jn.rj),jn.ri.vadd(x,jn.ri),jn.ri.vsub(se.position,jn.ri),Ie.release(Kr),Ie.release(xi),this.result.push(jn),this.createFrictionEquationsFromContact(jn,this.frictionResult);for(var dr=0,fa=Fr.length;dr!==fa;dr++)Ie.release(Fr[dr]);return}for(var ri=0;ri!==Nn.length;ri++){var hi=Ie.get(),ai=Ie.get();Y.vmult(mt[Nn[(ri+1)%Nn.length]],hi),Y.vmult(mt[Nn[(ri+2)%Nn.length]],ai),I.vadd(hi,hi),I.vadd(ai,ai);var Di=fl;ai.vsub(hi,Di);var Gi=Bs;Di.unit(Gi);var oi=Ie.get(),pa=Ie.get();x.vsub(hi,pa);var wi=pa.dot(Gi);Gi.scale(wi,oi),oi.vadd(hi,oi);var Ji=Ie.get();if(oi.vsub(x,Ji),wi>0&&wi*wi<Di.lengthSquared()&&Ji.lengthSquared()<bt*bt){if(De)return!0;var Ii=this.createContactEquation(se,de,R,w,ge,Ee);oi.vsub(I,Ii.rj),oi.vsub(x,Ii.ni),Ii.ni.normalize(),Ii.ni.scale(bt,Ii.ri),Ii.rj.vadd(I,Ii.rj),Ii.rj.vsub(de.position,Ii.rj),Ii.ri.vadd(x,Ii.ri),Ii.ri.vsub(se.position,Ii.ri),this.result.push(Ii),this.createFrictionEquationsFromContact(Ii,this.frictionResult);for(var ia=0,ho=Fr.length;ia!==ho;ia++)Ie.release(Fr[ia]);return Ie.release(hi),Ie.release(ai),Ie.release(oi),Ie.release(Ji),void Ie.release(pa)}Ie.release(hi),Ie.release(ai),Ie.release(oi),Ie.release(Ji),Ie.release(pa)}for(var Da=0,ii=Fr.length;Da!==ii;Da++)Ie.release(Fr[Da])}}},pe.planeConvex=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=Kn,He=Zl;He.set(0,0,1),N.vmult(He,He);for(var it=0,mt=Lh,bt=0;bt!==w.vertices.length;bt++)if(Ie.copy(w.vertices[bt]),Y.vmult(Ie,Ie),I.vadd(Ie,Ie),Ie.vsub(x,mt),He.dot(mt)<=0){if(De)return!0;var pt=this.createContactEquation(se,de,R,w,ge,Ee),zt=Ph;He.scale(He.dot(mt),zt),Ie.vsub(zt,zt),zt.vsub(x,pt.ri),pt.ni.copy(He),Ie.vsub(I,pt.rj),pt.ri.vadd(x,pt.ri),pt.ri.vsub(se.position,pt.ri),pt.rj.vadd(I,pt.rj),pt.rj.vsub(de.position,pt.rj),this.result.push(pt),it++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(pt,this.frictionResult)}this.enableFrictionReduction&&it&&this.createFrictionFromAverage(it)},pe.boxConvex=function(R,w,x,I,N,Y,se,de,ge,Ee,De){return R.convexPolyhedronRepresentation.material=R.material,R.convexPolyhedronRepresentation.collisionResponse=R.collisionResponse,this.convexConvex(R.convexPolyhedronRepresentation,w,x,I,N,Y,se,de,R,w,De)},pe.sphereHeightfield=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=w.data,He=R.radius,it=w.elementSize,mt=tc,bt=vl;B.pointToLocalFrame(I,Y,x,bt);var pt=Math.floor((bt.x-He)/it)-1,zt=Math.ceil((bt.x+He)/it)+1,Lt=Math.floor((bt.y-He)/it)-1,dn=Math.ceil((bt.y+He)/it)+1;if(!(zt<0||dn<0||pt>Ie.length||Lt>Ie[0].length)){pt<0&&(pt=0),zt<0&&(zt=0),Lt<0&&(Lt=0),dn<0&&(dn=0),pt>=Ie.length&&(pt=Ie.length-1),zt>=Ie.length&&(zt=Ie.length-1),dn>=Ie[0].length&&(dn=Ie[0].length-1),Lt>=Ie[0].length&&(Lt=Ie[0].length-1);var fn=[];if(w.getRectMinMax(pt,Lt,zt,dn,fn),!(bt.z-He>fn[1]||bt.z+He<fn[0]))for(var Vn=this.result,Jn=pt;Jn<zt;Jn++)for(var Nn=Lt;Nn<dn;Nn++){var Mn=Vn.length,Tr=!1;if(w.getConvexTrianglePillar(Jn,Nn,!1),B.pointToWorldFrame(I,Y,w.pillarOffset,mt),x.distanceTo(mt)<w.pillarConvex.boundingSphereRadius+R.boundingSphereRadius&&(Tr=this.sphereConvex(R,w.pillarConvex,x,mt,N,Y,se,de,R,w,De)),De&&Tr||(w.getConvexTrianglePillar(Jn,Nn,!0),B.pointToWorldFrame(I,Y,w.pillarOffset,mt),x.distanceTo(mt)<w.pillarConvex.boundingSphereRadius+R.boundingSphereRadius&&(Tr=this.sphereConvex(R,w.pillarConvex,x,mt,N,Y,se,de,R,w,De)),De&&Tr))return!0;if(Vn.length-Mn>2)return}}},pe.boxHeightfield=function(R,w,x,I,N,Y,se,de,ge,Ee,De){return R.convexPolyhedronRepresentation.material=R.material,R.convexPolyhedronRepresentation.collisionResponse=R.collisionResponse,this.convexHeightfield(R.convexPolyhedronRepresentation,w,x,I,N,Y,se,de,R,w,De)},pe.convexHeightfield=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=w.data,He=w.elementSize,it=R.boundingSphereRadius,mt=nu,bt=Ua,pt=Ha;B.pointToLocalFrame(I,Y,x,pt);var zt=Math.floor((pt.x-it)/He)-1,Lt=Math.ceil((pt.x+it)/He)+1,dn=Math.floor((pt.y-it)/He)-1,fn=Math.ceil((pt.y+it)/He)+1;if(!(Lt<0||fn<0||zt>Ie.length||dn>Ie[0].length)){zt<0&&(zt=0),Lt<0&&(Lt=0),dn<0&&(dn=0),fn<0&&(fn=0),zt>=Ie.length&&(zt=Ie.length-1),Lt>=Ie.length&&(Lt=Ie.length-1),fn>=Ie[0].length&&(fn=Ie[0].length-1),dn>=Ie[0].length&&(dn=Ie[0].length-1);var An=[];if(w.getRectMinMax(zt,dn,Lt,fn,An),!(pt.z-it>An[1]||pt.z+it<An[0]))for(var Jn=zt;Jn<Lt;Jn++)for(var Nn=dn;Nn<fn;Nn++){var Mn=!1;if(w.getConvexTrianglePillar(Jn,Nn,!1),B.pointToWorldFrame(I,Y,w.pillarOffset,mt),x.distanceTo(mt)<w.pillarConvex.boundingSphereRadius+R.boundingSphereRadius&&(Mn=this.convexConvex(R,w.pillarConvex,x,mt,N,Y,se,de,null,null,De,bt,null)),De&&Mn||(w.getConvexTrianglePillar(Jn,Nn,!0),B.pointToWorldFrame(I,Y,w.pillarOffset,mt),x.distanceTo(mt)<w.pillarConvex.boundingSphereRadius+R.boundingSphereRadius&&(Mn=this.convexConvex(R,w.pillarConvex,x,mt,N,Y,se,de,null,null,De,bt,null)),De&&Mn))return!0}}},pe.sphereParticle=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=hs;if(Ie.set(0,0,1),I.vsub(x,Ie),Ie.lengthSquared()<=R.radius*R.radius){if(De)return!0;var He=this.createContactEquation(de,se,w,R,ge,Ee);Ie.normalize(),He.rj.copy(Ie),He.rj.scale(R.radius,He.rj),He.ni.copy(Ie),He.ni.negate(He.ni),He.ri.set(0,0,0),this.result.push(He),this.createFrictionEquationsFromContact(He,this.frictionResult)}},pe.planeParticle=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=lo;Ie.set(0,0,1),se.quaternion.vmult(Ie,Ie);var He=Jl;if(I.vsub(se.position,He),Ie.dot(He)<=0){if(De)return!0;var it=this.createContactEquation(de,se,w,R,ge,Ee);it.ni.copy(Ie),it.ni.negate(it.ni),it.ri.set(0,0,0);var mt=co;Ie.scale(Ie.dot(I),mt),I.vsub(mt,mt),it.rj.copy(mt),this.result.push(it),this.createFrictionEquationsFromContact(it,this.frictionResult)}},pe.boxParticle=function(R,w,x,I,N,Y,se,de,ge,Ee,De){return R.convexPolyhedronRepresentation.material=R.material,R.convexPolyhedronRepresentation.collisionResponse=R.collisionResponse,this.convexParticle(R.convexPolyhedronRepresentation,w,x,I,N,Y,se,de,R,w,De)},pe.convexParticle=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=-1,He=$l,it=ec,mt=null,bt=tu;if(bt.copy(I),bt.vsub(x,bt),N.conjugate(Xo),Xo.vmult(bt,bt),R.pointIsInside(bt)){R.worldVerticesNeedsUpdate&&R.computeWorldVertices(x,N),R.worldFaceNormalsNeedsUpdate&&R.computeWorldFaceNormals(N);for(var pt=0,zt=R.faces.length;pt!==zt;pt++){var dn=R.worldFaceNormals[pt];I.vsub(R.worldVertices[R.faces[pt][0]],pl);var fn=-dn.dot(pl);if(null===mt||Math.abs(fn)<Math.abs(mt)){if(De)return!0;mt=fn,Ie=pt,He.copy(dn)}}if(-1!==Ie){var An=this.createContactEquation(de,se,w,R,ge,Ee);He.scale(mt,it),it.vadd(I,it),it.vsub(x,it),An.rj.copy(it),He.negate(An.ni),An.ri.set(0,0,0);var Tn=An.ri,Vn=An.rj;Tn.vadd(I,Tn),Tn.vsub(de.position,Tn),Vn.vadd(x,Vn),Vn.vsub(se.position,Vn),this.result.push(An),this.createFrictionEquationsFromContact(An,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},pe.sphereTrimesh=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=Vo,He=xh,it=ao,mt=oo,bt=ql,pt=ul,zt=Kl,Lt=cl,dn=Os,fn=cs;B.pointToLocalFrame(I,Y,x,bt);var An=R.radius;zt.lowerBound.set(bt.x-An,bt.y-An,bt.z-An),zt.upperBound.set(bt.x+An,bt.y+An,bt.z+An),w.getTrianglesInAABB(zt,fn);for(var Tn=ll,Vn=R.radius*R.radius,Jn=0;Jn<fn.length;Jn++)for(var Nn=0;Nn<3;Nn++)if(w.getVertex(w.indices[3*fn[Jn]+Nn],Tn),Tn.vsub(bt,dn),dn.lengthSquared()<=Vn){if(Lt.copy(Tn),B.pointToWorldFrame(I,Y,Lt,Tn),Tn.vsub(x,dn),De)return!0;var Mn=this.createContactEquation(se,de,R,w,ge,Ee);Mn.ni.copy(dn),Mn.ni.normalize(),Mn.ri.copy(Mn.ni),Mn.ri.scale(R.radius,Mn.ri),Mn.ri.vadd(x,Mn.ri),Mn.ri.vsub(se.position,Mn.ri),Mn.rj.copy(Tn),Mn.rj.vsub(de.position,Mn.rj),this.result.push(Mn),this.createFrictionEquationsFromContact(Mn,this.frictionResult)}for(var Tr=0;Tr<fn.length;Tr++)for(var kn=0;kn<3;kn++){w.getVertex(w.indices[3*fn[Tr]+kn],Ie),w.getVertex(w.indices[3*fn[Tr]+(kn+1)%3],He),He.vsub(Ie,it),bt.vsub(He,pt);var $r=pt.dot(it);bt.vsub(Ie,pt);var Ur=pt.dot(it);if(Ur>0&&$r<0&&(bt.vsub(Ie,pt),mt.copy(it),mt.normalize(),Ur=pt.dot(mt),mt.scale(Ur,pt),pt.vadd(Ie,pt),pt.distanceTo(bt)<R.radius)){if(De)return!0;var gr=this.createContactEquation(se,de,R,w,ge,Ee);pt.vsub(bt,gr.ni),gr.ni.normalize(),gr.ni.scale(R.radius,gr.ri),gr.ri.vadd(x,gr.ri),gr.ri.vsub(se.position,gr.ri),B.pointToWorldFrame(I,Y,pt,pt),pt.vsub(de.position,gr.rj),B.vectorToWorldFrame(Y,gr.ni,gr.ni),B.vectorToWorldFrame(Y,gr.ri,gr.ri),this.result.push(gr),this.createFrictionEquationsFromContact(gr,this.frictionResult)}}for(var Fr=Lo,$n=Yl,Or=hl,_r=zo,jn=0,Kr=fn.length;jn!==Kr;jn++){w.getTriangleVertices(fn[jn],Fr,$n,Or),w.getNormal(fn[jn],_r),bt.vsub(Fr,pt);var xi=pt.dot(_r);if(_r.scale(xi,pt),bt.vsub(pt,pt),xi=pt.distanceTo(bt),nt.pointInTriangle(pt,Fr,$n,Or)&&xi<R.radius){if(De)return!0;var dr=this.createContactEquation(se,de,R,w,ge,Ee);pt.vsub(bt,dr.ni),dr.ni.normalize(),dr.ni.scale(R.radius,dr.ri),dr.ri.vadd(x,dr.ri),dr.ri.vsub(se.position,dr.ri),B.pointToWorldFrame(I,Y,pt,pt),pt.vsub(de.position,dr.rj),B.vectorToWorldFrame(Y,dr.ni,dr.ni),B.vectorToWorldFrame(Y,dr.ri,dr.ri),this.result.push(dr),this.createFrictionEquationsFromContact(dr,this.frictionResult)}}fn.length=0},pe.planeTrimesh=function(R,w,x,I,N,Y,se,de,ge,Ee,De){var Ie=new m,He=ls;He.set(0,0,1),N.vmult(He,He);for(var it=0;it<w.vertices.length/3;it++){w.getVertex(it,Ie);var mt=new m;mt.copy(Ie),B.pointToWorldFrame(I,Y,mt,Ie);var bt=_o;if(Ie.vsub(x,bt),He.dot(bt)<=0){if(De)return!0;var pt=this.createContactEquation(se,de,R,w,ge,Ee);pt.ni.copy(He);var zt=Ro;He.scale(bt.dot(He),zt),Ie.vsub(zt,zt),pt.ri.copy(zt),pt.ri.vsub(se.position,pt.ri),pt.rj.copy(Ie),pt.rj.vsub(de.position,pt.rj),this.result.push(pt),this.createFrictionEquationsFromContact(pt,this.frictionResult)}}},Ne}(),ca=new m,Co=new m,ma=new m,Is=new m,Xl=new m,os=new y,ss=new y;kr.prototype[Hi.boxBox]=kr.prototype.boxBox,kr.prototype[Hi.boxConvex]=kr.prototype.boxConvex,kr.prototype[Hi.boxParticle]=kr.prototype.boxParticle,kr.prototype[Hi.sphereSphere]=kr.prototype.sphereSphere;var ls=new m,_o=new m,Ro=new m;kr.prototype[Hi.planeTrimesh]=kr.prototype.planeTrimesh;var zo=new m,Os=new m,ll=(new m,new m),cl=new m,Vo=new m,xh=new m,ao=new m,oo=new m,ql=new m,ul=new m,Lo=new m,Yl=new m,hl=new m,Kl=new p,cs=[];kr.prototype[Hi.sphereTrimesh]=kr.prototype.sphereTrimesh;var br=new m,Wo=new m;kr.prototype[Hi.spherePlane]=kr.prototype.spherePlane;var Na=new m,Mh=new m,Th=new m;function Po(Ne,pe,R){for(var w=null,x=Ne.length,I=0;I!==x;I++){var N=Ne[I],Y=Na;Ne[(I+1)%x].vsub(N,Y);var se=Mh;Y.cross(pe,se);var de=Th;R.vsub(N,de);var ge=se.dot(de);if(!(null===w||ge>0&&!0===w||ge<=0&&!1===w))return!1;null===w&&(w=ge>0)}return!0}var jo=new m,Ca=new m,dl=new m,Yc=new m,Kc=[new m,new m,new m,new m,new m,new m],Ql=new m,Sh=new m,Qc=new m,us=new m;kr.prototype[Hi.sphereBox]=kr.prototype.sphereBox;var so=new m,fl=new m,Bs=new m,Ch=new m,_h=new m,Zc=new m,Jc=new m,$c=new m,Rh=new m,eu=new m;kr.prototype[Hi.sphereConvex]=kr.prototype.sphereConvex,new m,new m,kr.prototype[Hi.planeBox]=kr.prototype.planeBox;var Kn=new m,Zl=new m,Lh=new m,Ph=new m;kr.prototype[Hi.planeConvex]=kr.prototype.planeConvex;var Ja=new m,ka=new m;kr.prototype[Hi.convexConvex]=kr.prototype.convexConvex;var lo=new m,Jl=new m,co=new m;kr.prototype[Hi.planeParticle]=kr.prototype.planeParticle;var hs=new m;kr.prototype[Hi.sphereParticle]=kr.prototype.sphereParticle;var Xo=new y,tu=new m,$l=(new m,new m),pl=new m,ec=new m;kr.prototype[Hi.convexParticle]=kr.prototype.convexParticle,kr.prototype[Hi.boxHeightfield]=kr.prototype.boxHeightfield;var Ha=new m,nu=new m,Ua=[0];kr.prototype[Hi.convexHeightfield]=kr.prototype.convexHeightfield;var vl=new m,tc=new m;kr.prototype[Hi.sphereHeightfield]=kr.prototype.sphereHeightfield;var ml=function(){function Ne(){this.current=[],this.previous=[]}var pe=Ne.prototype;return pe.getKey=function(R,w){if(w<R){var x=w;w=R,R=x}return R<<16|w},pe.set=function(R,w){for(var x=this.getKey(R,w),I=this.current,N=0;x>I[N];)N++;if(x!==I[N]){for(var Y=I.length-1;Y>=N;Y--)I[Y+1]=I[Y];I[N]=x}},pe.tick=function(){var R=this.current;this.current=this.previous,this.previous=R,this.current.length=0},pe.getDiff=function(R,w){for(var x=this.current,I=this.previous,N=x.length,Y=I.length,se=0,de=0;de<N;de++){for(var ge=x[de];ge>I[se];)se++;ge===I[se]||gl(R,ge)}se=0;for(var Ee=0;Ee<Y;Ee++){for(var De=I[Ee];De>x[se];)se++;x[se]===De||gl(w,De)}},Ne}();function gl(Ne,pe){Ne.push((4294901760&pe)>>16,65535&pe)}var Fn=function(){function Ne(){this.data={keys:[]}}var pe=Ne.prototype;return pe.get=function(R,w){if(R>w){var x=w;w=R,R=x}return this.data[R+"-"+w]},pe.set=function(R,w,x){if(R>w){var I=w;w=R,R=I}var N=R+"-"+w;this.get(R,w)||this.data.keys.push(N),this.data[N]=x},pe.reset=function(){for(var R=this.data,w=R.keys;w.length>0;)delete R[w.pop()]},Ne}(),ds=function(Ne){function pe(w){var x;return void 0===w&&(w={}),(x=Ne.call(this)||this).dt=-1,x.allowSleep=!!w.allowSleep,x.contacts=[],x.frictionEquations=[],x.quatNormalizeSkip=void 0!==w.quatNormalizeSkip?w.quatNormalizeSkip:0,x.quatNormalizeFast=void 0!==w.quatNormalizeFast&&w.quatNormalizeFast,x.time=0,x.stepnumber=0,x.default_dt=1/60,x.nextId=0,x.gravity=new m,w.gravity&&x.gravity.copy(w.gravity),x.broadphase=void 0!==w.broadphase?w.broadphase:new Ve,x.bodies=[],x.hasActiveBodies=!1,x.solver=void 0!==w.solver?w.solver:new Wl,x.constraints=[],x.narrowphase=new kr(v(x)),x.collisionMatrix=new E,x.collisionMatrixPrevious=new E,x.bodyOverlapKeeper=new ml,x.shapeOverlapKeeper=new ml,x.materials=[],x.contactmaterials=[],x.contactMaterialTable=new Fn,x.defaultMaterial=new ci("default"),x.defaultContactMaterial=new ta(x.defaultMaterial,x.defaultMaterial,{friction:.3,restitution:0}),x.doProfiling=!1,x.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},x.accumulator=0,x.subsystems=[],x.addBodyEvent={type:"addBody",body:null},x.removeBodyEvent={type:"removeBody",body:null},x.idToBodyMap={},x.broadphase.setWorld(v(x)),x}g(pe,Ne);var R=pe.prototype;return R.getContactMaterial=function(w,x){return this.contactMaterialTable.get(w.id,x.id)},R.numObjects=function(){return this.bodies.length},R.collisionMatrixTick=function(){var w=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=w,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()},R.addConstraint=function(w){this.constraints.push(w)},R.removeConstraint=function(w){var x=this.constraints.indexOf(w);-1!==x&&this.constraints.splice(x,1)},R.rayTest=function(w,x,I){I instanceof Ke?this.raycastClosest(w,x,{skipBackfaces:!0},I):this.raycastAll(w,x,{skipBackfaces:!0},I)},R.raycastAll=function(w,x,I,N){return void 0===I&&(I={}),I.mode=nt.ALL,I.from=w,I.to=x,I.callback=N,nc.intersectWorld(this,I)},R.raycastAny=function(w,x,I,N){return void 0===I&&(I={}),I.mode=nt.ANY,I.from=w,I.to=x,I.result=N,nc.intersectWorld(this,I)},R.raycastClosest=function(w,x,I,N){return void 0===I&&(I={}),I.mode=nt.CLOSEST,I.from=w,I.to=x,I.result=N,nc.intersectWorld(this,I)},R.addBody=function(w){this.bodies.includes(w)||(w.index=this.bodies.length,this.bodies.push(w),w.world=this,w.initPosition.copy(w.position),w.initVelocity.copy(w.velocity),w.timeLastSleepy=this.time,w instanceof P&&(w.initAngularVelocity.copy(w.angularVelocity),w.initQuaternion.copy(w.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=w,this.idToBodyMap[w.id]=w,this.dispatchEvent(this.addBodyEvent))},R.removeBody=function(w){w.world=null;var x=this.bodies.length-1,I=this.bodies,N=I.indexOf(w);if(-1!==N){I.splice(N,1);for(var Y=0;Y!==I.length;Y++)I[Y].index=Y;this.collisionMatrix.setNumObjects(x),this.removeBodyEvent.body=w,delete this.idToBodyMap[w.id],this.dispatchEvent(this.removeBodyEvent)}},R.getBodyById=function(w){return this.idToBodyMap[w]},R.getShapeById=function(w){for(var x=this.bodies,I=0,N=x.length;I<N;I++)for(var Y=x[I].shapes,se=0,de=Y.length;se<de;se++){var ge=Y[se];if(ge.id===w)return ge}},R.addMaterial=function(w){this.materials.push(w)},R.addContactMaterial=function(w){this.contactmaterials.push(w),this.contactMaterialTable.set(w.materials[0].id,w.materials[1].id,w)},R.step=function(w,x,I){if(void 0===x&&(x=0),void 0===I&&(I=10),0===x)this.internalStep(w),this.time+=w;else{this.accumulator+=x;for(var N=0;this.accumulator>=w&&N<I;)this.internalStep(w),this.accumulator-=w,N++;for(var Y=this.accumulator%w/w,se=0;se!==this.bodies.length;se++){var de=this.bodies[se];de.previousPosition.lerp(de.position,Y,de.interpolatedPosition),de.previousQuaternion.slerp(de.quaternion,Y,de.interpolatedQuaternion),de.previousQuaternion.normalize()}this.time+=x}},R.internalStep=function(w){this.dt=w;var x=this.contacts,I=Hs,N=_n,Y=this.numObjects(),se=this.bodies,de=this.solver,ge=this.gravity,Ee=this.doProfiling,De=this.profile,Ie=P.DYNAMIC,He=-1/0,it=this.constraints,mt=qo,bt=(ge.length(),ge.x),pt=ge.y,zt=ge.z,Lt=0;for(Ee&&(He=performance.now()),Lt=0;Lt!==Y;Lt++){var dn=se[Lt];if(dn.type===Ie){var fn=dn.force,An=dn.mass;fn.x+=An*bt,fn.y+=An*pt,fn.z+=An*zt}}for(var Tn=0,Vn=this.subsystems.length;Tn!==Vn;Tn++)this.subsystems[Tn].update();Ee&&(He=performance.now()),I.length=0,N.length=0,this.broadphase.collisionPairs(this,I,N),Ee&&(De.broadphase=performance.now()-He);var Jn=it.length;for(Lt=0;Lt!==Jn;Lt++){var Nn=it[Lt];if(!Nn.collideConnected)for(var Mn=I.length-1;Mn>=0;Mn-=1)(Nn.bodyA===I[Mn]&&Nn.bodyB===N[Mn]||Nn.bodyB===I[Mn]&&Nn.bodyA===N[Mn])&&(I.splice(Mn,1),N.splice(Mn,1))}this.collisionMatrixTick(),Ee&&(He=performance.now());var Tr=ks,kn=x.length;for(Lt=0;Lt!==kn;Lt++)Tr.push(x[Lt]);x.length=0;var $r=this.frictionEquations.length;for(Lt=0;Lt!==$r;Lt++)mt.push(this.frictionEquations[Lt]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(I,N,this,x,Tr,this.frictionEquations,mt),Ee&&(De.narrowphase=performance.now()-He),Ee&&(He=performance.now()),Lt=0;Lt<this.frictionEquations.length;Lt++)de.addEquation(this.frictionEquations[Lt]);for(var Ur=x.length,gr=0;gr!==Ur;gr++){var Fr=x[gr],$n=Fr.bi,Or=Fr.bj,_r=Fr.si,jn=Fr.sj;$n.material&&Or.material&&this.getContactMaterial($n.material,Or.material),$n.material&&Or.material&&$n.material.restitution>=0&&Or.material.restitution>=0&&(Fr.restitution=$n.material.restitution*Or.material.restitution),de.addEquation(Fr),$n.allowSleep&&$n.type===P.DYNAMIC&&$n.sleepState===P.SLEEPING&&Or.sleepState===P.AWAKE&&Or.type!==P.STATIC&&Or.velocity.lengthSquared()+Or.angularVelocity.lengthSquared()>=2*Math.pow(Or.sleepSpeedLimit,2)&&($n.wakeUpAfterNarrowphase=!0),Or.allowSleep&&Or.type===P.DYNAMIC&&Or.sleepState===P.SLEEPING&&$n.sleepState===P.AWAKE&&$n.type!==P.STATIC&&$n.velocity.lengthSquared()+$n.angularVelocity.lengthSquared()>=2*Math.pow($n.sleepSpeedLimit,2)&&(Or.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set($n,Or,!0),this.collisionMatrixPrevious.get($n,Or)||(Ga.body=Or,Ga.contact=Fr,$n.dispatchEvent(Ga),Ga.body=$n,Or.dispatchEvent(Ga)),this.bodyOverlapKeeper.set($n.id,Or.id),this.shapeOverlapKeeper.set(_r.id,jn.id)}for(this.emitContactEvents(),Ee&&(De.makeContactConstraints=performance.now()-He,He=performance.now()),Lt=0;Lt!==Y;Lt++){var Kr=se[Lt];Kr.wakeUpAfterNarrowphase&&(Kr.wakeUp(),Kr.wakeUpAfterNarrowphase=!1)}for(Jn=it.length,Lt=0;Lt!==Jn;Lt++){var xi=it[Lt];xi.update();for(var dr=0,fa=xi.equations.length;dr!==fa;dr++)de.addEquation(xi.equations[dr])}de.solve(w,this),Ee&&(De.solve=performance.now()-He),de.removeAllEquations();var hi=Math.pow;for(Lt=0;Lt!==Y;Lt++){var ai=se[Lt];if(ai.type&Ie){var Di=hi(1-ai.linearDamping,w),Gi=ai.velocity;Gi.scale(Di,Gi);var oi=ai.angularVelocity;if(oi){var pa=hi(1-ai.angularDamping,w);oi.scale(pa,oi)}}}for(this.dispatchEvent(Ns),Lt=0;Lt!==Y;Lt++){var wi=se[Lt];wi.preStep&&wi.preStep.call(wi)}Ee&&(He=performance.now());var Ji=this.stepnumber%(this.quatNormalizeSkip+1)==0,Ii=this.quatNormalizeFast;for(Lt=0;Lt!==Y;Lt++)se[Lt].integrate(w,Ji,Ii);for(this.clearForces(),this.broadphase.dirty=!0,Ee&&(De.integrate=performance.now()-He),this.time+=w,this.stepnumber+=1,this.dispatchEvent(Fs),Lt=0;Lt!==Y;Lt++){var ia=se[Lt],ho=ia.postStep;ho&&ho.call(ia)}var Da=!0;if(this.allowSleep)for(Da=!1,Lt=0;Lt!==Y;Lt++){var ii=se[Lt];ii.sleepTick(this.time),ii.sleepState!==P.SLEEPING&&(Da=!0)}this.hasActiveBodies=Da},R.clearForces=function(){for(var w=this.bodies,x=w.length,I=0;I!==x;I++){var N=w[I];N.force.set(0,0,0),N.torque.set(0,0,0)}},pe}(T),nc=(new p,new nt);if(typeof performance>"u"&&(performance={}),!performance.now){var fr=Date.now();performance.timing&&performance.timing.navigationStart&&(fr=performance.timing.navigationStart),performance.now=function(){return Date.now()-fr}}new m;var Ui,Yr,uo,Zn,ga,ya,Fs={type:"postStep"},Ns={type:"preStep"},Ga={type:P.COLLIDE_EVENT_NAME,body:null,contact:null},ks=[],qo=[],Hs=[],_n=[];ds.prototype.emitContactEvents=(Ui=[],Yr=[],uo={type:"beginContact",bodyA:null,bodyB:null},Zn={type:"endContact",bodyA:null,bodyB:null},ga={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},ya={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},function(){var Ne=this.hasAnyEventListener("beginContact"),pe=this.hasAnyEventListener("endContact");if((Ne||pe)&&this.bodyOverlapKeeper.getDiff(Ui,Yr),Ne){for(var R=0,w=Ui.length;R<w;R+=2)uo.bodyA=this.getBodyById(Ui[R]),uo.bodyB=this.getBodyById(Ui[R+1]),this.dispatchEvent(uo);uo.bodyA=uo.bodyB=null}if(pe){for(var x=0,I=Yr.length;x<I;x+=2)Zn.bodyA=this.getBodyById(Yr[x]),Zn.bodyB=this.getBodyById(Yr[x+1]),this.dispatchEvent(Zn);Zn.bodyA=Zn.bodyB=null}Ui.length=Yr.length=0;var N=this.hasAnyEventListener("beginShapeContact"),Y=this.hasAnyEventListener("endShapeContact");if((N||Y)&&this.shapeOverlapKeeper.getDiff(Ui,Yr),N){for(var se=0,de=Ui.length;se<de;se+=2){var ge=this.getShapeById(Ui[se]),Ee=this.getShapeById(Ui[se+1]);ga.shapeA=ge,ga.shapeB=Ee,ga.bodyA=ge.body,ga.bodyB=Ee.body,this.dispatchEvent(ga)}ga.bodyA=ga.bodyB=ga.shapeA=ga.shapeB=null}if(Y){for(var De=0,Ie=Yr.length;De<Ie;De+=2){var He=this.getShapeById(Yr[De]),it=this.getShapeById(Yr[De+1]);ya.shapeA=He,ya.shapeB=it,ya.bodyA=He.body,ya.bodyB=it.body,this.dispatchEvent(ya)}ya.bodyA=ya.bodyB=ya.shapeA=ya.shapeB=null}}),ue.AABB=p,ue.ArrayCollisionMatrix=E,ue.BODY_SLEEP_STATES=me,ue.BODY_TYPES={DYNAMIC:1,STATIC:2,KINEMATIC:4},ue.Body=P,ue.Box=ae,ue.Broadphase=sn,ue.COLLISION_TYPES=Hi,ue.ConeTwistConstraint=rr,ue.Constraint=vn,ue.ContactEquation=Si,ue.ContactMaterial=ta,ue.ConvexPolyhedron=q,ue.Cylinder=Gc,ue.DistanceConstraint=pi,ue.Equation=zn,ue.EventTarget=T,ue.FrictionEquation=hr,ue.GSSolver=Wl,ue.GridBroadphase=Oe,ue.Heightfield=ch,ue.HingeConstraint=cr,ue.JacobianElement=hn,ue.LockConstraint=xr,ue.Mat3=C,ue.Material=ci,ue.NaiveBroadphase=Ve,ue.Narrowphase=kr,ue.ObjectCollisionMatrix=h,ue.Particle=lh,ue.Plane=rl,ue.PointToPointConstraint=Qt,ue.Pool=Zi,ue.Quaternion=y,ue.RAY_MODES={CLOSEST:1,ANY:2,ALL:4},ue.Ray=nt,ue.RaycastResult=Ke,ue.RaycastVehicle=or,ue.RigidVehicle=qr,ue.RotationalEquation=Wt,ue.RotationalMotorEquation=ir,ue.SAPBroadphase=jt,ue.SHAPE_TYPES=O,ue.SPHSystem=nl,ue.Shape=D,ue.Solver=pr,ue.Sphere=xo,ue.SplitSolver=cn,ue.Spring=bi,ue.Transform=B,ue.Trimesh=Za,ue.Vec3=m,ue.Vec3Pool=ke,ue.World=ds},{}],5:[function(ee,be,ue){"use strict";const h=ue.TYPE={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},C=ue.FIT={ALL:"all",MANUAL:"manual"},m=(ue.HEIGHTFIELD_DATA_TYPE={short:"short",float:"float"},THREE.Object3D.prototype.hasOwnProperty("updateMatrices"));function s(g){g.fit=g.hasOwnProperty("fit")?g.fit:C.ALL,g.type=g.type||h.HULL,g.minHalfExtent=g.hasOwnProperty("minHalfExtent")?g.minHalfExtent:0,g.maxHalfExtent=g.hasOwnProperty("maxHalfExtent")?g.maxHalfExtent:Number.POSITIVE_INFINITY,g.cylinderAxis=g.cylinderAxis||"y",g.margin=g.hasOwnProperty("margin")?g.margin:.01,g.includeInvisible=!!g.hasOwnProperty("includeInvisible")&&g.includeInvisible,g.offset||(g.offset=new THREE.Vector3),g.orientation||(g.orientation=new THREE.Quaternion)}ue.createCollisionShapes=function(g,v){switch(v.type){case h.BOX:return[this.createBoxShape(g,v)];case h.CYLINDER:return[this.createCylinderShape(g,v)];case h.CAPSULE:return[this.createCapsuleShape(g,v)];case h.CONE:return[this.createConeShape(g,v)];case h.SPHERE:return[this.createSphereShape(g,v)];case h.HULL:return[this.createHullShape(g,v)];case h.HACD:return this.createHACDShapes(g,v);case h.VHACD:return this.createVHACDShapes(g,v);case h.MESH:return[this.createTriMeshShape(g,v)];case h.HEIGHTFIELD:return[this.createHeightfieldTerrainShape(g,v)];default:return console.warn(v.type+" is not currently supported"),[]}},ue.createBoxShape=function(g,v){v.type=h.BOX,s(v),v.fit===C.ALL&&(v.halfExtents=A(g,E(g,v),v.minHalfExtent,v.maxHalfExtent));const T=new Ammo.btVector3(v.halfExtents.x,v.halfExtents.y,v.halfExtents.z),y=new Ammo.btBoxShape(T);return Ammo.destroy(T),c(y,v,p(g,v)),y},ue.createCylinderShape=function(g,v){v.type=h.CYLINDER,s(v),v.fit===C.ALL&&(v.halfExtents=A(g,E(g,v),v.minHalfExtent,v.maxHalfExtent));const T=new Ammo.btVector3(v.halfExtents.x,v.halfExtents.y,v.halfExtents.z),y=(()=>{switch(v.cylinderAxis){case"y":return new Ammo.btCylinderShape(T);case"x":return new Ammo.btCylinderShapeX(T);case"z":return new Ammo.btCylinderShapeZ(T)}return null})();return Ammo.destroy(T),c(y,v,p(g,v)),y},ue.createCapsuleShape=function(g,v){v.type=h.CAPSULE,s(v),v.fit===C.ALL&&(v.halfExtents=A(g,E(g,v),v.minHalfExtent,v.maxHalfExtent));const{x:T,y,z:M}=v.halfExtents,_=(()=>{switch(v.cylinderAxis){case"y":return new Ammo.btCapsuleShape(Math.max(T,M),2*y);case"x":return new Ammo.btCapsuleShapeX(Math.max(y,M),2*T);case"z":return new Ammo.btCapsuleShapeZ(Math.max(T,y),2*M)}return null})();return c(_,v,p(g,v)),_},ue.createConeShape=function(g,v){v.type=h.CONE,s(v),v.fit===C.ALL&&(v.halfExtents=A(g,E(g,v),v.minHalfExtent,v.maxHalfExtent));const{x:T,y,z:M}=v.halfExtents,_=(()=>{switch(v.cylinderAxis){case"y":return new Ammo.btConeShape(Math.max(T,M),2*y);case"x":return new Ammo.btConeShapeX(Math.max(y,M),2*T);case"z":return new Ammo.btConeShapeZ(Math.max(T,y),2*M)}return null})();return c(_,v,p(g,v)),_},ue.createSphereShape=function(g,v){let T;v.type=h.SPHERE,s(v),T=v.fit!==C.MANUAL||isNaN(v.sphereRadius)?d(g,v,E(g,v)):v.sphereRadius;const y=new Ammo.btSphereShape(T);return c(y,v,p(g,v)),y},ue.createHullShape=function(){const g=new THREE.Vector3,v=new THREE.Vector3;return function(T,y){if(y.type=h.HULL,s(y),y.fit===C.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const M=E(T,y),_=new Ammo.btVector3,O=new Ammo.btConvexHullShape;O.setMargin(y.margin),v.addVectors(M.max,M.min).multiplyScalar(.5);let D=0;u(T,y,V=>{D+=V.attributes.position.array.length/3});const B=y.hullMaxVertices||1e5;D>B&&console.warn(`too many vertices for hull shape; sampling ~${B} from ~${D} vertices`);const H=Math.min(1,B/D);u(T,y,(V,ne)=>{const ae=V.attributes.position.array;for(let fe=0;fe<ae.length;fe+=3)Math.random()<=H&&(g.set(ae[fe],ae[fe+1],ae[fe+2]).applyMatrix4(ne).sub(v),_.setValue(g.x,g.y,g.z),O.addPoint(_,fe===ae.length-3))});let q=O;if(O.getNumVertices()>=100){const V=new Ammo.btShapeHull(O);V.buildHull(y.margin),Ammo.destroy(O),q=new Ammo.btConvexHullShape(Ammo.getPointer(V.getVertexPointer()),V.numVertices()),Ammo.destroy(V)}return Ammo.destroy(_),c(q,y,p(T,y)),q}}(),ue.createHACDShapes=function(){const g=new THREE.Vector3,v=new THREE.Vector3;return function(T,y){if(y.type=h.HACD,s(y),y.fit===C.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const M=E(T),_=p(T,y);let O=0,D=0;v.addVectors(M.max,M.min).multiplyScalar(.5),u(T,y,he=>{O+=he.attributes.position.array.length/3,D+=he.index?he.index.array.length/3:he.attributes.position.array.length/9});const B=new Ammo.HACD;y.hasOwnProperty("compacityWeight")&&B.SetCompacityWeight(y.compacityWeight),y.hasOwnProperty("volumeWeight")&&B.SetVolumeWeight(y.volumeWeight),y.hasOwnProperty("nClusters")&&B.SetNClusters(y.nClusters),y.hasOwnProperty("nVerticesPerCH")&&B.SetNVerticesPerCH(y.nVerticesPerCH),y.hasOwnProperty("concavity")&&B.SetConcavity(y.concavity);const H=Ammo._malloc(3*O*8),q=Ammo._malloc(3*D*4);B.SetPoints(H),B.SetTriangles(q),B.SetNPoints(O),B.SetNTriangles(D);const V=H/8,ne=q/4;u(T,y,(he,me)=>{const P=he.attributes.position.array,X=he.index?he.index.array:null;for(let W=0;W<P.length;W+=3)g.set(P[W+0],P[W+1],P[W+2]).applyMatrix4(me).sub(v),Ammo.HEAPF64[V+W+0]=g.x,Ammo.HEAPF64[V+W+1]=g.y,Ammo.HEAPF64[V+W+2]=g.z;if(X)for(let W=0;W<X.length;W++)Ammo.HEAP32[ne+W]=X[W];else for(let W=0;W<P.length/3;W++)Ammo.HEAP32[ne+W]=W}),B.Compute(),Ammo._free(H),Ammo._free(q);const ae=B.GetNClusters(),fe=[];for(let he=0;he<ae;he++){const me=new Ammo.btConvexHullShape;me.setMargin(y.margin);const P=B.GetNPointsCH(he),X=B.GetNTrianglesCH(he),W=Ammo._malloc(3*P*8),te=Ammo._malloc(3*X*4);B.GetCH(he,W,te);const ce=W/8;for(let Se=0;Se<P;Se++){const _e=new Ammo.btVector3,ze=Ammo.HEAPF64[ce+3*Se+0],rt=Ammo.HEAPF64[ce+3*Se+1],gt=Ammo.HEAPF64[ce+3*Se+2];_e.setValue(ze,rt,gt),me.addPoint(_e,Se===P-1),Ammo.destroy(_e)}c(me,y,_),fe.push(me)}return fe}}(),ue.createVHACDShapes=function(){const g=new THREE.Vector3,v=new THREE.Vector3;return function(T,y){if(y.type=h.VHACD,s(y),y.fit===C.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const M=E(T,y),_=p(T,y);let O=0,D=0;v.addVectors(M.max,M.min).multiplyScalar(.5),u(T,y,P=>{O+=P.attributes.position.count,D+=P.index?P.index.count/3:P.attributes.position.count/3});const B=new Ammo.VHACD,H=new Ammo.Parameters;y.hasOwnProperty("resolution")&&H.set_m_resolution(y.resolution),y.hasOwnProperty("depth")&&H.set_m_depth(y.depth),y.hasOwnProperty("concavity")&&H.set_m_concavity(y.concavity),y.hasOwnProperty("planeDownsampling")&&H.set_m_planeDownsampling(y.planeDownsampling),y.hasOwnProperty("convexhullDownsampling")&&H.set_m_convexhullDownsampling(y.convexhullDownsampling),y.hasOwnProperty("alpha")&&H.set_m_alpha(y.alpha),y.hasOwnProperty("beta")&&H.set_m_beta(y.beta),y.hasOwnProperty("gamma")&&H.set_m_gamma(y.gamma),y.hasOwnProperty("pca")&&H.set_m_pca(y.pca),y.hasOwnProperty("mode")&&H.set_m_mode(y.mode),y.hasOwnProperty("maxNumVerticesPerCH")&&H.set_m_maxNumVerticesPerCH(y.maxNumVerticesPerCH),y.hasOwnProperty("minVolumePerCH")&&H.set_m_minVolumePerCH(y.minVolumePerCH),y.hasOwnProperty("convexhullApproximation")&&H.set_m_convexhullApproximation(y.convexhullApproximation),y.hasOwnProperty("oclAcceleration")&&H.set_m_oclAcceleration(y.oclAcceleration);const q=Ammo._malloc(3*O*8),V=Ammo._malloc(3*D*4);let ne=q/8,ae=V/4;u(T,y,(P,X)=>{const W=P.attributes.position.array,te=P.index?P.index.array:null;for(let ce=0;ce<W.length;ce+=3)g.set(W[ce+0],W[ce+1],W[ce+2]).applyMatrix4(X).sub(v),Ammo.HEAPF64[ne+0]=g.x,Ammo.HEAPF64[ne+1]=g.y,Ammo.HEAPF64[ne+2]=g.z,ne+=3;if(te)for(let ce=0;ce<te.length;ce++)Ammo.HEAP32[ae]=te[ce],ae++;else for(let ce=0;ce<W.length/3;ce++)Ammo.HEAP32[ae]=ce,ae++}),B.Compute(q,3,O,V,3,D,H),Ammo._free(q),Ammo._free(V);const fe=B.GetNConvexHulls(),he=[],me=new Ammo.ConvexHull;for(let P=0;P<fe;P++){B.GetConvexHull(P,me);const X=me.get_m_nPoints(),W=(me.get_m_points(),new Ammo.btConvexHullShape);W.setMargin(y.margin);for(let te=0;te<X;te++){const ce=new Ammo.btVector3,Se=me.get_m_points(3*te+0),_e=me.get_m_points(3*te+1),ze=me.get_m_points(3*te+2);ce.setValue(Se,_e,ze),W.addPoint(ce,te===X-1),Ammo.destroy(ce)}c(W,y,_),he.push(W)}return Ammo.destroy(me),Ammo.destroy(B),he}}(),ue.createTriMeshShape=function(){const g=new THREE.Vector3,v=new THREE.Vector3,T=new THREE.Vector3;return function(y,M){if(M.type=h.MESH,s(M),M.fit===C.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const _=p(y,M),O=new Ammo.btVector3,D=new Ammo.btVector3,B=new Ammo.btVector3,H=new Ammo.btTriangleMesh(!0,!1);u(y,M,(ne,ae)=>{const fe=ne.attributes.position.array;if(ne.index)for(let he=0;he<ne.index.count;he+=3){const me=3*ne.index.array[he],P=3*ne.index.array[he+1],X=3*ne.index.array[he+2];g.set(fe[me],fe[me+1],fe[me+2]).applyMatrix4(ae),v.set(fe[P],fe[P+1],fe[P+2]).applyMatrix4(ae),T.set(fe[X],fe[X+1],fe[X+2]).applyMatrix4(ae),O.setValue(g.x,g.y,g.z),D.setValue(v.x,v.y,v.z),B.setValue(T.x,T.y,T.z),H.addTriangle(O,D,B,!1)}else for(let he=0;he<fe.length;he+=9)g.set(fe[he+0],fe[he+1],fe[he+2]).applyMatrix4(ae),v.set(fe[he+3],fe[he+4],fe[he+5]).applyMatrix4(ae),T.set(fe[he+6],fe[he+7],fe[he+8]).applyMatrix4(ae),O.setValue(g.x,g.y,g.z),D.setValue(v.x,v.y,v.z),B.setValue(T.x,T.y,T.z),H.addTriangle(O,D,B,!1)});const q=new Ammo.btVector3(_.x,_.y,_.z);H.setScaling(q),Ammo.destroy(q);const V=new Ammo.btBvhTriangleMeshShape(H,!0,!0);return V.resources=[H],Ammo.destroy(O),Ammo.destroy(D),Ammo.destroy(B),c(V,M),V}}(),ue.createHeightfieldTerrainShape=function(g,v){if(s(v),v.fit===C.ALL)return console.warn("cannot use fit: all with type: heightfield"),null;const T=v.heightfieldDistance||1,y=v.heightfieldData||[],M=v.heightScale||0,_=v.hasOwnProperty("upAxis")?v.upAxis:1,O="short"===v.heightDataType?Ammo.PHY_SHORT:Ammo.PHY_FLOAT,D=!v.hasOwnProperty("flipQuadEdges")||v.flipQuadEdges,B=y.length,H=B>0?y[0].length:0,q=Ammo._malloc(B*H*4),V=q/4;let ne=Number.POSITIVE_INFINITY,ae=Number.NEGATIVE_INFINITY,fe=0;for(let P=0;P<B;P++)for(let X=0;X<H;X++){const W=y[P][X];Ammo.HEAPF32[V+fe]=W,fe++,ne=Math.min(ne,W),ae=Math.max(ae,W)}const he=new Ammo.btHeightfieldTerrainShape(H,B,q,M,ne,ae,_,O,D),me=new Ammo.btVector3(T,1,T);return he.setLocalScaling(me),Ammo.destroy(me),he.heightfieldData=q,c(he,v),he};const c=function(g,v,T){g.type=v.type,g.setMargin(v.margin),g.destroy=()=>{for(let _ of g.resources||[])Ammo.destroy(_);g.heightfieldData&&Ammo._free(g.heightfieldData),Ammo.destroy(g)};const y=new Ammo.btTransform,M=new Ammo.btQuaternion;if(y.setIdentity(),y.getOrigin().setValue(v.offset.x,v.offset.y,v.offset.z),M.setValue(v.orientation.x,v.orientation.y,v.orientation.z,v.orientation.w),y.setRotation(M),Ammo.destroy(M),T){const _=new Ammo.btVector3(T.x,T.y,T.z);g.setLocalScaling(_),Ammo.destroy(_)}g.localTransform=y},u=function(){const g=new THREE.Matrix4,v=new THREE.Matrix4,T=new THREE.BufferGeometry;return function(y,M,_){v.getInverse(y.matrixWorld),y.traverse(O=>{!O.isMesh||THREE.Sky&&O.__proto__==THREE.Sky.prototype||!(M.includeInvisible||O.el&&O.el.object3D.visible||O.visible)||(O===y?g.identity():(m&&O.updateMatrices(),g.multiplyMatrices(v,O.matrixWorld)),_(O.geometry.isBufferGeometry?O.geometry:T.fromGeometry(O.geometry),g))})}}(),p=function(g,v){const T=new THREE.Vector3(1,1,1);return v.fit===C.ALL&&T.setFromMatrixScale(g.matrixWorld),T},d=function(){const g=new THREE.Vector3,v=new THREE.Vector3;return function(T,y,M){let _=0,{x:O,y:D,z:B}=M.getCenter(v);return u(T,y,(H,q)=>{const V=H.attributes.position.array;for(let ne=0;ne<V.length;ne+=3){g.set(V[ne],V[ne+1],V[ne+2]).applyMatrix4(q);const ae=O-g.x,fe=D-g.y,he=B-g.z;_=Math.max(_,ae*ae+fe*fe+he*he)}}),Math.sqrt(_)}}(),A=function(g,v,T,y){return(new THREE.Vector3).subVectors(v.max,v.min).multiplyScalar(.5).clampScalar(T,y)},E=function(){const g=new THREE.Vector3;return function(v,T){const y=new THREE.Box3;let M=1/0,_=1/0,O=1/0,D=-1/0,B=-1/0,H=-1/0;return y.min.set(0,0,0),y.max.set(0,0,0),u(v,T,(q,V)=>{const ne=q.attributes.position.array;for(let ae=0;ae<ne.length;ae+=3)g.set(ne[ae],ne[ae+1],ne[ae+2]).applyMatrix4(V),g.x<M&&(M=g.x),g.y<_&&(_=g.y),g.z<O&&(O=g.z),g.x>D&&(D=g.x),g.y>B&&(B=g.y),g.z>H&&(H=g.z)}),y.min.set(M,_,O),y.max.set(D,B,H),y}}()},{}],6:[function(ee,be,ue){(function(h){var C=ee("cannon-es"),m=typeof window<"u"?window.THREE:void 0!==h?h.THREE:null,s=function(){var v,T,y,M,_=new m.Vector3;function O(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new q,this.unassigned=new q,this.vertices=[]}function D(){this.normal=new m.Vector3,this.midpoint=new m.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function B(V,ne){this.vertex=V,this.prev=null,this.next=null,this.twin=null,this.face=ne}function H(V){this.point=V,this.prev=null,this.next=null,this.face=null}function q(){this.head=null,this.tail=null}return Object.assign(O.prototype,{setFromPoints:function(V){!0!==Array.isArray(V)&&console.error("THREE.ConvexHull: Points parameter is not an array."),V.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var ne=0,ae=V.length;ne<ae;ne++)this.vertices.push(new H(V[ne]));return this.compute(),this},setFromObject:function(V){var ne=[];return V.updateMatrixWorld(!0),V.traverse(function(ae){var fe,he,me,P=ae.geometry;if(void 0!==P)if(P.isGeometry){var X=P.vertices;for(fe=0,he=X.length;fe<he;fe++)(me=X[fe].clone()).applyMatrix4(ae.matrixWorld),ne.push(me)}else if(P.isBufferGeometry){var W=P.attributes.position;if(void 0!==W)for(fe=0,he=W.count;fe<he;fe++)(me=new m.Vector3).fromBufferAttribute(W,fe).applyMatrix4(ae.matrixWorld),ne.push(me)}}),this.setFromPoints(ne)},containsPoint:function(V){for(var ne=this.faces,ae=0,fe=ne.length;ae<fe;ae++)if(ne[ae].distanceToPoint(V)>this.tolerance)return!1;return!0},intersectRay:function(V,ne){for(var ae=this.faces,fe=-1/0,he=1/0,me=0,P=ae.length;me<P;me++){var X=ae[me],W=X.distanceToPoint(V.origin),te=X.normal.dot(V.direction);if(W>0&&te>=0)return null;var ce=0!==te?-W/te:0;if(!(ce<=0)&&(te>0?he=Math.min(ce,he):fe=Math.max(ce,fe),fe>he))return null}return V.at(-1/0!==fe?fe:he,ne),ne},intersectsRay:function(V){return null!==this.intersectRay(V,_)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(V,ne){return V.face=ne,null===ne.outside?this.assigned.append(V):this.assigned.insertBefore(ne.outside,V),ne.outside=V,this},removeVertexFromFace:function(V,ne){return V===ne.outside&&(ne.outside=null!==V.next&&V.next.face===ne?V.next:null),this.assigned.remove(V),this},removeAllVerticesFromFace:function(V){if(null!==V.outside){for(var ne=V.outside,ae=V.outside;null!==ae.next&&ae.next.face===V;)ae=ae.next;return this.assigned.removeSubList(ne,ae),ne.prev=ae.next=null,V.outside=null,ne}},deleteFaceVertices:function(V,ne){var ae=this.removeAllVerticesFromFace(V);if(void 0!==ae)if(void 0===ne)this.unassigned.appendChain(ae);else{var fe=ae;do{var he=fe.next;ne.distanceToPoint(fe.point)>this.tolerance?this.addVertexToFace(fe,ne):this.unassigned.append(fe),fe=he}while(null!==fe)}return this},resolveUnassignedPoints:function(V){if(!1===this.unassigned.isEmpty()){var ne=this.unassigned.first();do{for(var ae=ne.next,fe=this.tolerance,he=null,me=0;me<V.length;me++){var P=V[me];if(0===P.mark){var X=P.distanceToPoint(ne.point);if(X>fe&&(fe=X,he=P),fe>1e3*this.tolerance)break}}null!==he&&this.addVertexToFace(ne,he),ne=ae}while(null!==ne)}return this},computeExtremes:function(){var V,ne,ae,fe=new m.Vector3,he=new m.Vector3,me=[],P=[];for(V=0;V<3;V++)me[V]=P[V]=this.vertices[0];for(fe.copy(this.vertices[0].point),he.copy(this.vertices[0].point),V=0,ne=this.vertices.length;V<ne;V++){var X=this.vertices[V],W=X.point;for(ae=0;ae<3;ae++)W.getComponent(ae)<fe.getComponent(ae)&&(fe.setComponent(ae,W.getComponent(ae)),me[ae]=X);for(ae=0;ae<3;ae++)W.getComponent(ae)>he.getComponent(ae)&&(he.setComponent(ae,W.getComponent(ae)),P[ae]=X)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(fe.x),Math.abs(he.x))+Math.max(Math.abs(fe.y),Math.abs(he.y))+Math.max(Math.abs(fe.z),Math.abs(he.z))),{min:me,max:P}},computeInitialHull:function(){void 0===v&&(v=new m.Line3,T=new m.Plane,y=new m.Vector3);var V,ne,ae,fe,he,me,P,X,W,te=this.vertices,ce=this.computeExtremes(),Se=ce.min,_e=ce.max,ze=0,rt=0;for(me=0;me<3;me++)(W=_e[me].point.getComponent(me)-Se[me].point.getComponent(me))>ze&&(ze=W,rt=me);for(ze=0,v.set((ne=Se[rt]).point,(ae=_e[rt]).point),me=0,P=this.vertices.length;me<P;me++)(V=te[me])!==ne&&V!==ae&&(v.closestPointToPoint(V.point,!0,y),(W=y.distanceToSquared(V.point))>ze&&(ze=W,fe=V));for(ze=-1,T.setFromCoplanarPoints(ne.point,ae.point,fe.point),me=0,P=this.vertices.length;me<P;me++)(V=te[me])!==ne&&V!==ae&&V!==fe&&(W=Math.abs(T.distanceToPoint(V.point)))>ze&&(ze=W,he=V);var gt=[];if(T.distanceToPoint(he.point)<0)for(gt.push(D.create(ne,ae,fe),D.create(he,ae,ne),D.create(he,fe,ae),D.create(he,ne,fe)),me=0;me<3;me++)X=(me+1)%3,gt[me+1].getEdge(2).setTwin(gt[0].getEdge(X)),gt[me+1].getEdge(1).setTwin(gt[X+1].getEdge(0));else for(gt.push(D.create(ne,fe,ae),D.create(he,ne,ae),D.create(he,ae,fe),D.create(he,fe,ne)),me=0;me<3;me++)X=(me+1)%3,gt[me+1].getEdge(2).setTwin(gt[0].getEdge((3-me)%3)),gt[me+1].getEdge(0).setTwin(gt[X+1].getEdge(1));for(me=0;me<4;me++)this.faces.push(gt[me]);for(me=0,P=te.length;me<P;me++)if((V=te[me])!==ne&&V!==ae&&V!==fe&&V!==he){ze=this.tolerance;var Tt=null;for(X=0;X<4;X++)(W=this.faces[X].distanceToPoint(V.point))>ze&&(ze=W,Tt=this.faces[X]);null!==Tt&&this.addVertexToFace(V,Tt)}return this},reindexFaces:function(){for(var V=[],ne=0;ne<this.faces.length;ne++){var ae=this.faces[ne];0===ae.mark&&V.push(ae)}return this.faces=V,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var V,ne=0,ae=this.assigned.first().face,fe=ae.outside;do{var he=ae.distanceToPoint(fe.point);he>ne&&(ne=he,V=fe),fe=fe.next}while(null!==fe&&fe.face===ae);return V}},computeHorizon:function(V,ne,ae,fe){var he;this.deleteFaceVertices(ae),ae.mark=1,he=null===ne?ne=ae.getEdge(0):ne.next;do{var me=he.twin,P=me.face;0===P.mark&&(P.distanceToPoint(V)>this.tolerance?this.computeHorizon(V,me,P,fe):fe.push(he)),he=he.next}while(he!==ne);return this},addAdjoiningFace:function(V,ne){var ae=D.create(V,ne.tail(),ne.head());return this.faces.push(ae),ae.getEdge(-1).setTwin(ne.twin),ae.getEdge(0)},addNewFaces:function(V,ne){this.newFaces=[];for(var ae=null,fe=null,he=0;he<ne.length;he++){var me=this.addAdjoiningFace(V,ne[he]);null===ae?ae=me:me.next.setTwin(fe),this.newFaces.push(me.face),fe=me}return ae.next.setTwin(fe),this},addVertexToHull:function(V){var ne=[];return this.unassigned.clear(),this.removeVertexFromFace(V,V.face),this.computeHorizon(V.point,null,V.face,ne),this.addNewFaces(V,ne),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var V;for(this.computeInitialHull();void 0!==(V=this.nextVertexToAdd());)this.addVertexToHull(V);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(D,{create:function(V,ne,ae){var fe=new D,he=new B(V,fe),me=new B(ne,fe),P=new B(ae,fe);return he.next=P.prev=me,me.next=he.prev=P,P.next=me.prev=he,fe.edge=he,fe.compute()}}),Object.assign(D.prototype,{getEdge:function(V){for(var ne=this.edge;V>0;)ne=ne.next,V--;for(;V<0;)ne=ne.prev,V++;return ne},compute:function(){void 0===M&&(M=new m.Triangle);var V=this.edge.tail(),ne=this.edge.head(),ae=this.edge.next.head();return M.set(V.point,ne.point,ae.point),M.getNormal(this.normal),M.getMidpoint(this.midpoint),this.area=M.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(V){return this.normal.dot(V)-this.constant}}),Object.assign(B.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var V=this.head(),ne=this.tail();return null!==ne?ne.point.distanceTo(V.point):-1},lengthSquared:function(){var V=this.head(),ne=this.tail();return null!==ne?ne.point.distanceToSquared(V.point):-1},setTwin:function(V){return this.twin=V,V.twin=this,this}}),Object.assign(q.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(V,ne){return ne.prev=V.prev,ne.next=V,null===ne.prev?this.head=ne:ne.prev.next=ne,V.prev=ne,this},insertAfter:function(V,ne){return ne.prev=V,ne.next=V.next,null===ne.next?this.tail=ne:ne.next.prev=ne,V.next=ne,this},append:function(V){return null===this.head?this.head=V:this.tail.next=V,V.prev=this.tail,V.next=null,this.tail=V,this},appendChain:function(V){for(null===this.head?this.head=V:this.tail.next=V,V.prev=this.tail;null!==V.next;)V=V.next;return this.tail=V,this},remove:function(V){return null===V.prev?this.head=V.next:V.prev.next=V.next,null===V.next?this.tail=V.prev:V.next.prev=V.prev,this},removeSubList:function(V,ne){return null===V.prev?this.head=ne.next:V.prev.next=ne.next,null===ne.next?this.tail=V.prev:ne.next.prev=V.prev,this},isEmpty:function(){return null===this.head}}),O}(),c=Math.PI/2,u={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},p=function(v,T){var y,M,_,O;if((T=T||{}).type===u.BOX)return A(v);if(T.type===u.CYLINDER)return function(M,_){var O=["x","y","z"],D=_.cylinderAxis||"y",B=O.splice(O.indexOf(D),1)&&O,H=(new m.Box3).setFromObject(M);if(!isFinite(H.min.lengthSq()))return null;var q=H.max[D]-H.min[D],V=.5*Math.max(H.max[B[0]]-H.min[B[0]],H.max[B[1]]-H.min[B[1]]),ne=new C.Cylinder(V,V,q,12);return ne._type=C.Shape.types.CYLINDER,ne.radiusTop=V,ne.radiusBottom=V,ne.height=q,ne.numSegments=12,ne.orientation=new C.Quaternion,ne.orientation.setFromEuler("y"===D?c:0,"z"===D?c:0,0,"XYZ").normalize(),ne}(v,T);if(T.type===u.SPHERE)return function(M,_){if(_.sphereRadius)return new C.Sphere(_.sphereRadius);var O=E(M);return O?(O.computeBoundingSphere(),new C.Sphere(O.boundingSphere.radius)):null}(v,T);if(T.type===u.HULL)return function(M){var _=E(M);if(!_||!_.vertices.length)return null;for(var O=0;O<_.vertices.length;O++)_.vertices[O].x+=1e-4*(Math.random()-.5),_.vertices[O].y+=1e-4*(Math.random()-.5),_.vertices[O].z+=1e-4*(Math.random()-.5);var D=(new s).setFromObject(new m.Mesh(_)).faces,B=[],H=[];for(O=0;O<D.length;O++){var q=D[O],V=q.edge;do{var ne=V.head().point;B.push(new C.Vec3(ne.x,ne.y,ne.z)),H.push(new C.Vec3(q.normal.x,q.normal.y,q.normal.z)),V=V.next}while(V!==q.edge)}return new C.ConvexPolyhedron({vertices:B,normals:H})}(v);if(T.type===u.MESH)return(y=E(v))?function(M){var _=g(y);if(!_.length)return null;var O=Object.keys(_).map(Number);return new C.Trimesh(_,O)}():null;if(T.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',T.type);if(!(y=E(v)))return null;switch(y.metadata?y.metadata.type:y.type){case"BoxGeometry":case"BoxBufferGeometry":return d(y);case"CylinderGeometry":case"CylinderBufferGeometry":return(O=new C.Cylinder((_=(M=y).metadata?M.metadata.parameters:M.parameters).radiusTop,_.radiusBottom,_.height,_.radialSegments))._type=C.Shape.types.CYLINDER,O.radiusTop=_.radiusTop,O.radiusBottom=_.radiusBottom,O.height=_.height,O.numSegments=_.radialSegments,O.orientation=new C.Quaternion,O.orientation.setFromEuler(m.Math.degToRad(-90),0,0,"XYZ").normalize(),O;case"PlaneGeometry":case"PlaneBufferGeometry":return function(M){M.computeBoundingBox();var _=M.boundingBox;return new C.Box(new C.Vec3((_.max.x-_.min.x)/2||.1,(_.max.y-_.min.y)/2||.1,(_.max.z-_.min.z)/2||.1))}(y);case"SphereGeometry":case"SphereBufferGeometry":return function(M){return new C.Sphere((M.metadata?M.metadata.parameters:M.parameters).radius)}(y);case"TubeGeometry":case"Geometry":case"BufferGeometry":return A(v);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',y.type),d(y)}};function d(v){if(!g(v).length)return null;v.computeBoundingBox();var T=v.boundingBox;return new C.Box(new C.Vec3((T.max.x-T.min.x)/2,(T.max.y-T.min.y)/2,(T.max.z-T.min.z)/2))}function A(v){var T=v.clone();T.quaternion.set(0,0,0,1),T.updateMatrixWorld();var y=(new m.Box3).setFromObject(T);if(!isFinite(y.min.lengthSq()))return null;var M=new C.Box(new C.Vec3((y.max.x-y.min.x)/2,(y.max.y-y.min.y)/2,(y.max.z-y.min.z)/2)),_=y.translate(T.position.negate()).getCenter(new m.Vector3);return _.lengthSq()&&(M.offset=_),M}function E(v){var T,ne,y=(ne=[],v.traverse(function(ae){"Mesh"===ae.type&&ne.push(ae)}),ne),M=new m.Geometry,_=new m.Geometry;if(0===y.length)return null;if(1===y.length){var O=new m.Vector3,D=new m.Quaternion,B=new m.Vector3;return y[0].geometry.isBufferGeometry?y[0].geometry.attributes.position&&y[0].geometry.attributes.position.itemSize>2&&M.fromBufferGeometry(y[0].geometry):M=y[0].geometry.clone(),M.metadata=y[0].geometry.metadata,y[0].updateMatrixWorld(),y[0].matrixWorld.decompose(O,D,B),M.scale(B.x,B.y,B.z)}for(;T=y.pop();)if(T.updateMatrixWorld(),T.geometry.isBufferGeometry){if(T.geometry.attributes.position&&T.geometry.attributes.position.itemSize>2){var H=new m.Geometry;H.fromBufferGeometry(T.geometry),_.merge(H,T.matrixWorld),H.dispose()}}else _.merge(T.geometry,T.matrixWorld);var q=new m.Matrix4;return q.scale(v.scale),_.applyMatrix(q),_}function g(v){return v.attributes||(v=(new m.BufferGeometry).fromGeometry(v)),(v.attributes.position||{}).array||[]}p.Type=u,ue.threeToCannon=p}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"cannon-es":4}],7:[function(ee,be,ue){var h=arguments[3],C=arguments[4],m=arguments[5],s=JSON.stringify;be.exports=function(c,u){for(var p,d=Object.keys(m),A=0,E=d.length;A<E;A++){var g=d[A],v=m[g].exports;if(v===c||v&&v.default===c){p=g;break}}if(!p){p=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var T={};for(A=0,E=d.length;A<E;A++)T[g=d[A]]=g;C[p]=[Function(["require","module","exports"],"("+c+")(self)"),T]}var y=Math.floor(Math.pow(16,8)*Math.random()).toString(16),M={};M[p]=p,C[y]=[Function(["require"],"var f = require("+s(p)+");(f.default ? f.default : f)(self);"),M];var _={};!function V(ne){for(var ae in _[ne]=!0,C[ne][1]){var fe=C[ne][1][ae];_[fe]||V(fe)}}(y);var O="("+h+")({"+Object.keys(_).map(function(V){return s(V)+":["+C[V][0]+","+s(C[V][1])+"]"}).join(",")+"},{},["+s(y)+"])",D=window.URL||window.webkitURL||window.mozURL||window.msURL,B=new Blob([O],{type:"text/javascript"});if(u&&u.bare)return B;var H=D.createObjectURL(B),q=new Worker(H);return q.objectURL=H,q}},{}],8:[function(ee,be,ue){const h=ee("../constants").CONSTRAINT;be.exports=AFRAME.registerComponent("ammo-constraint",{multiple:!0,schema:{type:{default:h.LOCK,oneOf:[h.LOCK,h.FIXED,h.SPRING,h.SLIDER,h.HINGE,h.CONE_TWIST,h.POINT_TO_POINT]},target:{type:"selector"},pivot:{type:"vec3"},targetPivot:{type:"vec3"},axis:{type:"vec3",default:{x:0,y:0,z:1}},targetAxis:{type:"vec3",default:{x:0,y:0,z:1}}},init:function(){this.system=this.el.sceneEl.systems.physics,this.constraint=null},remove:function(){this.constraint&&(this.system.removeConstraint(this.constraint),this.constraint=null)},update:function(){const C=this.el,m=this.data;this.remove(),C.body&&m.target.body?(this.constraint=this.createConstraint(),this.system.addConstraint(this.constraint)):(C.body?m.target:C).addEventListener("body-loaded",this.update.bind(this,{}),{once:!0})},createConstraint:function(){let C;const m=this.data,s=this.el.body,c=m.target.body,u=s.getCenterOfMassTransform().invert().op_mul(c.getWorldTransform()),p=new Ammo.btTransform;switch(p.setIdentity(),m.type){case h.LOCK:{C=new Ammo.btGeneric6DofConstraint(s,c,u,p,!0);const d=new Ammo.btVector3(0,0,0);C.setLinearLowerLimit(d),C.setLinearUpperLimit(d),C.setAngularLowerLimit(d),C.setAngularUpperLimit(d),Ammo.destroy(d);break}case h.FIXED:u.setRotation(s.getWorldTransform().getRotation()),p.setRotation(c.getWorldTransform().getRotation()),C=new Ammo.btFixedConstraint(s,c,u,p);break;case h.SPRING:C=new Ammo.btGeneric6DofSpringConstraint(s,c,u,p,!0);break;case h.SLIDER:(C=new Ammo.btSliderConstraint(s,c,u,p,!0)).setLowerLinLimit(-1),C.setUpperLinLimit(1);break;case h.HINGE:{const d=new Ammo.btVector3(m.pivot.x,m.pivot.y,m.pivot.z),A=new Ammo.btVector3(m.targetPivot.x,m.targetPivot.y,m.targetPivot.z),E=new Ammo.btVector3(m.axis.x,m.axis.y,m.axis.z),g=new Ammo.btVector3(m.targetAxis.x,m.targetAxis.y,m.targetAxis.z);C=new Ammo.btHingeConstraint(s,c,d,A,E,g,!0),Ammo.destroy(d),Ammo.destroy(A),Ammo.destroy(E),Ammo.destroy(g);break}case h.CONE_TWIST:{const d=new Ammo.btTransform;d.setIdentity(),d.getOrigin().setValue(m.pivot.x,m.pivot.y,m.pivot.z);const A=new Ammo.btTransform;A.setIdentity(),A.getOrigin().setValue(m.targetPivot.x,m.targetPivot.y,m.targetPivot.z),C=new Ammo.btConeTwistConstraint(s,c,d,A),Ammo.destroy(d),Ammo.destroy(A);break}case h.POINT_TO_POINT:{const d=new Ammo.btVector3(m.pivot.x,m.pivot.y,m.pivot.z),A=new Ammo.btVector3(m.targetPivot.x,m.targetPivot.y,m.targetPivot.z);C=new Ammo.btPoint2PointConstraint(s,c,d,A),Ammo.destroy(d),Ammo.destroy(A);break}default:throw new Error("[constraint] Unexpected type: "+m.type)}return Ammo.destroy(u),Ammo.destroy(p),C}})},{"../constants":19}],9:[function(ee,be,ue){ee("ammo-debug-drawer");const h=ee("three-to-ammo"),C=ee("../../constants"),m=C.ACTIVATION_STATE,s=C.COLLISION_FLAG,c=C.SHAPE,u=C.TYPE,p=[m.ACTIVE_TAG,m.ISLAND_SLEEPING,m.WANTS_DEACTIVATION,m.DISABLE_DEACTIVATION,m.DISABLE_SIMULATION];function E(T,y,M){return Math.abs(y.x-M.x)<T&&Math.abs(y.y-M.y)<T&&Math.abs(y.z-M.z)<T}function g(T,y,M){return Math.abs(y.x()-M.x())<T&&Math.abs(y.y()-M.y())<T&&Math.abs(y.z()-M.z())<T}let v={schema:{loadedEvent:{default:""},mass:{default:1},gravity:{type:"vec3",default:{x:0,y:-9.8,z:0}},linearDamping:{default:.01},angularDamping:{default:.01},linearSleepingThreshold:{default:1.6},angularSleepingThreshold:{default:2.5},angularFactor:{type:"vec3",default:{x:1,y:1,z:1}},activationState:{default:m.ACTIVE_TAG,oneOf:p},type:{default:"dynamic",oneOf:[u.STATIC,u.DYNAMIC,u.KINEMATIC]},emitCollisionEvents:{default:!1},disableCollision:{default:!1},collisionFilterGroup:{default:1},collisionFilterMask:{default:1},scaleAutoUpdate:{default:!0}},init:function(){this.system=this.el.sceneEl.systems.physics,this.shapeComponents=[],""===this.data.loadedEvent?this.loadedEventFired=!0:this.el.addEventListener(this.data.loadedEvent,()=>{this.loadedEventFired=!0},{once:!0}),this.system.initialized&&this.loadedEventFired&&this.initBody()},initBody:function(){const T=new THREE.Vector3,y=new THREE.Quaternion;return new THREE.Box3,function(){const M=this.el,_=this.data;this.localScaling=new Ammo.btVector3;const O=this.el.object3D;O.getWorldPosition(T),O.getWorldQuaternion(y),this.prevScale=new THREE.Vector3(1,1,1),this.prevNumChildShapes=0,this.msTransform=new Ammo.btTransform,this.msTransform.setIdentity(),this.rotation=new Ammo.btQuaternion(y.x,y.y,y.z,y.w),this.msTransform.getOrigin().setValue(T.x,T.y,T.z),this.msTransform.setRotation(this.rotation),this.motionState=new Ammo.btDefaultMotionState(this.msTransform),this.localInertia=new Ammo.btVector3(0,0,0),this.compoundShape=new Ammo.btCompoundShape(!0),this.rbInfo=new Ammo.btRigidBodyConstructionInfo(_.mass,this.motionState,this.compoundShape,this.localInertia),this.body=new Ammo.btRigidBody(this.rbInfo),this.body.setActivationState(p.indexOf(_.activationState)+1),this.body.setSleepingThresholds(_.linearSleepingThreshold,_.angularSleepingThreshold),this.body.setDamping(_.linearDamping,_.angularDamping);const D=new Ammo.btVector3(_.angularFactor.x,_.angularFactor.y,_.angularFactor.z);this.body.setAngularFactor(D),Ammo.destroy(D);const B=new Ammo.btVector3(_.gravity.x,_.gravity.y,_.gravity.z);g(.001,B,this.system.driver.physicsWorld.getGravity())||(this.body.setGravity(B),this.body.setFlags(1)),Ammo.destroy(B),this.updateCollisionFlags(),this.el.body=this.body,this.body.el=M,this.isLoaded=!0,this.el.emit("body-loaded",{body:this.el.body}),this._addToSystem()}}(),tick:function(){this.system.initialized&&!this.isLoaded&&this.loadedEventFired&&this.initBody()},_updateShapes:function(){const T=[c.HULL,c.HACD,c.VHACD];return function(){let y=!1;const M=this.el.object3D;if(this.data.scaleAutoUpdate&&this.prevScale&&!E(.001,M.scale,this.prevScale)&&(this.prevScale.copy(M.scale),y=!0,this.localScaling.setValue(this.prevScale.x,this.prevScale.y,this.prevScale.z),this.compoundShape.setLocalScaling(this.localScaling)),this.shapeComponentsChanged){this.shapeComponentsChanged=!1,y=!0;for(let _=0;_<this.shapeComponents.length;_++){const O=this.shapeComponents[_];0===O.getShapes().length&&this._createCollisionShape(O);const D=O.getShapes();for(let B=0;B<D.length;B++){const H=D[B];H.added||(this.compoundShape.addChildShape(H.localTransform,H),H.added=!0)}}this.data.type===u.DYNAMIC&&this.updateMass(),this.system.driver.updateBody(this.body)}if(this.system.debug&&(y||!this.polyHedralFeaturesInitialized)){for(let _=0;_<this.shapeComponents.length;_++){const O=this.shapeComponents[_].getShapes();for(let D=0;D<O.length;D++){const B=O[D];-1!==T.indexOf(B.type)&&B.initializePolyhedralFeatures(0)}}this.polyHedralFeaturesInitialized=!0}}}(),_createCollisionShape:function(T){const y=T.data,M=h.createCollisionShapes(T.getMesh(),y);T.addShapes(M)},play:function(){this.isLoaded&&this._addToSystem()},_addToSystem:function(){this.addedToSystem||(this.system.addBody(this.body,this.data.collisionFilterGroup,this.data.collisionFilterMask),this.data.emitCollisionEvents&&this.system.driver.addEventListener(this.body),this.system.addComponent(this),this.addedToSystem=!0)},pause:function(){this.addedToSystem&&(this.system.removeComponent(this),this.system.removeBody(this.body),this.addedToSystem=!1)},update:function(T){if(this.isLoaded){if(!this.hasUpdated)return void(this.hasUpdated=!0);const y=this.data;if(T.type===y.type&&T.disableCollision===y.disableCollision||this.updateCollisionFlags(),T.activationState!==y.activationState&&(this.body.forceActivationState(p.indexOf(y.activationState)+1),y.activationState===m.ACTIVE_TAG&&this.body.activate(!0)),T.collisionFilterGroup!==y.collisionFilterGroup||T.collisionFilterMask!==y.collisionFilterMask){const M=this.body.getBroadphaseProxy();M.set_m_collisionFilterGroup(y.collisionFilterGroup),M.set_m_collisionFilterMask(y.collisionFilterMask),this.system.driver.broadphase.getOverlappingPairCache().removeOverlappingPairsContainingProxy(M,this.system.driver.dispatcher)}if(T.linearDamping==y.linearDamping&&T.angularDamping==y.angularDamping||this.body.setDamping(y.linearDamping,y.angularDamping),!E(.001,T.gravity,y.gravity)){const M=new Ammo.btVector3(y.gravity.x,y.gravity.y,y.gravity.z);g(.001,M,this.system.driver.physicsWorld.getGravity())?this.body.setFlags(0):this.body.setFlags(1),this.body.setGravity(M),Ammo.destroy(M)}if(T.linearSleepingThreshold==y.linearSleepingThreshold&&T.angularSleepingThreshold==y.angularSleepingThreshold||this.body.setSleepingThresholds(y.linearSleepingThreshold,y.angularSleepingThreshold),!E(.001,T.angularFactor,y.angularFactor)){const M=new Ammo.btVector3(y.angularFactor.x,y.angularFactor.y,y.angularFactor.z);this.body.setAngularFactor(M),Ammo.destroy(M)}}},remove:function(){this.triMesh&&Ammo.destroy(this.triMesh),this.localScaling&&Ammo.destroy(this.localScaling),this.compoundShape&&Ammo.destroy(this.compoundShape),this.body&&(Ammo.destroy(this.body),delete this.body),Ammo.destroy(this.rbInfo),Ammo.destroy(this.msTransform),Ammo.destroy(this.motionState),Ammo.destroy(this.localInertia),Ammo.destroy(this.rotation)},beforeStep:function(){this._updateShapes(),this.data.type!==u.DYNAMIC&&this.syncToPhysics()},step:function(){this.data.type===u.DYNAMIC&&this.syncFromPhysics()},syncToPhysics:function(){const T=new THREE.Quaternion,y=new THREE.Vector3,M=new THREE.Vector3,_=new THREE.Vector3;return function(){const O=this.el,D=O.parentEl;if(!this.body)return;this.motionState.getWorldTransform(this.msTransform),D.isScene?(y.copy(O.object3D.position),T.copy(O.object3D.quaternion)):(O.object3D.getWorldPosition(y),O.object3D.getWorldQuaternion(T));const B=this.msTransform.getOrigin();_.set(B.x(),B.y(),B.z());const H=this.msTransform.getRotation();var q,V,ne;M.set(H.x(),H.y(),H.z(),H.w()),E(.001,y,_)&&(q=.001,V=T,ne=M,Math.abs(V.x-ne.x)<q&&Math.abs(V.y-ne.y)<q&&Math.abs(V.z-ne.z)<q&&Math.abs(V.w-ne.w)<q||Math.abs(V.x+ne.x)<q&&Math.abs(V.y+ne.y)<q&&Math.abs(V.z+ne.z)<q&&Math.abs(V.w+ne.w)<q)||(this.body.isActive()||this.body.activate(!0),this.msTransform.getOrigin().setValue(y.x,y.y,y.z),this.rotation.setValue(T.x,T.y,T.z,T.w),this.msTransform.setRotation(this.rotation),this.motionState.setWorldTransform(this.msTransform),this.data.type===u.STATIC&&this.body.setCenterOfMassTransform(this.msTransform))}}(),syncFromPhysics:function(){const T=new THREE.Vector3,y=new THREE.Quaternion,M=new THREE.Quaternion;return function(){this.motionState.getWorldTransform(this.msTransform);const _=this.msTransform.getOrigin(),O=this.msTransform.getRotation(),D=this.el,B=D.parentEl;this.body&&B&&(B.isScene?(D.object3D.position.set(_.x(),_.y(),_.z()),D.object3D.quaternion.set(O.x(),O.y(),O.z(),O.w())):(y.set(O.x(),O.y(),O.z(),O.w()),B.object3D.getWorldQuaternion(M),y.multiply(M.invert()),D.object3D.quaternion.copy(y),T.set(_.x(),_.y(),_.z()),B.object3D.worldToLocal(T),D.object3D.position.copy(T)))}}(),addShapeComponent:function(T){T.data.type!==c.MESH||this.data.type===u.STATIC?(this.shapeComponents.push(T),this.shapeComponentsChanged=!0):console.warn("non-static mesh colliders not supported")},removeShapeComponent:function(T){const y=this.shapeComponents.indexOf(T);if(this.compoundShape&&-1!==y&&this.body){const _=T.getShapes();for(var M=0;M<_.length;M++)this.compoundShape.removeChildShape(_[M]);this.shapeComponentsChanged=!0,this.shapeComponents.splice(y,1)}},updateMass:function(){const T=this.body.getCollisionShape(),y=this.data.type===u.DYNAMIC?this.data.mass:0;T.calculateLocalInertia(y,this.localInertia),this.body.setMassProps(y,this.localInertia),this.body.updateInertiaTensor()},updateCollisionFlags:function(){let T=this.data.disableCollision?4:0;switch(this.data.type){case u.STATIC:T|=s.STATIC_OBJECT;break;case u.KINEMATIC:T|=s.KINEMATIC_OBJECT;break;default:this.body.applyGravity()}this.body.setCollisionFlags(T),this.updateMass(),this.system.driver.updateBody(this.body)},getVelocity:function(){return this.body.getLinearVelocity()}};be.exports.definition=v,be.exports.Component=AFRAME.registerComponent("ammo-body",v)},{"../../constants":19,"ammo-debug-drawer":3,"three-to-ammo":5}],10:[function(ee,be,ue){var h=ee("cannon-es"),C=ee("three-to-cannon").threeToCannon;ee("../../../lib/CANNON-shape2mesh");var m,s,u,p,d,c={dependencies:["velocity"],schema:{mass:{default:5,if:{type:"dynamic"}},linearDamping:{default:.01,if:{type:"dynamic"}},angularDamping:{default:.01,if:{type:"dynamic"}},shape:{default:"auto",oneOf:["auto","box","cylinder","sphere","hull","mesh","none"]},cylinderAxis:{default:"y",oneOf:["x","y","z"]},sphereRadius:{default:NaN},type:{default:"dynamic",oneOf:["static","dynamic"]}},init:function(){this.system=this.el.sceneEl.systems.physics,this.el.sceneEl.hasLoaded?this.initBody():this.el.sceneEl.addEventListener("loaded",this.initBody.bind(this))},initBody:function(){var u=this.el,p=this.data,d=this.el.object3D,A=d.position,E=d.quaternion;if(this.body=new h.Body({mass:"static"===p.type?0:p.mass||0,material:this.system.getMaterial("defaultMaterial"),position:new h.Vec3(A.x,A.y,A.z),quaternion:new h.Quaternion(E.x,E.y,E.z,E.w),linearDamping:p.linearDamping,angularDamping:p.angularDamping,type:"dynamic"===p.type?h.Body.DYNAMIC:h.Body.STATIC}),this.el.object3D.updateMatrixWorld(!0),"none"!==p.shape){var g="auto"===p.shape?void 0:AFRAME.utils.extend({},this.data,{type:C.Type[p.shape.toUpperCase()]}),v=C(this.el.object3D,g);if(!v)return void u.addEventListener("object3dset",this.initBody.bind(this));this.body.addShape(v,v.offset,v.orientation),this.system.debug&&(this.shouldUpdateWireframe=!0),this.isLoaded=!0}this.el.body=this.body,this.body.el=u,this.isPlaying&&this._play(),this.isLoaded&&this.el.emit("body-loaded",{body:this.el.body})},addShape:function(u,p,d){"none"===this.data.shape?u?this.body?(this.body.addShape(u,p,d),this.system.debug&&(this.shouldUpdateWireframe=!0),this.shouldUpdateBody=!0):console.warn("shape cannot be added before body is loaded"):console.warn("shape cannot be null"):console.warn("shape can only be added if shape property is none")},tick:function(){this.shouldUpdateBody&&(this.isLoaded=!0,this._play(),this.el.emit("body-loaded",{body:this.el.body}),this.shouldUpdateBody=!1),this.shouldUpdateWireframe&&(this.createWireframe(this.body),this.shouldUpdateWireframe=!1)},play:function(){this.isLoaded&&this._play()},_play:function(){this.syncToPhysics(),this.system.addComponent(this),this.system.addBody(this.body),this.wireframe&&this.el.sceneEl.object3D.add(this.wireframe)},pause:function(){this.isLoaded&&this._pause()},_pause:function(){this.system.removeComponent(this),this.body&&this.system.removeBody(this.body),this.wireframe&&this.el.sceneEl.object3D.remove(this.wireframe)},update:function(u){if(this.body){var p=this.data;null!=u.type&&p.type!=u.type&&(this.body.type="dynamic"===p.type?h.Body.DYNAMIC:h.Body.STATIC),this.body.mass=p.mass||0,"dynamic"===p.type&&(this.body.linearDamping=p.linearDamping,this.body.angularDamping=p.angularDamping),p.mass!==u.mass&&this.body.updateMassProperties(),this.body.updateProperties&&this.body.updateProperties()}},remove:function(){this.body&&(delete this.body.el,delete this.body),delete this.el.body,delete this.wireframe},beforeStep:function(){0===this.body.mass&&this.syncToPhysics()},step:function(){0!==this.body.mass&&this.syncFromPhysics()},createWireframe:function(u){var p,d;this.wireframe&&(this.el.sceneEl.object3D.remove(this.wireframe),delete this.wireframe),this.wireframe=new THREE.Object3D,this.el.sceneEl.object3D.add(this.wireframe);for(var A=new THREE.Quaternion,E=0;E<this.body.shapes.length;E++){p=this.body.shapeOffsets[E],A.copy(this.body.shapeOrientations[E]),d=h.shape2mesh(this.body).children[E];var g=new THREE.LineSegments(new THREE.EdgesGeometry(d.geometry),new THREE.LineBasicMaterial({color:16711680}));p&&g.position.copy(p),A&&g.quaternion.copy(A),this.wireframe.add(g)}this.syncWireframe()},syncWireframe:function(){var u,p=this.wireframe;this.wireframe&&(p.quaternion.copy(this.body.quaternion),p.orientation&&p.quaternion.multiply(p.orientation),p.position.copy(this.body.position),p.offset&&(u=p.offset.clone().applyQuaternion(p.quaternion),p.position.add(u)),p.updateMatrix())},syncToPhysics:(m=new THREE.Quaternion,s=new THREE.Vector3,function(){var u=this.el,p=u.parentEl,d=this.body;d&&(u.components.velocity&&d.velocity.copy(u.getAttribute("velocity")),p.isScene?(d.quaternion.copy(u.object3D.quaternion),d.position.copy(u.object3D.position)):(u.object3D.getWorldQuaternion(m),d.quaternion.copy(m),u.object3D.getWorldPosition(s),d.position.copy(s)),this.body.updateProperties&&this.body.updateProperties(),this.wireframe&&this.syncWireframe())}),syncFromPhysics:(u=new THREE.Vector3,p=new THREE.Quaternion,d=new THREE.Quaternion,function(){var A=this.el,E=A.parentEl,g=this.body;g&&E&&(E.isScene?(A.object3D.quaternion.copy(g.quaternion),A.object3D.position.copy(g.position)):(p.copy(g.quaternion),E.object3D.getWorldQuaternion(d),p.premultiply(d.invert()),A.object3D.quaternion.copy(p),u.copy(g.position),E.object3D.worldToLocal(u),A.object3D.position.copy(u)),this.wireframe&&this.syncWireframe())})};be.exports.definition=c,be.exports.Component=AFRAME.registerComponent("body",c)},{"../../../lib/CANNON-shape2mesh":2,"cannon-es":4,"three-to-cannon":6}],11:[function(ee,be,ue){var h=ee("./body"),C=AFRAME.utils.extend({},h.definition);be.exports=AFRAME.registerComponent("dynamic-body",C)},{"./body":10}],12:[function(ee,be,ue){var h=ee("./body"),C=AFRAME.utils.extend({},h.definition);C.schema=AFRAME.utils.extend({},h.definition.schema,{type:{default:"static",oneOf:["static","dynamic"]},mass:{default:0}}),be.exports=AFRAME.registerComponent("static-body",C)},{"./body":10}],13:[function(ee,be,ue){var h=ee("cannon-es");be.exports=AFRAME.registerComponent("constraint",{multiple:!0,schema:{type:{default:"lock",oneOf:["coneTwist","distance","hinge","lock","pointToPoint"]},target:{type:"selector"},maxForce:{default:1e6,min:0},collideConnected:{default:!0},wakeUpBodies:{default:!0},distance:{default:0,min:0},pivot:{type:"vec3"},targetPivot:{type:"vec3"},axis:{type:"vec3",default:{x:0,y:0,z:1}},targetAxis:{type:"vec3",default:{x:0,y:0,z:1}}},init:function(){this.system=this.el.sceneEl.systems.physics,this.constraint=null},remove:function(){this.constraint&&(this.system.removeConstraint(this.constraint),this.constraint=null)},update:function(){var C=this.el,m=this.data;this.remove(),C.body&&m.target.body?(this.constraint=this.createConstraint(),this.system.addConstraint(this.constraint)):(C.body?m.target:C).addEventListener("body-loaded",this.update.bind(this,{}))},createConstraint:function(){var C,m=this.data,s=new h.Vec3(m.pivot.x,m.pivot.y,m.pivot.z),c=new h.Vec3(m.targetPivot.x,m.targetPivot.y,m.targetPivot.z),u=new h.Vec3(m.axis.x,m.axis.y,m.axis.z),p=new h.Vec3(m.targetAxis.x,m.targetAxis.y,m.targetAxis.z);switch(m.type){case"lock":(C=new h.LockConstraint(this.el.body,m.target.body,{maxForce:m.maxForce})).type="LockConstraint";break;case"distance":(C=new h.DistanceConstraint(this.el.body,m.target.body,m.distance,m.maxForce)).type="DistanceConstraint";break;case"hinge":(C=new h.HingeConstraint(this.el.body,m.target.body,{pivotA:s,pivotB:c,axisA:u,axisB:p,maxForce:m.maxForce})).type="HingeConstraint";break;case"coneTwist":(C=new h.ConeTwistConstraint(this.el.body,m.target.body,{pivotA:s,pivotB:c,axisA:u,axisB:p,maxForce:m.maxForce})).type="ConeTwistConstraint";break;case"pointToPoint":(C=new h.PointToPointConstraint(this.el.body,s,m.target.body,c,m.maxForce)).type="PointToPointConstraint";break;default:throw new Error("[constraint] Unexpected type: "+m.type)}return C.collideConnected=m.collideConnected,C}})},{"cannon-es":4}],14:[function(ee,be,ue){be.exports={velocity:ee("./velocity"),registerAll:function(h){this._registered||((h=h||window.AFRAME).components.velocity||h.registerComponent("velocity",this.velocity),this._registered=!0)}}},{"./velocity":15}],15:[function(ee,be,ue){be.exports=AFRAME.registerComponent("velocity",{schema:{type:"vec3"},init:function(){this.system=this.el.sceneEl.systems.physics,this.system&&this.system.addComponent(this)},remove:function(){this.system&&this.system.removeComponent(this)},tick:function(h,C){C&&(this.system||this.afterStep(h,C))},afterStep:function(h,C){if(C){var m=this.el.sceneEl.systems.physics||{data:{maxInterval:.016666666666666666}},s=this.el.getAttribute("velocity")||{x:0,y:0,z:0},c=this.el.object3D.position||{x:0,y:0,z:0};C=Math.min(C,1e3*m.data.maxInterval),this.el.object3D.position.set(c.x+s.x*C/1e3,c.y+s.y*C/1e3,c.z+s.z*C/1e3)}}})},{}],16:[function(ee,be,ue){ee("three-to-ammo");const h=ee("../../constants"),C=h.SHAPE,m=h.FIT;var s={schema:{type:{default:C.HULL,oneOf:[C.BOX,C.CYLINDER,C.SPHERE,C.CAPSULE,C.CONE,C.HULL,C.HACD,C.VHACD,C.MESH,C.HEIGHTFIELD]},fit:{default:m.ALL,oneOf:[m.ALL,m.MANUAL]},halfExtents:{type:"vec3",default:{x:1,y:1,z:1}},minHalfExtent:{default:0},maxHalfExtent:{default:Number.POSITIVE_INFINITY},sphereRadius:{default:NaN},cylinderAxis:{default:"y",oneOf:["x","y","z"]},margin:{default:.01},offset:{type:"vec3",default:{x:0,y:0,z:0}},orientation:{type:"vec4",default:{x:0,y:0,z:0,w:1}},heightfieldData:{default:[]},heightfieldDistance:{default:1},includeInvisible:{default:!1}},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.physics,this.collisionShapes=[];let c=this.el;for(this.body=c.components["ammo-body"]||null;!this.body&&c.parentNode!=this.el.sceneEl;)(c=c.parentNode).components["ammo-body"]&&(this.body=c.components["ammo-body"]);if(this.body){if(this.data.fit!==m.MANUAL){if(!this.el.object3DMap.mesh)return void console.error("Cannot use FIT.ALL without object3DMap.mesh");this.mesh=this.el.object3DMap.mesh}this.body.addShapeComponent(this)}else console.warn("body not found")},getMesh:function(){return this.mesh||null},addShapes:function(c){this.collisionShapes=c},getShapes:function(){return this.collisionShapes},remove:function(){if(this.body)for(this.body.removeShapeComponent(this);this.collisionShapes.length>0;){const c=this.collisionShapes.pop();c.destroy(),Ammo.destroy(c.localTransform)}}};be.exports.definition=s,be.exports.Component=AFRAME.registerComponent("ammo-shape",s)},{"../../constants":19,"three-to-ammo":5}],17:[function(ee,be,ue){var h=ee("cannon-es"),C={schema:{shape:{default:"box",oneOf:["box","sphere","cylinder"]},offset:{type:"vec3",default:{x:0,y:0,z:0}},orientation:{type:"vec4",default:{x:0,y:0,z:0,w:1}},radius:{type:"number",default:1,if:{shape:["sphere"]}},halfExtents:{type:"vec3",default:{x:.5,y:.5,z:.5},if:{shape:["box"]}},radiusTop:{type:"number",default:1,if:{shape:["cylinder"]}},radiusBottom:{type:"number",default:1,if:{shape:["cylinder"]}},height:{type:"number",default:1,if:{shape:["cylinder"]}},numSegments:{type:"int",default:8,if:{shape:["cylinder"]}}},multiple:!0,init:function(){this.el.sceneEl.hasLoaded?this.initShape():this.el.sceneEl.addEventListener("loaded",this.initShape.bind(this))},initShape:function(){this.bodyEl=this.el;for(var m=this._findType(this.bodyEl),s=this.data;!m&&this.bodyEl.parentNode!=this.el.sceneEl;)this.bodyEl=this.bodyEl.parentNode,m=this._findType(this.bodyEl);if(m){var c,u,p,d=new THREE.Vector3;switch(this.bodyEl.object3D.getWorldScale(d),s.hasOwnProperty("offset")&&(u=new h.Vec3(s.offset.x*d.x,s.offset.y*d.y,s.offset.z*d.z)),s.hasOwnProperty("orientation")&&(p=new h.Quaternion).copy(s.orientation),s.shape){case"sphere":c=new h.Sphere(s.radius*d.x);break;case"box":var A=new h.Vec3(s.halfExtents.x*d.x,s.halfExtents.y*d.y,s.halfExtents.z*d.z);c=new h.Box(A);break;case"cylinder":c=new h.Cylinder(s.radiusTop*d.x,s.radiusBottom*d.x,s.height*d.y,s.numSegments);var E=new h.Quaternion;E.setFromEuler(90*THREE.Math.DEG2RAD,0,0,"XYZ").normalize(),p.mult(E,p);break;default:return void console.warn(s.shape+" shape not supported")}this.bodyEl.body?this.bodyEl.components[m].addShape(c,u,p):this.bodyEl.addEventListener("body-loaded",function(){this.bodyEl.components[m].addShape(c,u,p)},{once:!0})}else console.warn("body not found")},_findType:function(m){return m.hasAttribute("body")?"body":m.hasAttribute("dynamic-body")?"dynamic-body":m.hasAttribute("static-body")?"static-body":null},remove:function(){this.bodyEl.parentNode&&console.warn("removing shape component not currently supported")}};be.exports.definition=C,be.exports.Component=AFRAME.registerComponent("shape",C)},{"cannon-es":4}],18:[function(ee,be,ue){var h=ee("cannon-es");be.exports=AFRAME.registerComponent("spring",{multiple:!0,schema:{target:{type:"selector"},restLength:{default:1,min:0},stiffness:{default:100,min:0},damping:{default:1,min:0},localAnchorA:{type:"vec3",default:{x:0,y:0,z:0}},localAnchorB:{type:"vec3",default:{x:0,y:0,z:0}}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this),this.isActive=!0,this.spring=null},update:function(C){var m=this.el,s=this.data;s.target?m.body&&s.target.body?(this.createSpring(),this.updateSpring(C)):(m.body?s.target:m).addEventListener("body-loaded",this.update.bind(this,{})):console.warn("Spring: invalid target specified.")},updateSpring:function(C){if(this.spring){var m=this.data,s=this.spring;Object.keys(m).forEach(function(c){if(m[c]!==C[c]){if("target"===c)return void(s.bodyB=m.target.body);s[c]=m[c]}})}else console.warn("Spring: Component attempted to change spring before its created. No changes made.")},createSpring:function(){this.spring||(this.spring=new h.Spring(this.el.body))},step:function(C,m){return this.spring&&this.isActive?this.spring.applyForce():void 0},play:function(){this.isActive=!0},pause:function(){this.isActive=!1},remove:function(){this.spring&&delete this.spring,this.spring=null}})},{"cannon-es":4}],19:[function(ee,be,ue){be.exports={GRAVITY:-9.8,MAX_INTERVAL:4/60,ITERATIONS:10,CONTACT_MATERIAL:{friction:.01,restitution:.3,contactEquationStiffness:1e8,contactEquationRelaxation:3,frictionEquationStiffness:1e8,frictionEquationRegularization:3},ACTIVATION_STATE:{ACTIVE_TAG:"active",ISLAND_SLEEPING:"islandSleeping",WANTS_DEACTIVATION:"wantsDeactivation",DISABLE_DEACTIVATION:"disableDeactivation",DISABLE_SIMULATION:"disableSimulation"},COLLISION_FLAG:{STATIC_OBJECT:1,KINEMATIC_OBJECT:2,NO_CONTACT_RESPONSE:4,CUSTOM_MATERIAL_CALLBACK:8,CHARACTER_OBJECT:16,DISABLE_VISUALIZE_OBJECT:32,DISABLE_SPU_COLLISION_PROCESSING:64},TYPE:{STATIC:"static",DYNAMIC:"dynamic",KINEMATIC:"kinematic"},SHAPE:{BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},FIT:{ALL:"all",MANUAL:"manual"},CONSTRAINT:{LOCK:"lock",FIXED:"fixed",SPRING:"spring",SLIDER:"slider",HINGE:"hinge",CONE_TWIST:"coneTwist",POINT_TO_POINT:"pointToPoint"}}},{}],20:[function(ee,be,ue){const h=ee("./driver");function C(){this.collisionConfiguration=null,this.dispatcher=null,this.broadphase=null,this.solver=null,this.physicsWorld=null,this.debugDrawer=null,this.els=new Map,this.eventListeners=[],this.collisions=new Map,this.collisionKeys=[],this.currentCollisions=new Map}typeof window<"u"&&(window.AmmoModule=window.Ammo,window.Ammo=null),(C.prototype=new h).constructor=C,be.exports=C,C.prototype.init=function(m){return new Promise(s=>{AmmoModule().then(c=>{Ammo=c,this.epsilon=m.epsilon||1e-5,this.debugDrawMode=m.debugDrawMode||THREE.AmmoDebugConstants.NoDebug,this.maxSubSteps=m.maxSubSteps||4,this.fixedTimeStep=m.fixedTimeStep||1/60,this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.broadphase=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.physicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.broadphase,this.solver,this.collisionConfiguration),this.physicsWorld.setForceUpdateAllAabbs(!1),this.physicsWorld.setGravity(new Ammo.btVector3(0,m.hasOwnProperty("gravity")?m.gravity:-9.8,0)),this.physicsWorld.getSolverInfo().set_m_numIterations(m.solverIterations),s()})})},C.prototype.addBody=function(m,s,c){this.physicsWorld.addRigidBody(m,s,c),this.els.set(Ammo.getPointer(m),m.el)},C.prototype.removeBody=function(m){this.physicsWorld.removeRigidBody(m),this.removeEventListener(m);const s=Ammo.getPointer(m);this.els.delete(s),this.collisions.delete(s),this.collisionKeys.splice(this.collisionKeys.indexOf(s),1),this.currentCollisions.delete(s)},C.prototype.updateBody=function(m){this.els.has(Ammo.getPointer(m))&&this.physicsWorld.updateSingleAabb(m)},C.prototype.step=function(m){this.physicsWorld.stepSimulation(m,this.maxSubSteps,this.fixedTimeStep);const s=this.dispatcher.getNumManifolds();for(let c=0;c<s;c++){const u=this.dispatcher.getManifoldByIndexInternal(c),p=u.getNumContacts(),d=Ammo.getPointer(u.getBody0()),A=Ammo.getPointer(u.getBody1());let E=!1;for(let g=0;g<p;g++)if(u.getContactPoint(g).getDistance()<=this.epsilon){E=!0;break}E&&(this.collisions.has(d)||(this.collisions.set(d,[]),this.collisionKeys.push(d)),-1===this.collisions.get(d).indexOf(A)&&(this.collisions.get(d).push(A),-1!==this.eventListeners.indexOf(d)&&this.els.get(d).emit("collidestart",{targetEl:this.els.get(A)}),-1!==this.eventListeners.indexOf(A)&&this.els.get(A).emit("collidestart",{targetEl:this.els.get(d)})),this.currentCollisions.has(d)||this.currentCollisions.set(d,new Set),this.currentCollisions.get(d).add(A))}for(let c=0;c<this.collisionKeys.length;c++){const u=this.collisionKeys[c],p=this.collisions.get(u);for(let d=p.length-1;d>=0;d--){const A=p[d];this.currentCollisions.get(u).has(A)||(-1!==this.eventListeners.indexOf(u)&&this.els.get(u).emit("collideend",{targetEl:this.els.get(A)}),-1!==this.eventListeners.indexOf(A)&&this.els.get(A).emit("collideend",{targetEl:this.els.get(u)}),p.splice(d,1))}this.currentCollisions.get(u).clear()}this.debugDrawer&&this.debugDrawer.update()},C.prototype.addConstraint=function(m){this.physicsWorld.addConstraint(m,!1)},C.prototype.removeConstraint=function(m){this.physicsWorld.removeConstraint(m)},C.prototype.addEventListener=function(m){this.eventListeners.push(Ammo.getPointer(m))},C.prototype.removeEventListener=function(m){const s=Ammo.getPointer(m);-1!==this.eventListeners.indexOf(s)&&this.eventListeners.splice(this.eventListeners.indexOf(s),1)},C.prototype.destroy=function(){Ammo.destroy(this.collisionConfiguration),Ammo.destroy(this.dispatcher),Ammo.destroy(this.broadphase),Ammo.destroy(this.solver),Ammo.destroy(this.physicsWorld),Ammo.destroy(this.debugDrawer)},C.prototype.getDebugDrawer=function(m,s){return this.debugDrawer||((s=s||{}).debugDrawMode=s.debugDrawMode||this.debugDrawMode,this.debugDrawer=new THREE.AmmoDebugDrawer(m,this.physicsWorld,s)),this.debugDrawer}},{"./driver":21}],21:[function(ee,be,ue){function h(){}function C(){throw new Error("Method not implemented.")}be.exports=h,h.prototype.init=C,h.prototype.step=C,h.prototype.destroy=C,h.prototype.addBody=C,h.prototype.removeBody=C,h.prototype.applyBodyMethod=C,h.prototype.updateBodyProperties=C,h.prototype.addMaterial=C,h.prototype.addContactMaterial=C,h.prototype.addConstraint=C,h.prototype.removeConstraint=C,h.prototype.getContacts=C},{}],22:[function(ee,be,ue){be.exports={INIT:"init",STEP:"step",ADD_BODY:"add-body",REMOVE_BODY:"remove-body",APPLY_BODY_METHOD:"apply-body-method",UPDATE_BODY_PROPERTIES:"update-body-properties",ADD_MATERIAL:"add-material",ADD_CONTACT_MATERIAL:"add-contact-material",ADD_CONSTRAINT:"add-constraint",REMOVE_CONSTRAINT:"remove-constraint",COLLIDE:"collide"}},{}],23:[function(ee,be,ue){var h=ee("cannon-es"),C=ee("./driver");function m(){this.world=null,this.materials={},this.contactMaterial=null}(m.prototype=new C).constructor=m,be.exports=m,m.prototype.init=function(s){var c=new h.World;c.quatNormalizeSkip=s.quatNormalizeSkip,c.quatNormalizeFast=s.quatNormalizeFast,c.solver.iterations=s.solverIterations,c.gravity.set(0,s.gravity,0),c.broadphase=new h.NaiveBroadphase,this.world=c},m.prototype.step=function(s){this.world.step(s)},m.prototype.destroy=function(){delete this.world,delete this.contactMaterial,this.materials={}},m.prototype.addBody=function(s){this.world.addBody(s)},m.prototype.removeBody=function(s){this.world.removeBody(s)},m.prototype.applyBodyMethod=function(s,c,u){s["__"+c].apply(s,u)},m.prototype.updateBodyProperties=function(){},m.prototype.getMaterial=function(s){return this.materials[s]},m.prototype.addMaterial=function(s){this.materials[s.name]=new h.Material(s),this.materials[s.name].name=s.name},m.prototype.addContactMaterial=function(s,c,u){this.contactMaterial=new h.ContactMaterial(this.materials[s],this.materials[c],u),this.world.addContactMaterial(this.contactMaterial)},m.prototype.addConstraint=function(s){s.type||(s instanceof h.LockConstraint?s.type="LockConstraint":s instanceof h.DistanceConstraint?s.type="DistanceConstraint":s instanceof h.HingeConstraint?s.type="HingeConstraint":s instanceof h.ConeTwistConstraint?s.type="ConeTwistConstraint":s instanceof h.PointToPointConstraint&&(s.type="PointToPointConstraint")),this.world.addConstraint(s)},m.prototype.removeConstraint=function(s){this.world.removeConstraint(s)},m.prototype.getContacts=function(){return this.world.contacts}},{"./driver":21,"cannon-es":4}],24:[function(ee,be,ue){var h=ee("./driver");function C(){throw new Error("[NetworkDriver] Driver not implemented.")}(C.prototype=new h).constructor=C,be.exports=C},{"./driver":21}],25:[function(ee,be,ue){function h(){this.listeners=[]}be.exports=function(C){var m=new h,s=new h;return m.setTarget(s),s.setTarget(m),C(m),s},h.prototype.setTarget=function(C){this.target=C},h.prototype.addEventListener=function(C,m){this.listeners.push(m)},h.prototype.dispatchEvent=function(C,m){for(var s=0;s<this.listeners.length;s++)this.listeners[s](m)},h.prototype.postMessage=function(C){this.target.dispatchEvent("message",{data:C})}},{}],26:[function(ee,be,ue){var h=ee("webworkify"),C=ee("./webworkify-debug"),m=ee("./driver"),s=ee("./event"),c=ee("./worker"),u=ee("../utils/protocol"),p=u.ID;function d(A){this.fps=A.fps,this.engine=A.engine,this.interpolate=A.interpolate,this.interpBufferSize=A.interpolationBufferSize,this.debug=A.debug,this.bodies={},this.contacts=[],this.frameDelay=1e3*this.interpBufferSize/this.fps,this.frameBuffer=[],this.worker=this.debug?C(c):h(c),this.worker.addEventListener("message",this._onMessage.bind(this))}(d.prototype=new m).constructor=d,be.exports=d,d.prototype.init=function(A){this.worker.postMessage({type:s.INIT,worldConfig:A,fps:this.fps,engine:this.engine})},d.prototype.step=function(){if(this.interpolate){for(var A=this.frameBuffer[0],E=this.frameBuffer[1],g=performance.now();A&&E&&g-A.timestamp>this.frameDelay;)this.frameBuffer.shift(),A=this.frameBuffer[0],E=this.frameBuffer[1];if(A&&E){var v=(g-A.timestamp)/this.frameDelay;for(var T in v=(v-(1-1/this.interpBufferSize))*this.interpBufferSize,A.bodies)A.bodies.hasOwnProperty(T)&&E.bodies.hasOwnProperty(T)&&u.deserializeInterpBodyUpdate(A.bodies[T],E.bodies[T],this.bodies[T],v)}}},d.prototype.destroy=function(){this.worker.terminate(),delete this.worker},d.prototype._onMessage=function(A){if(A.data.type===s.STEP){var E=A.data.bodies;if(this.contacts=A.data.contacts,this.interpolate)this.frameBuffer.push({timestamp:performance.now(),bodies:E});else for(var g in E)E.hasOwnProperty(g)&&u.deserializeBodyUpdate(E[g],this.bodies[g])}else{if(A.data.type!==s.COLLIDE)throw new Error("[WorkerDriver] Unexpected message type.");var v=this.bodies[A.data.bodyID],T=this.bodies[A.data.targetID],y=u.deserializeContact(A.data.contact,this.bodies);if(!v._listeners||!v._listeners.collide)return;for(var M=0;M<v._listeners.collide.length;M++)v._listeners.collide[M]({target:T,body:v,contact:y})}},d.prototype.addBody=function(A){u.assignID("body",A),this.bodies[A[p]]=A,this.worker.postMessage({type:s.ADD_BODY,body:u.serializeBody(A)})},d.prototype.removeBody=function(A){this.worker.postMessage({type:s.REMOVE_BODY,bodyID:A[p]}),delete this.bodies[A[p]]},d.prototype.applyBodyMethod=function(A,E,g){switch(E){case"applyForce":case"applyImpulse":this.worker.postMessage({type:s.APPLY_BODY_METHOD,bodyID:A[p],methodName:E,args:[g[0].toArray(),g[1].toArray()]});break;default:throw new Error("Unexpected methodName: %s",E)}},d.prototype.updateBodyProperties=function(A){this.worker.postMessage({type:s.UPDATE_BODY_PROPERTIES,body:u.serializeBody(A)})},d.prototype.getMaterial=function(A){},d.prototype.addMaterial=function(A){this.worker.postMessage({type:s.ADD_MATERIAL,materialConfig:A})},d.prototype.addContactMaterial=function(A,E,g){this.worker.postMessage({type:s.ADD_CONTACT_MATERIAL,materialName1:A,materialName2:E,contactMaterialConfig:g})},d.prototype.addConstraint=function(A){A.type||(A instanceof CANNON.LockConstraint?A.type="LockConstraint":A instanceof CANNON.DistanceConstraint?A.type="DistanceConstraint":A instanceof CANNON.HingeConstraint?A.type="HingeConstraint":A instanceof CANNON.ConeTwistConstraint?A.type="ConeTwistConstraint":A instanceof CANNON.PointToPointConstraint&&(A.type="PointToPointConstraint")),u.assignID("constraint",A),this.worker.postMessage({type:s.ADD_CONSTRAINT,constraint:u.serializeConstraint(A)})},d.prototype.removeConstraint=function(A){this.worker.postMessage({type:s.REMOVE_CONSTRAINT,constraintID:A[p]})},d.prototype.getContacts=function(){var A=this.bodies;return this.contacts.map(function(E){return u.deserializeContact(E,A)})}},{"../utils/protocol":30,"./driver":21,"./event":22,"./webworkify-debug":25,"./worker":27,webworkify:7}],27:[function(ee,be,ue){var h=ee("./event"),C=ee("./local-driver"),m=ee("./ammo-driver"),s=ee("../utils/protocol"),c=s.ID;be.exports=function(u){var p,d=null,A={},E={};function g(){d.step(p);var v={};Object.keys(A).forEach(function(T){v[T]=s.serializeBody(A[T])}),u.postMessage({type:h.STEP,bodies:v,contacts:d.getContacts().map(s.serializeContact)})}u.addEventListener("message",function(v){var T=v.data;switch(T.type){case h.INIT:(d="cannon"===T.engine?new C:new m).init(T.worldConfig),p=1/T.fps,setInterval(g,1e3/T.fps);break;case h.ADD_BODY:var y=s.deserializeBody(T.body);y.material=d.getMaterial("defaultMaterial"),A[y[c]]=y,y.addEventListener("collide",function(_){var O={type:h.COLLIDE,bodyID:_.target[c],targetID:_.body[c],contact:s.serializeContact(_.contact)};u.postMessage(O)}),d.addBody(y);break;case h.REMOVE_BODY:d.removeBody(A[T.bodyID]),delete A[T.bodyID];break;case h.APPLY_BODY_METHOD:A[T.bodyID][T.methodName](s.deserializeVec3(T.args[0]),s.deserializeVec3(T.args[1]));break;case h.UPDATE_BODY_PROPERTIES:s.deserializeBodyUpdate(T.body,A[T.body.id]);break;case h.ADD_MATERIAL:d.addMaterial(T.materialConfig);break;case h.ADD_CONTACT_MATERIAL:d.addContactMaterial(T.materialName1,T.materialName2,T.contactMaterialConfig);break;case h.ADD_CONSTRAINT:var M=s.deserializeConstraint(T.constraint,A);E[M[c]]=M,d.addConstraint(M);break;case h.REMOVE_CONSTRAINT:d.removeConstraint(E[T.constraintID]),delete E[T.constraintID];break;default:throw new Error("[Worker] Unexpected event type: %s",T.type)}})}},{"../utils/protocol":30,"./ammo-driver":20,"./event":22,"./local-driver":23}],28:[function(ee,be,ue){ee("cannon-es");var h=ee("./constants"),C=h.GRAVITY,m=h.CONTACT_MATERIAL,s=ee("./drivers/local-driver"),c=ee("./drivers/worker-driver"),u=ee("./drivers/network-driver"),p=ee("./drivers/ammo-driver");be.exports=AFRAME.registerSystem("physics",{schema:{driver:{default:"local",oneOf:["local","worker","network","ammo"]},networkUrl:{default:"",if:{driver:"network"}},workerFps:{default:60,if:{driver:"worker"}},workerInterpolate:{default:!0,if:{driver:"worker"}},workerInterpBufferSize:{default:2,if:{driver:"worker"}},workerEngine:{default:"cannon",if:{driver:"worker"},oneOf:["cannon"]},workerDebug:{default:!1,if:{driver:"worker"}},gravity:{default:C},iterations:{default:h.ITERATIONS},friction:{default:m.friction},restitution:{default:m.restitution},contactEquationStiffness:{default:m.contactEquationStiffness},contactEquationRelaxation:{default:m.contactEquationRelaxation},frictionEquationStiffness:{default:m.frictionEquationStiffness},frictionEquationRegularization:{default:m.frictionEquationRegularization},maxInterval:{default:4/60},debug:{default:!1},debugDrawMode:{default:THREE.AmmoDebugConstants.NoDebug},maxSubSteps:{default:4},fixedTimeStep:{default:1/60}},async init(){var d=this.data;switch(this.debug=d.debug,this.callbacks={beforeStep:[],step:[],afterStep:[]},this.listeners={},this.driver=null,d.driver){case"local":this.driver=new s;break;case"ammo":this.driver=new p;break;case"network":this.driver=new u(d.networkUrl);break;case"worker":this.driver=new c({fps:d.workerFps,engine:d.workerEngine,interpolate:d.workerInterpolate,interpolationBufferSize:d.workerInterpBufferSize,debug:d.workerDebug});break;default:throw new Error('[physics] Driver not recognized: "%s".',d.driver)}"ammo"!==d.driver?(await this.driver.init({quatNormalizeSkip:0,quatNormalizeFast:!1,solverIterations:d.iterations,gravity:d.gravity}),this.driver.addMaterial({name:"defaultMaterial"}),this.driver.addMaterial({name:"staticMaterial"}),this.driver.addContactMaterial("defaultMaterial","defaultMaterial",{friction:d.friction,restitution:d.restitution,contactEquationStiffness:d.contactEquationStiffness,contactEquationRelaxation:d.contactEquationRelaxation,frictionEquationStiffness:d.frictionEquationStiffness,frictionEquationRegularization:d.frictionEquationRegularization}),this.driver.addContactMaterial("staticMaterial","defaultMaterial",{friction:1,restitution:0,contactEquationStiffness:d.contactEquationStiffness,contactEquationRelaxation:d.contactEquationRelaxation,frictionEquationStiffness:d.frictionEquationStiffness,frictionEquationRegularization:d.frictionEquationRegularization})):await this.driver.init({gravity:d.gravity,debugDrawMode:d.debugDrawMode,solverIterations:d.iterations,maxSubSteps:d.maxSubSteps,fixedTimeStep:d.fixedTimeStep}),this.initialized=!0,this.debug&&this.setDebug(!0)},tick:function(d,A){if(this.initialized&&A){var E,g=this.callbacks;for(E=0;E<this.callbacks.beforeStep.length;E++)this.callbacks.beforeStep[E].beforeStep(d,A);for(this.driver.step(Math.min(A/1e3,this.data.maxInterval)),E=0;E<g.step.length;E++)g.step[E].step(d,A);for(E=0;E<g.afterStep.length;E++)g.afterStep[E].afterStep(d,A)}},setDebug:function(d){this.debug=d,"ammo"===this.data.driver&&this.initialized&&(d&&!this.debugDrawer?(this.debugDrawer=this.driver.getDebugDrawer(this.el.object3D),this.debugDrawer.enable()):this.debugDrawer&&(this.debugDrawer.disable(),this.debugDrawer=null))},addBody:function(d,A,E){var g=this.driver;"local"===this.data.driver&&(d.__applyImpulse=d.applyImpulse,d.applyImpulse=function(){g.applyBodyMethod(d,"applyImpulse",arguments)},d.__applyForce=d.applyForce,d.applyForce=function(){g.applyBodyMethod(d,"applyForce",arguments)},d.updateProperties=function(){g.updateBodyProperties(d)},this.listeners[d.id]=function(v){d.el.emit("collide",v)},d.addEventListener("collide",this.listeners[d.id])),this.driver.addBody(d,A,E)},removeBody:function(d){this.driver.removeBody(d),"local"!==this.data.driver&&"worker"!==this.data.driver||(d.removeEventListener("collide",this.listeners[d.id]),delete this.listeners[d.id],d.applyImpulse=d.__applyImpulse,delete d.__applyImpulse,d.applyForce=d.__applyForce,delete d.__applyForce,delete d.updateProperties)},addConstraint:function(d){this.driver.addConstraint(d)},removeConstraint:function(d){this.driver.removeConstraint(d)},addComponent:function(d){var A=this.callbacks;d.beforeStep&&A.beforeStep.push(d),d.step&&A.step.push(d),d.afterStep&&A.afterStep.push(d)},removeComponent:function(d){var A=this.callbacks;d.beforeStep&&A.beforeStep.splice(A.beforeStep.indexOf(d),1),d.step&&A.step.splice(A.step.indexOf(d),1),d.afterStep&&A.afterStep.splice(A.afterStep.indexOf(d),1)},getContacts:function(){return this.driver.getContacts()},getMaterial:function(d){return this.driver.getMaterial(d)}})},{"./constants":19,"./drivers/ammo-driver":20,"./drivers/local-driver":23,"./drivers/network-driver":24,"./drivers/worker-driver":26,"cannon-es":4}],29:[function(ee,be,ue){be.exports.slerp=function(h,C,m){if(m<=0)return h;if(m>=1)return C;var s=h[0],c=h[1],u=h[2],p=h[3],d=p*C[3]+s*C[0]+c*C[1]+u*C[2];if(!(d<0))return C;if((h=h.slice())[3]=-C[3],h[0]=-C[0],h[1]=-C[1],h[2]=-C[2],(d=-d)>=1)return h[3]=p,h[0]=s,h[1]=c,h[2]=u,this;var A=Math.sqrt(1-d*d);if(Math.abs(A)<.001)return h[3]=.5*(p+h[3]),h[0]=.5*(s+h[0]),h[1]=.5*(c+h[1]),h[2]=.5*(u+h[2]),this;var E=Math.atan2(A,d),g=Math.sin((1-m)*E)/A,v=Math.sin(m*E)/A;return h[3]=p*g+h[3]*v,h[0]=s*g+h[0]*v,h[1]=c*g+h[1]*v,h[2]=u*g+h[2]*v,h}},{}],30:[function(ee,be,ue){var h=ee("cannon-es"),C=ee("./math"),m="__id";be.exports.ID=m;var s={};function c(g){var v={type:g.type};if(g.type===h.Shape.types.BOX)v.halfExtents=p(g.halfExtents);else if(g.type===h.Shape.types.SPHERE)v.radius=g.radius;else{if(g._type!==h.Shape.types.CYLINDER)throw new Error("Unimplemented shape type: %s",g.type);v.type=h.Shape.types.CYLINDER,v.radiusTop=g.radiusTop,v.radiusBottom=g.radiusBottom,v.height=g.height,v.numSegments=g.numSegments}return v}function u(g){var v;if(g.type===h.Shape.types.BOX)v=new h.Box(d(g.halfExtents));else if(g.type===h.Shape.types.SPHERE)v=new h.Sphere(g.radius);else{if(g.type!==h.Shape.types.CYLINDER)throw new Error("Unimplemented shape type: %s",g.type);(v=new h.Cylinder(g.radiusTop,g.radiusBottom,g.height,g.numSegments))._type=h.Shape.types.CYLINDER}return v}function p(g){return g.toArray()}function d(g){return new h.Vec3(g[0],g[1],g[2])}function A(g){return g.toArray()}function E(g){return new h.Quaternion(g[0],g[1],g[2],g[3])}be.exports.assignID=function(g,v){v[m]||(s[g]=s[g]||1,v[m]=g+"_"+s[g]++)},be.exports.serializeBody=function(g){return{shapes:g.shapes.map(c),shapeOffsets:g.shapeOffsets.map(p),shapeOrientations:g.shapeOrientations.map(A),position:p(g.position),quaternion:g.quaternion.toArray(),velocity:p(g.velocity),angularVelocity:p(g.angularVelocity),id:g[m],mass:g.mass,linearDamping:g.linearDamping,angularDamping:g.angularDamping,fixedRotation:g.fixedRotation,allowSleep:g.allowSleep,sleepSpeedLimit:g.sleepSpeedLimit,sleepTimeLimit:g.sleepTimeLimit}},be.exports.deserializeBodyUpdate=function(g,v){return v.position.set(g.position[0],g.position[1],g.position[2]),v.quaternion.set(g.quaternion[0],g.quaternion[1],g.quaternion[2],g.quaternion[3]),v.velocity.set(g.velocity[0],g.velocity[1],g.velocity[2]),v.angularVelocity.set(g.angularVelocity[0],g.angularVelocity[1],g.angularVelocity[2]),v.linearDamping=g.linearDamping,v.angularDamping=g.angularDamping,v.fixedRotation=g.fixedRotation,v.allowSleep=g.allowSleep,v.sleepSpeedLimit=g.sleepSpeedLimit,v.sleepTimeLimit=g.sleepTimeLimit,v.mass!==g.mass&&(v.mass=g.mass,v.updateMassProperties()),v},be.exports.deserializeInterpBodyUpdate=function(g,v,T,y){var M=1-y,_=y;T.position.set(g.position[0]*M+v.position[0]*_,g.position[1]*M+v.position[1]*_,g.position[2]*M+v.position[2]*_);var O=C.slerp(g.quaternion,v.quaternion,y);return T.quaternion.set(O[0],O[1],O[2],O[3]),T.velocity.set(g.velocity[0]*M+v.velocity[0]*_,g.velocity[1]*M+v.velocity[1]*_,g.velocity[2]*M+v.velocity[2]*_),T.angularVelocity.set(g.angularVelocity[0]*M+v.angularVelocity[0]*_,g.angularVelocity[1]*M+v.angularVelocity[1]*_,g.angularVelocity[2]*M+v.angularVelocity[2]*_),T.linearDamping=v.linearDamping,T.angularDamping=v.angularDamping,T.fixedRotation=v.fixedRotation,T.allowSleep=v.allowSleep,T.sleepSpeedLimit=v.sleepSpeedLimit,T.sleepTimeLimit=v.sleepTimeLimit,T.mass!==v.mass&&(T.mass=v.mass,T.updateMassProperties()),T},be.exports.deserializeBody=function(g){for(var v,T=new h.Body({mass:g.mass,position:d(g.position),quaternion:E(g.quaternion),velocity:d(g.velocity),angularVelocity:d(g.angularVelocity),linearDamping:g.linearDamping,angularDamping:g.angularDamping,fixedRotation:g.fixedRotation,allowSleep:g.allowSleep,sleepSpeedLimit:g.sleepSpeedLimit,sleepTimeLimit:g.sleepTimeLimit}),y=0;v=g.shapes[y];y++)T.addShape(u(v),d(g.shapeOffsets[y]),E(g.shapeOrientations[y]));return T[m]=g.id,T},be.exports.serializeShape=c,be.exports.deserializeShape=u,be.exports.serializeConstraint=function(g){var v={id:g[m],type:g.type,maxForce:g.maxForce,bodyA:g.bodyA[m],bodyB:g.bodyB[m]};switch(g.type){case"LockConstraint":break;case"DistanceConstraint":v.distance=g.distance;break;case"HingeConstraint":case"ConeTwistConstraint":v.axisA=p(g.axisA),v.axisB=p(g.axisB),v.pivotA=p(g.pivotA),v.pivotB=p(g.pivotB);break;case"PointToPointConstraint":v.pivotA=p(g.pivotA),v.pivotB=p(g.pivotB);break;default:throw new Error("Unexpected constraint type: "+g.type+'. You may need to manually set `constraint.type = "FooConstraint";`.')}return v},be.exports.deserializeConstraint=function(g,v){var T,y=h[g.type],M=v[g.bodyA],_=v[g.bodyB];switch(g.type){case"LockConstraint":T=new h.LockConstraint(M,_,g);break;case"DistanceConstraint":T=new h.DistanceConstraint(M,_,g.distance,g.maxForce);break;case"HingeConstraint":case"ConeTwistConstraint":T=new y(M,_,{pivotA:d(g.pivotA),pivotB:d(g.pivotB),axisA:d(g.axisA),axisB:d(g.axisB),maxForce:g.maxForce});break;case"PointToPointConstraint":T=new h.PointToPointConstraint(M,d(g.pivotA),_,d(g.pivotB),g.maxForce);break;default:throw new Error("Unexpected constraint type: "+g.type)}return T[m]=g.id,T},be.exports.serializeContact=function(g){return{bi:g.bi[m],bj:g.bj[m],ni:p(g.ni),ri:p(g.ri),rj:p(g.rj)}},be.exports.deserializeContact=function(g,v){return{bi:v[g.bi],bj:v[g.bj],ni:d(g.ni),ri:d(g.ri),rj:d(g.rj)}},be.exports.serializeVec3=p,be.exports.deserializeVec3=d,be.exports.serializeQuaternion=A,be.exports.deserializeQuaternion=E},{"./math":29,"cannon-es":4}]},{},[1]),function ee(be,ue,h){function C(c,u){if(!ue[c]){if(!be[c]){var p="function"==typeof require&&require;if(!u&&p)return p(c,!0);if(m)return m(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var A=ue[c]={exports:{}};be[c][0].call(A.exports,function(E){return C(be[c][1][E]||E)},A,A.exports,ee,be,ue,h)}return ue[c].exports}for(var m="function"==typeof require&&require,s=0;s<h.length;s++)C(h[s]);return C}({1:[function(ee,be,ue){"use strict";ee("./")},{"./":2}],2:[function(ee,be,ue){"use strict";ee("./src/controls"),ee("./src/loaders"),ee("./src/misc"),ee("./src/pathfinding"),ee("./src/primitives")},{"./src/controls":14,"./src/loaders":23,"./src/misc":28,"./src/pathfinding":34,"./src/primitives":42}],3:[function(ee,be,ue){"use strict";be.exports=THREE.ColladaLoader=function(h){this.manager=void 0!==h?h:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(h,C,m,s){var c=this,u=void 0===c.path?THREE.LoaderUtils.extractUrlBase(h):c.path,p=new THREE.FileLoader(c.manager);p.setPath(c.path),p.load(h,function(d){C(c.parse(d,u))},m,s)},setPath:function(h){return this.path=h,this},setResourcePath:function(h){return this.resourcePath=h,this},options:{set convertUpAxis(h){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(h){return this.crossOrigin=h,this},parse:function(h,C){function m(Me,qe){for(var at=[],ot=Me.childNodes,dt=0,St=ot.length;dt<St;dt++){var It=ot[dt];It.nodeName===qe&&at.push(It)}return at}function s(Me){if(0===Me.length)return[];for(var qe=Me.trim().split(/\s+/),at=new Array(qe.length),ot=0,dt=qe.length;ot<dt;ot++)at[ot]=qe[ot];return at}function c(Me){if(0===Me.length)return[];for(var qe=Me.trim().split(/\s+/),at=new Array(qe.length),ot=0,dt=qe.length;ot<dt;ot++)at[ot]=parseFloat(qe[ot]);return at}function u(Me){if(0===Me.length)return[];for(var qe=Me.trim().split(/\s+/),at=new Array(qe.length),ot=0,dt=qe.length;ot<dt;ot++)at[ot]=parseInt(qe[ot]);return at}function p(Me){return Me.substring(1)}function A(Me){return 0===Object.keys(Me).length}function E(Me,qe,at,ot){var dt=m(Me,qe)[0];if(void 0!==dt)for(var St=m(dt,at),It=0;It<St.length;It++)ot(St[It])}function g(Me,qe){for(var at in Me)Me[at].build=qe(Me[at])}function v(Me,qe){return void 0!==Me.build||(Me.build=qe(Me)),Me.build}function T(Me){var qe=[],at=Me.channels,ot=Me.samplers,dt=Me.sources;for(var St in at)if(at.hasOwnProperty(St)){var It=at[St],Zt=ot[It.sampler];!function(We,ft){for(var Mt=We.keyframes,Ht=We.name,kt=[],Ft=[],jt=[],ln=[],vn=0,hn=Mt.length;vn<hn;vn++){var zn=Mt[vn],xn=zn.time;ut.fromArray(zn.value).transpose(),ut.decompose(Ve,nt,Ke),kt.push(xn),Ft.push(Ve.x,Ve.y,Ve.z),jt.push(nt.x,nt.y,nt.z,nt.w),ln.push(Ke.x,Ke.y,Ke.z)}Ft.length>0&&ft.push(new THREE.VectorKeyframeTrack(Ht+".position",kt,Ft)),jt.length>0&&ft.push(new THREE.QuaternionKeyframeTrack(Ht+".quaternion",kt,jt)),ln.length>0&&ft.push(new THREE.VectorKeyframeTrack(Ht+".scale",kt,ln))}(function(We,ft,Mt){var Ht,kt,Ft,jt,ln,vn,hn=Ye.nodes[We.id],zn=Re(hn.id),xn=hn.transforms[We.sid],nr=hn.matrix.clone().transpose(),Pn={};switch(xn){case"matrix":for(Ft=0,jt=ft.array.length;Ft<jt;Ft++)if(kt=Ft*Mt.stride,void 0===Pn[Ht=ft.array[Ft]]&&(Pn[Ht]={}),!0===We.arraySyntax)Pn[Ht][We.indices[0]+4*We.indices[1]]=Mt.array[kt];else for(ln=0,vn=Mt.stride;ln<vn;ln++)Pn[Ht][ln]=Mt.array[kt+ln];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',xn)}var ur=function(Si,ti){var Pr=[];for(var xa in Si)Pr.push({time:parseFloat(xa),value:Si[xa]});Pr.sort(function(Qe,yt){return Qe.time-yt.time});for(var Pe=0;Pe<16;Pe++)!function(Qe,yt,Nt){var Dt,Qt,gn,On=!0;for(Qt=0,gn=Qe.length;Qt<gn;Qt++)void 0===(Dt=Qe[Qt]).value[yt]?Dt.value[yt]=null:On=!1;if(!0===On)for(Qt=0,gn=Qe.length;Qt<gn;Qt++)(Dt=Qe[Qt]).value[yt]=Nt;else!function(bn,Wt){for(var Wn,qn,rr=0,pi=bn.length;rr<pi;rr++){var xr=bn[rr];if(null===xr.value[Wt]){if(Wn=function(ir,cr,Jr){for(;cr>=0;){var li=ir[cr];if(null!==li.value[Jr])return li;cr--}return null}(bn,rr,Wt),qn=function(ir,cr,Jr){for(;cr<ir.length;){var li=ir[cr];if(null!==li.value[Jr])return li;cr++}return null}(bn,rr,Wt),null===Wn){xr.value[Wt]=qn.value[Wt];continue}if(null===qn){xr.value[Wt]=Wn.value[Wt];continue}(ir=xr).value[li=Wt]=(Jr=qn).time-(cr=Wn).time!=0?(ir.time-cr.time)*(Jr.value[li]-cr.value[li])/(Jr.time-cr.time)+cr.value[li]:cr.value[li]}}var ir,cr,Jr,li}(Qe,yt)}(Pr,Pe,ti.elements[Pe]);return Pr}(Pn,nr);return{name:zn.uuid,keyframes:ur}}(It,dt[Zt.inputs.INPUT],dt[Zt.inputs.OUTPUT]),qe)}return qe}function y(Me){return v(Ye.animations[Me],T)}function M(Me){for(var qe=[],at=Me.name,ot=Me.end-Me.start||-1,dt=Me.animations,St=0,It=dt.length;St<It;St++)for(var Zt=y(dt[St]),Xt=0,Vt=Zt.length;Xt<Vt;Xt++)qe.push(Zt[Xt]);return new THREE.AnimationClip(at,ot,qe)}function _(Me){return v(Ye.clips[Me],M)}function O(Me){var qe={id:Me.id},at=Ye.geometries[qe.id];return void 0!==Me.skin&&(qe.skin=function(ot){function dt(Si,ti){return ti.weight-Si.weight}var St,It,Zt,Xt={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},We=ot.vertexWeights,ft=We.vcount,Mt=We.v,Ht=We.inputs.JOINT.offset,kt=We.inputs.WEIGHT.offset,Ft=ot.sources[ot.joints.inputs.JOINT],jt=ot.sources[ot.joints.inputs.INV_BIND_MATRIX],ln=ot.sources[We.inputs.WEIGHT.id].array,vn=0;for(St=0,Zt=ft.length;St<Zt;St++){var hn=ft[St],zn=[];for(It=0;It<hn;It++)zn.push({index:Mt[vn+Ht],weight:ln[Mt[vn+kt]]}),vn+=2;for(zn.sort(dt),It=0;It<4;It++){var jr=zn[It];void 0!==jr?(Xt.indices.array.push(jr.index),Xt.weights.array.push(jr.weight)):(Xt.indices.array.push(0),Xt.weights.array.push(0))}}for(Xt.bindMatrix=ot.bindShapeMatrix?(new THREE.Matrix4).fromArray(ot.bindShapeMatrix).transpose():(new THREE.Matrix4).identity(),St=0,Zt=Ft.array.length;St<Zt;St++){var Xr=Ft.array[St],ur=(new THREE.Matrix4).fromArray(jt.array,St*jt.stride).transpose();Xt.joints.push({name:Xr,boneInverse:ur})}return Xt}(Me.skin),at.sources.skinIndices=qe.skin.indices,at.sources.skinWeights=qe.skin.weights),qe}function D(Me){return v(Ye.controllers[Me],O)}function B(Me){return void 0!==Me.build?Me.build:Me.init_from}function H(Me){var qe=Ye.images[Me];return void 0!==qe?v(qe,B):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",Me),null)}function q(Me){for(var qe={},at=0,ot=Me.childNodes.length;at<ot;at++){var dt=Me.childNodes[at];if(1===dt.nodeType)switch(dt.nodeName){case"color":qe[dt.nodeName]=c(dt.textContent);break;case"float":qe[dt.nodeName]=parseFloat(dt.textContent);break;case"texture":qe[dt.nodeName]={id:dt.getAttribute("texture"),extra:function(St){for(var It={technique:{}},Zt=0,Xt=St.childNodes.length;Zt<Xt;Zt++){var Vt=St.childNodes[Zt];1===Vt.nodeType&&"extra"===Vt.nodeName&&function(We,ft){for(var Mt=0,Ht=We.childNodes.length;Mt<Ht;Mt++){var kt=We.childNodes[Mt];1===kt.nodeType&&"technique"===kt.nodeName&&function(Ft,jt){for(var ln=0,vn=Ft.childNodes.length;ln<vn;ln++){var hn=Ft.childNodes[ln];if(1===hn.nodeType)switch(hn.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":jt.technique[hn.nodeName]=parseFloat(hn.textContent);break;case"wrapU":case"wrapV":jt.technique[hn.nodeName]="TRUE"===hn.textContent.toUpperCase()?1:"FALSE"===hn.textContent.toUpperCase()?0:parseInt(hn.textContent)}}}(kt,ft)}}(Vt,It)}return It}(dt)}}}return qe}function V(Me){return Me}function ne(Me){function qe(Mt){var hn,Ht=ot.profile.samplers[Mt.id],kt=null;if(void 0!==Ht?kt=H(ot.profile.surfaces[Ht.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),kt=H(Mt.id)),null!==kt){var Ft="tga"===(hn=kt).slice(2+(hn.lastIndexOf(".")-1>>>0)).toLowerCase()?Ce:mn;if(void 0!==Ft){var jt=Ft.load(kt),ln=Mt.extra;if(void 0!==ln&&void 0!==ln.technique&&!1===A(ln.technique)){var vn=ln.technique;jt.wrapS=vn.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,jt.wrapT=vn.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,jt.offset.set(vn.offsetU||0,vn.offsetV||0),jt.repeat.set(vn.repeatU||1,vn.repeatV||1)}else jt.wrapS=THREE.RepeatWrapping,jt.wrapT=THREE.RepeatWrapping;return jt}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",kt),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",Mt.id),null}var at,ot=v(Ye.effects[Me.url],V),dt=ot.profile.technique,St=ot.profile.extra;switch(dt.type){case"phong":case"blinn":at=new THREE.MeshPhongMaterial;break;case"lambert":at=new THREE.MeshLambertMaterial;break;default:at=new THREE.MeshBasicMaterial}at.name=Me.name;var It=dt.parameters;for(var Zt in It){var Xt=It[Zt];switch(Zt){case"diffuse":Xt.color&&at.color.fromArray(Xt.color),Xt.texture&&(at.map=qe(Xt.texture));break;case"specular":Xt.color&&at.specular&&at.specular.fromArray(Xt.color),Xt.texture&&(at.specularMap=qe(Xt.texture));break;case"bump":Xt.texture&&(at.normalMap=qe(Xt.texture));break;case"ambient":Xt.texture&&(at.lightMap=qe(Xt.texture));break;case"shininess":Xt.float&&at.shininess&&(at.shininess=Xt.float);break;case"emission":Xt.color&&at.emissive&&at.emissive.fromArray(Xt.color),Xt.texture&&(at.emissiveMap=qe(Xt.texture))}}var Vt=It.transparent,We=It.transparency;if(void 0===We&&Vt&&(We={float:1}),void 0===Vt&&We&&(Vt={opaque:"A_ONE",data:{color:[1,1,1,1]}}),Vt&&We)if(Vt.data.texture)at.transparent=!0;else{var ft=Vt.data.color;switch(Vt.opaque){case"A_ONE":at.opacity=ft[3]*We.float;break;case"RGB_ZERO":at.opacity=1-ft[0]*We.float;break;case"A_ZERO":at.opacity=1-ft[3]*We.float;break;case"RGB_ONE":at.opacity=ft[0]*We.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',Vt.opaque)}at.opacity<1&&(at.transparent=!0)}return void 0!==St&&void 0!==St.technique&&1===St.technique.double_sided&&(at.side=THREE.DoubleSide),at}function ae(Me){return v(Ye.materials[Me],ne)}function fe(Me){var qe;switch(Me.optics.technique){case"perspective":qe=new THREE.PerspectiveCamera(Me.optics.parameters.yfov,Me.optics.parameters.aspect_ratio,Me.optics.parameters.znear,Me.optics.parameters.zfar);break;case"orthographic":var at=Me.optics.parameters.ymag,ot=Me.optics.parameters.xmag,dt=Me.optics.parameters.aspect_ratio;ot=void 0===ot?at*dt:ot,at=void 0===at?ot/dt:at,ot*=.5,at*=.5,qe=new THREE.OrthographicCamera(-ot,ot,at,-at,Me.optics.parameters.znear,Me.optics.parameters.zfar);break;default:qe=new THREE.PerspectiveCamera}return qe.name=Me.name,qe}function he(Me){var qe=Ye.cameras[Me];return void 0!==qe?v(qe,fe):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",Me),null)}function me(Me){var qe;switch(Me.technique){case"directional":qe=new THREE.DirectionalLight;break;case"point":qe=new THREE.PointLight;break;case"spot":qe=new THREE.SpotLight;break;case"ambient":qe=new THREE.AmbientLight}return Me.parameters.color&&qe.color.copy(Me.parameters.color),Me.parameters.distance&&(qe.distance=Me.parameters.distance),qe}function P(Me){var qe=Ye.lights[Me];return void 0!==qe?v(qe,me):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",Me),null)}function X(Me){for(var qe={array:[],stride:3},at=0;at<Me.childNodes.length;at++){var ot=Me.childNodes[at];if(1===ot.nodeType)switch(ot.nodeName){case"float_array":qe.array=c(ot.textContent);break;case"Name_array":qe.array=s(ot.textContent);break;case"technique_common":var dt=m(ot,"accessor")[0];void 0!==dt&&(qe.stride=parseInt(dt.getAttribute("stride")))}}return qe}function W(Me){for(var qe=0,at=0,ot=Me.length;at<ot;at++)!0===Me[at].hasUV&&qe++;qe>0&&qe<Me.length&&(Me.uvsNeedsFix=!0)}function te(Me){var qe={},at=Me.sources,ot=Me.vertices,dt=Me.primitives;if(0===dt.length)return{};var St=function(Xt){for(var Vt={},We=0;We<Xt.length;We++){var ft=Xt[We];void 0===Vt[ft.type]&&(Vt[ft.type]=[]),Vt[ft.type].push(ft)}return Vt}(dt);for(var It in St){var Zt=St[It];W(Zt),qe[It]=function(Xt,Vt,We){for(var ft={},Mt={array:[],stride:0},Ht={array:[],stride:0},kt={array:[],stride:0},Ft={array:[],stride:0},jt={array:[],stride:0},ln={array:[],stride:4},vn={array:[],stride:4},hn=new THREE.BufferGeometry,zn=[],xn=0,nr=0;nr<Xt.length;nr++){var Pn=Xt[nr],jr=Pn.inputs,Xr=0;switch(Pn.type){case"lines":case"linestrips":Xr=2*Pn.count;break;case"triangles":Xr=3*Pn.count;break;case"polylist":for(var ur=0;ur<Pn.count;ur++){var Si=Pn.vcount[ur];switch(Si){case 3:Xr+=3;break;case 4:Xr+=6;break;default:Xr+=3*(Si-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",Pn.type)}for(var ti in hn.addGroup(xn,Xr,nr),xn+=Xr,Pn.material&&zn.push(Pn.material),jr){var Pr=jr[ti];switch(ti){case"VERTEX":for(var xa in We){var Pe=We[xa];switch(xa){case"POSITION":var Qe=Mt.array.length;if(ce(Pn,Vt[Pe],Pr.offset,Mt.array),Mt.stride=Vt[Pe].stride,Vt.skinWeights&&Vt.skinIndices&&(ce(Pn,Vt.skinIndices,Pr.offset,ln.array),ce(Pn,Vt.skinWeights,Pr.offset,vn.array)),!1===Pn.hasUV&&!0===Xt.uvsNeedsFix){Xr=(Mt.array.length-Qe)/Mt.stride;for(var yt=0;yt<Xr;yt++)kt.array.push(0,0)}break;case"NORMAL":ce(Pn,Vt[Pe],Pr.offset,Ht.array),Ht.stride=Vt[Pe].stride;break;case"COLOR":ce(Pn,Vt[Pe],Pr.offset,jt.array),jt.stride=Vt[Pe].stride;break;case"TEXCOORD":ce(Pn,Vt[Pe],Pr.offset,kt.array),kt.stride=Vt[Pe].stride;break;case"TEXCOORD1":ce(Pn,Vt[Pe],Pr.offset,Ft.array),kt.stride=Vt[Pe].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',xa)}}break;case"NORMAL":ce(Pn,Vt[Pr.id],Pr.offset,Ht.array),Ht.stride=Vt[Pr.id].stride;break;case"COLOR":ce(Pn,Vt[Pr.id],Pr.offset,jt.array),jt.stride=Vt[Pr.id].stride;break;case"TEXCOORD":ce(Pn,Vt[Pr.id],Pr.offset,kt.array),kt.stride=Vt[Pr.id].stride;break;case"TEXCOORD1":ce(Pn,Vt[Pr.id],Pr.offset,Ft.array),Ft.stride=Vt[Pr.id].stride}}}return Mt.array.length>0&&hn.addAttribute("position",new THREE.Float32BufferAttribute(Mt.array,Mt.stride)),Ht.array.length>0&&hn.addAttribute("normal",new THREE.Float32BufferAttribute(Ht.array,Ht.stride)),jt.array.length>0&&hn.addAttribute("color",new THREE.Float32BufferAttribute(jt.array,jt.stride)),kt.array.length>0&&hn.addAttribute("uv",new THREE.Float32BufferAttribute(kt.array,kt.stride)),Ft.array.length>0&&hn.addAttribute("uv2",new THREE.Float32BufferAttribute(Ft.array,Ft.stride)),ln.array.length>0&&hn.addAttribute("skinIndex",new THREE.Float32BufferAttribute(ln.array,ln.stride)),vn.array.length>0&&hn.addAttribute("skinWeight",new THREE.Float32BufferAttribute(vn.array,vn.stride)),ft.data=hn,ft.type=Xt[0].type,ft.materialKeys=zn,ft}(Zt,at,ot)}return qe}function ce(Me,qe,at,ot){function dt(zn){for(var xn=St[zn+at]*Vt,nr=xn+Vt;xn<nr;xn++)ot.push(Xt[xn])}var St=Me.p,It=Me.stride,Zt=Me.vcount,Xt=qe.array,Vt=qe.stride;if(void 0!==Me.vcount)for(var We=0,ft=0,Mt=Zt.length;ft<Mt;ft++){var Ht=Zt[ft];if(4===Ht){var kt=We+1*It,Ft=We+2*It,jt=We+3*It;dt(hn=We+0*It),dt(kt),dt(jt),dt(kt),dt(Ft),dt(jt)}else if(3===Ht)kt=We+1*It,Ft=We+2*It,dt(hn=We+0*It),dt(kt),dt(Ft);else if(Ht>4)for(var ln=1,vn=Ht-2;ln<=vn;ln++){var hn=We+0*It;kt=We+It*ln,Ft=We+It*(ln+1),dt(hn),dt(kt),dt(Ft)}We+=It*Ht}else for(ft=0,Mt=St.length;ft<Mt;ft+=It)dt(ft)}function Se(Me){return v(Ye.geometries[Me],te)}function _e(Me){return void 0!==Me.build?Me.build:Me}function ze(Me){for(var qe={sid:Me.getAttribute("sid"),name:Me.getAttribute("name")||"",attachments:[],transforms:[]},at=0;at<Me.childNodes.length;at++){var ot=Me.childNodes[at];if(1===ot.nodeType)switch(ot.nodeName){case"attachment_full":qe.attachments.push(function(dt){for(var St={joint:dt.getAttribute("joint").split("/").pop(),transforms:[],links:[]},It=0;It<dt.childNodes.length;It++){var Zt=dt.childNodes[It];if(1===Zt.nodeType)switch(Zt.nodeName){case"link":St.links.push(ze(Zt));break;case"matrix":case"translate":case"rotate":St.transforms.push(rt(Zt))}}return St}(ot));break;case"matrix":case"translate":case"rotate":qe.transforms.push(rt(ot))}}return qe}function rt(Me){var qe={type:Me.nodeName},at=c(Me.textContent);switch(qe.type){case"matrix":qe.obj=new THREE.Matrix4,qe.obj.fromArray(at).transpose();break;case"translate":qe.obj=new THREE.Vector3,qe.obj.fromArray(at);break;case"rotate":qe.obj=new THREE.Vector3,qe.obj.fromArray(at),qe.angle=THREE.Math.degToRad(at[3])}return qe}function gt(Me){return void 0!==Me.build?Me.build:Me}function Tt(Me){for(var qe={name:Me.getAttribute("name")||"",type:Me.getAttribute("type"),id:Me.getAttribute("id"),sid:Me.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},at=0;at<Me.childNodes.length;at++){var ot=Me.childNodes[at];if(1===ot.nodeType)switch(ot.nodeName){case"node":qe.nodes.push(ot.getAttribute("id")),Tt(ot);break;case"instance_camera":qe.instanceCameras.push(p(ot.getAttribute("url")));break;case"instance_controller":qe.instanceControllers.push($t(ot));break;case"instance_light":qe.instanceLights.push(p(ot.getAttribute("url")));break;case"instance_geometry":qe.instanceGeometries.push($t(ot));break;case"instance_node":qe.instanceNodes.push(p(ot.getAttribute("url")));break;case"matrix":dt=c(ot.textContent),qe.matrix.multiply(ut.fromArray(dt).transpose()),qe.transforms[ot.getAttribute("sid")]=ot.nodeName;break;case"translate":dt=c(ot.textContent),ht.fromArray(dt),qe.matrix.multiply(ut.makeTranslation(ht.x,ht.y,ht.z)),qe.transforms[ot.getAttribute("sid")]=ot.nodeName;break;case"rotate":var dt=c(ot.textContent),St=THREE.Math.degToRad(dt[3]);qe.matrix.multiply(ut.makeRotationAxis(ht.fromArray(dt),St)),qe.transforms[ot.getAttribute("sid")]=ot.nodeName;break;case"scale":dt=c(ot.textContent),qe.matrix.scale(ht.fromArray(dt)),qe.transforms[ot.getAttribute("sid")]=ot.nodeName;break;case"extra":break;default:console.log(ot)}}return Un(qe.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",qe.id):Ye.nodes[qe.id]=qe,qe}function $t(Me){for(var qe={id:p(Me.getAttribute("url")),materials:{},skeletons:[]},at=0;at<Me.childNodes.length;at++){var ot=Me.childNodes[at];switch(ot.nodeName){case"bind_material":for(var dt=ot.getElementsByTagName("instance_material"),St=0;St<dt.length;St++){var It=dt[St],Zt=It.getAttribute("symbol"),Xt=It.getAttribute("target");qe.materials[Zt]=p(Xt)}break;case"skeleton":qe.skeletons.push(p(ot.textContent))}}return qe}function un(Me,qe){var at,ot,dt=[],St=[];for(at=0;at<Me.length;at++){var It=Me[at];if(Un(It))In(Re(It),qe,dt);else if(void 0!==Ye.visualScenes[It])for(var Zt=Ye.visualScenes[It].children,Xt=0;Xt<Zt.length;Xt++){var Vt=Zt[Xt];"JOINT"===Vt.type&&In(Re(Vt.id),qe,dt)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",It)}for(at=0;at<qe.length;at++)for(Xt=0;Xt<dt.length;Xt++)if((ot=dt[Xt]).bone.name===qe[at].name){St[at]=ot,ot.processed=!0;break}for(at=0;at<dt.length;at++)!1===(ot=dt[at]).processed&&(St.push(ot),ot.processed=!0);var We=[],ft=[];for(at=0;at<St.length;at++)We.push((ot=St[at]).bone),ft.push(ot.boneInverse);return new THREE.Skeleton(We,ft)}function In(Me,qe,at){Me.traverse(function(ot){if(!0===ot.isBone){for(var dt,St=0;St<qe.length;St++){var It=qe[St];if(It.name===ot.name){dt=It.boneInverse;break}}void 0===dt&&(dt=new THREE.Matrix4),at.push({bone:ot,boneInverse:dt,processed:!1})}})}function sn(Me){for(var qe=[],at=Me.matrix,ot=Me.nodes,dt=Me.type,St=Me.instanceCameras,It=Me.instanceControllers,Zt=Me.instanceLights,Xt=Me.instanceGeometries,Vt=Me.instanceNodes,We=0,ft=ot.length;We<ft;We++)qe.push(Re(ot[We]));for(We=0,ft=St.length;We<ft;We++){var Mt=he(St[We]);null!==Mt&&qe.push(Mt.clone())}for(We=0,ft=It.length;We<ft;We++)for(var Ht=D((hn=It[We]).id),kt=Cr(zn=Se(Ht.id),hn.materials),Ft=un(hn.skeletons,Ht.skin.joints),jt=0,ln=kt.length;jt<ln;jt++)(xn=kt[jt]).isSkinnedMesh&&(xn.bind(Ft,Ht.skin.bindMatrix),xn.normalizeSkinWeights()),qe.push(xn);for(We=0,ft=Zt.length;We<ft;We++){var vn=P(Zt[We]);null!==vn&&qe.push(vn.clone())}for(We=0,ft=Xt.length;We<ft;We++){var hn=Xt[We],zn=Se(hn.id);for(jt=0,ln=(kt=Cr(zn,hn.materials)).length;jt<ln;jt++)qe.push(kt[jt])}for(We=0,ft=Vt.length;We<ft;We++)qe.push(Re(Vt[We]).clone());var xn;if(0===ot.length&&1===qe.length)xn=qe[0];else for(xn="JOINT"===dt?new THREE.Bone:new THREE.Group,We=0;We<qe.length;We++)xn.add(qe[We]);return""===xn.name&&(xn.name="JOINT"===dt?Me.sid:Me.name),xn.matrix.copy(at),xn.matrix.decompose(xn.position,xn.quaternion,xn.scale),xn}function tr(Me,qe){for(var at=[],ot=0,dt=Me.length;ot<dt;ot++){var St=qe[Me[ot]];void 0===St?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",Me[ot]),at.push(_t)):at.push(ae(St))}return at}function Cr(Me,qe){var at=[];for(var ot in Me){var dt=Me[ot],St=tr(dt.materialKeys,qe);0===St.length&&St.push("lines"===ot||"linestrips"===ot?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial);var It=void 0!==dt.data.attributes.skinIndex;if(It)for(var Zt=0,Xt=St.length;Zt<Xt;Zt++)St[Zt].skinning=!0;var Vt,We=1===St.length?St[0]:St;switch(ot){case"lines":Vt=new THREE.LineSegments(dt.data,We);break;case"linestrips":Vt=new THREE.Line(dt.data,We);break;case"triangles":case"polylist":Vt=It?new THREE.SkinnedMesh(dt.data,We):new THREE.Mesh(dt.data,We)}at.push(Vt)}return at}function Un(Me){return void 0!==Ye.nodes[Me]}function Re(Me){return v(Ye.nodes[Me],sn)}function Oe(Me){var qe=new THREE.Group;qe.name=Me.name;for(var at=Me.children,ot=0;ot<at.length;ot++)qe.add(Re(at[ot].id));return qe}function $e(Me){return v(Ye.visualScenes[Me],Oe)}var Ve=new THREE.Vector3,Ke=new THREE.Vector3,nt=new THREE.Quaternion,ut=new THREE.Matrix4,ht=new THREE.Vector3,_t=new THREE.MeshBasicMaterial({color:16711935});if(0===h.length)return{scene:new THREE.Scene};var Bt=m((new DOMParser).parseFromString(h,"application/xml"),"COLLADA")[0],Kt=Bt.getAttribute("version");console.log("THREE.ColladaLoader: File version",Kt);var Me,qe,Ce,rn=(Me=m(Bt,"asset")[0],{unit:(qe=m(Me,"unit")[0],void 0!==qe&&!0===qe.hasAttribute("meter")?parseFloat(qe.getAttribute("meter")):1),upAxis:function(qe){return void 0!==qe?qe.textContent:"Y_UP"}(m(Me,"up_axis")[0])}),mn=new THREE.TextureLoader(this.manager);mn.setPath(this.resourcePath||C).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Ce=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||C);var ie=[],le={},Fe=0,Ye={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};E(Bt,"library_animations","animation",function(Me){for(var qe={sources:{},samplers:{},channels:{}},at=0,ot=Me.childNodes.length;at<ot;at++){var St,dt=Me.childNodes[at];if(1===dt.nodeType)switch(dt.nodeName){case"source":St=dt.getAttribute("id"),qe.sources[St]=X(dt);break;case"sampler":St=dt.getAttribute("id"),qe.samplers[St]=function(It){for(var Zt={inputs:{}},Xt=0,Vt=It.childNodes.length;Xt<Vt;Xt++){var We=It.childNodes[Xt];if(1===We.nodeType&&"input"===We.nodeName){var ft=p(We.getAttribute("source")),Mt=We.getAttribute("semantic");Zt.inputs[Mt]=ft}}return Zt}(dt);break;case"channel":St=dt.getAttribute("target"),qe.channels[St]=function(It){var Zt={},Xt=It.getAttribute("target").split("/"),Vt=Xt.shift(),We=Xt.shift(),ft=-1!==We.indexOf("("),Mt=-1!==We.indexOf(".");if(Mt)Xt=We.split("."),We=Xt.shift(),Zt.member=Xt.shift();else if(ft){var Ht=We.split("(");We=Ht.shift();for(var kt=0;kt<Ht.length;kt++)Ht[kt]=parseInt(Ht[kt].replace(/\)/,""));Zt.indices=Ht}return Zt.id=Vt,Zt.sid=We,Zt.arraySyntax=ft,Zt.memberSyntax=Mt,Zt.sampler=p(It.getAttribute("source")),Zt}(dt);break;default:console.log(dt)}}Ye.animations[Me.getAttribute("id")]=qe}),E(Bt,"library_animation_clips","animation_clip",function(Me){for(var qe={name:Me.getAttribute("id")||"default",start:parseFloat(Me.getAttribute("start")||0),end:parseFloat(Me.getAttribute("end")||0),animations:[]},at=0,ot=Me.childNodes.length;at<ot;at++){var dt=Me.childNodes[at];1===dt.nodeType&&"instance_animation"===dt.nodeName&&qe.animations.push(p(dt.getAttribute("url")))}Ye.clips[Me.getAttribute("id")]=qe}),E(Bt,"library_controllers","controller",function(Me){for(var qe={},at=0,ot=Me.childNodes.length;at<ot;at++){var dt=Me.childNodes[at];if(1===dt.nodeType)switch(dt.nodeName){case"skin":qe.id=p(dt.getAttribute("source")),qe.skin=function(St){for(var It={sources:{}},Zt=0,Xt=St.childNodes.length;Zt<Xt;Zt++){var Vt=St.childNodes[Zt];if(1===Vt.nodeType)switch(Vt.nodeName){case"bind_shape_matrix":It.bindShapeMatrix=c(Vt.textContent);break;case"source":var We=Vt.getAttribute("id");It.sources[We]=X(Vt);break;case"joints":It.joints=function(ft){for(var Mt={inputs:{}},Ht=0,kt=ft.childNodes.length;Ht<kt;Ht++){var Ft=ft.childNodes[Ht];if(1===Ft.nodeType&&"input"===Ft.nodeName){var jt=Ft.getAttribute("semantic"),ln=p(Ft.getAttribute("source"));Mt.inputs[jt]=ln}}return Mt}(Vt);break;case"vertex_weights":It.vertexWeights=function(ft){for(var Mt={inputs:{}},Ht=0,kt=ft.childNodes.length;Ht<kt;Ht++){var Ft=ft.childNodes[Ht];if(1===Ft.nodeType)switch(Ft.nodeName){case"input":var jt=Ft.getAttribute("semantic"),ln=p(Ft.getAttribute("source")),vn=parseInt(Ft.getAttribute("offset"));Mt.inputs[jt]={id:ln,offset:vn};break;case"vcount":Mt.vcount=u(Ft.textContent);break;case"v":Mt.v=u(Ft.textContent)}}return Mt}(Vt)}}return It}(dt);break;case"morph":qe.id=p(dt.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ye.controllers[Me.getAttribute("id")]=qe}),E(Bt,"library_images","image",function(Me){var qe={init_from:m(Me,"init_from")[0].textContent};Ye.images[Me.getAttribute("id")]=qe}),E(Bt,"library_effects","effect",function(Me){for(var qe={},at=0,ot=Me.childNodes.length;at<ot;at++){var dt=Me.childNodes[at];1===dt.nodeType&&"profile_COMMON"===dt.nodeName&&(qe.profile=function(St){for(var It={surfaces:{},samplers:{}},Zt=0,Xt=St.childNodes.length;Zt<Xt;Zt++){var Vt=St.childNodes[Zt];if(1===Vt.nodeType)switch(Vt.nodeName){case"newparam":!function(We,ft){for(var Mt=We.getAttribute("sid"),Ht=0,kt=We.childNodes.length;Ht<kt;Ht++){var Ft=We.childNodes[Ht];if(1===Ft.nodeType)switch(Ft.nodeName){case"surface":ft.surfaces[Mt]=function(jt){for(var ln={},vn=0,hn=jt.childNodes.length;vn<hn;vn++){var zn=jt.childNodes[vn];1===zn.nodeType&&"init_from"===zn.nodeName&&(ln.init_from=zn.textContent)}return ln}(Ft);break;case"sampler2D":ft.samplers[Mt]=function(jt){for(var ln={},vn=0,hn=jt.childNodes.length;vn<hn;vn++){var zn=jt.childNodes[vn];1===zn.nodeType&&"source"===zn.nodeName&&(ln.source=zn.textContent)}return ln}(Ft)}}}(Vt,It);break;case"technique":It.technique=function(We){for(var ft={},Mt=0,Ht=We.childNodes.length;Mt<Ht;Mt++){var kt=We.childNodes[Mt];if(1===kt.nodeType)switch(kt.nodeName){case"constant":case"lambert":case"blinn":case"phong":ft.type=kt.nodeName,ft.parameters=function(Ft){for(var jt={},ln=0,vn=Ft.childNodes.length;ln<vn;ln++){var hn=Ft.childNodes[ln];if(1===hn.nodeType)switch(hn.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":jt[hn.nodeName]=q(hn);break;case"transparent":jt[hn.nodeName]={opaque:hn.getAttribute("opaque"),data:q(hn)}}}return jt}(kt)}}return ft}(Vt);break;case"extra":It.extra=function(We){for(var ft={},Mt=0,Ht=We.childNodes.length;Mt<Ht;Mt++){var kt=We.childNodes[Mt];1===kt.nodeType&&"technique"===kt.nodeName&&(ft.technique=function(Ft){for(var jt={},ln=0,vn=Ft.childNodes.length;ln<vn;ln++){var hn=Ft.childNodes[ln];1===hn.nodeType&&"double_sided"===hn.nodeName&&(jt[hn.nodeName]=parseInt(hn.textContent))}return jt}(kt))}return ft}(Vt)}}return It}(dt))}Ye.effects[Me.getAttribute("id")]=qe}),E(Bt,"library_materials","material",function(Me){for(var qe={name:Me.getAttribute("name")},at=0,ot=Me.childNodes.length;at<ot;at++){var dt=Me.childNodes[at];1===dt.nodeType&&"instance_effect"===dt.nodeName&&(qe.url=p(dt.getAttribute("url")))}Ye.materials[Me.getAttribute("id")]=qe}),E(Bt,"library_cameras","camera",function(Me){for(var qe={name:Me.getAttribute("name")},at=0,ot=Me.childNodes.length;at<ot;at++){var dt=Me.childNodes[at];1===dt.nodeType&&"optics"===dt.nodeName&&(qe.optics=function(St){for(var It=0;It<St.childNodes.length;It++){var Zt=St.childNodes[It];if("technique_common"===Zt.nodeName)return function(Xt){for(var Vt={},We=0;We<Xt.childNodes.length;We++){var ft=Xt.childNodes[We];switch(ft.nodeName){case"perspective":case"orthographic":Vt.technique=ft.nodeName,Vt.parameters=function(Mt){for(var Ht={},kt=0;kt<Mt.childNodes.length;kt++){var Ft=Mt.childNodes[kt];switch(Ft.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":Ht[Ft.nodeName]=parseFloat(Ft.textContent)}}return Ht}(ft)}}return Vt}(Zt)}return{}}(dt))}Ye.cameras[Me.getAttribute("id")]=qe}),E(Bt,"library_lights","light",function(Me){for(var qe={},at=0,ot=Me.childNodes.length;at<ot;at++){var dt=Me.childNodes[at];1===dt.nodeType&&"technique_common"===dt.nodeName&&(qe=function(St){for(var It={},Zt=0,Xt=St.childNodes.length;Zt<Xt;Zt++){var Vt=St.childNodes[Zt];if(1===Vt.nodeType)switch(Vt.nodeName){case"directional":case"point":case"spot":case"ambient":It.technique=Vt.nodeName,It.parameters=function(We){for(var ft={},Mt=0,Ht=We.childNodes.length;Mt<Ht;Mt++){var kt=We.childNodes[Mt];if(1===kt.nodeType)switch(kt.nodeName){case"color":var Ft=c(kt.textContent);ft.color=(new THREE.Color).fromArray(Ft);break;case"falloff_angle":ft.falloffAngle=parseFloat(kt.textContent);break;case"quadratic_attenuation":var jt=parseFloat(kt.textContent);ft.distance=jt?Math.sqrt(1/jt):0}}return ft}(Vt)}}return It}(dt))}Ye.lights[Me.getAttribute("id")]=qe}),E(Bt,"library_geometries","geometry",function(Me){var qe={name:Me.getAttribute("name"),sources:{},vertices:{},primitives:[]},at=m(Me,"mesh")[0];if(void 0!==at){for(var ot=0;ot<at.childNodes.length;ot++){var dt=at.childNodes[ot];if(1===dt.nodeType){var St=dt.getAttribute("id");switch(dt.nodeName){case"source":qe.sources[St]=X(dt);break;case"vertices":qe.vertices=function(It){for(var Zt={},Xt=0;Xt<It.childNodes.length;Xt++){var Vt=It.childNodes[Xt];1===Vt.nodeType&&(Zt[Vt.getAttribute("semantic")]=p(Vt.getAttribute("source")))}return Zt}(dt);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",dt.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":qe.primitives.push(function(It){for(var Zt={type:It.nodeName,material:It.getAttribute("material"),count:parseInt(It.getAttribute("count")),inputs:{},stride:0,hasUV:!1},Xt=0,Vt=It.childNodes.length;Xt<Vt;Xt++){var We=It.childNodes[Xt];if(1===We.nodeType)switch(We.nodeName){case"input":var ft=p(We.getAttribute("source")),Mt=We.getAttribute("semantic"),Ht=parseInt(We.getAttribute("offset")),kt=parseInt(We.getAttribute("set"));Zt.inputs[kt>0?Mt+kt:Mt]={id:ft,offset:Ht},Zt.stride=Math.max(Zt.stride,Ht+1),"TEXCOORD"===Mt&&(Zt.hasUV=!0);break;case"vcount":Zt.vcount=u(We.textContent);break;case"p":Zt.p=u(We.textContent)}}return Zt}(dt));break;default:console.log(dt)}}}Ye.geometries[Me.getAttribute("id")]=qe}}),E(Bt,"library_nodes","node",Tt),E(Bt,"library_visual_scenes","visual_scene",function(Me){var qe={name:Me.getAttribute("name"),children:[]};!function(dt){for(var St=dt.getElementsByTagName("node"),It=0;It<St.length;It++){var Zt=St[It];!1===Zt.hasAttribute("id")&&Zt.setAttribute("id","three_default_"+Fe++)}}(Me);for(var at=m(Me,"node"),ot=0;ot<at.length;ot++)qe.children.push(Tt(at[ot]));Ye.visualScenes[Me.getAttribute("id")]=qe}),E(Bt,"library_kinematics_models","kinematics_model",function(Me){for(var qe={name:Me.getAttribute("name")||"",joints:{},links:[]},at=0;at<Me.childNodes.length;at++){var ot=Me.childNodes[at];1===ot.nodeType&&"technique_common"===ot.nodeName&&function(dt,St){for(var It=0;It<dt.childNodes.length;It++){var Zt=dt.childNodes[It];if(1===Zt.nodeType)switch(Zt.nodeName){case"joint":St.joints[Zt.getAttribute("sid")]=function(Xt){for(var Vt,We=0;We<Xt.childNodes.length;We++){var ft=Xt.childNodes[We];if(1===ft.nodeType)switch(ft.nodeName){case"prismatic":case"revolute":Vt=function(Mt,Ht){Ht={sid:Mt.getAttribute("sid"),name:Mt.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:Mt.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var kt=0;kt<Mt.childNodes.length;kt++){var Ft=Mt.childNodes[kt];if(1===Ft.nodeType)switch(Ft.nodeName){case"axis":var jt=c(Ft.textContent);Ht.axis.fromArray(jt);break;case"limits":var ln=Ft.getElementsByTagName("max")[0],vn=Ft.getElementsByTagName("min")[0];Ht.limits.max=parseFloat(ln.textContent),Ht.limits.min=parseFloat(vn.textContent)}}return Ht.limits.min>=Ht.limits.max&&(Ht.static=!0),Ht.middlePosition=(Ht.limits.min+Ht.limits.max)/2,Ht}(ft)}}return Vt}(Zt);break;case"link":St.links.push(ze(Zt))}}}(ot,qe)}Ye.kinematicsModels[Me.getAttribute("id")]=qe}),E(Bt,"library_physics_models","physics_model",function(Me){for(var qe={name:Me.getAttribute("name")||"",rigidBodies:{}},at=0;at<Me.childNodes.length;at++){var ot=Me.childNodes[at];1===ot.nodeType&&"rigid_body"===ot.nodeName&&(qe.rigidBodies[ot.getAttribute("name")]={},function(dt,St){for(var It=0;It<dt.childNodes.length;It++){var Zt=dt.childNodes[It];1===Zt.nodeType&&"technique_common"===Zt.nodeName&&function(Xt,Vt){for(var We=0;We<Xt.childNodes.length;We++){var ft=Xt.childNodes[We];if(1===ft.nodeType)switch(ft.nodeName){case"inertia":Vt.inertia=c(ft.textContent);break;case"mass":Vt.mass=c(ft.textContent)[0]}}}(Zt,St)}}(ot,qe.rigidBodies[ot.getAttribute("name")]))}Ye.physicsModels[Me.getAttribute("id")]=qe}),E(Bt,"scene","instance_kinematics_scene",function(Me){for(var qe={bindJointAxis:[]},at=0;at<Me.childNodes.length;at++){var ot=Me.childNodes[at];1===ot.nodeType&&"bind_joint_axis"===ot.nodeName&&qe.bindJointAxis.push(function(dt){for(var St={target:dt.getAttribute("target").split("/").pop()},It=0;It<dt.childNodes.length;It++){var Zt=dt.childNodes[It];if(1===Zt.nodeType&&"axis"===Zt.nodeName){var Xt=Zt.getElementsByTagName("param")[0];St.axis=Xt.textContent;var Vt=St.axis.split("inst_").pop().split("axis")[0];St.jointIndex=Vt.substr(0,Vt.length-1)}}return St}(ot))}Ye.kinematicsScenes[p(Me.getAttribute("url"))]=qe}),g(Ye.animations,T),g(Ye.clips,M),g(Ye.controllers,O),g(Ye.images,B),g(Ye.effects,V),g(Ye.materials,ne),g(Ye.cameras,fe),g(Ye.lights,me),g(Ye.geometries,te),g(Ye.visualScenes,Oe),function(){var Me=Ye.clips;if(!0===A(Me)){if(!1===A(Ye.animations)){var qe=[];for(var at in Ye.animations)for(var ot=y(at),dt=0,St=ot.length;dt<St;dt++)qe.push(ot[dt]);ie.push(new THREE.AnimationClip("default",-1,qe))}}else for(var at in Me)ie.push(_(at))}(),function(){function Me(Ft,jt){var ln=jt.getAttribute("name"),vn=dt.joints[Ft];It.traverse(function(hn){hn.name===ln&&(Xt[Ft]={object:hn,transforms:function(zn){for(var xn=[],nr=Bt.querySelector('[id="'+zn.id+'"]'),Pn=0;Pn<nr.childNodes.length;Pn++){var jr=nr.childNodes[Pn];if(1===jr.nodeType)switch(jr.nodeName){case"matrix":var ur=c(jr.textContent),Xr=(new THREE.Matrix4).fromArray(ur).transpose();xn.push({sid:jr.getAttribute("sid"),type:jr.nodeName,obj:Xr});break;case"translate":case"scale":ur=c(jr.textContent);var Si=(new THREE.Vector3).fromArray(ur);xn.push({sid:jr.getAttribute("sid"),type:jr.nodeName,obj:Si});break;case"rotate":ur=c(jr.textContent),Si=(new THREE.Vector3).fromArray(ur);var ti=THREE.Math.degToRad(ur[3]);xn.push({sid:jr.getAttribute("sid"),type:jr.nodeName,obj:Si,angle:ti})}}return xn}(jt),joint:vn,position:vn.zeroPosition})})}var qe=Object.keys(Ye.kinematicsModels)[0],at=Object.keys(Ye.kinematicsScenes)[0],ot=Object.keys(Ye.visualScenes)[0];if(void 0!==qe&&void 0!==at){for(var dt=v(Ye.kinematicsModels[qe],_e),St=v(Ye.kinematicsScenes[at],gt),It=$e(ot),Zt=St.bindJointAxis,Xt={},Vt=0,We=Zt.length;Vt<We;Vt++){var ft=Zt[Vt],Mt=Bt.querySelector('[sid="'+ft.target+'"]');Mt&&Me(ft.jointIndex,Mt.parentElement)}var kt=new THREE.Matrix4;le={joints:dt&&dt.joints,getJointValue:function(Ft){var jt=Xt[Ft];if(jt)return jt.position;console.warn("THREE.ColladaLoader: Joint "+Ft+" doesn't exist.")},setJointValue:function(Ft,jt){var ln=Xt[Ft];if(ln){var vn=ln.joint;if(jt>vn.limits.max||jt<vn.limits.min)console.warn("THREE.ColladaLoader: Joint "+Ft+" value "+jt+" outside of limits (min: "+vn.limits.min+", max: "+vn.limits.max+").");else if(vn.static)console.warn("THREE.ColladaLoader: Joint "+Ft+" is static.");else{var hn=ln.object,zn=vn.axis,xn=ln.transforms;ut.identity();for(var nr=0;nr<xn.length;nr++){var Pn=xn[nr];if(Pn.sid&&-1!==Pn.sid.indexOf(Ft))switch(vn.type){case"revolute":ut.multiply(kt.makeRotationAxis(zn,THREE.Math.degToRad(jt)));break;case"prismatic":ut.multiply(kt.makeTranslation(zn.x*jt,zn.y*jt,zn.z*jt));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+vn.type)}else switch(Pn.type){case"matrix":ut.multiply(Pn.obj);break;case"translate":ut.multiply(kt.makeTranslation(Pn.obj.x,Pn.obj.y,Pn.obj.z));break;case"scale":ut.scale(Pn.obj);break;case"rotate":ut.multiply(kt.makeRotationAxis(Pn.obj,Pn.angle))}}hn.matrix.copy(ut),hn.matrix.decompose(hn.position,hn.quaternion,hn.scale),Xt[Ft].position=jt}}else console.log("THREE.ColladaLoader: "+Ft+" does not exist.")}}}}();var Pt=function(Me){return $e(p(m(Me,"instance_visual_scene")[0].getAttribute("url")))}(m(Bt,"scene")[0]);return"Z_UP"===rn.upAxis&&Pt.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Pt.scale.multiplyScalar(rn.unit),{animations:ie,kinematics:le,library:Ye,scene:Pt}}}},{}],4:[function(ee,be,ue){"use strict";var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(m){return typeof m}:function(m){return m&&"function"==typeof Symbol&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},C="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(m){return void 0===m?"undefined":h(m)}:function(m){return m&&"function"==typeof Symbol&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":void 0===m?"undefined":h(m)};be.exports=THREE.FBXLoader=function(){function m(P){this.manager=void 0!==P?P:THREE.DefaultLoadingManager}function s(P){this.textureLoader=P}function c(){}function u(){}function p(){}function d(){}function A(P,X){this.dv=new DataView(P),this.offset=0,this.littleEndian=void 0===X||X}function E(){}function g(P){var X=P.match(/FBXVersion: (\d+)/);if(X)return parseInt(X[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function v(P){return P/46186158e3}function T(P,X,W,te){var ce;switch(te.mappingType){case"ByPolygonVertex":ce=P;break;case"ByPolygon":ce=X;break;case"ByVertice":ce=W;break;case"AllSame":ce=te.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+te.mappingType)}"IndexToDirect"===te.referenceType&&(ce=te.indices[ce]);var Se=ce*te.dataSize;return function(ze,rt,gt,Tt){for(var $t=gt,un=0;$t<Tt;$t++,un++)ze[un]=rt[$t];return ze}(V,te.buffer,Se,Se+te.dataSize)}function y(P){var X=new THREE.Matrix4;he.set(0,0,0),me.identity();var W=function M(P){var X=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===P?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),X[0]):X[P]}(P.eulerOrder?P.eulerOrder:0);if(P.translation&&he.fromArray(P.translation),P.rotationOffset&&he.add(fe.fromArray(P.rotationOffset)),P.rotation&&((te=P.rotation.map(THREE.Math.degToRad)).push(W),me.makeRotationFromEuler(ae.fromArray(te))),P.preRotation&&((te=P.preRotation.map(THREE.Math.degToRad)).push(W),ne.makeRotationFromEuler(ae.fromArray(te)),me.premultiply(ne)),P.postRotation){var te=P.postRotation.map(THREE.Math.degToRad);te.push(W),ne.makeRotationFromEuler(ae.fromArray(te)),ne.getInverse(ne),me.multiply(ne)}return P.scale&&X.scale(fe.fromArray(P.scale)),X.setPosition(he),X.multiply(me),X}function _(P){return P.split(",").map(function(X){return parseFloat(X)})}function O(P,X,W){return void 0===X&&(X=0),void 0===W&&(W=P.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(P,X,W))}function D(P,X,W){return P.slice(0,X).concat(W).concat(P.slice(X))}var B,H,q;m.prototype={constructor:m,crossOrigin:"anonymous",load:function(P,X,W,te){var ce=this,Se=THREE.LoaderUtils.extractUrlBase(P),_e=new THREE.FileLoader(this.manager);_e.setResponseType("arraybuffer"),_e.load(P,function(ze){try{var rt=ce.parse(ze,Se);X(rt)}catch(gt){setTimeout(function(){te&&te(gt),ce.manager.itemError(P)},0)}},W,te)},setCrossOrigin:function(P){return this.crossOrigin=P,this},parse:function(P,X){if((te=P).byteLength>=(ce="Kaydara FBX Binary  \0").length&&ce===O(te,0,ce.length))B=(new d).parse(P);else{var W=O(P);if(!function(te){for(var Se=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],_e=0,ze=0;ze<Se.length;++ze)if(void 0,gt=te[1-1],te=te.slice(_e+1),_e++,gt===Se[ze])return!1;var gt;return!0}(W))throw new Error("THREE.FBXLoader: Unknown format.");if(g(W)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+g(W));B=(new p).parse(W)}var te,ce;return new s(new THREE.TextureLoader(this.manager).setPath(X).setCrossOrigin(this.crossOrigin)).parse(B)}},s.prototype={constructor:s,parse:function(){H=this.parseConnections();var P=this.parseImages(),X=this.parseTextures(P),W=this.parseMaterials(X),te=this.parseDeformers(),ce=(new c).parse(te);return this.parseScene(te,ce,W),q},parseConnections:function(){var P=new Map;return"Connections"in B&&B.Connections.connections.forEach(function(X){var W=X[0],te=X[1],ce=X[2];P.has(W)||P.set(W,{parents:[],children:[]});var Se={ID:te,relationship:ce};P.get(W).parents.push(Se),P.has(te)||P.set(te,{parents:[],children:[]});var _e={ID:W,relationship:ce};P.get(te).children.push(_e)}),P},parseImages:function(){var P={},X={};if("Video"in B.Objects){var W=B.Objects.Video;for(var te in W){var ce=W[te];if(P[rt=parseInt(te)]=ce.RelativeFilename||ce.Filename,"Content"in ce&&(ce.Content instanceof ArrayBuffer&&ce.Content.byteLength>0||"string"==typeof ce.Content&&""!==ce.Content)){var ze=this.parseImage(W[te]);X[ce.RelativeFilename||ce.Filename]=ze}}}for(var rt in P){var gt=P[rt];P[rt]=void 0!==X[gt]?X[gt]:P[rt].split("\\").pop()}return P},parseImage:function(P){var X,W=P.Content,te=P.RelativeFilename||P.Filename,ce=te.slice(te.lastIndexOf(".")+1).toLowerCase();switch(ce){case"bmp":X="image/bmp";break;case"jpg":case"jpeg":X="image/jpeg";break;case"png":X="image/png";break;case"tif":X="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");null===THREE.Loader.Handlers.get(".tga")&&THREE.Loader.Handlers.add(/\.tga$/i,new THREE.TGALoader),X="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+ce+'" is not supported.')}if("string"==typeof W)return"data:"+X+";base64,"+W;var Se=new Uint8Array(W);return window.URL.createObjectURL(new Blob([Se],{type:X}))},parseTextures:function(P){var X=new Map;if("Texture"in B.Objects){var W=B.Objects.Texture;for(var te in W){var ce=this.parseTexture(W[te],P);X.set(parseInt(te),ce)}}return X},parseTexture:function(P,X){var W=this.loadTexture(P,X);W.ID=P.id,W.name=P.attrName;var te=P.WrapModeU,ce=P.WrapModeV,_e=void 0!==ce?ce.value:0;if(W.wrapS=0===(void 0!==te?te.value:0)?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,W.wrapT=0===_e?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in P){var ze=P.Scaling.value;W.repeat.x=ze[0],W.repeat.y=ze[1]}return W},loadTexture:function(P,X){var W,te=this.textureLoader.path,ce=H.get(P.id).children;void 0!==ce&&ce.length>0&&void 0!==X[ce[0].ID]&&(0!==(W=X[ce[0].ID]).indexOf("blob:")&&0!==W.indexOf("data:")||this.textureLoader.setPath(void 0));var Se,_e=P.FileName.slice(-3).toLowerCase();if("tga"===_e){var ze=THREE.Loader.Handlers.get(".tga");null===ze?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",W),Se=new THREE.Texture):Se=ze.load(W)}else"psd"===_e?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",W),Se=new THREE.Texture):Se=this.textureLoader.load(W);return this.textureLoader.setPath(te),Se},parseMaterials:function(P){var X=new Map;if("Material"in B.Objects){var W=B.Objects.Material;for(var te in W){var ce=this.parseMaterial(W[te],P);null!==ce&&X.set(parseInt(te),ce)}}return X},parseMaterial:function(P,X){var W=P.id,te=P.attrName,ce=P.ShadingModel;if("object"===(void 0===ce?"undefined":C(ce))&&(ce=ce.value),!H.has(W))return null;var Se,_e=this.parseParameters(P,X,W);switch(ce.toLowerCase()){case"phong":Se=new THREE.MeshPhongMaterial;break;case"lambert":Se=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',ce),Se=new THREE.MeshPhongMaterial({color:3342591})}return Se.setValues(_e),Se.name=te,Se},parseParameters:function(P,X,W){var te={};P.BumpFactor&&(te.bumpScale=P.BumpFactor.value),P.Diffuse?te.color=(new THREE.Color).fromArray(P.Diffuse.value):P.DiffuseColor&&"Color"===P.DiffuseColor.type&&(te.color=(new THREE.Color).fromArray(P.DiffuseColor.value)),P.DisplacementFactor&&(te.displacementScale=P.DisplacementFactor.value),P.Emissive?te.emissive=(new THREE.Color).fromArray(P.Emissive.value):P.EmissiveColor&&"Color"===P.EmissiveColor.type&&(te.emissive=(new THREE.Color).fromArray(P.EmissiveColor.value)),P.EmissiveFactor&&(te.emissiveIntensity=parseFloat(P.EmissiveFactor.value)),P.Opacity&&(te.opacity=parseFloat(P.Opacity.value)),te.opacity<1&&(te.transparent=!0),P.ReflectionFactor&&(te.reflectivity=P.ReflectionFactor.value),P.Shininess&&(te.shininess=P.Shininess.value),P.Specular?te.specular=(new THREE.Color).fromArray(P.Specular.value):P.SpecularColor&&"Color"===P.SpecularColor.type&&(te.specular=(new THREE.Color).fromArray(P.SpecularColor.value));var ce=this;return H.get(W).children.forEach(function(Se){var _e=Se.relationship;switch(_e){case"Bump":te.bumpMap=ce.getTexture(X,Se.ID);break;case"DiffuseColor":te.map=ce.getTexture(X,Se.ID);break;case"DisplacementColor":te.displacementMap=ce.getTexture(X,Se.ID);break;case"EmissiveColor":te.emissiveMap=ce.getTexture(X,Se.ID);break;case"NormalMap":te.normalMap=ce.getTexture(X,Se.ID);break;case"ReflectionColor":te.envMap=ce.getTexture(X,Se.ID),te.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":te.specularMap=ce.getTexture(X,Se.ID);break;case"TransparentColor":te.alphaMap=ce.getTexture(X,Se.ID),te.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",_e)}}),te},getTexture:function(P,X){return"LayeredTexture"in B.Objects&&X in B.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),X=H.get(X).children[0].ID),P.get(X)},parseDeformers:function(){var P={},X={};if("Deformer"in B.Objects){var W=B.Objects.Deformer;for(var te in W){var ce=W[te],Se=H.get(parseInt(te));if("Skin"===ce.attrType){var _e=this.parseSkeleton(Se,W);_e.ID=te,Se.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),_e.geometryID=Se.parents[0].ID,P[te]=_e}else if("BlendShape"===ce.attrType){var ze={id:te};ze.rawTargets=this.parseMorphTargets(Se,W),ze.id=te,Se.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),X[te]=ze}}}return{skeletons:P,morphTargets:X}},parseSkeleton:function(P,X){var W=[];return P.children.forEach(function(te){var ce=X[te.ID];if("Cluster"===ce.attrType){var Se={ID:te.ID,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(ce.Transform.a),transformLink:(new THREE.Matrix4).fromArray(ce.TransformLink.a),linkMode:ce.Mode};"Indexes"in ce&&(Se.indices=ce.Indexes.a,Se.weights=ce.Weights.a),W.push(Se)}}),{rawBones:W,bones:[]}},parseMorphTargets:function(P,X){for(var W=[],te=0;te<P.children.length;te++){if(8===te){console.warn("FBXLoader: maximum of 8 morph targets supported. Ignoring additional targets.");break}var ce=P.children[te],Se=X[ce.ID],_e={name:Se.attrName,initialWeight:Se.DeformPercent,id:Se.id,fullWeights:Se.FullWeights.a};if("BlendShapeChannel"!==Se.attrType)return;H.get(parseInt(ce.ID)).children.forEach(function(ze){void 0===ze.relationship&&(_e.geoID=ze.ID)}),W.push(_e)}return W},parseScene:function(P,X,W){q=new THREE.Group;var te=this.parseModels(P.skeletons,X,W),ce=B.Objects.Model,Se=this;te.forEach(function(ze){Se.setLookAtProperties(ze,ce[ze.ID]),H.get(ze.ID).parents.forEach(function(gt){var Tt=te.get(gt.ID);void 0!==Tt&&Tt.add(ze)}),null===ze.parent&&q.add(ze)}),this.bindSkeleton(P.skeletons,X,te),this.createAmbientLight(),this.setupMorphMaterials();var _e=(new u).parse();1===q.children.length&&q.children[0].isGroup&&(q.children[0].animations=_e,q=q.children[0]),q.animations=_e},parseModels:function(P,X,W){var te=new Map,ce=B.Objects.Model;for(var Se in ce){var _e=parseInt(Se),ze=ce[Se],rt=H.get(_e),gt=this.buildSkeleton(rt,P,_e,ze.attrName);if(!gt){switch(ze.attrType){case"Camera":gt=this.createCamera(rt);break;case"Light":gt=this.createLight(rt);break;case"Mesh":gt=this.createMesh(rt,X,W);break;case"NurbsCurve":gt=this.createCurve(rt,X);break;default:gt=new THREE.Group}gt.name=THREE.PropertyBinding.sanitizeNodeName(ze.attrName),gt.ID=_e}this.setModelTransforms(gt,ze),te.set(_e,gt)}return te},buildSkeleton:function(P,X,W,te){var ce=null;return P.parents.forEach(function(Se){for(var _e in X){var ze=X[_e];ze.rawBones.forEach(function(rt,gt){if(rt.ID===Se.ID){var Tt=ce;(ce=new THREE.Bone).matrixWorld.copy(rt.transformLink),ce.name=THREE.PropertyBinding.sanitizeNodeName(te),ce.ID=W,ze.bones[gt]=ce,null!==Tt&&ce.add(Tt)}})}}),ce},createCamera:function(P){var X,W;if(P.children.forEach(function($t){var un=B.Objects.NodeAttribute[$t.ID];void 0!==un&&(W=un)}),void 0===W)X=new THREE.Object3D;else{var te=0;void 0!==W.CameraProjectionType&&1===W.CameraProjectionType.value&&(te=1);var ce=1;void 0!==W.NearPlane&&(ce=W.NearPlane.value/1e3);var Se=1e3;void 0!==W.FarPlane&&(Se=W.FarPlane.value/1e3);var _e=window.innerWidth,ze=window.innerHeight;void 0!==W.AspectWidth&&void 0!==W.AspectHeight&&(_e=W.AspectWidth.value,ze=W.AspectHeight.value);var rt=_e/ze,gt=45;void 0!==W.FieldOfView&&(gt=W.FieldOfView.value);var Tt=W.FocalLength?W.FocalLength.value:null;switch(te){case 0:X=new THREE.PerspectiveCamera(gt,rt,ce,Se),null!==Tt&&X.setFocalLength(Tt);break;case 1:X=new THREE.OrthographicCamera(-_e/2,_e/2,ze/2,-ze/2,ce,Se);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+te+"."),X=new THREE.Object3D}}return X},createLight:function(P){var X,W;if(P.children.forEach(function(gt){var Tt=B.Objects.NodeAttribute[gt.ID];void 0!==Tt&&(W=Tt)}),void 0===W)X=new THREE.Object3D;else{var te;te=void 0===W.LightType?0:W.LightType.value;var ce=16777215;void 0!==W.Color&&(ce=(new THREE.Color).fromArray(W.Color.value));var Se=void 0===W.Intensity?1:W.Intensity.value/100;void 0!==W.CastLightOnObject&&0===W.CastLightOnObject.value&&(Se=0);var _e=0;switch(void 0!==W.FarAttenuationEnd&&(_e=void 0!==W.EnableFarAttenuation&&0===W.EnableFarAttenuation.value?0:W.FarAttenuationEnd.value),te){case 0:X=new THREE.PointLight(ce,Se,_e,1);break;case 1:X=new THREE.DirectionalLight(ce,Se);break;case 2:var ze=Math.PI/3;void 0!==W.InnerAngle&&(ze=THREE.Math.degToRad(W.InnerAngle.value));var rt=0;void 0!==W.OuterAngle&&(rt=THREE.Math.degToRad(W.OuterAngle.value),rt=Math.max(rt,1)),X=new THREE.SpotLight(ce,Se,_e,ze,rt,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+W.LightType.value+", defaulting to a THREE.PointLight."),X=new THREE.PointLight(ce,Se)}void 0!==W.CastShadows&&1===W.CastShadows.value&&(X.castShadow=!0)}return X},createMesh:function(P,X,W){var te,ce=null,Se=null,_e=[];return P.children.forEach(function(ze){X.has(ze.ID)&&(ce=X.get(ze.ID)),W.has(ze.ID)&&_e.push(W.get(ze.ID))}),_e.length>1?Se=_e:_e.length>0?Se=_e[0]:(Se=new THREE.MeshPhongMaterial({color:13421772}),_e.push(Se)),"color"in ce.attributes&&_e.forEach(function(ze){ze.vertexColors=THREE.VertexColors}),ce.FBX_Deformer?(_e.forEach(function(ze){ze.skinning=!0}),te=new THREE.SkinnedMesh(ce,Se)):te=new THREE.Mesh(ce,Se),te},createCurve:function(P,X){var W=P.children.reduce(function(ce,Se){return X.has(Se.ID)&&(ce=X.get(Se.ID)),ce},null),te=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(W,te)},setModelTransforms:function(P,X){var W={};"RotationOrder"in X&&(W.eulerOrder=parseInt(X.RotationOrder.value)),"Lcl_Translation"in X&&(W.translation=X.Lcl_Translation.value),"RotationOffset"in X&&(W.rotationOffset=X.RotationOffset.value),"Lcl_Rotation"in X&&(W.rotation=X.Lcl_Rotation.value),"PreRotation"in X&&(W.preRotation=X.PreRotation.value),"PostRotation"in X&&(W.postRotation=X.PostRotation.value),"Lcl_Scaling"in X&&(W.scale=X.Lcl_Scaling.value);var te=y(W);P.applyMatrix(te)},setLookAtProperties:function(P,X){"LookAtProperty"in X&&H.get(P.ID).children.forEach(function(W){if("LookAtProperty"===W.relationship){var te=B.Objects.Model[W.ID];if("Lcl_Translation"in te){var ce=te.Lcl_Translation.value;void 0!==P.target?(P.target.position.fromArray(ce),q.add(P.target)):P.lookAt((new THREE.Vector3).fromArray(ce))}}})},bindSkeleton:function(P,X,W){var te=this.parsePoseNodes();for(var ce in P){var Se=P[ce];H.get(parseInt(Se.ID)).parents.forEach(function(_e){X.has(_e.ID)&&H.get(_e.ID).parents.forEach(function(rt){W.has(rt.ID)&&W.get(rt.ID).bind(new THREE.Skeleton(Se.bones),te[rt.ID])})})}},parsePoseNodes:function(){var P={};if("Pose"in B.Objects){var X=B.Objects.Pose;for(var W in X)if("BindPose"===X[W].attrType){var te=X[W].PoseNode;Array.isArray(te)?te.forEach(function(ce){P[ce.Node]=(new THREE.Matrix4).fromArray(ce.Matrix.a)}):P[te.Node]=(new THREE.Matrix4).fromArray(te.Matrix.a)}}return P},createAmbientLight:function(){if("GlobalSettings"in B&&"AmbientColor"in B.GlobalSettings){var P=B.GlobalSettings.AmbientColor.value,X=P[0],W=P[1],te=P[2];if(0!==X||0!==W||0!==te){var ce=new THREE.Color(X,W,te);q.add(new THREE.AmbientLight(ce,1))}}},setupMorphMaterials:function(){q.traverse(function(P){if(P.isMesh&&(P.geometry.morphAttributes.position||P.geometry.morphAttributes.normal)){var X=P.uuid,W=P.material.uuid,te=!1;q.traverse(function(ce){ce.isMesh&&ce.material.uuid===W&&ce.uuid!==X&&(te=!0)}),!0===te&&(P.material=P.material.clone()),P.material.morphTargets=!0}})}},c.prototype={constructor:c,parse:function(P){var X=new Map;if("Geometry"in B.Objects){var W=B.Objects.Geometry;for(var te in W){var ce=H.get(parseInt(te)),Se=this.parseGeometry(ce,W[te],P);X.set(parseInt(te),Se)}}return X},parseGeometry:function(P,X,W){switch(X.attrType){case"Mesh":return this.parseMeshGeometry(P,X,W);case"NurbsCurve":return this.parseNurbsGeometry(X)}},parseMeshGeometry:function(P,X,W){var te=W.skeletons,ce=W.morphTargets,Se=P.parents.map(function($t){return B.Objects.Model[$t.ID]});if(0!==Se.length){var _e=P.children.reduce(function($t,un){return void 0!==te[un.ID]&&($t=te[un.ID]),$t},null),ze=P.children.reduce(function($t,un){return void 0!==ce[un.ID]&&($t=ce[un.ID]),$t},null),rt=Se[0],gt={};"RotationOrder"in rt&&(gt.eulerOrder=rt.RotationOrder.value),"GeometricTranslation"in rt&&(gt.translation=rt.GeometricTranslation.value),"GeometricRotation"in rt&&(gt.rotation=rt.GeometricRotation.value),"GeometricScaling"in rt&&(gt.scale=rt.GeometricScaling.value);var Tt=y(gt);return this.genGeometry(X,_e,ze,Tt)}},genGeometry:function(P,X,W,te){var ce=new THREE.BufferGeometry;P.attrName&&(ce.name=P.attrName);var Se=this.parseGeoNode(P,X),_e=this.genBuffers(Se),ze=new THREE.Float32BufferAttribute(_e.vertex,3);if(te.applyToBufferAttribute(ze),ce.addAttribute("position",ze),_e.colors.length>0&&ce.addAttribute("color",new THREE.Float32BufferAttribute(_e.colors,3)),X&&(ce.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(_e.weightsIndices,4)),ce.addAttribute("skinWeight",new THREE.Float32BufferAttribute(_e.vertexWeights,4)),ce.FBX_Deformer=X),_e.normal.length>0){var rt=new THREE.Float32BufferAttribute(_e.normal,3);(new THREE.Matrix3).getNormalMatrix(te).applyToBufferAttribute(rt),ce.addAttribute("normal",rt)}if(_e.uvs.forEach(function(In,sn){var tr="uv"+(sn+1).toString();0===sn&&(tr="uv"),ce.addAttribute(tr,new THREE.Float32BufferAttribute(_e.uvs[sn],2))}),Se.material&&"AllSame"!==Se.material.mappingType){var gt=_e.materialIndex[0],Tt=0;if(_e.materialIndex.forEach(function(In,sn){In!==gt&&(ce.addGroup(Tt,sn-Tt,gt),gt=In,Tt=sn)}),ce.groups.length>0){var $t=ce.groups[ce.groups.length-1],un=$t.start+$t.count;un!==_e.materialIndex.length&&ce.addGroup(un,_e.materialIndex.length-un,gt)}0===ce.groups.length&&ce.addGroup(0,_e.materialIndex.length,_e.materialIndex[0])}return this.addMorphTargets(ce,P,W,te),ce},parseGeoNode:function(P,X){var W={};if(W.vertexPositions=void 0!==P.Vertices?P.Vertices.a:[],W.vertexIndices=void 0!==P.PolygonVertexIndex?P.PolygonVertexIndex.a:[],P.LayerElementColor&&(W.color=this.parseVertexColors(P.LayerElementColor[0])),P.LayerElementMaterial&&(W.material=this.parseMaterialIndices(P.LayerElementMaterial[0])),P.LayerElementNormal&&(W.normal=this.parseNormals(P.LayerElementNormal[0])),P.LayerElementUV){W.uv=[];for(var te=0;P.LayerElementUV[te];)W.uv.push(this.parseUVs(P.LayerElementUV[te])),te++}return W.weightTable={},null!==X&&(W.skeleton=X,X.rawBones.forEach(function(ce,Se){ce.indices.forEach(function(_e,ze){void 0===W.weightTable[_e]&&(W.weightTable[_e]=[]),W.weightTable[_e].push({id:Se,weight:ce.weights[ze]})})})),W},genBuffers:function(P){var X={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},W=0,te=0,ce=!1,Se=[],_e=[],ze=[],rt=[],gt=[],Tt=[],$t=this;return P.vertexIndices.forEach(function(un,In){var sn=!1;un<0&&(un^=-1,sn=!0);var tr=[],Cr=[];if(Se.push(3*un,3*un+1,3*un+2),P.color&&($e=T(In,W,un,P.color),ze.push($e[0],$e[1],$e[2])),P.skeleton){if(void 0!==P.weightTable[un]&&P.weightTable[un].forEach(function(Ke){Cr.push(Ke.weight),tr.push(Ke.id)}),Cr.length>4){ce||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),ce=!0);var Un=[0,0,0,0],Re=[0,0,0,0];Cr.forEach(function(Ke,nt){var ut=Ke,ht=tr[nt];Re.forEach(function(_t,Bt,Kt){if(ut>_t){Kt[Bt]=ut,ut=_t;var rn=Un[Bt];Un[Bt]=ht,ht=rn}})}),tr=Un,Cr=Re}for(;Cr.length<4;)Cr.push(0),tr.push(0);for(var Oe=0;Oe<4;++Oe)gt.push(Cr[Oe]),Tt.push(tr[Oe])}if(P.normal){var $e=T(In,W,un,P.normal);_e.push($e[0],$e[1],$e[2])}if(P.material&&"AllSame"!==P.material.mappingType)var Ve=T(In,W,un,P.material)[0];P.uv&&P.uv.forEach(function(Ke,nt){var ut=T(In,W,un,Ke);void 0===rt[nt]&&(rt[nt]=[]),rt[nt].push(ut[0]),rt[nt].push(ut[1])}),te++,sn&&($t.genFace(X,P,Se,Ve,_e,ze,rt,gt,Tt,te),W++,te=0,Se=[],_e=[],ze=[],rt=[],gt=[],Tt=[])}),X},genFace:function(P,X,W,te,ce,Se,_e,ze,rt,gt){for(var Tt=2;Tt<gt;Tt++)P.vertex.push(X.vertexPositions[W[0]]),P.vertex.push(X.vertexPositions[W[1]]),P.vertex.push(X.vertexPositions[W[2]]),P.vertex.push(X.vertexPositions[W[3*(Tt-1)]]),P.vertex.push(X.vertexPositions[W[3*(Tt-1)+1]]),P.vertex.push(X.vertexPositions[W[3*(Tt-1)+2]]),P.vertex.push(X.vertexPositions[W[3*Tt]]),P.vertex.push(X.vertexPositions[W[3*Tt+1]]),P.vertex.push(X.vertexPositions[W[3*Tt+2]]),X.skeleton&&(P.vertexWeights.push(ze[0]),P.vertexWeights.push(ze[1]),P.vertexWeights.push(ze[2]),P.vertexWeights.push(ze[3]),P.vertexWeights.push(ze[4*(Tt-1)]),P.vertexWeights.push(ze[4*(Tt-1)+1]),P.vertexWeights.push(ze[4*(Tt-1)+2]),P.vertexWeights.push(ze[4*(Tt-1)+3]),P.vertexWeights.push(ze[4*Tt]),P.vertexWeights.push(ze[4*Tt+1]),P.vertexWeights.push(ze[4*Tt+2]),P.vertexWeights.push(ze[4*Tt+3]),P.weightsIndices.push(rt[0]),P.weightsIndices.push(rt[1]),P.weightsIndices.push(rt[2]),P.weightsIndices.push(rt[3]),P.weightsIndices.push(rt[4*(Tt-1)]),P.weightsIndices.push(rt[4*(Tt-1)+1]),P.weightsIndices.push(rt[4*(Tt-1)+2]),P.weightsIndices.push(rt[4*(Tt-1)+3]),P.weightsIndices.push(rt[4*Tt]),P.weightsIndices.push(rt[4*Tt+1]),P.weightsIndices.push(rt[4*Tt+2]),P.weightsIndices.push(rt[4*Tt+3])),X.color&&(P.colors.push(Se[0]),P.colors.push(Se[1]),P.colors.push(Se[2]),P.colors.push(Se[3*(Tt-1)]),P.colors.push(Se[3*(Tt-1)+1]),P.colors.push(Se[3*(Tt-1)+2]),P.colors.push(Se[3*Tt]),P.colors.push(Se[3*Tt+1]),P.colors.push(Se[3*Tt+2])),X.material&&"AllSame"!==X.material.mappingType&&(P.materialIndex.push(te),P.materialIndex.push(te),P.materialIndex.push(te)),X.normal&&(P.normal.push(ce[0]),P.normal.push(ce[1]),P.normal.push(ce[2]),P.normal.push(ce[3*(Tt-1)]),P.normal.push(ce[3*(Tt-1)+1]),P.normal.push(ce[3*(Tt-1)+2]),P.normal.push(ce[3*Tt]),P.normal.push(ce[3*Tt+1]),P.normal.push(ce[3*Tt+2])),X.uv&&X.uv.forEach(function($t,un){void 0===P.uvs[un]&&(P.uvs[un]=[]),P.uvs[un].push(_e[un][0]),P.uvs[un].push(_e[un][1]),P.uvs[un].push(_e[un][2*(Tt-1)]),P.uvs[un].push(_e[un][2*(Tt-1)+1]),P.uvs[un].push(_e[un][2*Tt]),P.uvs[un].push(_e[un][2*Tt+1])})},addMorphTargets:function(P,X,W,te){if(null!==W){P.morphAttributes.position=[],P.morphAttributes.normal=[];var ce=this;W.rawTargets.forEach(function(Se){var _e=B.Objects.Geometry[Se.geoID];void 0!==_e&&ce.genMorphGeometry(P,X,_e,te)})}},genMorphGeometry:function(P,X,W,te){var ce=new THREE.BufferGeometry;W.attrName&&(ce.name=W.attrName);for(var Se=void 0!==X.PolygonVertexIndex?X.PolygonVertexIndex.a:[],_e=void 0!==X.Vertices?X.Vertices.a.slice():[],ze=void 0!==W.Vertices?W.Vertices.a:[],rt=void 0!==W.Indexes?W.Indexes.a:[],gt=0;gt<rt.length;gt++){var Tt=3*rt[gt];_e[Tt]+=ze[3*gt],_e[Tt+1]+=ze[3*gt+1],_e[Tt+2]+=ze[3*gt+2]}var un=this.genBuffers({vertexIndices:Se,vertexPositions:_e}),In=new THREE.Float32BufferAttribute(un.vertex,3);In.name=W.attrName,te.applyToBufferAttribute(In),P.morphAttributes.position.push(In)},parseNormals:function(P){var W=P.ReferenceInformationType,ce=[];return"IndexToDirect"===W&&("NormalIndex"in P?ce=P.NormalIndex.a:"NormalsIndex"in P&&(ce=P.NormalsIndex.a)),{dataSize:3,buffer:P.Normals.a,indices:ce,mappingType:P.MappingInformationType,referenceType:W}},parseUVs:function(P){var W=P.ReferenceInformationType,ce=[];return"IndexToDirect"===W&&(ce=P.UVIndex.a),{dataSize:2,buffer:P.UV.a,indices:ce,mappingType:P.MappingInformationType,referenceType:W}},parseVertexColors:function(P){var W=P.ReferenceInformationType,ce=[];return"IndexToDirect"===W&&(ce=P.ColorIndex.a),{dataSize:4,buffer:P.Colors.a,indices:ce,mappingType:P.MappingInformationType,referenceType:W}},parseMaterialIndices:function(P){var X=P.MappingInformationType,W=P.ReferenceInformationType;if("NoMappingInformation"===X)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:W};for(var te=P.Materials.a,ce=[],Se=0;Se<te.length;++Se)ce.push(Se);return{dataSize:1,buffer:te,indices:ce,mappingType:X,referenceType:W}},parseNurbsGeometry:function(P){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var rt,gt,X=parseInt(P.Order);if(isNaN(X))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",P.Order,P.id),new THREE.BufferGeometry;for(var W=X-1,te=P.KnotVector.a,ce=[],Se=P.Points.a,_e=0,ze=Se.length;_e<ze;_e+=4)ce.push((new THREE.Vector4).fromArray(Se,_e));if("Closed"===P.Form)ce.push(ce[0]);else if("Periodic"===P.Form)for(gt=te.length-1-(rt=W),_e=0;_e<W;++_e)ce.push(ce[_e]);var Tt=new THREE.NURBSCurve(W,te,ce,rt,gt).getPoints(7*ce.length),$t=new Float32Array(3*Tt.length);Tt.forEach(function(In,sn){In.toArray($t,3*sn)});var un=new THREE.BufferGeometry;return un.addAttribute("position",new THREE.BufferAttribute($t,3)),un}},u.prototype={constructor:u,parse:function(){var P=[],X=this.parseClips();if(void 0===X)return P;for(var W in X){var ce=this.addClip(X[W]);P.push(ce)}return P},parseClips:function(){if(void 0!==B.Objects.AnimationCurve){var P=this.parseAnimationCurveNodes();this.parseAnimationCurves(P);var X=this.parseAnimationLayers(P);return this.parseAnimStacks(X)}},parseAnimationCurveNodes:function(){var P=B.Objects.AnimationCurveNode,X=new Map;for(var W in P){var te=P[W];if(null!==te.attrName.match(/S|R|T|DeformPercent/)){var ce={id:te.id,attr:te.attrName,curves:{}};X.set(ce.id,ce)}}return X},parseAnimationCurves:function(P){var X=B.Objects.AnimationCurve;for(var W in X){var te={id:X[W].id,times:X[W].KeyTime.a.map(v),values:X[W].KeyValueFloat.a},ce=H.get(te.id);if(void 0!==ce){var Se=ce.parents[0].ID,_e=ce.parents[0].relationship;_e.match(/X/)?P.get(Se).curves.x=te:_e.match(/Y/)?P.get(Se).curves.y=te:_e.match(/Z/)?P.get(Se).curves.z=te:_e.match(/d|DeformPercent/)&&P.has(Se)&&(P.get(Se).curves.morph=te)}}},parseAnimationLayers:function(P){var X=B.Objects.AnimationLayer,W=new Map;for(var te in X){var ce=[],Se=H.get(parseInt(te));if(void 0!==Se){var _e=this;Se.children.forEach(function(ze,rt){if(P.has(ze.ID)){var gt=P.get(ze.ID);if(void 0!==gt.curves.x||void 0!==gt.curves.y||void 0!==gt.curves.z){if(void 0===ce[rt]){H.get(ze.ID).parents.forEach(function(Cr){void 0!==Cr.relationship&&(tr=Cr.ID)});var Tt=B.Objects.Model[tr.toString()],$t={modelName:THREE.PropertyBinding.sanitizeNodeName(Tt.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1],transform:_e.getModelAnimTransform(Tt)};"PreRotation"in Tt&&($t.preRotations=Tt.PreRotation.value),"PostRotation"in Tt&&($t.postRotations=Tt.PostRotation.value),ce[rt]=$t}ce[rt][gt.attr]=gt}else if(void 0!==gt.curves.morph){if(void 0===ce[rt]){var un;H.get(ze.ID).parents.forEach(function(Re){void 0!==Re.relationship&&(un=Re.ID)});var In=H.get(un).parents[0].ID,sn=H.get(In).parents[0].ID,tr=H.get(sn).parents[0].ID;Tt=B.Objects.Model[tr],$t={modelName:THREE.PropertyBinding.sanitizeNodeName(Tt.attrName),morphName:B.Objects.Deformer[un].attrName},ce[rt]=$t}ce[rt][gt.attr]=gt}}}),W.set(parseInt(te),ce)}}return W},getModelAnimTransform:function(P){var X={};return"RotationOrder"in P&&(X.eulerOrder=parseInt(P.RotationOrder.value)),"Lcl_Translation"in P&&(X.translation=P.Lcl_Translation.value),"RotationOffset"in P&&(X.rotationOffset=P.RotationOffset.value),"Lcl_Rotation"in P&&(X.rotation=P.Lcl_Rotation.value),"PreRotation"in P&&(X.preRotation=P.PreRotation.value),"PostRotation"in P&&(X.postRotation=P.PostRotation.value),"Lcl_Scaling"in P&&(X.scale=P.Lcl_Scaling.value),y(X)},parseAnimStacks:function(P){var X=B.Objects.AnimationStack,W={};for(var te in X){var ce=H.get(parseInt(te)).children;ce.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var Se=P.get(ce[0].ID);W[te]={name:X[te].attrName,layer:Se}}return W},addClip:function(P){var X=[],W=this;return P.layer.forEach(function(te){X=X.concat(W.generateTracks(te))}),new THREE.AnimationClip(P.name,-1,X)},generateTracks:function(P){var X=[],W=new THREE.Vector3,te=new THREE.Quaternion,ce=new THREE.Vector3;if(P.transform&&P.transform.decompose(W,te,ce),W=W.toArray(),te=(new THREE.Euler).setFromQuaternion(te).toArray(),ce=ce.toArray(),void 0!==P.T&&Object.keys(P.T.curves).length>0){var Se=this.generateVectorTrack(P.modelName,P.T.curves,W,"position");void 0!==Se&&X.push(Se)}if(void 0!==P.R&&Object.keys(P.R.curves).length>0){var _e=this.generateRotationTrack(P.modelName,P.R.curves,te,P.preRotations,P.postRotations);void 0!==_e&&X.push(_e)}if(void 0!==P.S&&Object.keys(P.S.curves).length>0){var ze=this.generateVectorTrack(P.modelName,P.S.curves,ce,"scale");void 0!==ze&&X.push(ze)}if(void 0!==P.DeformPercent){var rt=this.generateMorphTrack(P);void 0!==rt&&X.push(rt)}return X},generateVectorTrack:function(P,X,W,te){var ce=this.getTimesForAllAxes(X),Se=this.getKeyframeTrackValues(ce,X,W);return new THREE.VectorKeyframeTrack(P+"."+te,ce,Se)},generateRotationTrack:function(P,X,W,te,ce){void 0!==X.x&&(this.interpolateRotations(X.x),X.x.values=X.x.values.map(THREE.Math.degToRad)),void 0!==X.y&&(this.interpolateRotations(X.y),X.y.values=X.y.values.map(THREE.Math.degToRad)),void 0!==X.z&&(this.interpolateRotations(X.z),X.z.values=X.z.values.map(THREE.Math.degToRad));var Se=this.getTimesForAllAxes(X),_e=this.getKeyframeTrackValues(Se,X,W);void 0!==te&&((te=te.map(THREE.Math.degToRad)).push("ZYX"),te=(new THREE.Euler).fromArray(te),te=(new THREE.Quaternion).setFromEuler(te)),void 0!==ce&&((ce=ce.map(THREE.Math.degToRad)).push("ZYX"),ce=(new THREE.Euler).fromArray(ce),ce=(new THREE.Quaternion).setFromEuler(ce).inverse());for(var ze=new THREE.Quaternion,rt=new THREE.Euler,gt=[],Tt=0;Tt<_e.length;Tt+=3)rt.set(_e[Tt],_e[Tt+1],_e[Tt+2],"ZYX"),ze.setFromEuler(rt),void 0!==te&&ze.premultiply(te),void 0!==ce&&ze.multiply(ce),ze.toArray(gt,Tt/3*4);return new THREE.QuaternionKeyframeTrack(P+".quaternion",Se,gt)},generateMorphTrack:function(P){var X=P.DeformPercent.curves.morph,W=X.values.map(function(ce){return ce/100}),te=q.getObjectByName(P.modelName).morphTargetDictionary[P.morphName];return new THREE.NumberKeyframeTrack(P.modelName+".morphTargetInfluences["+te+"]",X.times,W)},getTimesForAllAxes:function(P){var X=[];return void 0!==P.x&&(X=X.concat(P.x.times)),void 0!==P.y&&(X=X.concat(P.y.times)),void 0!==P.z&&(X=X.concat(P.z.times)),X.sort(function(W,te){return W-te}).filter(function(W,te,ce){return ce.indexOf(W)==te})},getKeyframeTrackValues:function(P,X,W){var te=W,ce=[],Se=-1,_e=-1,ze=-1;return P.forEach(function(rt){if(X.x&&(Se=X.x.times.indexOf(rt)),X.y&&(_e=X.y.times.indexOf(rt)),X.z&&(ze=X.z.times.indexOf(rt)),-1!==Se){var gt=X.x.values[Se];ce.push(gt),te[0]=gt}else ce.push(te[0]);if(-1!==_e){var Tt=X.y.values[_e];ce.push(Tt),te[1]=Tt}else ce.push(te[1]);if(-1!==ze){var $t=X.z.values[ze];ce.push($t),te[2]=$t}else ce.push(te[2])}),ce},interpolateRotations:function(P){for(var X=1;X<P.values.length;X++){var W=P.values[X-1],te=P.values[X]-W,ce=Math.abs(te);if(ce>=180){for(var Se=ce/180,_e=te/Se,ze=W+_e,rt=P.times[X-1],gt=(P.times[X]-rt)/Se,Tt=rt+gt,$t=[],un=[];Tt<P.times[X];)$t.push(Tt),Tt+=gt,un.push(ze),ze+=_e;P.times=D(P.times,X,$t),P.values=D(P.values,X,un)}}}},p.prototype={constructor:p,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(P){this.nodeStack.push(P),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(P,X){this.currentProp=P,this.currentPropName=X},parse:function(P){this.currentIndent=0,console.log("FBXTree: ",E),this.allNodes=new E,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var X=this,W=P.split(/[\r\n]+/);return W.forEach(function(te,ce){var Se=te.match(/^[\s\t]*;/),_e=te.match(/^[\s\t]*$/);if(!Se&&!_e){var ze=te.match("^\\t{"+X.currentIndent+"}(\\w+):(.*){",""),rt=te.match("^\\t{"+X.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),gt=te.match("^\\t{"+(X.currentIndent-1)+"}}");ze?X.parseNodeBegin(te,ze):rt?X.parseNodeProperty(te,rt,W[++ce]):gt?X.popStack():te.match(/^[^\s\t}]/)&&X.parseNodePropertyContinued(te)}}),this.allNodes},parseNodeBegin:function(P,X){var W=X[1].trim().replace(/^"/,"").replace(/"$/,""),te=X[2].split(",").map(function(ze){return ze.trim().replace(/^"/,"").replace(/"$/,"")}),ce={name:W},Se=this.parseNodeAttr(te),_e=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(W,ce):W in _e?("PoseNode"===W?_e.PoseNode.push(ce):void 0!==_e[W].id&&(_e[W]={},_e[W][_e[W].id]=_e[W]),""!==Se.id&&(_e[W][Se.id]=ce)):"number"==typeof Se.id?(_e[W]={},_e[W][Se.id]=ce):"Properties70"!==W&&(_e[W]="PoseNode"===W?[ce]:ce),"number"==typeof Se.id&&(ce.id=Se.id),""!==Se.name&&(ce.attrName=Se.name),""!==Se.type&&(ce.attrType=Se.type),this.pushStack(ce)},parseNodeAttr:function(P){var X=P[0];""!==P[0]&&(X=parseInt(P[0]),isNaN(X)&&(X=P[0]));var W="",te="";return P.length>1&&(W=P[1].replace(/^(\w+)::/,""),te=P[2]),{id:X,name:W,type:te}},parseNodeProperty:function(P,X,W){var te=X[1].replace(/^"/,"").replace(/"$/,"").trim(),ce=X[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===te&&","===ce&&(ce=W.replace(/"/g,"").replace(/,$/,"").trim());var Se=this.getCurrentNode();if("Properties70"!==Se.name){if("C"===te){var _e=ce.split(",").slice(1),ze=parseInt(_e[0]),rt=parseInt(_e[1]),gt=ce.split(",").slice(3);te="connections",function(Tt,$t){for(var un=0,In=Tt.length,sn=$t.length;un<sn;un++,In++)Tt[In]=$t[un]}(ce=[ze,rt],gt=gt.map(function(Tt){return Tt.trim().replace(/^"/,"")})),void 0===Se[te]&&(Se[te]=[])}"Node"===te&&(Se.id=ce),te in Se&&Array.isArray(Se[te])?Se[te].push(ce):"a"!==te?Se[te]=ce:Se.a=ce,this.setCurrentProp(Se,te),"a"===te&&","!==ce.slice(-1)&&(Se.a=_(ce))}else this.parseNodeSpecialProperty(P,te,ce)},parseNodePropertyContinued:function(P){var X=this.getCurrentNode();X.a+=P,","!==P.slice(-1)&&(X.a=_(X.a))},parseNodeSpecialProperty:function(P,X,W){var te=W.split('",').map(function(gt){return gt.trim().replace(/^\"/,"").replace(/\s/,"_")}),ce=te[0],Se=te[1],_e=te[2],ze=te[3],rt=te[4];switch(Se){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":rt=parseFloat(rt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":rt=_(rt)}this.getPrevNode()[ce]={type:Se,type2:_e,flag:ze,value:rt},this.setCurrentProp(this.getPrevNode(),ce)}},d.prototype={constructor:d,parse:function(P){var X=new A(P);X.skip(23);var W=X.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+W);for(var te=new E;!this.endOfContent(X);){var ce=this.parseNode(X,W);null!==ce&&te.add(ce.name,ce)}return te},endOfContent:function(P){return P.size()%16==0?(P.getOffset()+160+16&-16)>=P.size():P.getOffset()+160+16>=P.size()},parseNode:function(P,X){var W={},te=X>=7500?P.getUint64():P.getUint32(),ce=X>=7500?P.getUint64():P.getUint32(),Se=(X>=7500?P.getUint64():P.getUint32(),P.getUint8()),_e=P.getString(Se);if(0===te)return null;for(var ze=[],rt=0;rt<ce;rt++)ze.push(this.parseProperty(P));var gt=ze.length>0?ze[0]:"",Tt=ze.length>1?ze[1]:"",$t=ze.length>2?ze[2]:"";for(W.singleProperty=1===ce&&P.getOffset()===te;te>P.getOffset();){var un=this.parseNode(P,X);null!==un&&this.parseSubNode(_e,W,un)}return W.propertyList=ze,"number"==typeof gt&&(W.id=gt),""!==Tt&&(W.attrName=Tt),""!==$t&&(W.attrType=$t),""!==_e&&(W.name=_e),W},parseSubNode:function(P,X,W){if(!0===W.singleProperty){var te=W.propertyList[0];Array.isArray(te)?(X[W.name]=W,W.a=te):X[W.name]=te}else if("Connections"===P&&"C"===W.name){var ce=[];W.propertyList.forEach(function(Tt,$t){0!==$t&&ce.push(Tt)}),void 0===X.connections&&(X.connections=[]),X.connections.push(ce)}else if("Properties70"===W.name)Object.keys(W).forEach(function(Tt){X[Tt]=W[Tt]});else if("Properties70"===P&&"P"===W.name){var Se,_e=W.propertyList[0],ze=W.propertyList[1],rt=W.propertyList[2],gt=W.propertyList[3];0===_e.indexOf("Lcl ")&&(_e=_e.replace("Lcl ","Lcl_")),0===ze.indexOf("Lcl ")&&(ze=ze.replace("Lcl ","Lcl_")),Se="Color"===ze||"ColorRGB"===ze||"Vector"===ze||"Vector3D"===ze||0===ze.indexOf("Lcl_")?[W.propertyList[4],W.propertyList[5],W.propertyList[6]]:W.propertyList[4],X[_e]={type:ze,type2:rt,flag:gt,value:Se}}else void 0===X[W.name]?"number"==typeof W.id?(X[W.name]={},X[W.name][W.id]=W):X[W.name]=W:"PoseNode"===W.name?(Array.isArray(X[W.name])||(X[W.name]=[X[W.name]]),X[W.name].push(W)):void 0===X[W.name][W.id]&&(X[W.name][W.id]=W)},parseProperty:function(P){var X=P.getString(1);switch(X){case"C":return P.getBoolean();case"D":return P.getFloat64();case"F":return P.getFloat32();case"I":return P.getInt32();case"L":return P.getInt64();case"R":return W=P.getUint32(),P.getArrayBuffer(W);case"S":var W=P.getUint32();return P.getString(W);case"Y":return P.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var te=P.getUint32(),ce=P.getUint32(),Se=P.getUint32();if(0===ce)switch(X){case"b":case"c":return P.getBooleanArray(te);case"d":return P.getFloat64Array(te);case"f":return P.getFloat32Array(te);case"i":return P.getInt32Array(te);case"l":return P.getInt64Array(te)}typeof Zlib>"u"&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var _e=new A(new Zlib.Inflate(new Uint8Array(P.getArrayBuffer(Se))).decompress().buffer);switch(X){case"b":case"c":return _e.getBooleanArray(te);case"d":return _e.getFloat64Array(te);case"f":return _e.getFloat32Array(te);case"i":return _e.getInt32Array(te);case"l":return _e.getInt64Array(te)}default:throw new Error("THREE.FBXLoader: Unknown property type "+X)}}},A.prototype={constructor:A,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(P){this.offset+=P},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(P){for(var X=[],W=0;W<P;W++)X.push(this.getBoolean());return X},getUint8:function(){var P=this.dv.getUint8(this.offset);return this.offset+=1,P},getInt16:function(){var P=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,P},getInt32:function(){var P=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,P},getInt32Array:function(P){for(var X=[],W=0;W<P;W++)X.push(this.getInt32());return X},getUint32:function(){var P=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,P},getInt64:function(){var P,X;return this.littleEndian?(P=this.getUint32(),X=this.getUint32()):(X=this.getUint32(),P=this.getUint32()),2147483648&X?(X=4294967295&~X,4294967295==(P=4294967295&~P)&&(X=X+1&4294967295),-(4294967296*X+(P=P+1&4294967295))):4294967296*X+P},getInt64Array:function(P){for(var X=[],W=0;W<P;W++)X.push(this.getInt64());return X},getUint64:function(){var P,X;return this.littleEndian?(P=this.getUint32(),X=this.getUint32()):(X=this.getUint32(),P=this.getUint32()),4294967296*X+P},getFloat32:function(){var P=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,P},getFloat32Array:function(P){for(var X=[],W=0;W<P;W++)X.push(this.getFloat32());return X},getFloat64:function(){var P=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,P},getFloat64Array:function(P){for(var X=[],W=0;W<P;W++)X.push(this.getFloat64());return X},getArrayBuffer:function(P){var X=this.dv.buffer.slice(this.offset,this.offset+P);return this.offset+=P,X},getString:function(P){for(var X=[],W=0;W<P;W++)X[W]=this.getUint8();var te=X.indexOf(0);return te>=0&&(X=X.slice(0,te)),THREE.LoaderUtils.decodeText(new Uint8Array(X))}},E.prototype={constructor:E,add:function(P,X){this[P]=X}};var V=[],ne=new THREE.Matrix4,ae=new THREE.Euler,fe=new THREE.Vector3,he=new THREE.Vector3,me=new THREE.Matrix4;return m}()},{}],5:[function(ee,be,ue){"use strict";be.exports=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},{}],6:[function(ee,be,ue){"use strict";be.exports=function(h,C,m){this.type=h,this.index=C,this.pressed=m.pressed,this.value=m.value}},{}],7:[function(ee,be,ue){"use strict";be.exports={size:5,cellSize:10,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5},autogenerated:!0,cells:[{q:-1,r:0,s:1,h:1,walkable:!0,userData:{}},{q:0,r:-1,s:1,h:1,walkable:!0,userData:{}},{q:0,r:0,s:0,h:1,walkable:!0,userData:{}},{q:1,r:-1,s:0,h:1,walkable:!0,userData:{}},{q:-1,r:1,s:0,h:0,walkable:!0,userData:{}},{q:0,r:1,s:-1,h:0,walkable:!0,userData:{}},{q:1,r:0,s:-1,h:0,walkable:!0,userData:{}}]}},{}],8:[function(ee,be,ue){"use strict";function h(m){var s=document.getElementById(m),c=s.parentNode;try{c&&c.removeChild(s)}catch{}}be.exports=function(m){return m=m||{},function(s,c){return function C(m,s,c){return new c(function(u,p){var T,y,M,d=s.timeout||5e3,A="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),E=(T=m,y=A,(M=document.createElement("script")).type="text/javascript",M.async=!0,M.id=y,M.src=T,M),g=setTimeout(function(){p(new Error("Script request to "+m+" timed out")),h(A)},d),v=function(T){clearTimeout(T)};E.addEventListener("load",function(T){u({ok:!0}),v(g),h(A)}),E.addEventListener("error",function(T){p(new Error("Script request to "+m+" failed "+T)),v(g),h(A)}),function(T){var y=document.getElementsByTagName("script")[0];y.parentNode.insertBefore(T,y)}(E)})}(s,c=c||{},m.Promise||Promise)}}},{}],9:[function(ee,be,ue){"use strict";var s,h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},C="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(s){return void 0===s?"undefined":h(s)}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":void 0===s?"undefined":h(s)},m=be.exports={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};m.Board=function(s,c){if(!s)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new THREE.Object3D,this.grid=null,this.overlay=null,this.finder=new m.AStarFinder(c),m.Loader.init(),this.setGrid(s)},m.Board.prototype={setEntityOnTile:function(s,c){var u=this.grid.cellToPixel(c.cell);s.position.copy(u),s.position.y+=s.heightOffset||0,s.tile&&(s.tile.entity=null),s.tile=c,c.entity=s},addTile:function(s){-1===this.tiles.indexOf(s)&&(this.tiles.push(s),this.snapTileToGrid(s),s.position.y=0,this.tileGroup.add(s.mesh),this.grid.add(s.cell),s.cell.tile=s)},removeTile:function(s){if(s){var c=this.tiles.indexOf(s);this.grid.remove(s.cell),-1!==c&&this.tiles.splice(c,1),s.dispose()}},removeAllTiles:function(){if(this.tileGroup)for(var s=this.tileGroup.children,c=0;c<s.length;c++)this.tileGroup.remove(s[c])},getTileAtCell:function(s){var c=this.grid.cellToHash(s);return s.tile||(void 0!==this.grid.cells[c]?this.grid.cells[c].tile:null)},snapToGrid:function(s){var c=this.grid.pixelToCell(s);s.copy(this.grid.cellToPixel(c))},snapTileToGrid:function(s){if(s.cell)s.position.copy(this.grid.cellToPixel(s.cell));else{var c=this.grid.pixelToCell(s.position);s.position.copy(this.grid.cellToPixel(c))}return s},getRandomTile:function(){var s=m.Tools.randomInt(0,this.tiles.length-1);return this.tiles[s]},findPath:function(s,c,u){return this.finder.findPath(s.cell,c.cell,u,this.grid)},setGrid:function(s){this.group.remove(this.tileGroup),this.grid&&s!==this.grid&&(this.removeAllTiles(),this.tiles.forEach(function(c){this.grid.remove(c.cell),c.dispose()}),this.grid.dispose()),this.grid=s,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},generateOverlay:function(s){var c=new THREE.LineBasicMaterial({color:0,opacity:.3});this.overlay&&this.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.grid.generateOverlay(s,this.overlay,c),this.group.add(this.overlay)},generateTilemap:function(s){this.reset();var c=this.grid.generateTiles(s);this.tiles=c,this.tileGroup=new THREE.Object3D;for(var u=0;u<c.length;u++)this.tileGroup.add(c[u].mesh);this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},m.Board.prototype.constructor=m.Board,m.Cell=function(s,c,u,p){this.q=s||0,this.r=c||0,this.s=u||0,this.h=p||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=m.LinkedList.generateID()},m.Cell.prototype={set:function(s,c,u){return this.q=s,this.r=c,this.s=u,this},copy:function(s){return this.q=s.q,this.r=s.r,this.s=s.s,this.h=s.h,this.tile=s.tile||null,this.userData=s.userData||{},this.walkable=s.walkable,this},add:function(s){return this.q+=s.q,this.r+=s.r,this.s+=s.s,this},equals:function(s){return this.q===s.q&&this.r===s.r&&this.s===s.s}},m.Cell.prototype.constructor=m.Cell,m.HexGrid=function(s){s=s||{},this.type=m.HEX,this.size=5,this.cellSize=void 0===s.cellSize?10:s.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var c,u=[];for(c=0;6>c;c++)u.push(this._createVertex(c));for(this.cellShape=new THREE.Shape,this.cellShape.moveTo(u[0].x,u[0].y),c=1;6>c;c++)this.cellShape.lineTo(u[c].x,u[c].y);this.cellShape.lineTo(u[0].x,u[0].y),this.cellShape.autoClose=!0,this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=u,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*m.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new m.Cell(1,-1,0),new m.Cell(1,0,-1),new m.Cell(0,1,-1),new m.Cell(-1,1,0),new m.Cell(-1,0,1),new m.Cell(0,-1,1)],this._diagonals=[new m.Cell(2,-1,-1),new m.Cell(1,1,-2),new m.Cell(-1,2,-1),new m.Cell(-2,1,1),new m.Cell(-1,-1,2),new m.Cell(1,-2,1)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new m.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},m.HexGrid.TWO_THIRDS=2/3,m.HexGrid.prototype={cellToPixel:function(s){return this._vec3.x=s.q*this._cellWidth*.75,this._vec3.y=s.h,this._vec3.z=-(s.s-s.r)*this._cellLength*.5,this._vec3},pixelToCell:function(s){var c=s.x*(m.HexGrid.TWO_THIRDS/this.cellSize),u=(-s.x/3+m.SQRT3/3*s.z)/this.cellSize;return this._cel.set(c,u,-c-u),this._cubeRound(this._cel)},getCellAt:function(s){var c=s.x*(m.HexGrid.TWO_THIRDS/this.cellSize),u=(-s.x/3+m.SQRT3/3*s.z)/this.cellSize;return this._cel.set(c,u,-c-u),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(s,c,u){var p,d,A=this._directions.length;for(this._list.length=0,p=0;A>p;p++)this._cel.copy(s),this._cel.add(this._directions[p]),!(d=this.cells[this.cellToHash(this._cel)])||u&&!u(s,d)||this._list.push(d);if(c)for(p=0;A>p;p++)this._cel.copy(s),this._cel.add(this._diagonals[p]),!(d=this.cells[this.cellToHash(this._cel)])||u&&!u(s,d)||this._list.push(d);return this._list},getRandomCell:function(){var s,c=0,u=m.Tools.randomInt(0,this.numCells);for(s in this.cells){if(c===u)return this.cells[s];c++}return this.cells[s]},cellToHash:function(s){return s.q+this._hashDelimeter+s.r+this._hashDelimeter+s.s},distance:function(s,c){return Math.max(Math.abs(s.q-c.q),Math.abs(s.r-c.r),Math.abs(s.s-c.s))+(c.h-s.h)},clearPath:function(){var s,c;for(s in this.cells)(c=this.cells[s])._calcCost=0,c._priority=0,c._parent=null,c._visited=!1},traverse:function(s){var c;for(c in this.cells)s(this.cells[c])},generateTile:function(s,c,u){var p=Math.abs(s.h);1>p&&(p=1);var d=this._geoCache[p];d||(this.extrudeSettings.amount=p,d=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[p]=d);var A=new m.Tile({size:this.cellSize,scale:c,cell:s,geometry:d,material:u});return s.tile=A,A},generateTiles:function(s){s=s||{};var p,d,A,c=[],u={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(p in u=m.Tools.merge(u,s),this.cellSize=u.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*m.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=u.extrudeSettings,this.cells)(d=this.generateTile(A=this.cells[p],u.tileScale,u.material)).position.copy(this.cellToPixel(A)),d.position.y=0,c.push(d);return c},generateTilePoly:function(s){s||(s=new THREE.MeshBasicMaterial({color:2405631}));var c=new THREE.Mesh(this.cellShapeGeo,s);return this._vec3.set(1,0,0),c.rotateOnAxis(this._vec3,m.PI/2),c},generate:function(s){var c,u,p,d;for(this.size=void 0===(s=s||{}).size?this.size:s.size,c=-this.size;c<this.size+1;c++)for(u=-this.size;u<this.size+1;u++)p=-c-u,Math.abs(c)<=this.size&&Math.abs(u)<=this.size&&Math.abs(p)<=this.size&&(d=new m.Cell(c,u,p),this.add(d))},generateOverlay:function(s,c,u){var p,d,A,E=this.cellShape.createPointsGeometry();for(p=-s;s+1>p;p++)for(d=-s;s+1>d;d++)if(A=-p-d,Math.abs(p)<=s&&Math.abs(d)<=s&&Math.abs(A)<=s){this._cel.set(p,d,A);var g=new THREE.Line(E,u);g.position.copy(this.cellToPixel(this._cel)),g.rotation.x=90*m.DEG_TO_RAD,c.add(g)}},add:function(s){var c=this.cellToHash(s);if(!this.cells[c])return this.cells[c]=s,this.numCells++,s},remove:function(s){var c=this.cellToHash(s);this.cells[c]&&(delete this.cells[c],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(s,c,u){var p=this;m.Tools.getJSON({url:s,callback:function(d){p.fromJSON(d),c.call(u||null,d)},cache:!1,scope:p})},fromJSON:function(s){var c,u,p=s.cells;for(this.cells={},this.numCells=0,this.size=s.size,this.cellSize=s.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*m.SQRT3*this._cellWidth,this.extrudeSettings=s.extrudeSettings,this.autogenerated=s.autogenerated,c=0;c<p.length;c++)(u=new m.Cell).copy(p[c]),this.add(u)},toJSON:function(){var s,c,u={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},p=[];for(c in this.cells)p.push({q:(s=this.cells[c]).q,r:s.r,s:s.s,h:s.h,walkable:s.walkable,userData:s.userData});return u.cells=p,u},_createVertex:function(s){var c=m.TAU/6*s;return new THREE.Vector3(this.cellSize*Math.cos(c),this.cellSize*Math.sin(c),0)},_cubeRound:function(s){var c=Math.round(s.q),u=Math.round(s.r),p=Math.round(s.s),d=Math.abs(c-s.q),A=Math.abs(u-s.r),E=Math.abs(p-s.s);return d>A&&d>E?c=-u-p:A>E?u=-c-p:p=-c-u,this._cel.set(c,u,p)}},m.HexGrid.prototype.constructor=m.HexGrid,m.SqrGrid=function(s){s=s||{},this.type=m.SQR,this.size=5,this.cellSize=void 0===s.cellSize?10:s.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var c=[];c.push(new THREE.Vector3),c.push(new THREE.Vector3(-this.cellSize,this.cellSize)),c.push(new THREE.Vector3(this.cellSize,this.cellSize)),c.push(new THREE.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new THREE.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=c,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new m.Cell(1,0,0),new m.Cell(0,-1,0),new m.Cell(-1,0,0),new m.Cell(0,1,0)],this._diagonals=[new m.Cell(-1,-1,0),new m.Cell(-1,1,0),new m.Cell(1,1,0),new m.Cell(1,-1,0)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new m.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},m.SqrGrid.prototype={cellToPixel:function(s){return this._vec3.x=s.q*this._fullCellSize,this._vec3.y=s.h,this._vec3.z=s.r*this._fullCellSize,this._vec3},pixelToCell:function(s){var c=Math.round(s.x/this._fullCellSize),u=Math.round(s.z/this._fullCellSize);return this._cel.set(c,u,0)},getCellAt:function(s){var c=Math.round(s.x/this._fullCellSize),u=Math.round(s.z/this._fullCellSize);return this._cel.set(c,u),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(s,c,u){var p,d,A=this._directions.length;for(this._list.length=0,p=0;A>p;p++)this._cel.copy(s),this._cel.add(this._directions[p]),!(d=this.cells[this.cellToHash(this._cel)])||u&&!u(s,d)||this._list.push(d);if(c)for(p=0;A>p;p++)this._cel.copy(s),this._cel.add(this._diagonals[p]),!(d=this.cells[this.cellToHash(this._cel)])||u&&!u(s,d)||this._list.push(d);return this._list},getRandomCell:function(){var s,c=0,u=m.Tools.randomInt(0,this.numCells);for(s in this.cells){if(c===u)return this.cells[s];c++}return this.cells[s]},cellToHash:function(s){return s.q+this._hashDelimeter+s.r},distance:function(s,c){return Math.max(Math.abs(s.q-c.q),Math.abs(s.r-c.r))+(c.h-s.h)},clearPath:function(){var s,c;for(s in this.cells)(c=this.cells[s])._calcCost=0,c._priority=0,c._parent=null,c._visited=!1},traverse:function(s){var c;for(c in this.cells)s(this.cells[c])},generateTile:function(s,c,u){var p=Math.abs(s.h);1>p&&(p=1);var d=this._geoCache[p];d||(this.extrudeSettings.amount=p,d=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[p]=d);var A=new m.Tile({size:this.cellSize,scale:c,cell:s,geometry:d,material:u});return s.tile=A,A},generateTiles:function(s){s=s||{};var p,d,A,c=[],u={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(p in u=m.Tools.merge(u,s),this.cellSize=u.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=u.extrudeSettings,this.cells)(d=this.generateTile(A=this.cells[p],u.tileScale,u.material)).position.copy(this.cellToPixel(A)),d.position.y=0,c.push(d);return c},generateTilePoly:function(s){s||(s=new THREE.MeshBasicMaterial({color:2405631}));var c=new THREE.Mesh(this.cellShapeGeo,s);return this._vec3.set(1,0,0),c.rotateOnAxis(this._vec3,m.PI/2),c},generate:function(s){this.size=void 0===(s=s||{}).size?this.size:s.size;var c,u,p,d=Math.ceil(this.size/2);for(c=-d;d>c;c++)for(u=-d;d>u;u++)p=new m.Cell(c,u+1),this.add(p)},generateOverlay:function(s,c,u){var p,d,A=Math.ceil(s/2);for(p=-A;A>p;p++)for(d=-A;A>d;d++){this._cel.set(p,d);var E=new THREE.Line(this.cellGeo,u);E.position.copy(this.cellToPixel(this._cel)),E.rotation.x=90*m.DEG_TO_RAD,c.add(E)}},add:function(s){var c=this.cellToHash(s);if(!this.cells[c])return this.cells[c]=s,this.numCells++,s},remove:function(s){var c=this.cellToHash(s);this.cells[c]&&(delete this.cells[c],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(s,c,u){m.Tools.getJSON({url:s,callback:function(p){this.fromJSON(p),c.call(u||null,p)},cache:!1,scope:this})},fromJSON:function(s){var c,u,p=s.cells;for(this.cells={},this.numCells=0,this.size=s.size,this.cellSize=s.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=s.extrudeSettings,this.autogenerated=s.autogenerated,c=0;c<p.length;c++)(u=new m.Cell).copy(p[c]),this.add(u)},toJSON:function(){var s,c,u={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},p=[];for(c in this.cells)p.push({q:(s=this.cells[c]).q,r:s.r,s:s.s,h:s.h,walkable:s.walkable,userData:s.userData});return u.cells=p,u}},m.SqrGrid.prototype.constructor=m.SqrGrid,m.Tile=function(s){var c={cell:null,geometry:null,material:null};if(!(c=m.Tools.merge(c,s=s||{})).cell||!c.geometry)throw new Error("Missing vg.Tile configuration");this.cell=c.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=m.Tools.generateID(),this.geometry=c.geometry,this.material=c.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:m.Tools.randomizeRGB("30, 30, 30",13)})),this.objectType=m.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*m.DEG_TO_RAD,this.mesh.scale.set(c.scale,c.scale,1),this._emissive=this.material.emissive?this.material.emissive.getHex():null},m.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},m.Tile.prototype.constructor=m.Tile,(s=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}).generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},(s.prototype={getNode:function(c){return this.objToNodeMap[c.uniqueID]},addNode:function(c){var u=new function(){this.obj=null,this.next=null,this.prev=null,this.free=!0};if(!c.uniqueID)try{c.uniqueID=s.generateID()}catch{return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return u.obj=c,u.free=!1,this.objToNodeMap[c.uniqueID]=u,u},swapObjects:function(c,u){this.objToNodeMap[c.obj.uniqueID]=null,this.objToNodeMap[u.uniqueID]=c,c.obj=u},add:function(c){var u=this.objToNodeMap[c.uniqueID];if(u){if(!1===u.free)return;u.obj=c,u.free=!1,u.next=null,u.prev=null}else u=this.addNode(c);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=u,u.prev=this.last,this.last=u,u.next=null}else this.first=u,this.last=u,u.next=null,u.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(c){return!!this.objToNodeMap[c.uniqueID]},moveUp:function(c){this.dump("before move up");var u=this.getNode(c);if(!u)throw"Oops, trying to move an object that isn't in the list";if(u.prev){var p=u.prev,d=p.prev;u==this.last&&(this.last=p);var A=u.next;d&&(d.next=u),u.next=p,u.prev=p.prev,p.next=A,p.prev=u,this.first==p&&(this.first=u)}},moveDown:function(c){var u=this.getNode(c);if(!u)throw"Oops, trying to move an object that isn't in the list";if(u.next){var p=u.next;this.moveUp(p.obj),this.last==p&&(this.last=u)}},sort:function(c){var u,p,d=this.sortArray,A=this.first;for(d.length=0;A;)d.push(A.obj),A=A.next;for(this.clear(),d.sort(c),p=d.length,u=0;p>u;u++)this.add(d[u])},remove:function(c){var u=this.getNode(c);return!(!u||u.free||(u.prev&&(u.prev.next=u.next),u.next&&(u.next.prev=u.prev),u.prev||(this.first=u.next),u.next||(this.last=u.prev),u.free=!0,u.prev=null,u.next=null,this.length--,0))},shift:function(){var c=this.first;return 0===this.length?null:(c.prev&&(c.prev.next=c.next),c.next&&(c.next.prev=c.prev),this.first=c.next,c.next||(this.last=null),c.free=!0,c.prev=null,c.next=null,this.length--,c.obj)},pop:function(){var c=this.last;return 0===this.length?null:(c.prev&&(c.prev.next=c.next),c.next&&(c.next.prev=c.prev),this.last=c.prev,c.prev||(this.first=null),c.free=!0,c.prev=null,c.next=null,this.length--,c.obj)},concat:function(c){for(var u=c.first;u;)this.add(u.obj),u=u.next},clear:function(){for(var c=this.first;c;)c.free=!0,c=c.next;this.first=null,this.length=0},dispose:function(){for(var c=this.first;c;)c.obj=null,c=c.next;this.first=null,this.objToNodeMap=null},dump:function(c){console.log("===================="+c+"=====================");for(var u=this.first;u;)console.log("{"+u.obj.toString()+"} previous="+(u.prev?u.prev.obj:"NULL")),u=u.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}).constructor=s,m.LinkedList=s,function(){var s=function(u,p,d,A,E){this._listener=p,this.isOnce=d,this.context=A,this.signal=u,this._priority=E||0};(s.prototype={active:!0,params:null,execute:function(u){var p,d;return this.active&&this._listener&&(d=this.params?this.params.concat(u):u,p=this._listener.apply(this.context,d),this.isOnce&&this.detach()),p},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}}).constructor=s;var c=function u(){this._bindings=[],this._prevParams=null;var p=this;this.dispatch=function(){u.prototype.dispatch.apply(p,arguments)}};(c.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(u,p){if("function"!=typeof u)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",p))},_registerListener:function(u,p,d,A){var E,g=this._indexOfListener(u,d);if(-1!==g){if((E=this._bindings[g]).isOnce!==p)throw new Error("You cannot add"+(p?"":"Once")+"() then add"+(p?"Once":"")+"() the same listener without removing the relationship first.")}else E=new s(this,u,p,d,A),this._addBinding(E);return this.memorize&&this._prevParams&&E.execute(this._prevParams),E},_addBinding:function(u){var p=this._bindings.length;do{p--}while(this._bindings[p]&&u._priority<=this._bindings[p]._priority);this._bindings.splice(p+1,0,u)},_indexOfListener:function(u,p){for(var d,A=this._bindings.length;A--;)if((d=this._bindings[A])._listener===u&&d.context===p)return A;return-1},has:function(u,p){return-1!==this._indexOfListener(u,p)},add:function(u,p,d){return this.validateListener(u,"add"),this._registerListener(u,!1,p,d)},addOnce:function(u,p,d){return this.validateListener(u,"addOnce"),this._registerListener(u,!0,p,d)},remove:function(u,p){this.validateListener(u,"remove");var d=this._indexOfListener(u,p);return-1!==d&&(this._bindings[d]._destroy(),this._bindings.splice(d,1)),u},removeAll:function(u){void 0===u&&(u=null);for(var p=this._bindings.length;p--;)u?this._bindings[p].context===u&&(this._bindings[p]._destroy(),this._bindings.splice(p,1)):this._bindings[p]._destroy();u||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var u,p=Array.prototype.slice.call(arguments),d=this._bindings.length;if(this.memorize&&(this._prevParams=p),d){u=this._bindings.slice(),this._shouldPropagate=!0;do{d--}while(u[d]&&this._shouldPropagate&&!1!==u[d].execute(p))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}).constructor=c,m.Signal=c}(),m.AStarFinder=function(s){var c={allowDiagonal:!1,heuristicFilter:null};c=m.Tools.merge(c,s=s||{}),this.allowDiagonal=c.allowDiagonal,this.heuristicFilter=c.heuristicFilter,this.list=new m.LinkedList},m.AStarFinder.prototype={findPath:function(s,c,u,p){var d,A,E,g,v,T;for(u=u||this.heuristicFilter,p.clearPath(),this.list.clear(),this.list.add(s);this.list.length>0;){if(this.list.sort(this.compare),(d=this.list.shift())._visited=!0,d===c)return m.PathUtil.backtrace(c);for(v=0,T=(E=p.getNeighbors(d,this.allowDiagonal,u)).length;T>v;v++)if((g=E[v]).walkable&&(A=d._calcCost+p.distance(d,g),!g._visited||A<g._calcCost)){if(g._visited=!0,g._parent=d,g._calcCost=A,g._priority=A+p.distance(c,g),g===c)return m.PathUtil.backtrace(c);this.list.add(g)}}return null},compare:function(s,c){return s._priority-c._priority}},m.AStarFinder.prototype.constructor=m.AStarFinder,m.PathUtil={backtrace:function(s){for(var c=[s];s._parent;)c.push(s=s._parent);return c.reverse()},biBacktrace:function(s,c){var u=this.backtrace(s),p=this.backtrace(c);return u.concat(p.reverse())},pathLength:function(s){var c,u,p,d,A,E=0;for(c=1;c<s.length;++c)d=(u=s[c-1])[0]-(p=s[c])[0],A=u[1]-p[1],E+=Math.sqrt(d*d+A*A);return E},interpolate:function(s,c,u,p){var d,A,E,g,v,T,y=Math.abs,M=[];for(d=u>s?1:-1,A=p>c?1:-1,v=(E=y(u-s))-(g=y(p-c));s!==u||c!==p;)M.push([s,c]),(T=2*v)>-g&&(v-=g,s+=d),E>T&&(v+=E,c+=A);return M},expandPath:function(s){var c,u,p,d,A,E,g=[],v=s.length;if(2>v)return g;for(A=0;v-1>A;++A)for(d=(p=this.interpolate((c=s[A])[0],c[1],(u=s[A+1])[0],u[1])).length,E=0;d-1>E;++E)g.push(p[E]);return g.push(s[v-1]),g},smoothenPath:function(s,c){var u,p,d,E,g,v,T,y,M,_,O,D=c.length,q=c[D-1][0],V=c[D-1][1];for(E=[[u=c[0][0],p=c[0][1]]],v=2;D>v;++v){for(d=(y=c[v])[0],M=this.interpolate(u,p,d,y[1]),O=!1,T=1;T<M.length;++T)if(!s.isWalkableAt((_=M[T])[0],_[1])){O=!0;break}O&&(E.push(g=c[v-1]),u=g[0],p=g[1])}return E.push([q,V]),E},compressPath:function(s){if(s.length<3)return s;var c,u,p,d,A,E,g=[],v=s[0][0],T=s[0][1],y=s[1][0],M=s[1][1],_=y-v,O=M-T;for(_/=A=Math.sqrt(_*_+O*O),O/=A,g.push([v,T]),E=2;E<s.length;E++)c=y,u=M,p=_,d=O,_=(y=s[E][0])-c,O=(M=s[E][1])-u,O/=A=Math.sqrt(_*_+O*O),((_/=A)!==p||O!==d)&&g.push([c,u]);return g.push([y,M]),g}},m.Loader={manager:null,imageLoader:null,crossOrigin:!1,init:function(s){this.crossOrigin=s||!1,this.manager=new THREE.LoadingManager(function(){},function(){},function(){console.warn("Error loading images")}),this.imageLoader=new THREE.ImageLoader(this.manager),this.imageLoader.crossOrigin=s},loadTexture:function(s,c,u,p){var d=new THREE.Texture(null,c);return this.imageLoader.load(s,function(A){d.image=A,d.needsUpdate=!0,u&&u(d)},null,function(A){p&&p(A)}),d.sourceFile=s,d}},m.MouseCaster=function(s,c,u){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new m.Signal,this.group=s,this._camera=c,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,(u=u||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),u.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),u.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),u.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),u.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},m.MouseCaster.OVER="over",m.MouseCaster.OUT="out",m.MouseCaster.DOWN="down",m.MouseCaster.UP="up",m.MouseCaster.CLICK="click",m.MouseCaster.WHEEL="wheel",m.MouseCaster.prototype={update:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var s,c,u=this._raycaster.intersectObject(this.group,!0);u.length>0?(this.pickedObject!=(c=(s=u[0]).object.userData.structure)&&(this.pickedObject&&this.signal.dispatch(m.MouseCaster.OUT,this.pickedObject),this.pickedObject=c,this.selectedObject=null,this.signal.dispatch(m.MouseCaster.OVER,this.pickedObject)),this.position.copy(s.point),this.screenPosition.z=s.distance):(this.pickedObject&&this.signal.dispatch(m.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=u}},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(s){return(s=s||window.event).preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=s.shiftKey,this.ctrl=s.ctrlKey,this.down=1===s.which,this.rightDown=3===s.which,void this.signal.dispatch(m.MouseCaster.DOWN,this.pickedObject))},_onDocumentMouseUp:function(s){return s.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.shift=s.shiftKey,this.ctrl=s.ctrlKey,this.signal.dispatch(m.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(m.MouseCaster.CLICK,this.pickedObject),this.down=1!==s.which&&this.down,void(this.rightDown=3!==s.which&&this.rightDown))},_onDocumentMouseMove:function(s){s.preventDefault(),this.screenPosition.x=s.clientX/window.innerWidth*2-1,this.screenPosition.y=-s.clientY/window.innerHeight*2+1},_onMouseWheel:function(s){if(this.active){s.preventDefault(),s.stopPropagation();var c=0;void 0!==s.wheelDelta?c=s.wheelDelta:void 0!==s.detail&&(c=-s.detail),c>0?this.wheel++:this.wheel--,this.signal.dispatch(m.MouseCaster.WHEEL,this.wheel)}}},m.MouseCaster.prototype.constructor=m.MouseCaster,m.Scene=function(s,c){var u={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},p={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(u=m.Tools.merge(u,s),"boolean"!=typeof c&&(p=m.Tools.merge(p,c)),this.renderer=new THREE.WebGLRenderer({alpha:u.alpha,antialias:u.antialias}),this.renderer.setClearColor(u.clearColor,0),this.renderer.sortObjects=u.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=u.orthoZoom,this.container=new THREE.Scene,this.container.fog=u.fog,this.container.add(new THREE.AmbientLight(14540253)),u.lightPosition||u.light.position.set(-1,1,-1).normalize(),this.container.add(u.light),"OrthographicCamera"===u.cameraType){var d=window.innerWidth/this.orthoZoom,A=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(d/-2,d/2,A/2,A/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!c,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=p.minDistance,this.controls.maxDistance=p.maxDistance,this.controls.zoomSpeed=p.zoomSpeed,this.controls.noZoom=p.noZoom),u.cameraPosition&&this.camera.position.copy(u.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var E=this.width/this.orthoZoom,g=this.height/this.orthoZoom;this.camera.left=E/-2,this.camera.right=E/2,this.camera.top=g/2,this.camera.bottom=g/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(u.element)},m.Scene.prototype={attachTo:function(s){s.style.width=this.width+"px",s.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),s.appendChild(this.renderer.domElement)},add:function(s){this.container.add(s)},remove:function(s){this.container.remove(s)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)this.orthoZoom=0;else{var s=this.width/this.orthoZoom,c=this.height/this.orthoZoom;this.camera.left=s/-2,this.camera.right=s/2,this.camera.top=c/2,this.camera.bottom=c/-2,this.camera.updateProjectionMatrix()}},focusOn:function(s){this.camera.lookAt(s.position)}},m.Scene.prototype.constructor=m.Scene,m.SelectionManager=function(s){this.mouse=s,this.onSelect=new m.Signal,this.onDeselect=new m.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},m.SelectionManager.prototype={select:function(s,c){s&&(c=c||!0,this.selected!==s&&this.clearSelection(c),s.selected?this.toggleSelection&&(c&&this.onDeselect.dispatch(s),s.deselect()):s.select(),this.selected=s,c&&this.onSelect.dispatch(s))},clearSelection:function(s){s=s||!0,this.selected&&(s&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(s,c){switch(s){case m.MouseCaster.DOWN:c||this.clearSelection();break;case m.MouseCaster.CLICK:this.select(c)}}},m.SelectionManager.prototype.constructor=m.SelectionManager,m.Tools={clamp:function(s,c,u){return Math.max(c,Math.min(u,s))},sign:function(s){return s&&s/Math.abs(s)},random:function(s,c){return 1===arguments.length?Math.random()*s-.5*s:Math.random()*(c-s)+s},randomInt:function(s,c){return 1===arguments.length?Math.random()*s-.5*s|0:Math.random()*(c-s+1)+s|0},normalize:function(s,c,u){return(s-c)/(u-c)},getShortRotation:function(s){return(s%=this.TAU)>this.PI?s-=this.TAU:s<-this.PI&&(s+=this.TAU),s},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(s){if("object"!=(void 0===s?"undefined":C(s))||s.nodeType||s===s.window)return!1;try{if(s.constructor&&!Object.prototype.hasOwnProperty.call(s.constructor.prototype,"isPrototypeOf"))return!1}catch{return!1}return!0},merge:function(s,c){var u=this,p=Array.isArray(c),d=p&&[]||{};return p?(d=d.concat(s=s||[]),c.forEach(function(A,E){void 0===d[E]?d[E]=A:u.isPlainObject(A)?d[E]=u.merge(s[E],A):-1===s.indexOf(A)&&d.push(A)}),d):(s&&u.isPlainObject(s)&&Object.keys(s).forEach(function(A){d[A]=s[A]}),Object.keys(c).forEach(function(A){d[A]=c[A]&&u.isPlainObject(c[A])&&s[A]?u.merge(s[A],c[A]):c[A]}),d)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(s){for(;s.lastChild;)s.removeChild(s.lastChild)},radixSort:function(s,c,u,p){if(p=p||31,!((c=c||0)>=(u=u||s.length)-1||0>p)){for(var d=c,A=u,E=1<<p;A>d;)if(s[d]&E){--A;var g=s[d];s[d]=s[A],s[A]=g}else++d;this.radixSort(s,c,A,p-1),this.radixSort(s,A,u,p-1)}},randomizeRGB:function(s,c){var u,p,d=s.split(","),A="rgb(";for(c=this.randomInt(c),u=0;3>u;u++)0>(p=parseInt(d[u])+c)?p=0:p>255&&(p=255),A+=p+",";return(A=A.substring(0,A.length-1))+")"},getJSON:function(s){var c=new XMLHttpRequest,u=void 0!==s.cache&&s.cache?s.url:s.url+"?t="+Math.floor(1e4*Math.random())+Date.now();c.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+s.url);else{var p=null;try{p=JSON.parse(this.responseText)}catch{return}s.callback.call(s.scope||null,p)}},c.open("GET",u,!0),c.setRequestHeader("Accept","application/json"),c.setRequestHeader("Content-Type","application/json"),c.send("")}}},{}],10:[function(ee,be,ue){"use strict";!function(h){function C(H,q){return-1!==String(H).indexOf(q)}function m(H,q,V){v!==q&&g!==q&&E!==q||Object.keys(V).forEach(function(ne){H[ne]=V[ne]})}function s(H){var q="keyCode"in H?H.keyCode:"which"in H?H.which:0,V=function(){if(B||"keyLocation"in H){var ae=B?H.location:H.keyLocation;if(ae&&q in M[ae])return M[ae][q]}return"keyIdentifier"in H&&H.keyIdentifier in y?y[H.keyIdentifier]:q in T?T[q]:null}();if(!V)return null;var ae,ne=(ae=_[V.code])?H.shiftKey&&"shiftKey"in ae?ae.shiftKey:ae.key:V.code;return{code:V.code,key:ne,location:V.location,keyCap:V.keyCap}}var c="KeyboardEvent"in h;c||(h.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in h.KeyboardEvent||(h.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in h.KeyboardEvent||(h.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in h.KeyboardEvent||(h.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in h.KeyboardEvent||(h.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var u=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,p=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,d=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,A=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD,E=C(navigator.platform,"Win")?"win":C(navigator.platform,"Mac")?"mac":C(navigator.platform,"CrOS")?"cros":C(navigator.platform,"Linux")?"linux":C(navigator.userAgent,"iPad")||C(navigator.platform,"iPod")||C(navigator.platform,"iPhone")?"ios":"",g=C(navigator.userAgent,"Chrome/")?"chrome":C(navigator.vendor,"Apple")?"safari":C(navigator.userAgent,"MSIE")?"ie":C(navigator.userAgent,"Gecko/")?"moz":C(navigator.userAgent,"Opera/")?"opera":"",v=g+"-"+E,T={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:p},92:{code:"OSRight",location:d},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:A},97:{code:"Numpad1",keyCap:"1",location:A},98:{code:"Numpad2",keyCap:"2",location:A},99:{code:"Numpad3",keyCap:"3",location:A},100:{code:"Numpad4",keyCap:"4",location:A},101:{code:"Numpad5",keyCap:"5",location:A},102:{code:"Numpad6",keyCap:"6",location:A},103:{code:"Numpad7",keyCap:"7",location:A},104:{code:"Numpad8",keyCap:"8",location:A},105:{code:"Numpad9",keyCap:"9",location:A},106:{code:"NumpadMultiply",keyCap:"*",location:A},107:{code:"NumpadAdd",keyCap:"+",location:A},108:{code:"NumpadComma",keyCap:",",location:A},109:{code:"NumpadSubtract",keyCap:"-",location:A},110:{code:"NumpadDecimal",keyCap:".",location:A},111:{code:"NumpadDivide",keyCap:"/",location:A},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:A},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:p},161:{code:"ShiftRight",location:d},162:{code:"ControlLeft",location:p},163:{code:"ControlRight",location:d},164:{code:"AltLeft",location:p},165:{code:"AltRight",location:d},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};m(T,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:A},189:{code:"NumpadSubtract",keyCap:"-",location:A}}),m(T,"moz-mac",{12:{code:"NumLock",location:A},173:{code:"Minus",keyCap:"-"}}),m(T,"moz-win",{173:{code:"Minus",keyCap:"-"}}),m(T,"chrome-mac",{93:{code:"OSRight",location:d}}),m(T,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),m(T,"ios",{10:{code:"Enter",location:u}}),m(T,"safari-mac",{91:{code:"OSLeft",location:p},93:{code:"OSRight",location:d},229:{code:"KeyQ",keyCap:"Q"}});var y={};"cros"===E&&(y["U+00A0"]={code:"ShiftLeft",location:p},y["U+00A1"]={code:"ShiftRight",location:d},y["U+00A2"]={code:"ControlLeft",location:p},y["U+00A3"]={code:"ControlRight",location:d},y["U+00A4"]={code:"AltLeft",location:p},y["U+00A5"]={code:"AltRight",location:d}),"chrome-mac"===v&&(y["U+0010"]={code:"ContextMenu"}),"safari-mac"===v&&(y["U+0010"]={code:"ContextMenu"}),"ios"===E&&(y["U+0010"]={code:"Function"},y["U+001C"]={code:"ArrowLeft"},y["U+001D"]={code:"ArrowRight"},y["U+001E"]={code:"ArrowUp"},y["U+001F"]={code:"ArrowDown"},y["U+0001"]={code:"Home"},y["U+0004"]={code:"End"},y["U+000B"]={code:"PageUp"},y["U+000C"]={code:"PageDown"});var M=[];M[p]={16:{code:"ShiftLeft",location:p},17:{code:"ControlLeft",location:p},18:{code:"AltLeft",location:p}},M[d]={16:{code:"ShiftRight",location:d},17:{code:"ControlRight",location:d},18:{code:"AltRight",location:d}},M[A]={13:{code:"NumpadEnter",location:A}},m(M[A],"moz",{109:{code:"NumpadSubtract",location:A},107:{code:"NumpadAdd",location:A}}),m(M[p],"moz-mac",{224:{code:"OSLeft",location:p}}),m(M[d],"moz-mac",{224:{code:"OSRight",location:d}}),m(M[d],"moz-win",{91:{code:"OSRight",location:d}}),m(M[d],"mac",{93:{code:"OSRight",location:d}}),m(M[A],"chrome-mac",{12:{code:"NumLock",location:A}}),m(M[A],"safari-mac",{12:{code:"NumLock",location:A},187:{code:"NumpadAdd",location:A},189:{code:"NumpadSubtract",location:A},190:{code:"NumpadDecimal",location:A},191:{code:"NumpadDivide",location:A}});var _={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};m(_,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var H,q,V,O={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},D=(H=T,q="code",V={},Object.keys(H).forEach(function(ne){var ae=H[ne];q in ae&&(V[ae[q]]=ae)}),V);try{var B=c&&"location"in new KeyboardEvent("")}catch{}"KeyboardEvent"in h&&"defineProperty"in Object&&function(){function H(V,ne,ae){ne in V||Object.defineProperty(V,ne,ae)}if(H(KeyboardEvent.prototype,"code",{get:function(){var V=s(this);return V?V.code:""}}),"key"in KeyboardEvent.prototype){var q=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var V=q.get.call(this);return O.hasOwnProperty(V)?O[V]:V}})}H(KeyboardEvent.prototype,"key",{get:function(){var V=s(this);return V&&"key"in V?V.key:"Unidentified"}}),H(KeyboardEvent.prototype,"location",{get:function(){var V=s(this);return V&&"location"in V?V.location:u}}),H(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in h.KeyboardEvent||(h.KeyboardEvent.queryKeyCap=function(H,q){if(H=String(H),!D.hasOwnProperty(H))return"Undefined";if(q&&"en-us"!==String(q).toLowerCase())throw Error("Unsupported locale");var V=D[H];return V.keyCap||V.code||"Undefined"}),h.identifyKey=function(H){if(!("code"in H)){var q=s(H);H.code=q?q.code:"",H.key=q&&"key"in q?q.key:"Unidentified",H.location="location"in H?H.location:"keyLocation"in H?H.keyLocation:q&&"location"in q?q.location:u,H.locale=""}}}(window)},{}],11:[function(ee,be,ue){var h=function(){};h.computeCentroids=function(y){var M,_,O;for(M=0,_=y.faces.length;M<_;M++)(O=y.faces[M]).centroid=new THREE.Vector3(0,0,0),O.centroid.add(y.vertices[O.a]),O.centroid.add(y.vertices[O.b]),O.centroid.add(y.vertices[O.c]),O.centroid.divideScalar(3)},h.roundNumber=function(y,M){return Number(y.toFixed(M))},h.sample=function(y){return y[Math.floor(Math.random()*y.length)]},h.mergeVertexIds=function(y,M){var _=[];if(y.forEach(function(V){M.indexOf(V)>=0&&_.push(V)}),_.length<2)return[];_.includes(y[0])&&_.includes(y[y.length-1])&&y.push(y.shift()),_.includes(M[0])&&_.includes(M[M.length-1])&&M.push(M.shift()),_=[],y.forEach(function(V){M.includes(V)&&_.push(V)});for(var O=_[1],D=_[0],B=y.slice();B[0]!==O;)B.push(B.shift());for(var H=0,q=M.slice();q[0]!==D;)if(q.push(q.shift()),H++>10)throw new Error("Unexpected state");return q.shift(),q.pop(),B.concat(q)},h.setPolygonCentroid=function(y,M){var _=new THREE.Vector3,O=M.vertices;y.vertexIds.forEach(function(D){_.add(O[D])}),_.divideScalar(y.vertexIds.length),y.centroid.copy(_)},h.cleanPolygon=function(y,M){for(var _=[],O=M.vertices,D=0;D<y.vertexIds.length;D++){var B,H,q,V=O[y.vertexIds[D]];0===D?(B=y.vertexIds[1],H=y.vertexIds[y.vertexIds.length-1]):D===y.vertexIds.length-1?(B=y.vertexIds[0],H=y.vertexIds[y.vertexIds.length-2]):(B=y.vertexIds[D+1],H=y.vertexIds[D-1]),q=O[H];var ne=O[B].clone().sub(V),ae=q.clone().sub(V),fe=ne.angleTo(ae);if(fe>Math.PI-.01&&fe<Math.PI+.01){var he=[];y.neighbours.forEach(function(me){me.vertexIds.includes(y.vertexIds[D])||he.push(me)}),y.neighbours=he}else _.push(y.vertexIds[D])}y.vertexIds=_,this.setPolygonCentroid(y,M)},h.isConvex=function(y,M){var _=M.vertices;if(y.vertexIds.length<3)return!1;for(var O=!0,D=[],B=0;B<y.vertexIds.length;B++){var H,q,V=_[y.vertexIds[B]];0===B?(H=_[y.vertexIds[1]],q=_[y.vertexIds[y.vertexIds.length-1]]):B===y.vertexIds.length-1?(H=_[y.vertexIds[0]],q=_[y.vertexIds[y.vertexIds.length-2]]):(H=_[y.vertexIds[B+1]],q=_[y.vertexIds[B-1]]);var ne=H.clone().sub(V),ae=q.clone().sub(V),fe=ne.angleTo(ae);if(fe===Math.PI||0===fe)return!1;var he=ne.cross(ae).y;D.push(he)}return D.forEach(function(me){0===me&&(O=!1)}),D.forEach(D[0]>0?function(me){me<0&&(O=!1)}:function(me){me>0&&(O=!1)}),O},h.distanceToSquared=function(y,M){var _=y.x-M.x,O=y.y-M.y,D=y.z-M.z;return _*_+O*O+D*D},h.isPointInPoly=function(y,M){for(var _=!1,O=-1,D=y.length,B=D-1;++O<D;B=O)(y[O].z<=M.z&&M.z<y[B].z||y[B].z<=M.z&&M.z<y[O].z)&&M.x<(y[B].x-y[O].x)*(M.z-y[O].z)/(y[B].z-y[O].z)+y[O].x&&(_=!_);return _},h.isVectorInPolygon=function(y,M,_){var O=1e5,D=-1e5,B=[];return M.vertexIds.forEach(function(H){O=Math.min(_[H].y,O),D=Math.max(_[H].y,D),B.push(_[H])}),!!(y.y<D+.5&&y.y>O-.5&&this.isPointInPoly(B,y))},h.triarea2=function(y,M,_){return(_.x-y.x)*(M.z-y.z)-(M.x-y.x)*(_.z-y.z)},h.vequal=function(y,M){return this.distanceToSquared(y,M)<1e-5};var C=function(y){this.content=[],this.scoreFunction=y};C.prototype.push=function(y){this.content.push(y),this.sinkDown(this.content.length-1)},C.prototype.pop=function(){var y=this.content[0],M=this.content.pop();return this.content.length>0&&(this.content[0]=M,this.bubbleUp(0)),y},C.prototype.remove=function(y){var M=this.content.indexOf(y),_=this.content.pop();M!==this.content.length-1&&(this.content[M]=_,this.scoreFunction(_)<this.scoreFunction(y)?this.sinkDown(M):this.bubbleUp(M))},C.prototype.size=function(){return this.content.length},C.prototype.rescoreElement=function(y){this.sinkDown(this.content.indexOf(y))},C.prototype.sinkDown=function(y){for(var M=this.content[y];y>0;){var _=(y+1>>1)-1,O=this.content[_];if(!(this.scoreFunction(M)<this.scoreFunction(O)))break;this.content[_]=M,this.content[y]=O,y=_}},C.prototype.bubbleUp=function(y){for(var M=this.content.length,_=this.content[y],O=this.scoreFunction(_);;){var D=y+1<<1,B=D-1,H=null,q=void 0;if(B<M&&(q=this.scoreFunction(this.content[B]))<O&&(H=B),D<M&&this.scoreFunction(this.content[D])<(null===H?O:q)&&(H=D),null===H)break;this.content[y]=this.content[H],this.content[H]=_,y=H}};var m=function(){};m.init=function(y){for(var M=0;M<y.length;M++){var _=y[M];_.f=0,_.g=0,_.h=0,_.cost=1,_.visited=!1,_.closed=!1,_.parent=null}},m.cleanUp=function(y){for(var M=0;M<y.length;M++){var _=y[M];delete _.f,delete _.g,delete _.h,delete _.cost,delete _.visited,delete _.closed,delete _.parent}},m.heap=function(){return new C(function(y){return y.f})},m.search=function(y,M,_){this.init(y);var O=this.heap();for(O.push(M);O.size()>0;){var D=O.pop();if(D===_){for(var B=D,H=[];B.parent;)H.push(B),B=B.parent;return this.cleanUp(H),H.reverse()}D.closed=!0;for(var q=this.neighbours(y,D),V=0,ne=q.length;V<ne;V++){var ae=q[V];if(!ae.closed){var fe=D.g+ae.cost,he=ae.visited;if(!he||fe<ae.g){if(ae.visited=!0,ae.parent=D,!ae.centroid||!_.centroid)throw new Error("Unexpected state");ae.h=ae.h||this.heuristic(ae.centroid,_.centroid),ae.g=fe,ae.f=ae.g+ae.h,he?O.rescoreElement(ae):O.push(ae)}}}}return[]},m.heuristic=function(y,M){return h.distanceToSquared(y,M)},m.neighbours=function(y,M){for(var _=[],O=0;O<M.neighbours.length;O++)_.push(y[M.neighbours[O]]);return _};var s=1,c=function(){};c.buildZone=function(y){var M=this,_=this._buildNavigationMesh(y),O={};_.vertices.forEach(function(H){H.x=h.roundNumber(H.x,2),H.y=h.roundNumber(H.y,2),H.z=h.roundNumber(H.z,2)}),O.vertices=_.vertices;var D=this._buildPolygonGroups(_);O.groups=[];var B=function(H,q){for(var V=0;V<H.length;V++)if(q===H[V])return V};return D.forEach(function(H){var q=[];H.forEach(function(V){var ne=V.neighbours.map(function(fe){return B(H,fe)}),ae=V.neighbours.map(function(fe){return M._getSharedVerticesInOrder(V,fe)});V.centroid.x=h.roundNumber(V.centroid.x,2),V.centroid.y=h.roundNumber(V.centroid.y,2),V.centroid.z=h.roundNumber(V.centroid.z,2),q.push({id:B(H,V),neighbours:ne,vertexIds:V.vertexIds,centroid:V.centroid,portals:ae})}),O.groups.push(q)}),O},c._buildNavigationMesh=function(y){return h.computeCentroids(y),y.mergeVertices(),this._buildPolygonsFromGeometry(y)},c._buildPolygonGroups=function(y){var M=[],_=0,O=function(D){D.neighbours.forEach(function(B){void 0===B.group&&(B.group=D.group,O(B))})};return y.polygons.forEach(function(D){void 0===D.group&&(D.group=_++,O(D)),M[D.group]||(M[D.group]=[]),M[D.group].push(D)}),M},c._buildPolygonNeighbours=function(y,M,_){var O=new Set,D=_.get(y.vertexIds[0]),B=_.get(y.vertexIds[1]),H=_.get(y.vertexIds[2]);D.forEach(function(q){(B.has(q)||H.has(q))&&O.add(M.polygons[q])}),B.forEach(function(q){H.has(q)&&O.add(M.polygons[q])}),y.neighbours=Array.from(O)},c._buildPolygonsFromGeometry=function(y){for(var M=this,_=[],O=y.vertices,D=y.faceVertexUvs,B=new Map,H=0;H<O.length;H++)B.set(H,new Set);y.faces.forEach(function(V){_.push({id:s++,vertexIds:[V.a,V.b,V.c],centroid:V.centroid,normal:V.normal,neighbours:[]}),B.get(V.a).add(_.length-1),B.get(V.b).add(_.length-1),B.get(V.c).add(_.length-1)});var q={polygons:_,vertices:O,faceVertexUvs:D};return _.forEach(function(V){M._buildPolygonNeighbours(V,q,B)}),q},c._getSharedVerticesInOrder=function(y,M){var _=y.vertexIds,O=M.vertexIds,D=new Set;if(_.forEach(function(H){O.includes(H)&&D.add(H)}),D.size<2)return[];D.has(_[0])&&D.has(_[_.length-1])&&_.push(_.shift()),D.has(O[0])&&D.has(O[O.length-1])&&O.push(O.shift());var B=[];return _.forEach(function(H){O.includes(H)&&B.push(H)}),B};var u=function(){this.portals=[]};u.prototype.push=function(y,M){void 0===M&&(M=y),this.portals.push({left:y,right:M})},u.prototype.stringPull=function(){var y,M,_,O=this.portals,D=[],B=0,H=0,q=0;M=O[0].left,_=O[0].right,D.push(y=O[0].left);for(var V=1;V<O.length;V++){var ne=O[V].left,ae=O[V].right;if(h.triarea2(y,_,ae)<=0){if(!(h.vequal(y,_)||h.triarea2(y,M,ae)>0)){D.push(M),M=y=M,_=y,H=B=H,q=B,V=B;continue}_=ae,q=V}if(h.triarea2(y,M,ne)>=0){if(!(h.vequal(y,M)||h.triarea2(y,_,ne)<0)){D.push(_),M=y=_,_=y,H=B=q,q=B,V=B;continue}M=ne,H=V}}return 0!==D.length&&h.vequal(D[D.length-1],O[O.length-1].left)||D.push(O[O.length-1].left),this.path=D,D};var p,d,A,E,g,v,T=function(){this.zones={}};T.createZone=function(y){return c.buildZone(y)},T.prototype.setZoneData=function(y,M){this.zones[y]=M},T.prototype.getGroup=function(y,M){if(!this.zones[y])return null;var _=null,O=Math.pow(50,2);return this.zones[y].groups.forEach(function(D,B){D.forEach(function(H){var q=h.distanceToSquared(H.centroid,M);q<O&&(_=B,O=q)})}),_},T.prototype.getRandomNode=function(y,M,_,O){if(!this.zones[y])return new THREE.Vector3;_=_||null,O=O||0;var D=[];return this.zones[y].groups[M].forEach(function(B){_&&O?h.distanceToSquared(_,B.centroid)<O*O&&D.push(B.centroid):D.push(B.centroid)}),h.sample(D)||new THREE.Vector3},T.prototype.getClosestNode=function(y,M,_,O){void 0===O&&(O=!1);var D=this.zones[M].vertices,B=null,H=1/0;return this.zones[M].groups[_].forEach(function(q){var V=h.distanceToSquared(q.centroid,y);V<H&&(!O||h.isVectorInPolygon(y,q,D))&&(B=q,H=V)}),B},T.prototype.findPath=function(y,M,_,O){var D=this.zones[_].groups[O],B=this.zones[_].vertices,H=this.getClosestNode(y,_,O),q=this.getClosestNode(M,_,O,!0);if(!H||!q)return null;var V=m.search(D,H,q),ne=function(X,W){for(var te=0;te<X.neighbours.length;te++)if(X.neighbours[te]===W.id)return X.portals[te]},ae=new u;ae.push(y);for(var fe=0;fe<V.length;fe++){var he=V[fe+1];if(he){var me=ne(V[fe],he);ae.push(B[me[0]],B[me[1]])}}ae.push(M),ae.stringPull();var P=ae.path.map(function(X){return new THREE.Vector3(X.x,X.y,X.z)});return P.shift(),P},T.prototype.clampStep=(A=new THREE.Vector3,E=new THREE.Plane,g=new THREE.Triangle,v=new THREE.Vector3,function(y,M,_,O,D,B){var H=this.zones[O].vertices,q=this.zones[O].groups[D],V=[_],ne={};ne[_.id]=0,p=void 0,v.set(0,0,0),d=1/0,E.setFromCoplanarPoints(H[_.vertexIds[0]],H[_.vertexIds[1]],H[_.vertexIds[2]]),E.projectPoint(M,A),M.copy(A);for(var ae=V.pop();ae;ae=V.pop()){g.set(H[ae.vertexIds[0]],H[ae.vertexIds[1]],H[ae.vertexIds[2]]),g.closestPointToPoint(M,A),A.distanceToSquared(M)<d&&(p=ae,v.copy(A),d=A.distanceToSquared(M));var fe=ne[ae];if(!(fe>2))for(var he=0;he<ae.neighbours.length;he++){var me=q[ae.neighbours[he]];me.id in ne||(V.push(me),ne[me.id]=fe+1)}}return B.copy(v),p}),ue.Pathfinding=T},{}],12:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(h){var C=this.el;this.active&&this.checkpoint!==h&&(this.checkpoint&&C.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=h,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(C.emit("navigation-start",{checkpoint:h}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,C.emit("navigation-end",{checkpoint:h}),C.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(this.active){var h=this.data,C=this.offset,m=this.position,s=this.targetPosition,c=this.checkpoint;return this.sync(),m.distanceTo(s)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:c}),C.set(0,0,0)):(C.setLength(h.animateSpeed),C)}},sync:function(){var h=this.offset,C=this.position,m=this.targetPosition;C.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(m),m.add(this.checkpoint.components.checkpoint.getOffset()),h.copy(m).sub(C)}})},{}],13:[function(ee,be,ue){"use strict";var c,u,h=ee("../../lib/GamepadButton"),C=ee("../../lib/GamepadButtonEvent");be.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:h,schema:{enabled:{default:!0},camera:{default:"[camera]",type:"selector"},rotationSensitivity:{default:2}},init:function(){var c=this.el.sceneEl;this.system=c.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};var u=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=THREE.Math.degToRad(u.x),this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=THREE.Math.degToRad(u.y),this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,c.addBehavior(this)},update:function(){this.tick()},tick:function(c,u){this.updateButtonState(),this.updateRotation(u)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var c=this._dpadVector,u=this._moveVector;this.getDpad(c),this.getJoystick(1,u);var d=c.y||u.y;return Math.abs(c.x||u.x)>.2||Math.abs(d)>.2},getVelocityDelta:function(){var c=this._dpadVector,u=this._moveVector;this.getDpad(c),this.getJoystick(1,u);var p=c.x||u.x,d=c.y||u.y,A=new THREE.Vector3;return Math.abs(p)>.2&&(A.x+=p),Math.abs(d)>.2&&(A.z+=d),A},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var c=this._lookVector;return this.getJoystick(2,c),Math.abs(c.x)>.2||Math.abs(c.y)>.2},updateRotation:function(c){if(this.isRotationActive()){var u=this.data,p=this.yaw,d=this.pitch,A=u.camera.components["look-controls"],E=A&&A.pitchObject&&A.yawObject;E&&(d.rotation.copy(A.pitchObject.rotation),p.rotation.copy(A.yawObject.rotation));var g=this._lookVector;this.getJoystick(2,g),Math.abs(g.x)<=.2&&(g.x=0),Math.abs(g.y)<=.2&&(g.y=0),g.multiplyScalar(u.rotationSensitivity*c/1e3),p.rotation.y-=g.x,d.rotation.x-=g.y,d.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,d.rotation.x)),u.camera.object3D.rotation.set(d.rotation.x,p.rotation.y,0),E&&(A.pitchObject.rotation.copy(d.rotation),A.yawObject.rotation.copy(p.rotation))}},updateButtonState:function(){var c=this.getGamepad("right");if(this.data.enabled&&c)for(var u=0;u<c.buttons.length;u++)c.buttons[u].pressed&&!this.buttons[u]?this.emit(new C("gamepadbuttondown",u,c.buttons[u])):!c.buttons[u].pressed&&this.buttons[u]&&this.emit(new C("gamepadbuttonup",u,c.buttons[u])),this.buttons[u]=c.buttons[u].pressed;else Object.keys(this.buttons)&&(this.buttons={})},emit:function(c){this.el.emit(c.type,c),this.el.emit(c.type+":"+c.index,new C(c.type,c.index,c))},getGamepad:(c=[],u=[],function(p){var d=this.el.sceneEl.components["proxy-controls"],A=d&&d.isConnected()&&d.getGamepad(0);if(A)return A;c.length=0;for(var E=0;E<this.system.controllers.length;E++){var g=this.system.controllers[E],v=g?g.gamepad:null;if(c.push(v),v&&v.handedness===p)return v}for(var T=navigator.getGamepads?navigator.getGamepads():u,y=0;y<T.length;y++){var M=T[y];if(M&&M.hand===p)return M}return c[0]||T[0]}),getButton:function(c){return this.getGamepad("right").buttons[c]},getAxis:function(c){return this.getGamepad(c>1?"right":"left").axes[c]},getJoystick:function(c,u){var p=this.getGamepad(1===c?"left":"right");if("xr-standard"===p.mapping)switch(c){case 1:return u.set(p.axes[2],p.axes[3]);case 2:return u.set(p.axes[0],p.axes[1])}else switch(c){case 1:return u.set(p.axes[0],p.axes[1]);case 2:return u.set(p.axes[2],p.axes[3])}throw new Error('Unexpected joystick index "%d".',c)},getDpad:function(c){var u=this.getGamepad("left");return u.buttons[h.DPAD_RIGHT]?c.set((u.buttons[h.DPAD_RIGHT].pressed?1:0)+(u.buttons[h.DPAD_LEFT].pressed?-1:0),(u.buttons[h.DPAD_UP].pressed?-1:0)+(u.buttons[h.DPAD_DOWN].pressed?1:0)):c.set(0,0)},isConnected:function(){var c=this.getGamepad("left");return!(!c||!c.connected)},getID:function(){return this.getGamepad("left").id}})},{"../../lib/GamepadButton":5,"../../lib/GamepadButtonEvent":6}],14:[function(ee,be,ue){"use strict";ee("./checkpoint-controls"),ee("./gamepad-controls"),ee("./keyboard-controls"),ee("./touch-controls"),ee("./movement-controls"),ee("./trackpad-controls")},{"./checkpoint-controls":12,"./gamepad-controls":13,"./keyboard-controls":15,"./movement-controls":16,"./touch-controls":17,"./trackpad-controls":18}],15:[function(ee,be,ue){"use strict";ee("../../lib/keyboard.polyfill");var h=window.KeyboardEvent;be.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this)},this.attachEventListeners()},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){var C=this.data,m=this.getKeys();return this.dVelocity.set(0,0,0),C.enabled&&((m.KeyW||m.ArrowUp)&&(this.dVelocity.z-=1),(m.KeyA||m.ArrowLeft)&&(this.dVelocity.x-=1),(m.KeyS||m.ArrowDown)&&(this.dVelocity.z+=1),(m.KeyD||m.ArrowRight)&&(this.dVelocity.x+=1)),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.pause()},attachEventListeners:function(){window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(C){AFRAME.utils.shouldCaptureKeyEvent(C)&&(this.localKeys[C.code]=!0,this.emit(C))},onKeyUp:function(C){AFRAME.utils.shouldCaptureKeyEvent(C)&&(delete this.localKeys[C.code],this.emit(C))},onBlur:function(){for(var C in this.localKeys)this.localKeys.hasOwnProperty(C)&&delete this.localKeys[C]},emit:function(C){"__keyboard-controls-proxy"in C&&this.el.emit(C.type,C),this.el.emit(C.type+":"+C.code,new h(C.type,C)),this.data.debug&&console.log(C.type+":"+C.code)},isPressed:function(C){return C in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){var C=this.el.sceneEl.components["proxy-controls"];return C&&C.isConnected()}})},{"../../lib/keyboard.polyfill":10}],16:[function(ee,be,ue){"use strict";var h,C,m;be.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){var h=this.el;this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.navGroup=null,this.navNode=null,h.sceneEl.hasLoaded?this.injectControls():h.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(h){var C=this.el,m=this.data,s=C.sceneEl.systems.nav;C.sceneEl.hasLoaded&&this.injectControls(),s&&m.constrainToNavMesh!==h.constrainToNavMesh&&(m.constrainToNavMesh?s.addAgent(this):s.removeAgent(this))},injectControls:function(){for(var h,C=this.data,m=0;m<C.controls.length;m++)this.el.components[h=C.controls[m]+"-controls"]||this.el.setAttribute(h,"")},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:(h=new THREE.Vector3,C=new THREE.Vector3,m=new THREE.Vector3,function(s,c){if(c){var u=this.el,p=this.data;if(p.enabled){this.updateVelocityCtrl();var d=this.velocityCtrl,A=this.velocity;if(d)if(c/1e3>.2?A.set(0,0,0):this.updateVelocity(c),p.constrainToNavMesh&&!1!==d.isNavMeshConstrained){if(A.lengthSq()<1e-5)return;h.copy(u.object3D.position),C.copy(A).multiplyScalar(c/1e3).add(h);var E=u.sceneEl.systems.nav;this.navGroup=null===this.navGroup?E.getGroup(h):this.navGroup,this.navNode=this.navNode||E.getNode(h,this.navGroup),this.navNode=E.clampStep(h,C,this.navGroup,this.navNode,m),u.object3D.position.copy(m)}else u.hasAttribute("velocity")?u.setAttribute("velocity",A):(u.object3D.position.x+=A.x*c/1e3,u.object3D.position.y+=A.y*c/1e3,u.object3D.position.z+=A.z*c/1e3)}}}),updateVelocityCtrl:function(){var h=this.data;if(h.enabled){for(var C=0,m=h.controls.length;C<m;C++){var s=this.el.components[h.controls[C]+"-controls"];if(s&&s.isVelocityActive())return void(this.velocityCtrl=s)}this.velocityCtrl=null}},updateVelocity:function(){var h=new THREE.Vector2,C=new THREE.Quaternion;return function(m){var s=void 0,c=this.el,u=this.velocityCtrl,p=this.velocity,d=this.data;if(u){if(!u.getVelocityDelta){if(u.getVelocity)return void p.copy(u.getVelocity());if(u.getPositionDelta)return void p.copy(u.getPositionDelta(m).multiplyScalar(1e3/m));throw new Error("Incompatible movement controls: ",u)}s=u.getVelocityDelta(m)}if(c.hasAttribute("velocity")&&!d.constrainToNavMesh&&p.copy(this.el.getAttribute("velocity")),s&&d.enabled){C.copy(d.camera.object3D.quaternion),C.premultiply(c.object3D.quaternion),s.applyQuaternion(C);var E=s.length();d.fly?(p.copy(s),p.multiplyScalar(16.66667*this.data.speed)):(h.set(s.x,s.z),h.setLength(E*this.data.speed*16.66667),p.x=h.x,p.z=h.y)}}}()})},{}],17:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var h=this.el.sceneEl,C=h.canvas;C?(C.addEventListener("touchstart",this.onTouchStart),C.addEventListener("touchend",this.onTouchEnd)):h.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var h=this.el.sceneEl&&this.el.sceneEl.canvas;h&&(h.removeEventListener("touchstart",this.onTouchStart),h.removeEventListener("touchend",this.onTouchEnd))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},onTouchStart:function(h){this.direction=-1,this.data.reverseEnabled&&2===h.touches.length&&(this.direction=1),h.preventDefault()},onTouchEnd:function(h){this.direction=0,h.preventDefault()}})},{}],18:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var h=this.data,C=this.el.sceneEl;switch(C.addEventListener("axismove",this.onAxisMove),h.mode){case"swipe":case"touch":C.addEventListener("trackpadtouchstart",this.onTouchStart),C.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":C.addEventListener("trackpaddown",this.onTouchStart),C.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){var h=this.el.sceneEl;h.removeEventListener("axismove",this.onAxisMove),h.removeEventListener("trackpadtouchstart",this.onTouchStart),h.removeEventListener("trackpadtouchend",this.onTouchEnd),h.removeEventListener("trackpaddown",this.onTouchStart),h.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(h){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}h.preventDefault()},onTouchEnd:function(h){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,h.preventDefault()},onAxisMove:function(h){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(h);case"touch":case"press":return this.handleTouchAxis(h)}},handleSwipeAxis:function(h){var C=this.data,m=h.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=m[0],this.startingAxisData[1]=m[1]),this.startingAxisData.length>0){var s=0,c=0;C.enableNegX&&m[0]<this.startingAxisData[0]&&(s=-1),C.enablePosX&&m[0]>this.startingAxisData[0]&&(s=1),C.enablePosZ&&m[1]>this.startingAxisData[1]&&(c=-1),C.enableNegZ&&m[1]<this.startingAxisData[1]&&(c=1);var u=Math.abs(this.startingAxisData[1]-m[1]);Math.abs(this.startingAxisData[0]-m[0])>u?(this.zVel=0,this.xVel=s,this.isMoving=!0):(this.xVel=0,this.zVel=c,this.isMoving=!0)}},handleTouchAxis:function(h){var C=this.data,m=h.detail.axis,s=0,c=0;C.enableNegX&&m[0]<0&&(s=-1),C.enablePosX&&m[0]>0&&(s=1),C.enablePosZ&&m[1]>0&&(c=-1),C.enableNegZ&&m[1]<0&&(c=1),Math.abs(m[0])>Math.abs(m[1])?(this.zVel=0,this.xVel=s):(this.xVel=0,this.zVel=c)}})},{}],19:[function(ee,be,ue){"use strict";function h(m){return m.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}var C={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};be.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(C)},repetitions:{default:1/0,min:0},timeScale:{default:1}},init:function(){var m=this;this.model=null,this.mixer=null,this.activeActions=[];var s=this.el.getObject3D("mesh");s?this.load(s):this.el.addEventListener("model-loaded",function(c){m.load(c.detail.model)})},load:function(m){var s=this.el;this.model=m,this.mixer=new THREE.AnimationMixer(m),this.mixer.addEventListener("loop",function(c){s.emit("animation-loop",{action:c.action,loopDelta:c.loopDelta})}),this.mixer.addEventListener("finished",function(c){s.emit("animation-finished",{action:c.action,direction:c.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(m){if(m){var s=this.data,c=AFRAME.utils.diff(s,m);if("clip"in c)return this.stopAction(),void(s.clip&&this.playAction());this.activeActions.forEach(function(u){"duration"in c&&s.duration&&u.setDuration(s.duration),"clampWhenFinished"in c&&(u.clampWhenFinished=s.clampWhenFinished),("loop"in c||"repetitions"in c)&&u.setLoop(C[s.loop],s.repetitions),"timeScale"in c&&u.setEffectiveTimeScale(s.timeScale)})}},stopAction:function(){for(var m=this.data,s=0;s<this.activeActions.length;s++)m.crossFadeDuration?this.activeActions[s].fadeOut(m.crossFadeDuration):this.activeActions[s].stop();this.activeActions.length=0},playAction:function(){if(this.mixer){var m=this.model,s=this.data,c=m.animations||(m.geometry||{}).animations||[];if(c.length)for(var u,p=new RegExp("^"+s.clip.split(/\*+/).map(h).join(".*")+"$"),d=0;u=c[d];d++)if(u.name.match(p)){var A=this.mixer.clipAction(u,m);A.enabled=!0,A.clampWhenFinished=s.clampWhenFinished,s.duration&&A.setDuration(s.duration),1!==s.timeScale&&A.setEffectiveTimeScale(s.timeScale),A.setLoop(C[s.loop],s.repetitions).fadeIn(s.crossFadeDuration).play(),this.activeActions.push(A)}}},tick:function(m,s){this.mixer&&!isNaN(s)&&this.mixer.update(s/1e3)}})},{}],20:[function(ee,be,ue){"use strict";THREE.ColladaLoader=ee("../../lib/ColladaLoader"),be.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var h=this,C=this.el,m=this.data,s=this.el.sceneEl.systems.renderer;m&&(this.remove(),this.loader.load(m,function(c){h.model=c.scene,h.model.traverse(function(u){if(u.isMesh){var p=u.material;p.color&&s.applyColorCorrection(p.color),p.map&&s.applyColorCorrection(p.map),p.emissive&&s.applyColorCorrection(p.emissive),p.emissiveMap&&s.applyColorCorrection(p.emissiveMap)}}),C.setObject3D("mesh",h.model),C.emit("model-loaded",{format:"collada",model:h.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/ColladaLoader":3}],21:[function(ee,be,ue){"use strict";THREE.FBXLoader=ee("../../lib/FBXLoader"),be.exports=AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var h=this.data;if(h.src){this.remove();var C=new THREE.FBXLoader;h.crossorigin&&C.setCrossOrigin(h.crossorigin),C.load(h.src,this.load.bind(this))}},load:function(h){this.model=h,this.el.setObject3D("mesh",h),this.el.emit("model-loaded",{format:"fbx",model:h})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/FBXLoader":4}],22:[function(ee,be,ue){"use strict";var m,h=ee("../../lib/fetch-script")(),C=(m=void 0,function(){return m=m||h("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js")});be.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){var m=this;this.model=null,this.loader=null,this.loaderPromise=C().then(function(){m.loader=new THREE.GLTFLoader,m.loader.setCrossOrigin("Anonymous")})},update:function(){var m=this,s=this,c=this.el,u=this.data;u&&(this.remove(),this.loaderPromise.then(function(){m.loader.load(u,function(p){s.model=p.scene,s.model.animations=p.animations,c.setObject3D("mesh",s.model),c.emit("model-loaded",{format:"gltf",model:s.model})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/fetch-script":8}],23:[function(ee,be,ue){"use strict";ee("./animation-mixer"),ee("./collada-model-legacy"),ee("./fbx-model"),ee("./gltf-model-legacy"),ee("./object-model")},{"./animation-mixer":19,"./collada-model-legacy":20,"./fbx-model":21,"./gltf-model-legacy":22,"./object-model":24}],24:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var h=this,C=void 0,m=this.data;m.src&&(this.remove(),C=new THREE.ObjectLoader,m.crossorigin&&C.setCrossOrigin(m.crossorigin),C.load(m.src,function(s){s.traverse(function(c){c instanceof THREE.SkinnedMesh&&c.material&&(c.material.skinning=!!(c.geometry&&c.geometry.bones||[]).length)}),h.load(s)}))},load:function(h){this.model=h,this.el.setObject3D("mesh",h),this.el.emit("model-loaded",{format:"json",model:h})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{}],25:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){var h=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!h)throw new Error("No `checkpoint-controls` component found.");h.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},{}],26:[function(ee,be,ue){"use strict";function h(C,m,s,c){C&&(m=m||[],C.traverse(function(u){var p;u.isMesh&&(p=u.material,p?Array.isArray(p)?p:p.materials?p.materials:[p]:[]).forEach(function(p){(!p||"envMap"in p)&&(m.length&&-1===m.indexOf(p.name)||(p.envMap=s,p.reflectivity=c,p.needsUpdate=!0))})}))}be.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},format:{default:"RGBFormat",oneOf:["RGBFormat","RGBAFormat"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){var C=this,m=this.data;this.texture=(new THREE.CubeTextureLoader).load([m.path+"posx."+m.extension,m.path+"negx."+m.extension,m.path+"posy."+m.extension,m.path+"negy."+m.extension,m.path+"posz."+m.extension,m.path+"negz."+m.extension]),this.texture.format=THREE[m.format],this.object3dsetHandler=function(){var s=C.el.getObject3D("mesh"),c=C.data;h(s,c.materials,C.texture,c.reflectivity)},this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(C){var m=this.data,s=this.el.getObject3D("mesh"),c=[],u=[];if(m.materials.length&&(C.materials?(c=m.materials.filter(function(d){return!C.materials.includes(d)}),u=C.materials.filter(function(d){return!m.materials.includes(d)})):c=m.materials),c.length&&h(s,c,this.texture,m.reflectivity),u.length&&h(s,u,null,1),C.materials&&m.reflectivity!==C.reflectivity){var p=m.materials.filter(function(d){return C.materials.includes(d)});p.length&&h(s,p,this.texture,m.reflectivity)}this.data.enableBackground&&!C.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&C.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);var C=this.el.getObject3D("mesh"),m=this.data;h(C,m.materials,null,1),m.enableBackground&&this.setBackground(null)},setBackground:function(C){this.el.sceneEl.object3D.background=C}})},{}],27:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){var h=this.el;h.addEventListener("hit",this.onHit),h.addEventListener("gripdown",this.onGripClose),h.addEventListener("gripup",this.onGripOpen),h.addEventListener("trackpaddown",this.onGripClose),h.addEventListener("trackpadup",this.onGripOpen),h.addEventListener("triggerdown",this.onGripClose),h.addEventListener("triggerup",this.onGripOpen)},pause:function(){var h=this.el;h.removeEventListener("hit",this.onHit),h.removeEventListener("gripdown",this.onGripClose),h.removeEventListener("gripup",this.onGripOpen),h.removeEventListener("trackpaddown",this.onGripClose),h.removeEventListener("trackpadup",this.onGripOpen),h.removeEventListener("triggerdown",this.onGripClose),h.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){var h=this.hitEl;this.grabbing=!1,h&&(h.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(h){var C=h.detail.el;C&&!C.is(this.GRABBED_STATE)&&this.grabbing&&!this.hitEl&&(C.addState(this.GRABBED_STATE),this.hitEl=C,this.constraint=new CANNON.LockConstraint(this.el.body,C.body),this.system.addConstraint(this.constraint))}})},{}],28:[function(ee,be,ue){"use strict";ee("./checkpoint"),ee("./cube-env-map"),ee("./grab"),ee("./jump-ability"),ee("./kinematic-body"),ee("./mesh-smooth"),ee("./normal-material"),ee("./sphere-collider")},{"./checkpoint":25,"./cube-env-map":26,"./grab":27,"./jump-ability":29,"./kinematic-body":30,"./mesh-smooth":31,"./normal-material":32,"./sphere-collider":33}],29:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("jump-ability",{dependencies:["velocity"],schema:{on:{default:"keydown:Space gamepadbuttondown:0"},playerHeight:{default:1.764},maxJumps:{default:1},distance:{default:5},debug:{default:!1}},init:function(){this.velocity=0,this.numJumps=0;var h=this.beginJump.bind(this),C=this.data.on.split(" ");this.bindings={};for(var m=0;m<C.length;m++)this.bindings[C[m]]=h,this.el.addEventListener(C[m],h);this.bindings.collide=this.onCollide.bind(this),this.el.addEventListener("collide",this.bindings.collide)},remove:function(){for(var h in this.bindings)this.bindings.hasOwnProperty(h)&&(this.el.removeEventListener(h,this.bindings[h]),delete this.bindings[h]);this.el.removeEventListener("collide",this.bindings.collide),delete this.bindings.collide},beginJump:function(){if(this.numJumps<this.data.maxJumps){var C=Math.sqrt(-2*this.data.distance*-24.8),m=this.el.getAttribute("velocity");this.el.setAttribute("velocity",{x:m.x,y:C,z:m.z}),this.numJumps++,this.el.emit("jumpstart")}},onCollide:function(){this.numJumps>0&&this.el.emit("jumpend"),this.numJumps=0}})},{}],30:[function(ee,be,ue){"use strict";var h,C,m,s;be.exports=AFRAME.registerComponent("kinematic-body",{dependencies:["velocity"],schema:{mass:{default:5},radius:{default:1.3},linearDamping:{default:.05},enableSlopes:{default:!0},enableJumps:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this);var h=this.el,C=this.data,m=(new CANNON.Vec3).copy(h.object3D.getWorldPosition(new THREE.Vector3));this.body=new CANNON.Body({material:this.system.getMaterial("staticMaterial"),position:m,mass:C.mass,linearDamping:C.linearDamping,fixedRotation:!0}),this.body.addShape(new CANNON.Sphere(C.radius),new CANNON.Vec3(0,C.radius,0)),this.body.el=this.el,this.el.body=this.body,this.system.addBody(this.body),h.hasAttribute("wasd-controls")&&console.warn("[kinematic-body] Not compatible with wasd-controls, use movement-controls.")},remove:function(){this.system.removeBody(this.body),this.system.removeComponent(this),delete this.el.body},beforeStep:function(h,C){if(C){var m=this.el,c=this.body;this.data.enableJumps||c.velocity.set(0,0,0),c.position.copy(m.getAttribute("position"))}},step:(h=new THREE.Vector3,C=new THREE.Vector3,m=new THREE.Vector3,s=new THREE.Vector3,function(c,u){if(u){var p=this.body,d=this.data,A=void 0,E=-1/0,g=void 0,v=this.system.getContacts();u=Math.min(u,1e3*this.system.data.maxInterval),s.set(0,0,0),h.copy(this.el.getAttribute("velocity")),p.velocity.copy(h);for(var T,y=0;T=v[y];y++)if(T.enabled){if(p.id===T.bi.id)T.ni.negate(m);else{if(p.id!==T.bj.id)continue;m.copy(T.ni)}p.velocity.dot(m)<-1e-6&&m.y<=.5?h.projectOnPlane(m):m.y>.5&&(A=p.id===T.bi.id?Math.abs(T.rj.y+T.bj.position.y):Math.abs(T.ri.y+T.bi.position.y))>E&&(E=A,s.copy(m),g=p.id===T.bi.id?T.bj:T.bi)}C.copy(h).normalize(),g&&(!d.enableJumps||C.y<.5)?(d.enableSlopes?s.y<.999999&&s.copy(this.raycastToGround(g,s)):s.set(0,1,0),h.projectOnPlane(s)):this.system.driver.world&&h.add(this.system.driver.world.gravity.scale(4*u/1e3)),p.velocity.copy(h),this.el.setAttribute("velocity",p.velocity),this.el.setAttribute("position",p.position)}}),raycastToGround:function(h,C){var m=void 0,s=void 0,c=this.body.position,u=this.body.position.clone();return(m=new CANNON.Ray(c,u))._updateDirection(),m.intersectBody(h),m.hasHit?(s=m.result.hitNormalWorld,Math.abs(s.y)>Math.abs(C.y)?s:C):C}})},{}],31:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("mesh-smooth",{init:function(){this.el.addEventListener("model-loaded",function(h){h.detail.model.traverse(function(C){C.isMesh&&C.geometry.computeVertexNormals()})})}})},{}],32:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial)},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){var h=this;this.el.object3D.traverse(function(C){C.isMesh&&(C.material=h.material)})}})},{}],33:[function(ee,be,ue){"use strict";var h,C,m,s,c,u;be.exports=AFRAME.registerComponent("sphere-collider",{schema:{objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},remove:function(){this.pause()},play:function(){var h=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(h,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){var C,h=this.data;C=h.objects?this.el.sceneEl.querySelectorAll(h.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(C)},tick:(h=new THREE.Vector3,C=new THREE.Vector3,m=new THREE.Vector3,s=new THREE.Vector3,c=new THREE.Box3,u=new Map,function(){var p=this.el,d=this.data,A=[],E=void 0;p.getObject3D("mesh")&&(u.clear(),p.object3D.getWorldPosition(h),p.object3D.getWorldScale(m),E=d.radius*Math.max.apply(null,m.toArray()),this.els.forEach(function(g){var v=void 0,T=void 0,y=void 0,M=void 0;g.isEntity&&(T=g.getObject3D("mesh"))&&(c.setFromObject(T).getSize(s),M=Math.max(s.x,s.y,s.z)/2,v=Math.sqrt(2*M*M),c.getCenter(C),v&&(y=h.distanceTo(C))<v+E&&(A.push(g),u.set(g,y)))}),A.sort(function(g,v){return u.get(g)>u.get(v)?1:-1}).forEach(this.handleHit),0===A.length&&p.emit("hit",{el:null}),this.collisions.filter(function(g){return!u.has(g)}).forEach(this.handleHitEnd),this.collisions=A)}),handleHit:function(h){h.emit("hit"),h.addState(this.data.state),this.el.emit("hit",{el:h})},handleHitEnd:function(h){h.emit("hitend"),h.removeState(this.data.state),this.el.emit("hitend",{el:h})}})},{}],34:[function(ee,be,ue){"use strict";ee("./nav-mesh"),ee("./nav-agent"),ee("./system")},{"./nav-agent":35,"./nav-mesh":36,"./system":37}],35:[function(ee,be,ue){"use strict";var h,C,m;be.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:(h=new THREE.Vector3,C=new THREE.Vector3,m=new THREE.Vector3,function(s,c){var u=this.el,p=this.data,d=this.raycaster,A=p.speed*c/1e3;if(p.active){if(!this.path.length){var E=this.el.object3D.position;this.group=this.group||this.system.getGroup(E),this.path=this.system.getPath(E,h.copy(p.destination),this.group)||[],u.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",p.destination),this.el.setAttribute("nav-agent",{active:!1}),void u.emit("navigation-end");var g=u.object3D.position,v=this.path[0];C.subVectors(v,g);var T=void 0;if(C.length()<A){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void u.emit("navigation-end");m.copy(g),T=this.path[0]}else m.copy(C.setLength(A)).add(g),T=v;T.y=g.y,u.object3D.lookAt(T),d.ray.origin.copy(m),d.ray.origin.y+=1.5,d.ray.direction.y=-1;var y=d.intersectObject(this.system.getNavMesh());y.length?(C.subVectors(y[0].point,g),g.add(C.setLength(A))):g.copy(m)}})})},{}],36:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerComponent("nav-mesh",{init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var h=this.el.getObject3D("mesh"),C=this.el.sceneEl.object3D;if(h){var m=void 0;if(h.traverse(function(c){c.isMesh&&(m=c)}),m){var s=m.geometry.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(m.geometry):m.geometry.clone();C.updateMatrixWorld(),s.applyMatrix(m.matrixWorld),this.system.setNavMeshGeometry(s),this.hasLoadedNavMesh=!0}}}})},{}],37:[function(ee,be,ue){"use strict";var h=ee("three-pathfinding").Pathfinding,C=new h,m="level";be.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(s){this.navMesh=new THREE.Mesh(s),C.setZoneData(m,h.createZone(s)),Array.from(this.agents).forEach(function(c){return c.updateNavLocation()})},getNavMesh:function(){return this.navMesh},addAgent:function(s){this.agents.add(s)},removeAgent:function(s){this.agents.delete(s)},getPath:function(s,c,u){return this.navMesh?C.findPath(s,c,m,u):null},getGroup:function(s){return this.navMesh?C.getGroup(m,s):null},getNode:function(s,c){return this.navMesh?C.getClosestNode(s,m,c,!0):null},clampStep:function(s,c,u,p,d){return this.navMesh?p?C.clampStep(s,c,p,m,u,d):(d.copy(c),this.getNode(c,u)):(d.copy(c),null)}})},{"three-pathfinding":11}],38:[function(ee,be,ue){"use strict";be.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},{}],39:[function(ee,be,ue){"use strict";var h=ee("../../lib/hex-grid.min.js"),C=ee("../../lib/default-hex-grid");be.exports.Primitive=AFRAME.registerPrimitive("a-hexgrid",{defaultComponents:{hexgrid:{}},mappings:{src:"hexgrid.src"}}),be.exports.Component=AFRAME.registerComponent("hexgrid",{dependencies:["material"],schema:{src:{type:"asset"}},init:function(){var m=this,s=this.data;s.src?fetch(s.src).then(function(c){return c.json()}).then(function(c){return m.addMesh(c)}):this.addMesh(C)},addMesh:function(m){var s=new h.HexGrid;s.fromJSON(m);var c=new h.Board(s);c.generateTilemap(),this.el.setObject3D("mesh",c.group),this.addMaterial()},addMaterial:function(){var m=(this.el.components.material||{}).material;m&&this.el.object3D.traverse(function(s){s.isMesh&&(s.material=m)})},remove:function(){this.el.removeObject3D("mesh")}})},{"../../lib/default-hex-grid":7,"../../lib/hex-grid.min.js":9}],40:[function(ee,be,ue){"use strict";be.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),be.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){var h=this.el,C=this.data,m=h.components.material,s=new THREE.PlaneGeometry(C.width,C.depth,C.density,C.density);s.mergeVertices(),this.waves=[];for(var u=0,p=s.vertices.length;u<p;u++)this.waves.push({z:s.vertices[u].z,ang:Math.random()*Math.PI*2,amp:C.amplitude+Math.random()*C.amplitudeVariance,speed:(C.speed+Math.random()*C.speedVariance)/1e3});m||((m={}).material=new THREE.MeshPhongMaterial({color:C.color,transparent:C.opacity<1,opacity:C.opacity,shading:THREE.FlatShading})),this.mesh=new THREE.Mesh(s,m.material),h.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(h,C){if(C){for(var m,s,c=this.mesh.geometry.vertices,u=0;m=c[u];u++)m.z=(s=this.waves[u]).z+Math.sin(s.ang)*s.amp,s.ang+=s.speed*C;this.mesh.geometry.verticesNeedUpdate=!0}}})},{}],41:[function(ee,be,ue){"use strict";be.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),be.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){var C=this.data,m=this.el.components.material;if(C.path.length){var s=new THREE.CatmullRomCurve3(C.path.map(function(u){return u=u.split(" "),new THREE.Vector3(Number(u[0]),Number(u[1]),Number(u[2]))})),c=new THREE.TubeGeometry(s,C.segments,C.radius,C.radialSegments,C.closed);m||((m={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(c,m.material),this.el.setObject3D("mesh",this.mesh)}else console.error("[a-tube] `path` property expected but not found.")},update:function(h){Object.keys(h).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},{}],42:[function(ee,be,ue){"use strict";ee("./a-grid"),ee("./a-hexgrid"),ee("./a-ocean"),ee("./a-tube")},{"./a-grid":38,"./a-hexgrid":39,"./a-ocean":40,"./a-tube":41}]},{},[1]),function(ee){function be(h){if(ue[h])return ue[h].exports;var C=ue[h]={exports:{},id:h,loaded:!1};return ee[h].call(C.exports,C,C.exports,be),C.loaded=!0,C.exports}var ue={};be.m=ee,be.c=ue,be.p="",be(0)}([function(ee,be,ue){"use strict";var m=function h(c){return c&&c.__esModule?c:{default:c}}(ue(1));if(typeof AFRAME>"u")throw"mouse-cursor Component attempted to register before AFRAME was available.";var s=AFRAME.utils.device.isMobile()||window.hasNonPolyfillWebVRSupport;AFRAME.registerComponent("mouse-cursor",{schema:{},init:function(){this._raycaster=new THREE.Raycaster,this._mouse=new THREE.Vector2,this._isMobile=this.el.sceneEl.isMobile,this._isStereo=!1,this._active=!1,this._isDown=!1,this._intersectedEl=null,this._attachEventListeners(),this._canvasSize=!1,this.__getCanvasPos=this._getCanvasPos.bind(this),this.__getCanvasPos=this._getCanvasPos.bind(this),this.__onEnterVR=this._onEnterVR.bind(this),this.__onExitVR=this._onExitVR.bind(this),this.__onDown=this._onDown.bind(this),this.__onClick=this._onClick.bind(this),this.__onMouseMove=this._onMouseMove.bind(this),this.__onRelease=this._onRelease.bind(this),this.__onTouchMove=this._onTouchMove.bind(this),this.__onComponentChanged=this._onComponentChanged.bind(this)},update:function(c){},remove:function(){this._removeEventListeners(),this._raycaster=null},pause:function(){this._active=!1},play:function(){this._active=!0},_attachEventListeners:function(){var c=this.el,u=c.sceneEl,p=u.canvas;return p?(window.addEventListener("resize",this.__getCanvasPos),document.addEventListener("scroll",this.__getCanvasPos),this._getCanvasPos(),u.addEventListener("enter-vr",this.__onEnterVR),u.addEventListener("exit-vr",this.__onExitVR),p.addEventListener("mousedown",this.__onDown),p.addEventListener("mousemove",this.__onMouseMove),p.addEventListener("mouseup",this.__onRelease),p.addEventListener("mouseout",this.__onRelease),p.addEventListener("touchstart",this.__onDown),p.addEventListener("touchmove",this.__onTouchMove),p.addEventListener("touchend",this.__onRelease),p.addEventListener("click",this.__onClick),void c.addEventListener("componentchanged",this.__onComponentChanged)):void c.sceneEl.addEventListener("render-target-loaded",this._attachEventListeners.bind(this))},_removeEventListeners:function(){var c=this.el,u=c.sceneEl,p=u.canvas;p&&(window.removeEventListener("resize",this.__getCanvasPos),document.removeEventListener("scroll",this.__getCanvasPos),u.removeEventListener("enter-vr",this.__onEnterVR),u.removeEventListener("exit-vr",this.__onExitVR),p.removeEventListener("mousedown",this.__onDown),p.removeEventListener("mousemove",this.__onMouseMove),p.removeEventListener("mouseup",this.__onRelease),p.removeEventListener("mouseout",this.__onRelease),p.removeEventListener("touchstart",this.__onDown),p.removeEventListener("touchmove",this.__onTouchMove),p.removeEventListener("touchend",this.__onRelease),p.removeEventListener("click",this.__onClick),c.removeEventListener("componentchanged",this.__onComponentChanged))},_isActive:function(){return!(!this._active&&!this._raycaster)},_onDown:function(c){this._isActive()&&(this._isDown=!0,this._updateMouse(c),this._updateIntersectObject(),this._isMobile||this._setInitMousePosition(c),this._intersectedEl&&this._emit("mousedown"))},_onClick:function(c){this._isActive()&&(this._updateMouse(c),this._updateIntersectObject(),this._intersectedEl&&this._emit("click"))},_onRelease:function(){if(this._isActive()){if(this._defMousePosition){var c=Math.abs(this._initMousePosition.x-this._defMousePosition.x),u=Math.abs(this._initMousePosition.y-this._defMousePosition.y);Math.max(c,u)>.04&&(this._isDown=!1)}this._isDown&&this._intersectedEl&&this._emit("mouseup"),this._isDown=!1,this._resetMousePosition()}},_onMouseMove:function(c){this._isActive()&&(this._updateMouse(c),this._updateIntersectObject(),this._isDown&&this._setMousePosition(c))},_onTouchMove:function(c){this._isActive()&&(this._isDown=!1)},_onEnterVR:function(){s&&(this._isStereo=!0),this._getCanvasPos()},_onExitVR:function(){this._isStereo=!1,this._getCanvasPos()},_onComponentChanged:function(c){"position"===c.detail.name&&this._updateIntersectObject()},_getPosition:function(c){var u=this._canvasSize,p=u.width,g=void 0,v=void 0;if(this._isMobile){var T=c.touches;if(!T||1!==T.length)return;var y=T[0];g=y.clientX,v=y.clientY}else g=c.clientX,v=c.clientY;return g-=u.left,this._isStereo&&(g=g%(p/2)*2),{x:g/p*2-1,y:-(v-=u.top)/u.height*2+1}},_updateMouse:function(c){var u=this._getPosition(c);u&&(this._mouse.x=u.x,this._mouse.y=u.y)},_setMousePosition:function(c){this._defMousePosition=this._getPosition(c)},_setInitMousePosition:function(c){this._initMousePosition=this._getPosition(c)},_resetMousePosition:function(){this._initMousePosition=this._defMousePosition=null},_getCanvasPos:function(){this._canvasSize=this.el.sceneEl.canvas.getBoundingClientRect()},_getChildren:function(c){var u=this;return c.children.map(function(p){return"Group"===p.type?u._getChildren(p):p})},_getAllChildren:function(){var c=this._getChildren(this.el.sceneEl.object3D);return(0,m.default)(c)},_updateIntersectObject:function(){var c=this._raycaster,p=this._mouse,d=this.el.getObject3D("camera");this._getAllChildren(),c.ray.origin.setFromMatrixPosition(d.matrixWorld),c.ray.direction.set(p.x,p.y,.5).unproject(d).sub(c.ray.origin).normalize();var A=this._getAllChildren(),E=c.intersectObjects(A);if(E.length>0){var g=void 0;if(E.every(function(T){return!0!==T.object.parent.visible||(g=T.object,!1)}),!g)return void this._clearIntersectObject();var v=g.parent.el;if(this._intersectedEl===v)return;this._clearIntersectObject(),this._setIntersectObject(v)}else this._clearIntersectObject()},_setIntersectObject:function(c){this._intersectedEl=c,this._isMobile||(c.addState("hovered"),c.emit("mouseenter"),this.el.addState("hovering"))},_clearIntersectObject:function(){var c=this._intersectedEl;c&&!this._isMobile&&(c.removeState("hovered"),c.emit("mouseleave"),this.el.removeState("hovering")),this._intersectedEl=null},_emit:function(c){var u=this._intersectedEl;this.el.emit(c,{target:u}),u&&u.emit(c)}})},function(ee,be){(function(ue){function h(me,P){for(var X=-1,W=P.length,te=me.length;++X<W;)me[te+X]=P[X];return me}function C(me,P,X,W,te){var ce=-1,Se=me.length;for(X||(X=m),te||(te=[]);++ce<Se;){var _e=me[ce];P>0&&X(_e)?P>1?C(_e,P-1,X,W,te):h(te,_e):W||(te[te.length]=_e)}return te}function m(me){return he(me)||function c(me){return function p(me){return function g(me){return!!me&&"object"==typeof me}(me)&&function u(me){return null!=me&&function A(me){return"number"==typeof me&&me>-1&&me%1==0&&me<=T}(me.length)&&!function d(me){var P=function E(me){var P=typeof me;return!!me&&("object"==P||"function"==P)}(me)?V.call(me):"";return P==M||P==_}(me)}(me)}(me)&&q.call(me,"callee")&&(!ae.call(me,"callee")||V.call(me)==y)}(me)||!!(fe&&me&&me[fe])}var T=9007199254740991,y="[object Arguments]",M="[object Function]",_="[object GeneratorFunction]",D="object"==typeof self&&self&&self.Object===Object&&self,B="object"==typeof ue&&ue&&ue.Object===Object&&ue||D||Function("return this")(),H=Object.prototype,q=H.hasOwnProperty,V=H.toString,ne=B.Symbol,ae=H.propertyIsEnumerable,fe=ne?ne.isConcatSpreadable:void 0,he=Array.isArray;ee.exports=function s(me){return me&&me.length?C(me,Infinity):[]}}).call(be,function(){return this}())}]),AFRAME.registerComponent("rotation-listener",{tick(){const ee=this.el.getAttribute("rotation"),be=AFRAME.utils.coordinates.stringify(ee);this.lastValue!==be&&(this.el.emit("rotationChanged",ee),this.lastValue=be)}}),AFRAME.registerComponent("position-listener",{tick(){const ee=this.el.getAttribute("position"),be=AFRAME.utils.coordinates.stringify(ee);this.lastValue!==be&&(this.el.emit("positionChanged",ee),this.lastValue=be)}}),this.JSON||(this.JSON={}),function(){function f(ee){return ee<10?"0"+ee:ee}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(ee){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(ee){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(ee){return escapable.lastIndex=0,escapable.test(ee)?'"'+ee.replace(escapable,function(be){var ue=meta[be];return"string"==typeof ue?ue:"\\u"+("0000"+be.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+ee+'"'}function str(ee,be){var ue,h,C,m,c,s=gap,u=be[ee];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(ee)),"function"==typeof rep&&(u=rep.call(be,ee,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,c=[],"[object Array]"===Object.prototype.toString.apply(u)){for(m=u.length,ue=0;ue<m;ue+=1)c[ue]=str(ue,u)||"null";return C=0===c.length?"[]":gap?"[\n"+gap+c.join(",\n"+gap)+"\n"+s+"]":"["+c.join(",")+"]",gap=s,C}if(rep&&"object"==typeof rep)for(m=rep.length,ue=0;ue<m;ue+=1)"string"==typeof(h=rep[ue])&&(C=str(h,u))&&c.push(quote(h)+(gap?": ":":")+C);else for(h in u)Object.hasOwnProperty.call(u,h)&&(C=str(h,u))&&c.push(quote(h)+(gap?": ":":")+C);return C=0===c.length?"{}":gap?"{\n"+gap+c.join(",\n"+gap)+"\n"+s+"}":"{"+c.join(",")+"}",gap=s,C}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(ee,be,ue){var h;if(gap="",indent="","number"==typeof ue)for(h=0;h<ue;h+=1)indent+=" ";else"string"==typeof ue&&(indent=ue);if(rep=be,be&&"function"!=typeof be&&("object"!=typeof be||"number"!=typeof be.length))throw new Error("JSON.stringify");return str("",{"":ee})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(ee,be){var ue,h,C=ee[be];if(C&&"object"==typeof C)for(ue in C)Object.hasOwnProperty.call(C,ue)&&(void 0!==(h=walk(C,ue))?C[ue]=h:delete C[ue]);return reviver.call(ee,be,C)}if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(ee){return"\\u"+("0000"+ee.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),window.DM||(DM={_apiKey:null,_session:null,_userStatus:"unknown",_refreshRequested:!1,_refreshCallbacks:[],_sessionLoadingMethod:null,_logging:!0,_domain:{api:"https://api.dailymotion.com",www:"//www.dailymotion.com",cdn:"//api.dmcdn.net"},_oauth:{logoutUrl:"https://www.dailymotion.com/oauth/logout",authorizeUrl:"https://www.dailymotion.com/oauth/authorize",tokenUrl:"https://graphql.api.dailymotion.com/oauth/token"},copy:function(ee,be,ue,h){for(var C in be)(ue||typeof ee[C]>"u")&&(ee[C]=h?h(be[C]):be[C]);return ee},create:function(ee,be){for(var ue=window.DM,h=ee?ee.split("."):[],C=h.length,m=0;m<C;m++){var s=h[m],c=ue[s];c||(ue[s]=c=be&&m+1==C?be:{}),ue=c}return ue},provide:function(ee,be,ue){return DM.copy("string"==typeof ee?DM.create(ee):ee,be,ue)},guid:function(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")},log:function(ee){DM._logging&&(window.Debug&&window.Debug.writeln?window.Debug.writeln(ee):window.console&&window.console.log(ee)),DM.Event&&DM.Event.fire("dm.log",ee)},error:function(ee){window.console&&window.console.error(ee),DM.Event&&DM.Event.fire("dm.error",ee)},warn:function(ee){try{console&&"function"==typeof console.warn&&console.warn(ee)}catch{}},$:function(ee){return"string"==typeof ee&&(ee=document.getElementById(ee)),ee},parseBool:function(ee){return!0===ee||!1===ee?ee:0!==ee&&("string"==typeof ee?!ee.match(/^(?:|false|no|off|0)$/i):!!ee)},type:function(ee){if(!DM._class2type){DM._class2type={};for(var be="Boolean Number String Function Array Date RegExp Object".split(" "),ue=0,h=be.length;ue<h;ue++){var C=be[ue];DM._class2type["[object "+C+"]"]=C.toLowerCase()}DM._class2type["[object Undefined]"]="undefined"}return null===ee?String(ee):DM._class2type[Object.prototype.toString.call(ee)]||"object"}}),DM.provide("JSON",{stringify:function(ee){return window.Prototype&&Object.toJSON?Object.toJSON(ee):JSON.stringify(ee)},parse:function(ee){return JSON.parse(ee)},flatten:function(ee){var be={};for(var ue in ee)if(ee.hasOwnProperty(ue)){var h=ee[ue];if(null==h)continue;be[ue]="string"==typeof h?h:DM.JSON.stringify(h)}return be}}),DM.provide("Array",{indexOf:function(ee,be){if(ee.indexOf)return ee.indexOf(be);var ue=ee.length;if(ue)for(var h=0;h<ue;h++)if(ee[h]===be)return h;return-1},merge:function(ee,be){for(var ue=0;ue<be.length;ue++)DM.Array.indexOf(ee,be[ue])<0&&ee.push(be[ue]);return ee},flatten:function(ee){for(var be in ee)ee.hasOwnProperty(be)&&"array"==DM.type(ee[be])&&(ee[be]=ee[be].join(","));return ee},filter:function(ee,be){for(var ue=[],h=0;h<ee.length;h++)be(ee[h])&&ue.push(ee[h]);return ue},keys:function(ee,be){var ue=[];for(var h in ee)(be||ee.hasOwnProperty(h))&&ue.push(h);return ue},map:function(ee,be){for(var ue=[],h=0;h<ee.length;h++)ue.push(be(ee[h]));return ue},forEach:function(ee,be,ue){if(ee)if("[object Array]"!==Object.prototype.toString.apply(ee)&&(ee instanceof Function||"number"!=typeof ee.length))for(var m in ee)(ue||ee.hasOwnProperty(m))&&be(ee[m],m,ee);else if(ee.forEach)ee.forEach(be);else for(var h=0,C=ee.length;h<C;h++)be(ee[h],h,ee)}}),DM.provide("Cookie",{_domain:null,_enabled:!1,setEnabled:function(ee){DM.Cookie._enabled=ee},getEnabled:function(){return DM.Cookie._enabled},getKeyValuePair:function(ee){var C,m,be=ee.indexOf("="),ue=ee.substr(0,be=be<0?ee.length:be),h=ee.substr(be+1);try{C=decodeURIComponent(ue)}catch{console.error("Could not decode cookie key: "+ue)}try{m=decodeURIComponent(h)}catch{console.error("Could not decode cookie value: "+h)}return{key:C,value:m}},getCookieValue:function(ee){for(var be=ee+"=",ue=document.cookie.split(";"),h=0;h<ue.length;h++){for(var C=ue[h];" "==C.charAt(0);)C=C.substring(1,C.length);if(0==C.indexOf(be))return C.substring(be.length,C.length)}return null},load:function(){var be,ue,ee=document.cookie.split("; ");return DM.Array.forEach(ee,function(h){var C=DM.Cookie.getKeyValuePair(h);C.key.match("dms_"+DM._apiKey)&&(C.value=C.value.replace(/^"(.+(?="$))"$/,"$1"),be=C)}),be&&((ue=DM.QS.decode(be.value)).expires=parseInt(ue.expires,10),DM.Cookie._domain=ue.base_domain),ue},setRaw:function(ee,be,ue){var h=(ee+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent);document.cookie="dms_"+DM._apiKey+'="'+h+'"'+(h&&0==be?"":"; expires="+new Date(1e3*be).toGMTString())+"; path=/"+(ue&&"localhost"!==ue?"; domain=."+ue:""),DM.Cookie._domain=ue},setNeonCookies:function(ee,be,ue){if(!(typeof ue>"u")){var h=new Date;h.setSeconds(h.getSeconds()+ue);var C=new Date(h.getTime()),m=C.setSeconds(C.getSeconds()+7776e3);ee&&(document.cookie="access_token="+ee+"; expires="+new Date(h).toUTCString()+"; path=/"),be&&(document.cookie="refresh_token="+be+"; expires="+new Date(m).toUTCString()+"; path=/")}},set:function(ee){ee?DM.Cookie.setRaw(DM.QS.encode(ee),ee.expires,ee.base_domain):DM.Cookie.clear()},clear:function(){DM.Cookie.setRaw("",0,DM.Cookie._domain)}}),DM.provide("EventProvider",{subscribers:function(){return this._subscribersMap||(this._subscribersMap={}),this._subscribersMap},subscribe:function(ee,be){var ue=this.subscribers();ue[ee]?ue[ee].push(be):ue[ee]=[be]},unsubscribe:function(ee,be){var ue=this.subscribers()[ee];DM.Array.forEach(ue,function(h,C){h==be&&(ue[C]=null)})},monitor:function(ee,be){if(!be()){var ue=this,h=function(){be.apply(be,arguments)&&ue.unsubscribe(ee,h)};this.subscribe(ee,h)}},clear:function(ee){delete this.subscribers()[ee]},fire:function(){var ee=Array.prototype.slice.call(arguments),be=ee.shift();DM.Array.forEach(this.subscribers()[be],function(ue){ue&&ue.apply(this,ee)})}}),DM.provide("Event",DM.EventProvider),DM.provide("",{init:function(ee){if(ee=DM.copy(ee||{},{logging:!0}),DM._apiKey=ee.apiKey,!ee.logging&&window.location.toString().indexOf("dm_debug=1")<0&&(DM._logging=!1),DM._apiKey){DM._apiSecret=ee.apiSecret||null,DM.Cookie.setEnabled(ee.cookie),DM.Auth.readFragment();var be,ue=DM.Auth.loadSiteSession();null!==ue.session?(be=ue.session,DM._sessionLoadingMethod=ue.loading_method):ee.session?(be=ee.session,DM._sessionLoadingMethod="init_options"):DM.Auth._receivedSession?(be=DM.Auth._receivedSession,DM._sessionLoadingMethod="fragment"):(be=DM.Cookie.load(),DM._sessionLoadingMethod="local_cookies"),null!==be&&DM.Auth.isSessionExpired(be)?DM.Auth.refreshToken(be,function(){ee.status&&DM.getLoginStatus()}):DM.Auth.setSession(be,be?"connected":"unknown"),ee.status&&DM.getLoginStatus()}}}),window.setTimeout(function(){window.dmAsyncInit&&dmAsyncInit()},0),DM.provide("QS",{encode:function(ee,be,ue){be=void 0===be?"&":be,ue=!1===ue?function(C){return C}:encodeURIComponent;var h=[];return DM.Array.forEach(ee,function(C,m){null!==C&&typeof C<"u"&&h.push(ue(m)+"="+ue(C))}),h.sort(),h.join(be)},decode:function(ee){for(var be=ee.split("&"),ue=decodeURIComponent,h={},C=0;C<be.length;C+=1){var m=be[C].indexOf("=");if(!(m<1))for(var s=ue(be[C].substring(0,m)).replace(/\]/g,"").split("["),c=ue(be[C].substring(m+1)),u=h;s.length>0;){var p=s.shift();0===s.length?0===p.length?u.push(c):u[p]=c:typeof u[p]>"u"&&(u[p]=0===s[0].length?[]:{}),u=u[p]}}return h}}),DM.provide("",{api:function(){DM.ApiServer.call.apply(DM.ApiServer,arguments)}}),DM.provide("ApiServer",{type:null,METHODS:["get","post","delete"],_callbacks:{},_calls:[],call:function(){for(var h,C,m,ee=Array.prototype.slice.call(arguments),be=ee.shift(),ue=ee.shift(),s=!1;typeof ue<"u";){var c=typeof ue;if("string"!==c||h)if("function"!==c||m)if("object"!==c||C){if("boolean"!==c||s)return void DM.log("Invalid argument passed to DM.api(): "+ue);s=ue}else C=DM.ApiServer.formatCallParams(ue);else m=ue;else h=ue.toLowerCase();ue=ee.shift()}h=h||"get",C=C||{},"/"===be[0]&&(be=be.substr(1)),DM.Array.indexOf(DM.ApiServer.METHODS,h)<0?DM.log("Invalid method passed to DM.api(): "+h):DM.ApiServer.transport(be,h,C,m,s)},formatCallParams:function(ee){var be=ee.subrequests,ue=[],h="";if(be){var C=DM.type(be);if("object"!=C)throw new Error('Unexpected type "'+C+'" for "subrequests" parameter. Expected type: object');for(fieldName in be){var m=be[fieldName],s=[];for(subRequestParam in s.push(fieldName+".fields("+(m.fields||[]).join(",")+")"),delete m.fields,m)s.push(subRequestParam+"("+m[subRequestParam]+")");s.length&&ue.push(s.join("."))}delete ee.subrequests}if(ue.length&&(h=ue.join(",")),ee.fields){var c=DM.type(ee.fields);if("array"==c)ee.fields.push(h),ee.fields=ee.fields.join(",");else{if("string"!=c)throw new Error('Unexpected type "'+c+'"  for "fields" parameter, Allowed types: array, string');ee.fields.length?ee.fields+=","+h:ee.fields=h}}else h&&(ee.fields=h);return ee},getSimpleCallURL:function(ee,be){var ue=DM.QS.encode(be),h=ue.length?(ee.indexOf("?")>-1?"&":"?")+ue:"";return DM._domain.api+"/"+ee+h},transport:function(ee,be,ue,h,C){try{DM.ApiServer.xhr(),DM.ApiServer.transport=DM.ApiServer.ajax,DM.ApiServer.type="ajax"}catch{DM.ApiServer.transport=DM.ApiServer.jsonp,DM.ApiServer.type="jsonp"}DM.ApiServer.transport(ee,be,ue,h,C)},jsonp:function(ee,be,ue,h){var s,C=DM.guid(),m=document.createElement("script");ue.method=be,ue.callback="DM.ApiServer._callbacks."+C;var u=DM.getSession();u&&u.access_token&&!ue.access_token&&(ue.access_token=u.access_token),ue=DM.Array.flatten(ue);var p=DM.ApiServer.getSimpleCallURL(ee,ue);if(p.length>2e3)throw new Error("JSONP only support a maximum of 2000 bytes of input.");DM.ApiServer._callbacks[C]=function(d){h&&h(d),delete DM.ApiServer._callbacks[C],m.src=null,m.parentNode.removeChild(m),s&&(clearTimeout(s),s=null)},m.async=!0,m.src=p,document.getElementsByTagName("head")[0].appendChild(m),s=setTimeout(function(){DM.ApiServer._callbacks[C]({error:{code:500,message:"The request has timed out",type:"transport_error"}})},5e3)},ajax:function(ee,be,ue,h,C){var m={path:ee,method:be,params:ue,cb:h};C?DM.ApiServer.performSimpleCall(ee,be,ue,h):(DM.ApiServer._calls.push(m),DM.ApiServer.ajaxHandleQueue())},ajaxHandleQueue:function(){!DM.ApiServer._callTimeout&&DM.ApiServer._calls.length>0?DM.ApiServer._callTimeout=setTimeout(function(){DM.ApiServer.performMultipleCalls(DM.ApiServer._calls),DM.ApiServer._calls=[],delete DM.ApiServer._callTimeout},0):10==DM.ApiServer._calls.length&&(DM.ApiServer._callTimeout&&(clearTimeout(DM.ApiServer._callTimeout),delete DM.ApiServer._callTimeout),DM.ApiServer.performMultipleCalls(DM.ApiServer._calls),DM.ApiServer._calls=[])},performSimpleCall:function(ee,be,ue,h){if(DM._session&&DM.Auth.isSessionExpired())DM.Auth.refreshToken(DM._session,function(c){c.error?h&&h(c):DM.ApiServer.performSimpleCall(ee,be,ue,h)});else{var C=DM.getSession();C&&C.access_token&&!ue.access_token&&(ue.access_token=C.access_token),ue=DM.Array.flatten(ue);var m=DM.ApiServer.getSimpleCallURL(ee,ue),s=DM.ApiServer.xhr();s.open(be,m),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(),s.onreadystatechange=function(){if(4==s.readyState){var u;if(s.status)try{u=DM.JSON.parse(s.responseText)}catch{}"object"!=DM.type(u)&&(u={error:{code:500,message:"Invalid server response",type:"transport_error"}},DM.error("Cannot parse call response data "+s.responseText)),h&&h(u)}}}},performMultipleCalls:function(ee){for(var be=[],ue=DM._domain.api,h=0,C=ee.length;h<C;h++){var m=ee[h];be.push({call:m.method.toUpperCase()+" /"+m.path,args:m.params,id:h})}if(DM._session&&DM.Auth.isSessionExpired())DM.Auth.refreshToken(DM._session,function(u){u.error?DM.Array.forEach(ee,function(p){p&&p.cb&&p.cb(u)}):DM.ApiServer.performMultipleCalls(ee)});else{var s=DM.getSession();s&&s.access_token&&(ue+="?access_token="+encodeURIComponent(s.access_token));var c=DM.ApiServer.xhr();c.open("POST",ue),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(DM.JSON.stringify(be)),c.onreadystatechange=function(){if(4==c.readyState){var p,u={error:{code:500,message:"Invalid server response",type:"transport_error"}};if(c.status)try{p=DM.JSON.parse(c.responseText)}catch{}var d=DM.type(p);if("array"==d)for(var A=0,E=p.length;A<E;A++){var g=p[A];(m="id"in g&&ee[g.id]?ee[g.id]:null)?(m.cb&&m.cb("result"in g?g.result:"error"in g?{error:g.error}:{error:{code:500,message:"Missing result or error key",type:"transport_error"}}),ee[g.id]=null):DM.error("Response with no valid call id: "+DM.JSON.stringify(g))}else"object"==d&&"error"in p?u=p:DM.error("Cannot parse multicall response data "+c.responseText);DM.Array.forEach(ee,function(v){v&&v.cb&&v.cb(u)})}}}},xhr:function(){var ee=new window.XMLHttpRequest;if(!("withCredentials"in ee))throw new Error("Browser is not CORS capable");return ee}}),DM.provide("",{getLoginStatus:function(ee){ee&&DM.Auth.refreshToken(DM._session,function(be){ee({status:DM._userStatus,session:be})})},getSession:function(){return DM.Auth.isSessionExpired()&&DM.Auth.setSession(null,"notConnected"),DM._session},login:function(ee,be){var ue=typeof window.screenX<"u"?window.screenX:window.screenLeft,h=typeof window.screenY<"u"?window.screenY:window.screenTop,C=typeof window.outerWidth<"u"?window.outerWidth:document.documentElement.clientWidth,m=typeof window.outerHeight<"u"?window.outerHeight:document.documentElement.clientHeight-22,d="width=500,height=520,left="+parseInt(ue+(C-500)/2,10)+",top="+parseInt(h+(m-520)/2.5,10)+",status,scrollbars=yes";if("popup"===(be=DM.copy(be||{},{client_id:DM._apiKey,response_type:"token",display:"popup",scope:"",redirect_uri:document.location.href,state:"dmauth_"+DM.guid()})).display){var A=window.open(DM._oauth.authorizeUrl+"?"+DM.QS.encode(be),"dmauth",d);DM.Auth._active[be.state]={cb:ee||function(){},win:A},DM.Auth._popupMonitor()}else location.href=DM._oauth.authorizeUrl+"?"+DM.QS.encode(be)},logout:function(ee){var m,be=DM._oauth.logoutUrl,ue=DM.getSession(),h=[],C="dm_l_o_sc";ue&&ue.access_token&&(h.push("access_token="+encodeURIComponent(ue.access_token)),m="_"+ue.access_token+"_logout",window[m]=function(c){"array"!=DM.type(c)||c.length?ee(c):(ee({}),DM.Auth.setSession(null,"notConnected")),window[m]=null},h.push("callback="+m));var s=document.getElementById(C);s&&s.parentNode.removeChild(s),(s=document.createElement("script")).type="text/javascript",s.id=C,document.body.appendChild(s),s.src=be+(h.length?"?"+h.join("&"):"")}}),DM.provide("Auth",{_active:{},_receivedSession:null,loadSiteSession:function(){var ee=!0,be={},ue={session:null,loading_method:null};if(window.location.host.match(/dailymotion\.com$/)){var h=DM.Cookie.getCookieValue("sid"),C=DM.Cookie.getCookieValue("access_token"),m=DM.Cookie.getCookieValue("refresh_token");m&&(be.refresh_token=m,ee=!1);var s="neon_cookie";C&&(be.access_token=C,ee=!1),!m&&!C&&h&&(be.access_token=h,s="sid_cookie",ee=!1),m&&!be.access_token&&(be.expires=Math.round((new Date).getTime()/1e3)-10)}return ee||(ue.session=be,ue.loading_method=s),ue},refreshToken:function(ee,be){if(be=be||function(){},DM._refreshCallbacks.push(be),!DM._refreshRequested){DM._refreshRequested=!0;var ue=function(s){for(;DM._refreshCallbacks.length>0;)DM._refreshCallbacks.pop()(s);DM._refreshRequested=!1};if(!DM.Auth.isSessionExpired(ee))return void ue(ee);if(DM._apiKey&&DM._apiSecret&&ee&&ee.refresh_token){var h=DM.ApiServer.xhr(),C={grant_type:"refresh_token",client_id:DM._apiKey,client_secret:DM._apiSecret,refresh_token:ee.refresh_token},m=DM.QS.encode(C);h.open("POST",DM._oauth.tokenUrl),h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h.send(m),h.onreadystatechange=function(){if(4==h.readyState){var c,s={error:{code:500,message:"Invalid server response",type:"transport_error"}};if(h.status)try{c=DM.JSON.parse(h.responseText)}catch{}"object"!=DM.type(c)&&(c=s,DM.error("Cannot parse call response data "+h.responseText)),h.status&&200!==h.status&&(c=s);var u=c.access_token?c:null;DM.Auth.setSession(u,u?"connected":"notConnected"),ue(c)}}}else ue(ee)}},readFragment:function(){var ee=window.location.hash.replace("%23","#"),be=ee.substr(ee.lastIndexOf("#")+1);if(be.indexOf("access_token=")>=0||be.indexOf("error=")>=0){var ue=DM.QS.decode(be);window.opener&&window.opener.DM.Auth.setSession&&"dmauth"==window.name&&"dmauth"!=window.opener.name?(document.documentElement.style.display="none",window.opener.DM.Auth.recvSession(ue)):ue&&"state"in ue&&0==ue.state.indexOf("dmauth_")&&("access_token"in ue&&(DM.Auth._receivedSession=ue),window.location.hash=ee.substr(0,ee.lastIndexOf("#")))}},recvSession:function(ee){if(ee||DM.error("Received invalid session"),"error"in ee&&DM.error("Received auth error `"+ee.error+"': "+ee.error_description),"state"in ee)if(ee.state in DM.Auth._active){var be;if(ee)for(k in be={},ee)be[k]=ee[k];else be=ee;DM.Auth._active[ee.state].session=be}else DM.error("Received a session from an inactive window");else DM.error("Received a session with not `state' field")},setSession:function(ee,be){var ue=!DM._session&&ee,h=DM._session&&!ee,m=ue||h||DM._session&&ee&&DM._session.access_token!=ee.access_token,s=be!=DM._userStatus;if(ee&&"expires_in"in ee){ee.expires=Math.round((new Date).getTime()/1e3)+parseInt(ee.expires_in,10);var c=parseInt(ee.expires_in,10);delete ee.expires_in}var u={session:ee,status:be};return DM._session=ee,DM._userStatus=be,m&&DM.Cookie&&DM.Cookie.getEnabled()&&DM.Cookie.set(ee),"neon_cookie"===DM._sessionLoadingMethod&&DM.Cookie.setNeonCookies(ee.access_token,ee.refresh_token,c),s&&DM.Event.fire("auth.statusChange",u),!!h&&DM.Event.fire("auth.logout",u),!!ue&&DM.Event.fire("auth.login",u),m&&DM.Event.fire("auth.sessionChange",u),u},isSessionExpired:function(ee,be){return typeof ee>"u"&&(ee=DM._session),typeof be>"u"&&(be=DM._sessionLoadingMethod),!ee||("neon_cookie"===be?!DM.Cookie.getCookieValue("access_token"):ee&&"expires"in ee&&(new Date).getTime()>1e3*ee.expires)},_popupMonitor:function(){for(var ee in DM.Auth._active){if("win"in DM.Auth._active[ee])try{DM.Auth._active[ee].win.closed&&(delete DM.Auth._active[ee].win,DM.Auth.recvSession({error:"access_denied",error_description:"Client closed the window",state:ee}))}catch{}if("session"in DM.Auth._active[ee]){var be=DM.Auth._active[ee];delete DM.Auth._active[ee];var ue=be.session;"access_token"in ue?DM.Auth.setSession(ue,"connected"):DM.Auth.setSession(null,"notConnected"),"win"in be&&be.win.close(),"cb"in be&&be.cb({status:DM._userStatus,session:DM._session})}}var h=!1;for(var ee in DM.Auth._active){h=!0;break}h&&!DM.Auth._popupInterval?DM.Auth._popupInterval=window.setInterval(DM.Auth._popupMonitor,100):!h&&DM.Auth._popupInterval&&(window.clearInterval(DM.Auth._popupInterval),DM.Auth._popupInterval=null)}}),DM.provide("",{player:function(ee,be){if(!(ee=DM.$(ee))||ee.nodeType!==Node.ELEMENT_NODE)throw new Error("Invalid first argument sent to DM.player(), requires a HTML element or element id: "+ee);if(!be||"object"!=typeof be)throw new Error("Missing 'options' parameter for DM.player()");return void 0!==DM.Player._INSTANCES[ee.id]&&(ee=DM.Player.destroy(ee.id)),DM.Player.create(ee,be)},destroy:function(ee){if(ee){if(void 0===DM.Player._INSTANCES[ee])return void DM.warn("Invalid first argument sent to DM.destroy(), requires a player id: "+ee);DM.Player.destroy(ee)}else{if(0===DM.Array.keys(DM.Player._INSTANCES).length)return void DM.warn("DM.destroy(): no player to destroy");for(var be in DM.Player._INSTANCES)DM.Player.destroy(be)}}}),DM.provide("Player",{_IFRAME_ORIGIN:null,_INSTANCES:{},_EVENTS:{},_ANCHORS:{},_INTERVAL_ID:null,API_MODE:null,EVENT_HANDLERS:{},_environmentInfo:null,apiReady:!1,autoplay:!1,currentTime:0,bufferedTime:0,duration:NaN,seeking:!1,error:null,ended:!1,muted:!1,volume:1,paused:!0,fullscreen:!1,controls:void 0,rebuffering:!1,qualities:[],quality:void 0,subtitles:[],subtitle:void 0,video:null,companionAds:null,play:function(){this.api("play")},togglePlay:function(){this.api("toggle-play")},pause:function(){this.api("pause")},seek:function(ee){this.api("seek",ee)},load:function(ee,be){this.api("load",ee,be)},setMuted:function(ee){this.api("muted",ee)},toggleMuted:function(){this.api("toggle-muted")},setVolume:function(ee){this.api("volume",ee)},setQuality:function(ee){this.api("quality",ee)},setSubtitle:function(ee){this.api("subtitle",ee)},setFullscreen:function(ee){this.api("fullscreen",ee)},setControls:function(ee){this.api("controls",ee)},toggleControls:function(){this.api("toggle-controls")},setProp:function(){this.api.apply(this,["set-prop"].concat([].slice.call(arguments)))},setAdsConfig:function(ee){this.api("set-ads-config",ee)},watchOnSite:function(ee){this.api("watch-on-site")},api:function(ee){var be=2<=arguments.length?[].slice.call(arguments,1):[];this._send(ee,be)},create:function(ee,be){if(be=DM.copy(be,{width:480,height:270,title:"video player",referrerPolicy:null,params:{},events:{}}),location.search.length>1&&-1!==location.search.indexOf("dm:params")){var ue=DM.QS.decode(location.search.substr(1));"dm:params"in ue&&(be.params=DM.copy(DM.QS.decode(ue["dm:params"]),be.params))}DM._domain.www=DM._domain.www.replace(/^https?\:/,"");var h=document.createElement("iframe");if(DM.Array.forEach(["id","style","class"],function(m){var s=ee.getAttribute(m);s&&h.setAttribute(m,s)}),h.setAttribute("frameborder","0"),h.setAttribute("allowfullscreen","true"),h.setAttribute("allow","autoplay"),"string"==typeof be.referrerPolicy&&(h.referrerPolicy=be.referrerPolicy),h.title="Dailymotion "+be.title,h.type="text/html",h.width=be.width,h.height=be.height,ee.parentNode.replaceChild(h,ee),DM.copy(h,DM.Player),h.init(be.video,be.params,be.playlist,be.events,ee),"object"==typeof be.events)for(var C in be.events)h.addEventListener(C,be.events[C],!1);return h},destroy:function(ee){var be=DM.Player._INSTANCES[ee],ue=DM.Player._ANCHORS[ee];return DM.Array.forEach(DM.Player._EVENTS[ee],function(h){var C=DM.Array.keys(h)[0];be.removeEventListener(C,h[C],!1)}),be.parentNode.replaceChild(ue,be),delete DM.Player._INSTANCES[ee],delete DM.Player._ANCHORS[ee],delete DM.Player._EVENTS[ee],ue},_getPathname:function(ee,be){return be&&!ee?"/embed/playlist/"+be:ee?"/embed/video/"+ee:"/embed"},init:function(ee,be,ue,h,C){DM.Player._installHandlers(),(be="object"==typeof be?be:{}).api=DM.Player.API_MODE,be.origin=location.origin?location.origin:"*",DM._apiKey&&(be.apiKey=DM._apiKey),ee&&ue&&(be.playlist=ue),this.id=be.id=this.id?this.id:DM.guid(),this.src="https:"+DM._domain.www+this._getPathname(ee,ue)+"?"+DM.QS.encode(be),DM.Player._INSTANCES[this.id]!=this&&(DM.Player._INSTANCES[this.id]=this,DM.Player._EVENTS[this.id]=h,DM.Player._ANCHORS[this.id]=C,this.addEventListener("unload",function(){delete DM.Player._INSTANCES[this.id],delete DM.Player._ANCHORS[this.id],delete DM.Player._EVENTS[this.id]})),this.autoplay=DM.parseBool(be.autoplay)},_installHandlers:function(){if(null===DM.Player.API_MODE&&window.postMessage){DM.Player.API_MODE="postMessage";var ee=function(be){var ue=be.origin?be.origin.replace(/^https?:/,""):null;if(ue&&0===ue.indexOf(DM._domain.www)&&be.data&&"string"==typeof be.data){DM.Player._IFRAME_ORIGIN||(DM.Player._IFRAME_ORIGIN=be.origin);var h=DM.Player._decodePostMessage(be.data);if(h.id&&h.event){var C=DM.$(h.id);!C||"function"!=typeof C._recvEvent||C._recvEvent(h)}}};window.addEventListener?window.addEventListener("message",ee,!1):window.attachEvent&&window.attachEvent("onmessage",ee)}},_decodePostMessage:function(ee){if("{"===ee.substring(0,1))try{return JSON.parse(ee)}catch{return{}}return DM.QS.decode(ee)},_send:function(ee,be){if(this.apiReady){if("postMessage"==DM.Player.API_MODE){if(!this.contentWindow||"function"!=typeof this.contentWindow.postMessage)return void DM.warn("Player not reachable anymore. You may have destroyed it.");this.contentWindow.postMessage(JSON.stringify({command:ee,parameters:be||[]}),DM.Player._IFRAME_ORIGIN)}}else DM.warn('Player not ready. Ignoring command : "'+ee+'"')},_dispatch:document.createEvent?function(ee){const be=ee.event,ue=document.createEvent("HTMLEvents");"ad_log"===ee.event&&ee.args&&(ue.data=ee.args),ue.initEvent(be,!0,!0),this.dispatchEvent(ue)}:function(ee){const be=ee.event;if("on"+be in this)ue=document.createEventObject(),this.fireEvent("on"+be,ue);else if(be in this.EVENT_HANDLERS){var ue={type:be,target:this};DM.Array.forEach(this.EVENT_HANDLERS[be],function(h){h(ue)})}},_recvEvent:function(ee){switch(ee.event){case"apiready":if(this.apiReady)return;this.apiReady=!0,this._environmentInfo=ee.info||null;break;case"start":this.ended=!1;break;case"loadedmetadata":this.error=null;break;case"timeupdate":case"ad_timeupdate":this.currentTime=parseFloat(ee.time);break;case"progress":this.bufferedTime=parseFloat(ee.time);break;case"durationchange":this.duration=parseFloat(ee.duration);break;case"seeking":this.seeking=!0,this.currentTime=parseFloat(ee.time);break;case"seeked":this.seeking=!1,this.currentTime=parseFloat(ee.time);break;case"fullscreenchange":this.fullscreen=DM.parseBool(ee.fullscreen);break;case"controlschange":this.controls=DM.parseBool(ee.controls);break;case"volumechange":this.volume=parseFloat(ee.volume),this.muted=DM.parseBool(ee.muted);break;case"video_start":case"ad_start":case"ad_play":case"playing":case"play":this.paused=!1;break;case"end":this.ended=!0;break;case"ad_pause":case"ad_end":case"video_end":case"pause":this.paused=!0;break;case"error":this.error={code:ee.code,title:ee.title,message:ee.message};break;case"rebuffer":this.rebuffering=DM.parseBool(ee.rebuffering);break;case"qualitiesavailable":this.qualities=ee.qualities;break;case"qualitychange":this.quality=ee.quality;break;case"subtitlesavailable":this.subtitles=ee.subtitles;break;case"subtitlechange":this.subtitle=ee.subtitle;break;case"videochange":this.video={videoId:ee.videoId,title:ee.title};break;case"ad_companions":this.companionAds=ee.companionAds}this._dispatch(ee)},addEventListener:function(ee,be,ue){"on"+ee in this&&this.attachEvent?this.attachEvent("on"+ee,be,ue):(ee in this.EVENT_HANDLERS||(this.EVENT_HANDLERS[ee]=[]),this.EVENT_HANDLERS[ee].push(be))}});